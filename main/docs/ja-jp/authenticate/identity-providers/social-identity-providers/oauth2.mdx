---
og:description: Learn how to add any OAuth2 provider using Auth0 Custom Social Connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 汎用のOAuth2認可サーバーにアプリを接続する
og:url: https://auth0.com/docs/
permalink: oauth2
title: 汎用のOAuth2認可サーバーにアプリを接続する
twitter:description: Learn how to add any OAuth2 provider using Auth0 Custom Social
  Connections.
twitter:title: 汎用のOAuth2認可サーバーにアプリを接続する
---

最も一般的な[IDプロバイダー（IdP）](/connections)は、[Auth0 Dashboard](%24%7Bmanage_url%7D)や[Auth0 Marketplace](https://marketplace.auth0.com/features/social-connections)から利用できます。ただし、Auth0 Dashboardでは、任意のOAuth 2.0プロバイダーを**カスタムソーシャル接続**として追加することもできます。

1. Dashboardから、[［Authentication（認証）］>［Social（ソーシャル）］](%24%7Bmanage_url%7D/#/connections/social)に移動します。
2. **［Create Connection（接続を作成）］**を選択し、リストの下部に移動してから**［Create Custom（カスタムを作成）］**を選択します。

表示されるフォームには、カスタム接続の構成に使用しなければならないフィールドがいくつかあります。

* **Connection Name（接続名）**：作成している接続の論理識別子です。この名前は変更できません。先頭と末尾が英数字でなければなりません。英数字とダッシュ以外は使用できません。
* **Authorization URL（認可URL）**：URLユーザーがログインのためにリダイレクトされるURLです。
* **Token URL（トークンURL）**：URL受け取った認可コードをアクセストークンとIDトークン（要求された場合）に交換するために使用されます。
* **Scope（スコープ）**：認可要求と一緒に送信する`scope`パラメーターです。複数のスコープはスペースで区切ります。
* **Separate scopes using a space（スコープをスペースで区切る）**：`connection_scope`パラメーターが[IdPのAPI呼び出し](/calling-an-external-idp-api)に含まれる場合に、スコープの区切り方を決めるトグルです。デフォルトでは、スコープはカンマで区切られます。このトグルを有効にすると、スコープがスペースで区切られます。詳細については、「[IDプロバイダーのAPI呼び出しにスコープ/許可を追加する](/adding-scopes-for-an-external-idp)」をお読みください。
* **Client ID（クライアントID）**：アプリケーションとしてAuth0を使う場合のクライアントIDで、認可の要求や認可コードの交換に使用されます。クライアントIDを取得するには、IDプロバイダーに登録する必要があります。
* **Client Secret（クライアントシークレット）**：アプリケーションとしてAuth0をを使う場合のクライアントシークレットで、認可コードの交換に使用されます。クライアントシークレットを取得するには、IDプロバイダーに登録する必要があります。
* **Fetch User Profile Script（ユーザープロファイルの取得スクリプト）**：提供されたアクセストークンでユーザー情報URLを呼び出すためのNode.jsスクリプトです。このスクリプトの詳細については、「[ユーザープロファイルの取得スクリプト](#fetch-user-profile-script)」を参照してください。



カスタム接続を作成すると、**［Application（アプリケーション）］**ビューが表示され、その接続がAuth0の[レート制限ポリシー](/support/policies/rate-limit-policy)の対象となります。ここでは、接続を表示したいアプリケーションを有効または無効にすることができます。

## 認証フローを更新する

作成された接続にはデフォルトで、認可コードフローのOAuth 2.0付与タイプが割り当てられます。クライアントシークレットを保管できない公開アプリケーション（シングルページアプリケーションやネイティブアプリケーションなど）がある場合には、Management APIを使って接続を更新し、[PKCEを使用した認可コードフロー](/login/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce)が使えるようにすることができます。認可フローの詳細については、「[どのOAuth 2.0フローを使用するべきですか？](/login/flows/which-oauth-2-0-flow-should-i-use)

1. [`/get-connections-by-id`](https://auth0.com/docs/api/management/v2/connections/get-connections-by-id)エンドポイントに対して`GET`要求を行います。応答は以下のようになります。
2. `options`オブジェクト全体をコピーします。
3. `options`オブジェクトを使って[`PATCH`](https://auth0.com/docs/api/management/v2/connections/patch-connections-by-id)要求を行い、`"pkce_enabled":``true`を追加します。



## ユーザープロファイルの取得スクリプト

ユーザーがOAuth2プロバイダーを使ってログインすると、ユーザープロファイルの取得スクリプトが呼び出されます。Auth0はこのスクリプトを実行して、OAuth2プロバイダーのAPIを呼び出し、ユーザープロファイルを取得します。



返されたプロファイルに`user_id`プロパティは必須です。`email`プロパティは任意ですが、強く推奨されます。返される可能性のある属性については、「[ユーザープロファイルのルート属性](/users/user-profiles/root-attributes/update-root-attributes-for-users)」を参照してください。

プロバイダーから返されるプロファイルの内容には、フィルタリング、追加や削除を実行することができます。ただし、このスクリプトはできるだけシンプルに保つことをお勧めします。ユーザー情報のより高度な操作は、[ルール](/rules)を使って実行することができます。ルールを使用する利点の1つは、任意の接続に適用できることです。

## カスタム接続を使用してログインする

カスタム接続でのユーザーログインには、Auth0の標準的なメカニズムであれば何でも使用することができます。直接リンクは以下のようになります。



## アイコンと表示名を変更する

IDプロバイダーのログインボタンにアイコンを追加するには、`options`オブジェクトの`icon_url`プロパティ、ログインボタンのテキストを変更するには`display_name`プロパティを[Management API](/api/management/v2#!/Connections/patch_connections_by_id)経由で使用します。





## プロバイダー固有のパラメータを渡す

OAuth 2.0プロバイダーの認可エンドポイントには、プロバイダー固有のパラメーターを渡すことができます。パラメーターは静的でも動的でも構いません。

### 静的パラメーターを渡す

静的パラメーター（すべての認可要求で送信されるパラメーター）を渡すには、[Management API](/api/management/v2#!/Connections/patch_connections_by_id)を使ってOAuth 2.0接続を構成した場合、`option`の`authParams`要素を使用することができます。以下の呼び出しは、すべての認可要求について、`custom_param`の静的パラメーターを`custom.param.value`に設定します。



### 動的パラメーターを渡す

特定の状況で、OAuth 2.0 IDプロバイダーに動的な値を渡したいことがあります。この場合には、`options`の`authParamsMap`要素を使って、[Auth0](/api/authentication#social)の[`/authorize`エンドポイント](/api/authentication#social)が受け入れる既存の追加パラメーターの1つと、IDプロバイダーが受け入れるパラメーターのマッピングを指定することができます。

上の例で、`custom_param`パラメーターを認可エンドポイントに渡したい場合に、Auth0の`/authorize`エンドポイント呼び出しでパラメーターの実際の値を指定したいとします。

この場合には、`/authorize`エンドポイントが受け入れる既存の追加パラメーターの1つ（`access_type`など）を使って、それを`custom_param`パラメーターにマッピングすることができます。



これで、`/authorize`エンドポイントを呼び出す際に`access_type`パラメーターにアクセスタイプを渡すことができ、その値が`custom_param`パラメーターで認可エンドポイントに渡されます。

## 追加のヘッダーを渡す

場合によっては、OAuth 2.0プロバイダーのトークンエンドポイントに追加のヘッダーを渡す必要があります。追加のヘッダーを構成するには、接続の設定を開いて、**［Custom Headers（カスタムヘッダー）］**フィールドに、カスタムヘッダーがキーと値のペアとして含まれるJSONオブジェクトを指定します。



たとえば、IDプロバイダーに対して、`Authorization`ヘッダーで[Basic認証](https://en.wikipedia.org/wiki/Basic_access_authentication)の資格情報を渡す必要があるとします。このシナリオでは、**［Custom Headers（カスタムヘッダー）］**フィールドに以下のJSONオブジェクトを指定することができます。



ここで、`[your credentials]`は、IDプロバイダーに送信する実際の資格情報となります。