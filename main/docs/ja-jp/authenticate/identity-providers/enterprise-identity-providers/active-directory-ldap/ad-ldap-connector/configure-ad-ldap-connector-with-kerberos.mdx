---
og:description: Describes how to configure AD/LDAP Connector for federating with Kerberos
  authentication.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: KerberosでAD/LDAPコネクターの認証を構成する
og:url: https://auth0.com/docs/
permalink: configure-ad-ldap-connector-with-kerberos
title: KerberosでAD/LDAPコネクターの認証を構成する
twitter:description: Describes how to configure AD/LDAP Connector for federating with
  Kerberos authentication.
twitter:title: KerberosでAD/LDAPコネクターの認証を構成する
---

You can federate with Active Directory through the AD/LDAP Connector if you use Classic Login. The AD/LDAP Connector enables your users to authenticate when they are on a domain-joined machine within the corporate network.

## Active Directoryを設定

1. Go to [Auth0 Dashboard \> Authentication \> Enterprise \> Active Directory/LDAP](https://manage.auth0.com/#/connections/enterprise/ad), and select the connection you want to configure.
2. Enable the **Use Windows Integrated Auth (Kerberos)** switch.

### Kerberosの自動検出範囲

Kerberos認証が有効な場合、ADコネクターが稼働しているサーバーのIPアドレスは、ネットワークIPアドレス範囲に明示的に追加されます。つまり、ユーザーの要求がADコネクターのものと同じIPアドレスから送られてきた場合は、Kerberos認証が試行されます。

1. Configure the **IP Ranges**. Use [CIDR-notation](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing). These should be ranges that are visible by Auth0. When Auth0 is running in the cloud, it won't be able to see your user's internal IP address. In that case you'd configure the public facing/WAN IP address(es) of your company.
2. We recommend restarting the Windows Service that hosts the AD Connector every time this setting is changed. This way, changes will take effect immediately.

## 認証フロー

Depending on the users' location, the authentication flow will be different when IP ranges are set. Using Fabrikam as an example, since it uses the SaaS version of Auth0, they configured their Public IP Address (`24.12.34.56/32`) in the connection. Users connecting from within the building will all originate from `24.12.34.56` (as configured on the connection). When they authenticate, the users can follow the AD/LDAP native flow and have a seamless <Tooltip tip="Single Sign-On (SSO): Service that, after a user logs into one applicaton, automatically logs that user in to other applications." cta="View Glossary" href="/docs/glossary?term=SSO">SSO</Tooltip> experience.

For this to work, the network must allow the users to connect to the AD/LDAP Connector on the port configured in the `config.json` file. In highly available deployments of the Connector, the address users will be connecting to is the network load balancer in front of all connectors instances.

<Frame>
  ![Configure AD/LDAP Connector Authentication with Kerberos Flow Diagram](/images/cdy7uua7fh8z/1EUZhFx2w5FjDeIoMySERC/fc50869b131faf3257cfe429c96f68d1/2023-09-22_14-28-30.png)
</Frame>

To learn more, read [Deploy AD/LDAP Connectors for High Availability Environments.](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-high-availability)

一方、ユーザーが企業ネットワークを使用していない（顧客先にいる、VPNを使わないリモートワークなど）場合は、AD/LDAPコネクターに直接アクセスすることはできません。ユーザーはユーザー名/パスワードを入力する必要があり、Auth0はAD/LDAPコネクターを使ってこれらの資格情報を検証します（今度は、Active Directoryを使用してこれらの資格情報を検証します）。

<Frame>
  ![Configure AD/LDAP Connector Authentication with Kerberos Credentials Flow Diagram](/images/cdy7uua7fh8z/7xo1cIdF6GmSowlVB8kjQn/4b55f555977742af3f3df94c5b3a0a9b/2023-09-22_14-29-00.png)
</Frame>

## Lockによる自動ログイン

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">
  Detecting IP ranges in an AD/LDAP connection and using those ranges with Lock to allow integrated Windows Authentication is a feature that works in Lock 10, but can only be used in Lock 11 in Universal Login scenarios. This feature is disabled in Lock 11 when Lock 11 is used in Embedded Login scenarios.
</Callout>

When an application is using Lock 10 or 11 within the Login Page hosted by Auth0 (typically used for <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip>/WS-Federation protocols and Single Sign-on (SSO) Integrations), there will be a button which allows users to authenticate using "Windows Authentication".

（エンドユーザーのIPアドレスに基づいて）Kerberosを使用できる場合は、ユーザーの自動サインインが必要になることもあります。Kerberosを使用できる場合にユーザーを自動的にサインインするために、以下の変更をAuth0のログインページに追加することができます。

```html lines expandable
<script src="https://cdn.auth0.com/js/lock/11.x.x/lock.min.js"></script>
<script src="https://cdn.auth0.com/js/auth0/9.x/auth0.min.js"></script>
<script src="https://cdn.auth0.com/js/polyfills/1.0/object-assign.min.js"></script>

<script>
  var config = JSON.parse(decodeURIComponent(escape(window.atob('@@config@@'))));

  var lock = new Auth0Lock(config.clientID, config.auth0Domain, {
      //...additional configuration
  });

  function handleError(err) {
    // add proper error handling
    console.log(err);
  };

  var params = Object.assign({
      scope: config.internalOptions.scope,
      _csrf: config.internalOptions._csrf,
      state: config.internalOptions.state,
    },
    {
      /* additional configuration needed for use of custom domains 
      overrides: {
        __tenant: config.auth0Tenant,
        __token_issuer: '{yourCustomDomain}'
      }, */
      domain: config.auth0Domain,
      clientID: config.clientID,
      redirectUri: config.callbackURL,
      responseType: 'code'
    });

  var webAuth = new auth0.WebAuth(params);

  /*
   * Verify if Kerberos is possible, if it is, try to authenticate the user.
   *
   * the response from getSSOData will only have a connection and strategy if 
   * the IP address is within the Kerberos range in the connection's settings
   */
  webAuth.client.getSSOData(true, function(err, data) {
    if (err) handleError(err);

    if (data.connection && data.strategy === 'ad') {
      webAuth.authorize({connection: data.connection}, function(err) {
        if (err) handleError(err);
      });
    } else {
      lock.show();
    }
  });
</script>
```

## ランタイム時にKerberosをバイパスする

ユーザーが接続の設定で構成された範囲内のIPアドレスからログインしていても、`rememberLastLogin: false`を`lock.show()`に渡すことで、Kerberosを使用しないようにすることができます。

```javascript lines
function useKerberos() {
      // return true to use Kerberos, false to bypass
    };
    
    lock.show({rememberLastLogin: useKerberos()});
```

## Kerberos要求ログを有効にする

1. To enable verbose logging of Kerberos requests, add a system level environment variable `DEBUG=kerberos-server`.
2. Restart the Connector.
3. Log in again and check the logs for more information.

## Kerberosに対するFirefoxのサポート

By default, [Firefox](https://www.mozilla.org/firefox) [rejects all "negotiate" requests required to authenticate users with Kerberos](https://developer.mozilla.org/en-US/docs/Mozilla/Integrated_authentication). If you wish to use Firefox with Kerberos, you need to AllowList the server where the connector is installed.

1. Open a Firefox tab and type `about:config` in the address bar.
2. Dismiss any warning message, and in the search box type `negotiate`.
3. Locate the `network.negotiate-auth.trusted-uris` item and double click to change its value.
4. Type the domain name of the server where the connector is installed. If you have multiple instances of the connector behind a load balancer, add the dns name of the balancer.
   Kerberosに対するHTTPSのサポート https://myotherdomain.com`.
5. Click **Ok**. You don't need to restart the server for the changes to take effect.

## Kerberos認証はHTTP（HTTPSでなく）で行うことができます。Microsoft Office 365やその他の最新製品は、HTTPに対応していないことがあります。

この制限を解決するには、次のようにします。

To resolve this limitation:

1. Set up a reverse proxy and expose the AD/LDAP Connector on an HTTPS domain. You can use the `SERVER_URL` (Front Facing URL) parameter to publish the public location where the AD/LDAP Connector will be listening to incoming requests.
2. Map the `SERVER_URL` in the reverse proxy to all internal instances of the deployed connectors.