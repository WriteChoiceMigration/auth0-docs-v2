---
og:description: Learn how to connect your app to Google Workspace using an enterprise
  connection.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Google Workspaceへのアプリ接続
og:url: https://auth0.com/docs/
permalink: google-apps
title: Google Workspaceへのアプリ接続
twitter:description: Learn how to connect your app to Google Workspace using an enterprise
  connection.
twitter:title: Google Workspaceへのアプリ接続
---



## 前提条件

開始する前に：

* [Auth0にアプリケーションを登録します](/get-started/create-apps)。

* 適切な**［Application Type（アプリケーションタイプ）］**を選択します。
* **`${account.callback}`**の**［Allowed Callback URL（許可されているコールバックURL）］**を追加します。
* アプリケーションの[［Grant Types（付与タイプ）］](/applications/update-grant-types)に適切なフローが必ず含まれていることを確認してください。

## ステップ

アプリケーションをGoogle Workspaceに接続するには、以下を行う必要があります：

1. [Googleでアプリを設定する](#set-up-your-app-in-google)
2. [Auth0でエンタープライズ接続を作成する](#create-an-enterprise-connection-in-auth0)
3. [Auth0アプリケーションでエンタープライズ接続を有効にする](#enable-the-enterprise-connection-for-your-auth0-application)
4. [接続のテスト](#test-the-connection)



## Googleでアプリを設定する

Google Workspaceを使用してユーザーがログインできるようにするには、Google開発者コンソールでアプリケーションを登録する必要があります。



### 新規アプリケーションを登録する

Googleに新規アプリケーションを登録する方法については、Googleの[OAuth 2.0の設定](https://support.google.com/googleapi/answer/6158849)に関する文書をご覧ください。このプロセスでGoogleは、ご利用のアプリケーション用の**クライアントID**と**クライアントシークレット**を作成しますので、それをメモしておきます。

アプリの設定時、これらの設定を必ず使用してください：

* **OAuth同意画面**で、**［Authorized domains（承認されたドメイン）］**の下に、`auth0.com`を追加します。
* アプリケーションの種類を選択するよう指示された場合は、 **［Webアプリケーション］**を選び、以下のパラメーターを設定します：



### Admin SDK Serviceを有効化する

Google Workspaceのエンタープライズドメインに接続する予定であれば、 **Admin SDK Service**を有効にする必要があります。方法については、Googleの[APIの有効化と無効化](https://support.google.com/googleapi/answer/6158841)に関する文書をご覧ください。

## Auth0でエンタープライズ接続を作成する



次に、Auth0でGoogle Workspaceのエンタープライズ接続を作成・構成する必要があります。Google開発者コンソールでご利用のを設定した際に作成された**クライアントID**と**クライアントシークレット**があることを確認してください。

1. [［Auth0 Dashboard］>［Authentication（認証）］>［Enterprise（エンタープライズ）］](%24%7Bmanage_url%7D/#/connections/enterprise)に移動し、**Google Workspace**の［`+`］記号をクリックします。
2. 接続の詳細を入力し、 **［Create（作成）］**をクリックします。
3. Google Workspaceを設定するための適切な管理者権限をお持ちの場合は、GoogleのAdmin APIを使って**［Continue（続行）］**をクリックします。管理者権限を持っていない場合には、提示されたURLを管理者に提供して必要な設定を調整してもらってください。
4. **［Login Experience（ログインエクスペリエンス）］**タブでこの接続でのユーザーログインの方法を設定できます。

## 接続を使用する

### Auth0アプリケーションでエンタープライズ接続を有効化する

新たなAD接続を使うにはまずAuth0アプリケーションの[接続を有効](/connections/enable-enterprise-connections)にする必要があります。

### 接続をテストする

これで[接続をテスト](/connections/test-enterprise-connections)する準備が整いました。

### Googleにリフレッシュトークンを要求する

Googleは常に、ユーザープロファイルに保存されているアクセストークンを返します。`access_type=offline&approval_prompt=force`を認証要求に追加すると、Auth0はこれらのパラメーターをGoogleに転送します。その後Googleはやはりユーザープロファイルに保存されているリフレッシュトークンを返します。

### GoogleからのIDプロバイダートークンの使用

Auth0がデフォルトで取得するユーザーやグループ詳細以外に追加で取得した場合は、Googleから返されたアクセストークンを使ってGoogleのAPIを呼び出せます。これらのトークンにセキュアにアクセスするには、[IDプロバイダーのアクセストークン](/security/tokens/access-tokens/identity-provider-access-tokens)に示すガイドラインに従ってください。

Google Workspaceの場合、Auth0は個別`ユーザー`オブジェクトとワークスペース管理者の`接続`オブジェクト上にアクセストークンとリフレッシュトークンを保存します。

GoogleのDirectory Admin APIでユーザーの拡張されたグループプロパティを取得するには、[Auth0 Dashboard](https://manage.auth0.com/#/connections/enterprise)でGoolgle Workspace接続まで移動し、 **［Groups（グループ）］**の拡張属性を有効にします。次に**［Setup（設定）］ **タブを使って管理者の合意を完了します。

これらのステップを完了後、Auth0 Management APIの[Get a connection（接続取得）](/api/management/v2/connections/get-connections-by-id)エンドポイントを使って`接続`オブジェクトの管理者アクセストークンを取得します。その後、 このトークンを使ってGoogleの[Manage Groups](https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups#get_all_member_groups)エンドポイントを呼び出すことができます。

**呼び出し例**：



### Actionsで認証を検証する

`ログイン後の`[Actions](/signup-and-login-triggers/login-trigger)を使って、認証イベントがGoogle組織の一員である正規ユーザーからのものかどうかを検証できます。その結果、組織の一員でなくなったユーザーがアプリケーションに不正アクセスすることを防ぐことで、脆弱性の可能性を最小限に抑えることができます。

正規のGoogle認証であることを検証するには、`ログイン後の`Actionsを使って、ユーザーに関連付けられた`idp_tenant_domain`クレームを検証し、その値がそのユーザーに対して予想される組織と合致するかどうか確認します。

`idp_tenant_domain`を検証できるのは、以下の接続タイプの認証を使うユーザーに限ります：

* Googleソーシャル
* Google Workspace
* Google OIDC

#### **例**

以下に、`idp_tenant_domain`を`ログイン後`Actionsを使って検証する方法を示します。



### 既存接続を再承認する

Google Workspace管理者が削除された場合、ログインの失敗を回避するには、その管理者が設定・認証したGoogle Workspaceエンタープライズ接続を新たなGoogle Workspace管理者が再承認する必要があります。そのためには、新たな管理者がGoogle Workspaceエンタープライズ接続の**［Setup（セットアップ）］**タブにあるリンクを使います。

## 次の手順

* [Auth0のライブラリーを使ってAuth0を統合する](/libraries)
* [Authentication APIを使ってAuth0を統合する](/api/authentication)
* [認証フローについての詳細を読む](/login/flows)
* [追加のパラメーターをIDプロバイダーに渡す](/pass-parameters-to-idps)
* [アクセス許可のためにユーザーを再度プロンプトする](/reprompt-permissions)