---
og:description: Learn how to connect your app to Microsoft Azure Active Directory
  using an enterprise connection.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Microsoft Entra IDにアプリを接続する
og:url: https://auth0.com/docs/
permalink: v2
title: Microsoft Entra IDにアプリを接続する
twitter:description: Learn how to connect your app to Microsoft Azure Active Directory
  using an enterprise connection.
twitter:title: Microsoft Entra IDにアプリを接続する
---

Microsoft Entra IDと統合すると、ユーザーは以下を行えるようになります。

* 自分や自社が管理するMicrosoft Entra IDにあるアプリケーションを、自社内部から使用する
* 他社のMicrosoft Entra IDからアプリケーションを使用する（外部ディレクトリは別の接続として構成することをお勧めします）。



## 手順

アプリケーションをMicrosoft Entra IDに接続するには、以下を行う必要があります。

1. [アプリをMicrosoft Entra IDに登録する](#register-your-app-with-azure-ad)
2. [Auth0でエンタープライズ接続を作成する](#create-an-enterprise-connection-in-auth0)
3. [Auth0アプリケーションでエンタープライズ接続を有効にする](#enable-the-enterprise-connection-for-your-auth0-application)
4. [接続をテストする](#test-the-connection)

### アプリをMicrosoft Entra IDに登録する

アプリをMicrosoft Entra IDに登録するには、Microsoftドキュメントの「[クイックスタート：Microsoft IDプラットフォームにアプリケーションを登録する](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)」を参照してください。



登録の際に次の設定を構成します。





このプロセス中、Microsoftはアプリケーション用の**アプリケーション（クライアント）ID**を生成します。このIDはアプリの**［Overview（概要）］**画面に表示されます。**これらの値をメモします。**

#### クライアントシークレットを作成する

クライアントシークレットを作成するには、Microsoftドキュメントの「[クイックスタート：Web API にアクセスするようにクライアントアプリケーションを構成する」の「資格情報をWebアプリケーションに追加する」](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app#add-credentials)を参照してください。

生成したら、**これらの値をメモします**。



#### アクセス許可を追加する

アクセス許可を追加するには、Microsoftドキュメントの「[クイックスタート：Web APIにアクセスするようにクライアントアプリケーションを構成する」の「Web APIにアクセスするためのアクセス許可を追加する」](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-configure-app-access-web-apis#add-permissions-to-access-web-apis)を参照してください。

アクセス許可を設定する際には、以下を考慮してください。

拡張された属性（**Extended Profile**や**Security Groups**など）を有効にする場合には、その後、**Microsoft Graph API**で以下の権限を構成する必要があります。



### Auth0でエンタープライズ接続を作成する

Auth0でMicrosoft Entra IDエンタープライズ接続を作成して構成します。Microsoft Azureポータルでアプリをセットアップする際に、**［Application (client) ID（アプリケーション（クライアント）ID）］**と**［Client secret（クライアントシークレット）］**が生成されていることを確認してください。

1. [［Auth0 Dashboard］>［Authentication（認証）］>［Enterprise（エンタープライズ）］](%24%7Bmanage_url%7D/#/connections/enterprise)に移動し、**［Microsoft Entra ID］**を見つけ、その［`+`］を選択します。
2. 接続の詳細を入力し、**［Create（作成）］**を選択します。
3. **［Provisioning（プロビジョニング）］**ビューでユーザープロファイルがAuth0で作成および更新される方法を構成することができます。
4. **［Login Experience（ログインエクスペリエンス）］**ビューでこの接続でのユーザーログインの方法を構成することができます。
5. 適切なMicrosoft Entra ID管理者権限を持っていて、ユーザーログインに必要なアプリケーションへの同意ができる場合には、**［Continue（続行）］**をクリックします。[Microsoft Entra IDアカウントにログイン](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent#requesting-consent-for-an-entire-tenant)して同意することが求められます。管理者権限を持っていない場合には、提示されたURLを管理者に提供して同意してもらってください。

### Auth0アプリケーションでエンタープライズ接続を有効化

新たなMicrosoft Entra IDエンタープライズ接続を使用するにはまず、Auth0アプリケーションの[接続を有効](/connections/enable-enterprise-connections)にする必要があります。

### 接続のテスト

これで[接続をテスト](/connections/test-enterprise-connections)する準備が整いました。

## トラブルシューティング

以下は問題を解決するためのヒントの一部です。

**アプリケーションをMicrosoft Entra IDに登録しましたが、Microsoft Entra IDで［アプリの登録］に戻ったらアプリケーションが見あたりません。**

アプリを間違って別のMicrosoft Entra IDディレクトリに登録した（または、アプリを登録する前にMicrosoft Entra IDディレクトリを作成しなかった）可能性があります。一番簡単なのは、アプリをMicrosoft Entra IDに登録し直すことです。アプリの登録時に正しいディレクトリを使用していることを確認します。Microsoft Entra IDディレクトリを作成する必要がある場合には、Microsoftドキュメント「[クイックスタート：Microsoft Entra IDで新しいテナントを作成する」の「組織の新しいテナントを作成する」](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-access-create-new-tenant#create-a-new-tenant-for-your-organization)に従ってください。

**「Access cannot be granted to this service because the service listing is not properly configured by the publisher.（サービスリスティングがパブリッシャーによって適切に構成されていないため、このサービスへのアクセスは付与できません。）」というエラーメッセージを受け取りました。**

この問題を解決するには、登録したEntra IDアプリで**［Supported account types（サポートされているアカウントの種類）］**を変更してみてください。Microsoft Entra IDアプリの認証設定で、適切なマルチテナントオプションが選択されていることを確認します。次のようなマルチテナントオプションがあります：**任意の組織ディレクトリ内のアカウント（任意のMicrosoft Entra IDディレクトリ - マルチテナント）**

**ユーザーがログインしようとすると、「invalid_request; failed to obtain access token（アクセストークンの取得失敗）」というメッセージを受け取ります。**

このエラーが起きる理由として最も可能性が高いのは、Microsoft Entra IDの**クライアントシークレット**が無効か期限切れであることです。この問題を解決するには、Microsoft Entra IDでアプリ用に新しい**クライアントシークレット**を生成し、Auth0で構成されたエンタープライズ接続で**クライアントシークレット**を更新します。

## Microsoft Entra IDで署名鍵をロールオーバーする

署名鍵は、IDプロバイダーが自ら発行した認証トークンに署名するために使用されます。そして、コンシューマーアプリケーション（この場合はAuth0）が生成されたトークンの真正性を検証するのに使用されます。

セキュリティ上の理由により、Microsoft Entra IDの署名鍵は[定期的にロールオーバー](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-signing-key-rollover)されます。この場合、**何も対処する必要はありません**。Auth0は自動的に新しい鍵を使用します。

## 未検証ラベルを削除する

カスタムドメインを使用している場合には、Microsoft Entra IDログインのアプリケーション同意プロンプトで、ドメインに「unverified（未検証）」のラベルが表示されることがあります。未検証ラベルを削除するには以下のMicrosoftドキュメントを参照してください。

1. Auth0アプリケーションのドメインを検証する[Microsoft Entra IDポータルを使用してカスタムドメイン名を追加する](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/add-custom-domain#add-your-custom-domain-name-to-azure-ad)
2. 検証したドメインをAuth0アプリケーションに割り当てる[アプリの発行元ドメインを構成する](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-configure-publisher-domain#configure-publisher-domain-using-the-azure-portal)

## 次の手順

* [Auth0のライブラリーを使ってAuth0を統合する](/libraries)
* [Authentication APIを使ってAuth0を統合する](/api/authentication)
* [認証フローについての詳細を読む](/login/flows)
* [追加のパラメーターをIDプロバイダーに渡す](/pass-parameters-to-idps)
* [アクセス許可のためにユーザーを再度プロンプトする](/reprompt-permissions)