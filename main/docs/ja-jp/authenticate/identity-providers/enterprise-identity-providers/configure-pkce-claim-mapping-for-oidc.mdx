---
og:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: OIDC接続のPKCEとクレームのマッピングを構成する
og:url: https://auth0.com/docs/
permalink: configure-pkce-claim-mapping-for-oidc
title: OIDC接続のPKCEとクレームのマッピングを構成する
twitter:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
twitter:title: OIDC接続のPKCEとクレームのマッピングを構成する
---

IDプロバイダーに[OpenID Connect](/oidc)または[Okta Workforce](/okta)を使用しているエンタープライズ接続では、Proof Key for Code Exchange（PKCE）や、属性・トークンのマッピングをサポートできます。

## OIDC接続のPKCEを構成する

OpenID Connect・Okta Workforce接続は、自動的にPKCEをサポートするよう構成されます。

OIDCのIDプロバイダー（IdP）がOIDC Discoveryメタデータを介してPKCEをサポートしている場合、Auth0のデフォルト設定では、使用可能なアルゴリズムのうち最強のものが使用されます。OIDC Discoveryメタデータの詳細については、[OpenIDのドキュメント](https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata)をご確認ください。

### 接続のPKCE構成を表示する

Auth0 Dashboardでは、特定の接続のPKCE構成を表示できます。

1. **［Authentication（認証）］>［Enterprise（エンタープライズ）］**に移動して、OIDCプロバイダー（OpenID ConnectまたはOkta Workforce）を選択します。
2. **［設定］**タブを選択します。
3. **［General（一般）］**セクションで、**［Connection Profile（接続プロファイル）］**フィールドを見つけてください。



### 対応されているPKCEの構成値

Auth0では、PKCEの構成に以下の値を使用できます。



## OIDC接続のクレームをマッピングする

OpenID ConnectとOkta Workforce接続は、IDプロバイダー（IdP）から受け取ったクレームを自動的にマッピングできます。このマッピングは、Auth0提供のライブラリーテンプレートで、または、独自のテンプレートを直接入力することで構成できます。

### マッピングテンプレートのプロパティ

マッピングテンプレートは、以下のリストにある`options.attribute_map`オブジェクトプロパティをサポートしています。テンプレートは、有効なキー・値のペアを持つJSON形式でなくてはなりません。



### モードのマッピング

`mapping_mode`プロパティは、IdPから受け取るクレームをどのような方法でAuth0のユーザープロファイルにマッピングするかを定義します。`mapping_mode`には、以下の値を使用できます。



#### 予約済みのクレーム

一部のクレームは、Auth0用に予約されているため、ユーザープロファイルの属性キーとして使うことはできません。

`mapping_mode`プロパティを`bind_all`に設定すると、IdPが値を予約済みのクレームにマッピングしようとする場合があります。その接続でのユーザー認証が妨げられることはありませんが、予約済みクレームに関連付けられた値は、Auth0のユーザープロファイルに**マッピングされません**。

`mapping_mode`を`use_map`に設定すれば、受け取る予約済みクレームを有効なクレームにマッピングできます。



予約済みクレームの完全なリストについては、「[カスタムクレームを作成する](/security/tokens/json-web-tokens/create-custom-claims)」をご確認ください。

### UserInfoのスコープ

`userinfo_scope`プロパティは、要求時にAuth0がIdPへ送信するUserInfoエンドポイントのスコープを定義します。

たとえば、UserInfoエンドポイントの要求時に標準のOIDCスコープと`groups`スコープを送信したい場合には、次のようにします。



### Attributes（属性）

`attributes`プロパティは、マッピング情報を含むオブジェクトです。この情報に基づいてAuth0がIdPからのクレームを解釈します。マッピング情報は、キー・値のペアとして入力しなければなりません。

左側のキーは、Auth0のユーザープロファイル属性に対応します。右側の値は、IdPからのクレームで、リテラル値、動的なコンテキストオブジェクト、またはその組み合わせとして表されます。動的コンテキストオブジェクトは、おなじみの`${variable}`形式で作成されたテンプレート式です。



#### リテラル値

リテラル値とは、接続の全ユーザーに対して特定のプロファイル属性にマッピングされる静的な値です。

たとえば、SalesForceのOIDC接続を構成していて、すべてのユーザープロファイルに同じSFDC Community IDを割り当てたい場合は、次のようにします。



#### コンテキストオブジェクト

ユーザープロファイル属性に動的な値をマッピングするには、`context`オブジェクトを使用します。全プロファイルで静的なリテラル値とは対照的に、個々のプロファイルに一意の値が保管できるようになります。

`context`オブジェクトは以下のプロパティをサポートしています。



### 例

#### シンプルなユーザークレームマッピング

この例では、IDトークンからのデータを使用して一般的なユーザークレームをAuth0のユーザープロファイルにマッピングしています。



#### グループクレームマッピング

この例では、受信IdPからグループをAuth0のユーザープロファイルにマッピングしています。



#### リテラル値とコンテキストオブジェクトの組み合わせ

この例では、リテラル値と動的テンプレート式を組み合わせて、複雑な値をAuth0のユーザープロファイル属性にマッピングしています。