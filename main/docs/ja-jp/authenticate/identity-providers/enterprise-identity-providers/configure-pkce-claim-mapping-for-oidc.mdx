---
og:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: OIDC接続のPKCEとクレームのマッピングを構成する
og:url: https://auth0.com/docs/
permalink: configure-pkce-claim-mapping-for-oidc
title: OIDC接続のPKCEとクレームのマッピングを構成する
twitter:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
twitter:title: OIDC接続のPKCEとクレームのマッピングを構成する
---

Enterprise connections using [OpenID Connect](/docs/authenticate/identity-providers/enterprise-identity-providers/oidc) or O[kta Workforce](/docs/authenticate/identity-providers/enterprise-identity-providers/okta) as the <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+provider">identity provider</Tooltip> can support Proof Key for Code Exchange (PKCE), as well as attribute and token mapping.

## OIDC接続のPKCEを構成する

<Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Connect and Okta Workforce connections are automatically configured to support Proof Key for Code Exchange (PKCE).

If your OIDC identity provider (IdP) supports PKCE through OIDC Discovery metadata, Auth0 will use the strongest algorithm available by default. For more information on OIDC Discovery metadata, review [OpenID’s documentation](https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata).

### 接続のPKCE構成を表示する

You can view the PKCE configuration for a specific connection through the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>:

1. Navigate to **Authentication > Enterprise** and choose your OIDC provider (either OpenID Connect or Okta Workforce).
2. Select the **Settings** tab.
3. In the **General** section, locate the **Connection Profile** field.

<Tabs><Tab title="Auth0 Dashboard">

You can manage the PKCE configuration for a connection through the Auth0 Dashboard:

1. Navigate to [**Dashboard > Authenticate >Enterprise**](https://manage.auth0.com/#/connections/enterprise) and choose your OIDC provider (either OpenID Connect or Okta Workforce).
2. Select the **Settings** tab and locate the **Connection Profile** field.
3. Set the `pkce` property to one of the [supported values](#supported-pkce-configuration-values) listed below.
4. Select **Save**.

</Tab><Tab title="Management API">

#### Use discovery endpoint

```bash lines
curl --request POST \
--url 'https://{yourDomain}/api/v2/connections' \
--header 'authorization: Bearer MGMT_API_ACCESS_TOKEN' \
--data '{ 
  "strategy": "oidc", 
   "name": "CONNECTION_NAME", 
   "options": { 
     "type": "back_channel", 
     "discovery_url": "https://IDP_DOMAIN/.well-known/openid-configuration", 
     "client_id" : "IDP_CLIENT_ID", 
     "client_secret" : "IDP_CLIENT_SECRET", 
     "scopes": "openid profile", 
     "connection_settings": { "pkce": "auto" }
               } 
          }'
```






#### Without discovery endpoint

Without a `discovery_url` the `oidc_metadata` object needs to be populated manually with the necessary fields.

```bash lines
curl --request POST \
  --url 'https://{yourDomain}/api/v2/connections' \
  --header 'authorization: Bearer MGMT_API_ACCESS_TOKEN' \
  --data '{
    "strategy": "oidc",
    "name": "CONNECTION_NAME",
    "options": {
      "type": "back_channel",
      "client_id": "IDP_CLIENT_ID",
      "client_secret": "IDP_CLIENT_SECRET",
      "connection_settings": { "pkce": "auto" },
      "issuer": "https://IDP_DOMAIN",
      "authorization_endpoint": "https://IDP_DOMAIN/authorize",
      "jwks_uri": "https://IDP_DOMAIN/.well-known/jwks.json",
      "scopes": "openid profile",
      "oidc_metadata": {
        "issuer": "https://IDP_DOMAIN",
        "authorization_endpoint": "https://IDP_DOMAIN/authorize",
        "jwks_uri": "https://IDP_DOMAIN/.well-known/jwks.json",
        "token_endpoint": "https://IDP_DOMAIN/token/refresh",
        "code_challenge_methods_supported": ["plain", "S256"]
      }
    }
  }'
```






</Tab></Tabs>

### 対応されているPKCEの構成値

Auth0では、PKCEの構成に以下の値を使用できます。

<table class="table"><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auto</code></td>
<td>Default value. Uses the strongest algorithm available.</td>
</tr>
<tr>
<td><code>s256</code></td>
<td>Uses the SHA-256 algorithm. Auth0 does not currently support RS512 tokens.</td>
</tr>
<tr>
<td><code>plain</code></td>
<td>Uses plaintext as described in the <a href="https://www.rfc-editor.org/rfc/rfc7636#section-4.2" title="Proof Key for Code Exchange by OAuth Public Clients - Code Challenge">PKCE specification</a>.</td>
</tr>
<tr>
<td><code>disabled</code></td>
<td>Disables support for PKCE.</td>
</tr>
</tbody>
</table>

<Warning>

Setting the `pkce` property to a value other than `auto`may prevent a connection from working properly if the selected value is not supported by the identity provider.

Do not set the property to `disabled` except when troubleshooting authentication issues.

</Warning>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

**Azure AD Limitation**

If you are using an OpenID Connect connection for Azure AD, you must set `pkce` to `s256` as the connection's metadata does not expose the hashing algorithm used. Currently, the [Azure AD Enterprise connection](/docs/authenticate/identity-providers/enterprise-identity-providers/azure-active-directory/v2) does not support PKCE.

</Callout>

## OIDC接続のクレームをマッピングする

OpenID ConnectとOkta Workforce接続は、IDプロバイダー（IdP）から受け取ったクレームを自動的にマッピングできます。このマッピングは、Auth0提供のライブラリーテンプレートで、または、独自のテンプレートを直接入力することで構成できます。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Mapped claims are not automatically added to an Auth0 ID token. To add claims to an ID token, see [Create custom claims](/docs/secure/tokens/json-web-tokens/create-custom-claims#create-custom-claims).

</Callout>

### マッピングテンプレートのプロパティ

マッピングテンプレートは、以下のリストにある`options.attribute_map`オブジェクトプロパティをサポートしています。テンプレートは、有効なキー・値のペアを持つJSON形式でなくてはなりません。

<table class="table"><thead>
<tr>
<th><strong>Property</strong></th>
<th><strong>Required?</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mapping_mode</code></td>
<td>Required</td>
<td>Method used to map incoming claims.</td>
</tr>
<tr>
<td><code>userinfo_scope</code></td>
<td>Optional</td>
<td>Scopes to send to the IdP's Userinfo endpoint.</td>
</tr>
<tr>
<td><code>attributes</code></td>
<td>Required</td>
<td>Object containing mapping details for incoming claims.</td>
</tr>
</tbody>
</table>

### モードのマッピング

予約済みのクレーム

<table class="table"><thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>use_map</code></td>
<td>Uses the provided template to map the data.</td>
</tr>
<tr>
<td><code>bind_all</code></td>
<td>Copies all data elements provided by the IdP.</td>
</tr>
</tbody>
</table>

#### 一部のクレームは、Auth0用に予約されているため、ユーザープロファイルの属性キーとして使うことはできません。

予約済みクレームの完全なリストについては、「[カスタムクレームを作成する](/security/tokens/json-web-tokens/create-custom-claims)」をご確認ください。

UserInfoのスコープ

たとえば、UserInfoエンドポイントの要求時に標準のOIDCスコープと`groups`スコープを送信したい場合には、次のようにします。

```json lines
"attribute_map": {
        "mapping_mode": "use_map",
        "attributes": {
            "amr": "{context.tokenset.amr}", // `amr` is a restricted claim and will not be mapped
            "federated_amr": "{context.tokenset.amr}" // `federated_amr` is not a restricted claim and will be mapped
        }
    }
```






For a complete list of restricted claims, review [Create Custom Claims](/docs/secure/tokens/json-web-tokens/create-custom-claims).

### 左側のキーは、Auth0のユーザープロファイル属性に対応します。右側の値は、IdPからのクレームで、リテラル値、動的なコンテキストオブジェクト、またはその組み合わせとして表されます。動的コンテキストオブジェクトは、おなじみの`${variable}`形式で作成されたテンプレート式です。

リテラル値

リテラル値とは、接続の全ユーザーに対して特定のプロファイル属性にマッピングされる静的な値です。

```json lines
"attribute_map": {
    . . .
    "mapping_mode": "bind_all",
    "userinfo_scope": "openid email profile groups",
    . . .
}
```






### たとえば、SalesForceのOIDC接続を構成していて、すべてのユーザープロファイルに同じSFDC Community IDを割り当てたい場合は、次のようにします。

コンテキストオブジェクト

ユーザープロファイル属性に動的な値をマッピングするには、`context`オブジェクトを使用します。全プロファイルで静的なリテラル値とは対照的に、個々のプロファイルに一意の値が保管できるようになります。

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "name": "${context.tokenset.name}",
        "email": "${context.tokenset.email}",
        "username": "${context.tokenset.preferred_username}"
    }
}
```






#### 例

シンプルなユーザークレームマッピング

この例では、IDトークンからのデータを使用して一般的なユーザークレームをAuth0のユーザープロファイルにマッピングしています。

```json lines
"attribute_map": {
    . . .
    "attributes": {
        …
        "sf_community_id": "3423409219032-32"
    }
}
```






#### グループクレームマッピング

この例では、受信IdPからグループをAuth0のユーザープロファイルにマッピングしています。

The `context` object supports the following properties:

<table class="table"><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context.connection</code></td>
<td>Contains the following properties:<br/><br/><li> <code>id</code>: The connection’s unique identifier (for example, <code>con_4423423423432423</code>).</li><br/><li> <code>strategy</code>: The connection’s strategy (for example, <code>oidc</code>).</li></td>
</tr>
<tr>
<td><code>context.tokenset</code></td>
<td>Contains the following properties:<br/><br/><li> <code>access_token</code>: The entire validated access token sent by the IdP.</li><br/><li><code>&lt;claim name&gt;</code>: Any ID token claim sent by the IdP.</li></td>
</tr>
<tr>
<td><code>context.userinfo</code></td>
<td>Contains the following properties:<br/><br/><li> <code>&lt;claim name&gt;</code>: Any available claim provided by the IdP’s UserInfo endpoint.</li></td>
</tr>
</tbody>
</table>

### この例では、リテラル値と動的テンプレート式を組み合わせて、複雑な値をAuth0のユーザープロファイル属性にマッピングしています。

#### Simple user claim mapping

This example demonstrates how to map common user claims to the Auth0 user profile with data from the <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip>:

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "name": "${context.tokenset.name}",
        "email": "${context.tokenset.email}",
        "username": "${context.tokenset.preferred_username}"
    }
}
```






#### Group claim mapping

This example shows how to map groups to the Auth0 user profile from the incoming IdP:

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "federated_groups": "${context.userinfo.groups}",
        "federated_locale": "${context.userinfo.locale}",
        "federated_zoneinfo": "${context.userinfo.zoneinfo}"
    }
}
```






#### Combining literal values and context objects

This example demonstrates how to combine literal values and dynamic template expressions to map a complex value to an attribute on the Auth0 user profile:

```json lines
"attribute_map":{
    . . .
    "attributes": {
        "alt_id": "user_email|${context.tokenset.email}",
        . . .
    }
}
```