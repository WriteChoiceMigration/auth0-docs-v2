---
og:description: Describes how to test your custom database connections in Auth0 Dashboard.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: カスタムデータベース接続をテストする
og:url: https://auth0.com/docs/
permalink: test-custom-database-connections
title: カスタムデータベース接続をテストする
twitter:description: Describes how to test your custom database connections in Auth0
  Dashboard.
twitter:title: カスタムデータベース接続をテストする
---

Auth0がホストするデータベース構造を使用してユーザーを保存する場合は、同じテナントまたは別のテナントに対してユーザーを認証することで接続をテストできます。

## Auth0へのユーザーをインポートを有効にしてテストする

ユーザーのインポートを有効にすると、ユーザーは外部ユーザーストアからAuth0ユーザーストアに徐々に移行されます。このプロセスでは、ユーザーは初めてログインに成功したときに外部ストアに対して認証されます。以降のログイン試行はすべてAuth0ユーザーストアに対して実行されます。詳細については、「[ユーザーのインポートとエクスポート](/users/import-and-export-users)」の自動移行についてお読みください。

### テストテナントおよびアプリケーションを作成する

1. Auth0 Dashboardを使用して[新しいテナントを作成](/get-started/create-tenants)します。
2. [［Applications（アプリケーション）］>［Applications（アプリケーション）］](%24%7Bmanage_url%7D/#/applications/applications)に移動して、[マシンツーマシン](%24%7Bmanage_url%7D/#/applications/applications/create)アプリケーションを作成します。
3. このアプリケーションに対して、**パスワード**と**クライアント資格情報**付与の両方を有効にします（このテストでは両方の付与を有効にしてください）。
4. アプリケーションを承認するには、[［Applications（アプリケーション）］>［APIs］](%24%7Bmanage_url%7D/#/apis)に移動します。
5. **［Management API］**を選択します。
6. **［Machine-to-Machine Applications（マシンツーマシンアプリケーション）］**タブで、トグルを使用してテストアプリケーションを承認します。
7. ドロップダウンメニューを選択して、次のAuth0 Management APIのスコープを有効にします。

* `read:users`
* `update:users`
* `delete:users`
* `create:users`
* `read:users_app_metadata`
* `update:users_app_metadata`
* `create:users_app_metadata
`

### データベース接続テストを作成する

ダッシュボードでテナントとアプリケーションを作成したら、ソースデータベース接続とターゲットデータベース接続を作成します。

1. [［Authentication（認証）］>［Database（データベース）］](%24%7Bmanage_url%7D/#/connections/database)に移動して、新しいデータベース接続を作成してソースにします。
2. テストソース接続に名前を付け、**［Requires Username（ユーザー名の要求）］**を有効にし、**［Create（作成）］**を選択します。
3. 手順2から同じ構成で、2番目のデータベースをターゲットとして作成します。
4. ターゲットデータベースでは、**［Custom Database（カスタムデータベース）］**ビューに切り替え、**［Use my own database（自分自身のデータベースを使用する）］**のトグルをオンにします。
5. **［Settings（設定）］**ビューに切り替え、**［Import Users to Auth0（Auth0にユーザーをインポート）］**を有効にします。
6. **［Custom Database（カスタムデータベース）］**ビューに切り替え、**［Database settings（データベースの設定）］**を見つけます。手順1で作成したソースデータベースから次の情報を追加します。
7. ターゲットデータベースで、[Login（ログイン）](/docs/authenticate/database-connections/test-custom-db#login)および[Get User（ユーザーの取得）](/docs/authenticate/database-connections/test-custom-db#get-user)のデータベースアクションスクリプトを更新します。データベースアクションスクリプトを使用したベストプラクティスに関する詳細は、「[カスタムデータベース接続とアクションスクリプトのベストプラクティス](/custom-database-connections-scripts)」をお読みください。
8. 各スクリプトで**［Save and Try（保存して試す）］**を選択します。Real-time Webtask Logs機能拡張の`console.log`出力を監視してください。詳細については、「[Real-time Webtask Logs機能拡張](/extensions/real-time-webtask-logs)」をお読みください。
9. **［Try Connection（接続を試す）］**を選択して、接続ライブをテストします。

## ユーザーインポートを有効にせずにテストする

1. [テストテナントおよびアプリケーションを作成する](https://www.auth0.com/docs/authenticate/database-connections/test-custom-db#create-a-test-tenant-and-application)で手順を繰り返します。
2. 1つのテストデータベース接続を作成します。
3. ソース データベース設定の**［Import Users to Auth0（ユーザーをAuth0にインポート）］**が無効になっていることを確認します。ユーザーは、ログイン試行ごとに外部ユーザーストアに対して認証を行います。
4. 次のサンプルですべてのデータベースアクションスクリプトを更新します。

### Get User（ユーザーの取得）スクリプト

[Get User（ユーザーの取得）](/get-user)スクリプトは、ユーザーの現在の状態を判別する実行可能関数を実装します。

**［Import Users to Auth0（ユーザーをAuth0にインポート）］**が有効になっている場合、ユーザーがサインアップしようとすると、Get User（ユーザーの取得）スクリプトが実行され、ユーザーが外部ユーザーストアに既に存在するかどうかが確認されます。

Get User（ユーザーの取得）スクリプトは、ユーザーが次の操作を試みる場合にも実行されます。

* ユーザーのメールアドレスを変更する（[Change Email（メールの変更）](/change-email)スクリプト）
* ログインする（[Login（ログイン）](/login)スクリプト）
* ユーザーのパスワードを変更する（[Change Password（パスワードの変更）](/change-password)スクリプト）

**［Import Users to Auth0（ユーザーをAuth0にインポート）］**が無効になっている場合、ユーザーがサインアップしようとすると、Get Userスクリプトが実行され、ユーザーが外部ユーザーストアに既に存在するかどうかが確認されます。ユーザーが外部ユーザーストアに存在している場合、Create（作成）スクリプトは実行されません。

Get User（ユーザーの取得）スクリプトは、ユーザーが次の操作を試みる場合にも実行されます。

* ユーザーを作成する（[Create（作成）](/create)スクリプト）
* ユーザーのメールアドレスを変更する（[Change Email（メールの変更）](/change-email)スクリプト）
* ユーザーのパスワードを変更する（[Change Password（パスワードの変更）](/change-password)スクリプト）

#### 例



### Login（ログイン）スクリプト

[Login（ログイン）](/login)スクリプトは、ユーザーがログインするときにユーザーを認証する実行可能関数を実装します。ユーザーがターゲットデータベース（Auth0）に存在する場合は、そのレコードを使用して認証します。それ以外の場合は、ソースデータベース（外部）内のレコードを使用してユーザーを認証します。

#### 例



### Create（作成）スクリプト

[Create（作成）スクリプト](/create)は、ユーザーがユニバーサルログインを通じてサインアップしたとき、またはAuth0 DashboardまたはAuth0 Management APIを使用して作成されたときに、外部データベースに対応するユーザーレコードを作成する実行可能関数を実装します。

#### 例



### Delete（削除）スクリプト

[Delete（削除）スクリプト](/delete)は、Auth0 DashboardまたはAuth0 Management APIを使用してユーザーが削除されたときに、同じ操作でAuth0と外部データベースからユーザーを削除する実行可能関数を実装します。

#### 例



### Verify（検証）スクリプト

[Verify（検証）スクリプト](/verify)は、ユーザーがAuth0から送信された検証メール内のリンクをクリックしたときに、外部データベース内のユーザーのメールアドレスの検証ステータスをマークする実行可能関数を実装します。

#### 例



### Change Password（パスワードの変更）スクリプト

[Change Password（パスワードの変更）スクリプト](/change-password)は、Auth0 DashboardまたはAuth0 Management APIからパスワード変更ワークフローが開始されたときに、外部データベース内のユーザーのパスワードを更新する実行可能関数を実装します。

#### 例



### Change Email（メールの変更）スクリプト

[Change Email（メールの変更）スクリプト](/change-email)は、ユーザーがメールアドレスまたはメールアドレスの検証ステータスを変更したときに、ユーザーのメールアドレスを更新する実行可能関数を実装します。

このスクリプトはAuth0 Dashboardでは利用できません。Management API[接続を更新](/docs/api/management/v2/connections/patch-connections-by-id)エンドポイントを呼び出し、`options.customScripts.change_email`プロパティを提供する必要があります。

#### 例