---
og:description: Learn about best practices for the custom database action script environment.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: カスタムデータベースアクションスクリプト環境のベストプラクティス
og:url: https://auth0.com/docs/
permalink: environment
title: カスタムデータベースアクションスクリプト環境のベストプラクティス
twitter:description: Learn about best practices for the custom database action script
  environment.
twitter:title: カスタムデータベースアクションスクリプト環境のベストプラクティス
---

Action scripts execute as a series of called JavaScript functions in an instance of a serverless Webtask container. As part of this, a specific environment is provided, together with a number of artifacts supplied by both the Webtask container and the Auth0 <Tooltip tip="Authentication Server: Server that confirms or denies a user’s identity." cta="View Glossary" href="/docs/glossary?term=authentication+server">authentication server</Tooltip> (your Auth0 tenant) itself.

## npmモジュール

Auth0 serverless Webtask containers can make use of a wide range of [`npm`](https://www.npmjs.com/) modules; `npm` modules not only reduce the overall size of action script code implementation, but also provide access to a wide range of pre-built functionality.

By default, a large list of publicly-available `npm` modules are supported out-of-the-box. This list has been compiled and vetted for any potential security concerns. To see which `npm` modules are supported, read [Can I require: Auth0 Extensibility](https://auth0-extensions.github.io/canirequire/).

If you require an `npm` module that is not supported out-of-the-box, then you can make a request via the [Auth0 Extensibility portal](https://auth0-extensions.github.io/canirequire/) or through your Auth0 representative. Auth0 will evaluate your request to determine suitability, if you need to escalate an unresolved request open a support ticket via the [Auth0 support portal](https://support.auth0.com/). There is currently no support in Auth0 for the use of `npm` modules from private repositories.

## 変数

Auth0アクションスクリプトは、グローバルに利用可能な`configuration`オブジェクトとして定義されているものを介してアクセスされる環境変数の概念をサポートします。`configuration`オブジェクトは読み取り専用として扱い、外部IDストアにアクセスするための資格情報やAPIキーなどの機密情報を保存するために使用される必要があります。これにより、アクションスクリプトにセキュリティ上重要な値がハードコードされることが軽減されます。

The `configuration` object can also be used to support whatever Software Development Life Cycle (SDLC) best practice strategies you employ, such as [setting up multiple environments](/docs/get-started/auth0-overview/create-tenants/set-up-multiple-environments), by allowing you to define variables that have tenant-specific values. This mitigates hardcoded values in an action script, which may change depending upon which tenant is executing it.

## Auth0サーバーレスWebtaskコンテナは、各Auth0テナントに関連付けられたプールからプロビジョニングされます。各コンテナインスタンスはグローバルオブジェクトを利用可能にし、そのオブジェクトにはコンテナインスタンス内で実行されるすべてのアクションスクリプトからアクセスできます。グローバルオブジェクトは、コンテナーに固有のグローバル変数として機能し、コンテナーインスタンス内で実行されるすべてのアクションスクリプトで使用できる情報（または関数）を定義するために使用できます。

つまり、リソースがユーザー固有でない限り、グローバルオブジェクトを使用して高価なリソースをキャッシュできます。たとえば、ユーザー固有ではない機能を提供するサードパーティAPI（ログ記録など）のアクセストークンを保存できます。または、Auth0で定義され、クライアントの資格情報フローを使用して取得された、ユーザー固有ではない独自のAPIへのアクセストークンを保存するために使用することもできます。

This means that the Auth0サーバーレスWebtaskコンテナは、各Auth0テナントに関連付けられたプールからプロビジョニングされます。各コンテナインスタンスはグローバルオブジェクトを利用可能にし、そのオブジェクトにはコンテナインスタンス内で実行されるすべてのアクションスクリプトからアクセスできます。グローバルオブジェクトは、コンテナーに固有のグローバル変数として機能し、コンテナーインスタンス内で実行されるすべてのアクションスクリプトで使用できる情報（または関数）を定義するために使用できます。 can be used to cache expensive resources, as long as those resources are not user-specific. For example, an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip> for a third-party (e.g., logging) API that provides non user-specific functionality could be stored. Or it could be used to store an Access Token to your own non user-specific API defined in Auth0 and obtained via use of the Client Credentials flow.

<Warning>

An action script may execute in any of the container instances already running or in a newly-created container instance (which may subsequently be added to the pool). There is no container affinity for action script execution in Auth0. This means that you should avoid storing any user-specific information in the Auth0サーバーレスWebtaskコンテナは、各Auth0テナントに関連付けられたプールからプロビジョニングされます。各コンテナインスタンスはグローバルオブジェクトを利用可能にし、そのオブジェクトにはコンテナインスタンス内で実行されるすべてのアクションスクリプトからアクセスできます。グローバルオブジェクトは、コンテナーに固有のグローバル変数として機能し、コンテナーインスタンス内で実行されるすべてのアクションスクリプトで使用できる情報（または関数）を定義するために使用できます。 and should always ensure that any declaration made within the Auth0サーバーレスWebtaskコンテナは、各Auth0テナントに関連付けられたプールからプロビジョニングされます。各コンテナインスタンスはグローバルオブジェクトを利用可能にし、そのオブジェクトにはコンテナインスタンス内で実行されるすべてのアクションスクリプトからアクセスできます。グローバルオブジェクトは、コンテナーに固有のグローバル変数として機能し、コンテナーインスタンス内で実行されるすべてのアクションスクリプトで使用できる情報（または関数）を定義するために使用できます。 provides for initialization too.

</Warning>

カスタム データベース接続環境チェックリスト

## データベースに、ユーザープロファイル属性を保管する**id**、**nickname**、**email**、**password**などのフィールドがあることを確認してください。Auth0のユーザープロファイルスキームと予想されるフィールドの詳細については、「[正規化されたユーザープロファイル](/users/user-profiles/normalized-user-profiles)」を参照してください。ユーザープロファイルを更新する方法については、「[データベースを使用してユーザープロファイルを更新する](/users/user-profiles/update-user-profiles-using-your-database)」をお読みください。

* Make sure that your database has the appropriate fields to store user profiles attributes, such as **id**, **nickname**, **email**, and **password**. To learn more about Auth0's user profile schema and expected fields, read [Normalized User Profiles](/docs/manage-users/user-accounts/user-profiles/normalized-user-profiles). To learn how to update user profiles, read [Update User Profiles Using Your Database](/docs/manage-users/user-accounts/user-profiles/update-user-profiles-using-your-database).
* 返されたユーザープロファイルにある`id`（または`user_id`）プロパティは、Auth0によってユーザーの識別に使用されます。複数のカスタムデータベース接続を使用している場合は、**user ID**の競合を避けるために、**すべてのカスタムデータベース接続にわたって****id**値が一意である必要があります。**id**の値には、接続名をプレフィックス（スペースは削除）として追加することをお勧めします。ユーザーIDの詳細については、「[ユーザーを識別する](/users/identify-users)」をお読みください。
* The `id` (or alternatively `user_id`) property in the returned user profile will be used by Auth0 to identify the user. If you are using multiple custom database connections, then the **id** value **must be unique across all the custom database connections** to avoid **user ID** collisions. Our recommendation is to prefix the value of **id** with the connection name (omitting any whitespace). To learn more about user IDs, read [Identify Users](/docs/manage-users/user-accounts/identify-users).
* データベースまたはサービスはAuth0サーバーからアクセスできなければなりません。ストアがファイアウォールの背後にある場合は、受信接続を構成してください。
* 特定のランタイムバージョンをテスト

## カスタムデータベーススクリプトのランタイムバージョンは、**［Extensibility（拡張性）］**内の**［Dashboard］>［Settings（設定）］>［Advanced（詳細）］**で定義されています。

The runtime version for custom Database scripts is defined at **Dashboard > Settings > Advanced** within the **Extensibility** section.

Follow these steps to test a single custom database script on a specific runtime version:

1. Navigate to **Authentication > Database.**
2. Select the Database connection where you have defined a custom script.
3. From within the selected database connection's page, select the **Custom Database** tab.
4. Scroll to **Database Action Scripts** section of the page.
5. Select the specific script you want to verify (eg. Login, Create etc) on the respective tab.
6. Select **Save and Try**. This loads a modal with specific test parameters and sample context details. Update as needed.
7. Select **Try** from the modal to open a dropdown selector for a specific Node version.
8. The test would trigger upon selecting the desired Node version and results would show up in a message on the same screen.

## Learn more

* [Custom Database Action Script Execution Best Practices](/docs/authenticate/database-connections/custom-db/custom-database-connections-scripts/execution)
* [Error Handling Best Practices](/docs/troubleshoot/error-handling-best-practices)
* [Debugging Best Practices](/docs/troubleshoot/debugging-best-practices)
* [Deployment Best Practices](/docs/deploy-monitor/deployment-best-practices)
* [Custom Database Connection Security Best Practices](/docs/authenticate/database-connections/custom-db/custom-database-connections-scripts/connection-security)