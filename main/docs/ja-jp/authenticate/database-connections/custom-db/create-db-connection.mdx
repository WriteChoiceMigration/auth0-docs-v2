---
og:description: Learn how to create a database connection.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: カスタムデータベース接続を作成する
og:url: https://auth0.com/docs/
permalink: create-db-connection
title: カスタムデータベース接続を作成する
twitter:description: Learn how to create a database connection.
twitter:title: カスタムデータベース接続を作成する
---

<Card title="Availability varies by Auth0 plan">

Your Auth0 plan or custom agreement affects whether this feature is available. To learn more, read [Pricing](https://auth0.com/pricing).

</Card>

If you have your own user database, you can use it as an <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+provider">identity provider</Tooltip> in Auth0 to authenticate users. In this process, you will create the custom database connection, create database action scripts, and add configuration parameters.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Make sure that your database has the appropriate fields to store user profiles attributes, such as `id`, `nickname`, `email`, and `password`. To learn about Auth0's user profile schema, read [Normalized User Profiles](/docs/manage-users/user-accounts/user-profiles/normalized-user-profiles). To learn more about updating user profiles, read [Update User Profiles Using Your Database](/docs/manage-users/user-accounts/user-profiles/update-user-profiles-using-your-database).

</Callout>

Auth0では、以下に示した一般に使用されるほとんどのデータベースの接続とスクリプトを作成することができます。

* ASP.NET Membership Provider
* MongoDB
* MySQL
* PostgreSQL
* SQLServer
* Windows Azure SQL Database
* 基本認証でアクセスされるWebサービス

You can connect to any kind of database or web service with a properly-configured custom script. Note that input sanitization must be completed on the customer end; Auth0 does not sanitize or validate any username/password combination passed by a custom database. アプリケーション scripts are subject to Auth0's [Rate Limit Policy](/docs/troubleshoot/customer-support/operational-policies/rate-limit-policy).

<Card title="Network firewall">

If you are behind a firewall, this feature may require that you add the appropriate Auth0 IP addresses to the Allow List to work properly.

</Card>

## Auth0 Dashboardで接続を作成する

1. Navigate to [Auth0 Dashboard > Authentication > Database](https://manage.auth0.com/#/connections/database), and select **Create DB Connection**.
2. Configure the connection's settings, and click **Create**:

<table class="table"><thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Definition</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Name</strong></td>
<td>The name of the connection. The name must start and end with an alphanumeric character, contain only alphanumeric characters and dashes, and not exceed 35 characters.</td>
</tr>
<tr>
<td><strong>Requires Username</strong></td>
<td>Forces users to provide a username <em>and</em> email address during registration.</td>
</tr>
<tr>
<td><strong>Username Length</strong></td>
<td>Sets the minimum and maximum length for a username.</td>
</tr>
<tr>
<td><strong>Disable Sign Ups</strong></td>
<td>Prevents signups to your application. You will still be able to create users with your API credentials or via the Auth0 Dashboard.</td>
</tr>
</tbody>
</table>

   Auth0で接続を作成すると、（**［Settings（設定）］**ビューのほかに）以下のビューも表示されます。
   * Password Policy（パスワードポリシー）
   * Custom Database（カスタムデータベース）
   * アプリケーション
   * ［Try Connection（接続を試す）］
3. Select the **Custom Database** view, and enable the **Use my own database** switch.

   <Frame>![Enable アプリケーション Use My Own Database Option](/images/cdy7uua7fh8z/3kgHDpBFdVWNq9XOfhsTXI/2efa43e44793b8dd69b9f9e8b54bf752/2025-02-25_10-20-20.png)</Frame>

## データベースアクションスクリプトを作成する

**［Use my own database（独自のデータベースを使用する）］**スイッチを切り替えると、**［Database Action Scripts（データベースアクションスクリプト）］**領域が有効になり、ここでスクリプトを作成し、データベース使用時の認証の仕組みを設定します。データベースアクションスクリプトを記述するか、**［Templates（テンプレート）］**ドロップダウンからテンプレートを選択し、必要に応じて変更することができます。

使用できるデータベースアクションスクリプトは以下のとおりです。

スクリプトの詳細については、「[カスタムデータベースのアクションスクリプト用テンプレート](/templates)」および「[カスタムデータベースのアクションスクリプト実行のベストプラクティス](/custom-database-connections-scripts/execution)」をお読みください。

<table class="table"><thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Description</strong></th>
<th><strong>Parameters</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Login</strong> <br/><span class="label label-danger">Required</span></td>
<td>Executes each time a user attempts to log in.</td>
<td><code>email</code>, <code>password</code></td>
</tr>
<tr>
<td><strong>Create</strong></td>
<td>Executes when a user signs up.</td>
<td><code>user</code></td>
</tr>
<tr>
<td><strong>Verify</strong></td>
<td>Executes after a user follows the verification link.</td>
<td><code>email</code></td>
</tr>
<tr>
<td><strong>Change Password</strong></td>
<td>Executes when a user clicks on the confirmation link after a reset password request.</td>
<td><code>email</code>, <code>newPassword</code></td>
</tr>
<tr>
<td><strong>Get User</strong></td>
<td>Retrieves a user profile from your database without authenticating the user.</td>
<td><code>email</code></td>
</tr>
<tr>
<td><strong>Delete</strong></td>
<td>Executes when a user is deleted using the API or Auth0 Dashboard.</td>
<td><code>id</code></td>
</tr>
</tbody>
</table>

To learn more about the scripts, read [Custom Database Action Script Templates](/docs/authenticate/database-connections/custom-db/templates) and [Custom Database Action Script Execution Best Practices](/docs/authenticate/database-connections/custom-db/custom-database-connections-scripts/execution).

### 以下の手順は、MySQLデータベースのログインスクリプトの例を示したものです。

<Card title="Avoid user ID collisions with multiple databases">

The `id` (or alternatively `user_id`) property in the returned user profile will be used by Auth0 to identify the user.

If you are using multiple custom database connections, then `id` value must be unique across all the custom database connections to avoid user ID collisions. Our recommendation is to prefix the value of `id` with the connection name (omitting any whitespace). To learn more about user IDs, read [Identify Users](/docs/manage-users/user-accounts/identify-users).

</Card>

上記のスクリプトはMySQLデータベースに接続し、クエリーを実行して`email == user.email`を含む最初のユーザーを取得します。`bcrypt.compareSync`メソッドでは次に、パスワードが一致するかどうかを検証します。一致する場合は、`id`、`nickname`、および`email`などのユーザープロファイル情報を含むオブジェクトを返します。このスクリプトは、これらの列を含む`users`テーブルを持っていると仮定します。ログインスクリプトによって返された`id`を使って、ユーザープロファイルのユーザーID属性を構築します。

1. After toggling the **Use my own database** switch, the **Database Action Scripts** area is enabled. Make sure you are on the **Login** tab.
2. Use the **Templates** dropdown to select the MySQL database script template.

   ```javascript lines expandable
   function login(email, password, callback) {
     var bcrypt = require('bcrypt');
     var mysql = require('mysql');
     var connection = mysql.createConnection({
       host: 'localhost',
       user: 'me',
       password: 'secret',
       database: 'mydb'
     });
     connection.connect();
     var query = "SELECT id, nickname, email, password " +
       "FROM users WHERE email = ?";
     connection.query(query, [email], function (err, results) {
       if (err) return callback(err);
       if (results.length === 0) return callback(new WrongUsernameOrPasswordError(email));
       var user = results[0];
       bcrypt.compare(password, user.password, function (err, isValid) {
         if (err) {
           callback(err);
         } else if (!isValid) {
           callback(new WrongUsernameOrPasswordError(email));
         } else {
           callback(null, {
             // This prefix (replace with your own custom DB name)
             // ensure uniqueness across different custom DBs if there's the
             // possibility of collisions (e.g. if the user ID is an email address or an integer)
             id: 'MyConnection1|' + user.id.toString(),
             nickname: user.nickname,
             email: user.email
           });
         }
       });
     });
   }
   ```


   

   

   **［Save（保存）］**または**［Try（試す）］**をクリックしないと、スクリプトのテンプレートはAuth0で使用されません。これは、スクリプトを1つだけ変更し、その他に変更を加えない場合にも当てはまります。すべてのスクリプトを設定するには、**［Save（保存）］**を少なくとも一度はクリックする必要があります。
   Organization用カスタムデータベースのサポート
   カスタムデータベース接続をOrganizationと組み合わせて使用する場合は、スクリプト署名の`context`パラメーターを使って、`id`、`name`、`metadata`のようなOrganizationの詳細をカスタムデータベースのアクションスクリプトに適用することができます。関連するアクションが組織コンテキストで実行されると、Organizationデータがコンテキストオブジェクトに渡されます。たとえば、ユーザーが組織のログインスクリプトを認証すると、ログインアクションのスクリプトが渡されます。詳細については、「[データベース接続](/connections/database)」をお読みください。
3. Click **Save and Try**.
4. In the pop-up modal, enter your email and password and click **Try**. This provides a dropdown to select from a list of available runtimes, with your current runtime on top.

   <Frame>![Modal to try the login script.](/images/cdy7uua7fh8z/8uBGZhHYZwOcO19ljJNNp/ccd69d84fdbdff90dc779a6b1ea8a6fd/Try_the_Login_Script_-_English.png)</Frame>

コンテキストオブジェクトを有効にする

## Organizationコンテキストを使用する

If you use custom database connections in conjunction with Organizations, you can use the `context` parameter in the script signature to make Organization details like `id`, `name`, and `metadata` available to your custom database action scripts. Organization data is passed in the context object when the associated action happens in the context of an organization; for example, when a user authenticates on an organization’s login prompt, the login action script is passed. To learn more, read [Database Connections](/docs/authenticate/database-connections).

### 構成パラメーターを追加する

1. Navigate to [Auth0 Dashboard > Authentication > Database](https://manage.auth0.com/dashboard/us/#/connections/database/).
2. Select your database connection.
3. Under the **Custom Database** tab, find **Context objects in database scripts** and select **Enable**.

   <Warning>

   This feature cannot be disabled once toggled.

   </Warning>

### データベースへの接続に必要な資格情報といったパラメーターは、スクリプトエディターの下にある**［Settings（設定）］**セクションに保存することができます。これらのパラメーターはすべてのスクリプトに使用することができ、データベースアクションスクリプト内の`configuration`オブジェクト（`configuration.MYSQL_PASSWORD`など）を使ってパラメーター値にアクセスすることができます。

スクリプトに追加したパラメーターを使って接続を構成します。たとえば、以下をMySQL Loginスクリプトに追加することができます。

<Tabs><Tab title="Login">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```






</Tab><Tab title="Create">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```






</Tab><Tab title="Verify">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```






</Tab><Tab title="Change Password">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```






</Tab><Tab title="Get User">

```json lines
{
    "organization": {
        "display_name": "My Organization",
        "id": "org_XXXXXX",
        "metadata": {
            "example": "value"
        },
        "name": "my-organization"
    }
}
```


</Tab>
<Tab title="Delete">
</Tab>
</Tabs>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

An empty context will always be passed to the `delete` script.

</Callout>

## Add configuration parameters

You can store parameters, like the credentials required to connect to your database, in the **Settings** section below the script editor. These will be available for all of your scripts, and you can access the parameter values using the `configuration` object in your database action scripts (i.e., `configuration.MYSQL_PASSWORD`).

Use the added parameters in your scripts to configure the connection. For example, you might add the following to the MySQL Login script:

```javascript lines
function login (username, password, callback) {
  var mysql = require('mysql');
  var connection = mysql.createConnection({
    host     : configuration.MYSQL_HOST,
    user     : 'me',
    password : configuration.MYSQL_PASSWORD,
    database : 'mydb'
  });
}
```






## Learn more

* [Custom Database Connection and Action Script Best Practices](/docs/authenticate/database-connections/custom-db/custom-database-connections-scripts)
* [Troubleshoot Custom Databases](/docs/authenticate/database-connections/custom-db/error-handling)
* [Import and Export Users](/docs/manage-users/user-migration)