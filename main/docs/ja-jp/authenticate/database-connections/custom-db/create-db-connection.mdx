---
og:description: Learn how to create a database connection.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: カスタムデータベース接続を作成する
og:url: https://auth0.com/docs/
permalink: create-db-connection
title: カスタムデータベース接続を作成する
twitter:description: Learn how to create a database connection.
twitter:title: カスタムデータベース接続を作成する
---



独自のユーザーデータベースをお持ちの場合は、そのデータベースをIDプロバイダーに使用してユーザーを認証することができます。このプロセスでは、カスタムデータベース接続の作成、データベースアクションスクリプトの作成、構成パラメーターの追加といった操作を行います。



Auth0では、以下に示した一般に使用されるほとんどのデータベースの接続とスクリプトを作成することができます。

* ASP.NET Membership Provider
* MongoDB
* MySQL
* PostgreSQL
* SQLServer
* Windows Azure SQL Database
* 基本認証でアクセスされるWebサービス

正しく構成されたカスタムスクリプトを使用すれば、あらゆる種類のデータベースやWebサービスに接続することができます。入力値のサニタイジングは顧客側で完了しなければなりません。Auth0では、カスタムデータベースによって渡されたユーザー名/パスワードの組み合わせをサニタイズまたは検証しません。カスタムデータベーススクリプトは、Auth0の[レート制限ポリシー](/support/policies/rate-limit-policy)の適用対象となります。



## Auth0 Dashboardで接続を作成する

1. [［Auth0 Dashboard］>［Authentication（認証）］>［Database（データベース）］](%24%7Bmanage_url%7D/#/connections/database)に移動して、**［Create DB Connection（DB接続の作成）］**を選択します。
2. 接続の設定を構成し、**［Create（作成）］**をクリックします。

Auth0で接続を作成すると、（**［Settings（設定）］**ビューのほかに）以下のビューも表示されます。

* Password Policy（パスワードポリシー）
* Custom Database（カスタムデータベース）
* アプリケーション
* ［Try Connection（接続を試す）］
3. **［Custom Database（カスタムデータベース）］**ビューを選択し、**［Use my own database（独自のデータベースを使用する）］**スイッチを有効にします。

## データベースアクションスクリプトを作成する

**［Use my own database（独自のデータベースを使用する）］**スイッチを切り替えると、**［Database Action Scripts（データベースアクションスクリプト）］**領域が有効になり、ここでスクリプトを作成し、データベース使用時の認証の仕組みを設定します。データベースアクションスクリプトを記述するか、**［Templates（テンプレート）］**ドロップダウンからテンプレートを選択し、必要に応じて変更することができます。

`login`スクリプトは構成する**必要があります**。ユーザー機能性のその他のスクリプトはしてもしなくても構いません。

使用できるデータベースアクションスクリプトは以下のとおりです。



スクリプトの詳細については、「[カスタムデータベースのアクションスクリプト用テンプレート](/templates)」および「[カスタムデータベースのアクションスクリプト実行のベストプラクティス](/custom-database-connections-scripts/execution)」をお読みください。

### ログインスクリプトを作成する



以下の手順は、MySQLデータベースのログインスクリプトの例を示したものです。

1. **［Use my own database（独自のデータベースを使用する）］**スイッチを切り替えた後、**［Database Action Scripts（データベースアクションスクリプト）］**領域が有効になります。**［Login（ログイン）］**タブが開いていることを確認します。
2. **［Templates（テンプレート）］**ドロップダウンを使用して、MySQLデータベーススクリプト用テンプレートを選択します。

上記のスクリプトはMySQLデータベースに接続し、クエリーを実行して`email == user.email`を含む最初のユーザーを取得します。`bcrypt.compareSync`メソッドでは次に、パスワードが一致するかどうかを検証します。一致する場合は、`id`、`nickname`、および`email`などのユーザープロファイル情報を含むオブジェクトを返します。このスクリプトは、これらの列を含む`users`テーブルを持っていると仮定します。ログインスクリプトによって返された`id`を使って、ユーザープロファイルのユーザーID属性を構築します。
3. **［Save and Try（保存して試す）］**をクリックします。
4. **［Try（試す）］**をクリックしてスクリプトをテストします。（この手順によりスクリプトの保存も行われます。）

**［Save（保存）］**または**［Try（試す）］**をクリックしないと、スクリプトのテンプレートはAuth0で使用されません。これは、スクリプトを1つだけ変更し、その他に変更を加えない場合にも当てはまります。すべてのスクリプトを設定するには、**［Save（保存）］**を少なくとも一度はクリックする必要があります。

## Organization用カスタムデータベースのサポート

カスタムデータベース接続をOrganizationと組み合わせて使用する場合は、スクリプト署名の`context`パラメーターを使って、`id`、`name`、`metadata`のようなOrganizationの詳細をカスタムデータベースのアクションスクリプトに適用することができます。関連するアクションが組織コンテキストで実行されると、Organizationデータがコンテキストオブジェクトに渡されます。たとえば、ユーザーが組織のログインスクリプトを認証すると、ログインアクションのスクリプトが渡されます。詳細については、「[データベース接続](/connections/database)」をお読みください。

### コンテキストオブジェクトを有効にする

1. [［Auth0 Dashboard］>［Authentication（認証）］>［Database（データベース）］](https://manage.auth0.com/dashboard/us/#/connections/database/)の順に移動します。
2. データベース接続を選択します。
3. **［Custom Database（カスタムデータベース）］**タブで、**［Context objects in database scripts（データベーススクリプト内のコンテキストオブジェクト）］**を見つけて、**［Enable（有効にする）］**を選択します。

### Organizationコンテキストを使用する

コンテキストオブジェクトがDashboardで有効になると、「context」オブジェクトをカスタムデータベースのアクションスクリプトに追加し、コールバックパラメーターの直前に挿入することができます。イベントがOrganizationコンテキストでトリガーされると、対応するデータを以下の形式でカスタムデータベースのアクションスクリプトで使用できるようになります。

## 構成パラメーターを追加する

データベースへの接続に必要な資格情報といったパラメーターは、スクリプトエディターの下にある**［Settings（設定）］**セクションに保存することができます。これらのパラメーターはすべてのスクリプトに使用することができ、データベースアクションスクリプト内の`configuration`オブジェクト（`configuration.MYSQL_PASSWORD`など）を使ってパラメーター値にアクセスすることができます。

スクリプトに追加したパラメーターを使って接続を構成します。たとえば、以下をMySQL Loginスクリプトに追加することができます。