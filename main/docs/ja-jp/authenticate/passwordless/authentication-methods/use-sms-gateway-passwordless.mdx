---
og:description: Learn how to set up a custom SMS gateway for Passwordless connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: パスワードレス接続のためにカスタムSMSゲートウェイをセットアップする
og:url: https://auth0.com/docs/
permalink: use-sms-gateway-passwordless
title: パスワードレス接続のためにカスタムSMSゲートウェイをセットアップする
twitter:description: Learn how to set up a custom SMS gateway for Passwordless connections.
twitter:title: パスワードレス接続のためにカスタムSMSゲートウェイをセットアップする
---

このガイドでは、１回限り使用できるコードを送信するためにカスタムSMSゲートウェイを使用する方法について説明します。

デフォルトでは、[パスワードレスSMS接続](/use-sms-gateway-passwordless/sms-otp)は、[Twilio](https://www.twilio.com)を使用して１回限り使用できるコードを送信します。ただし、カスタムSMSゲートウェイがある場合は、代わりにそれを使用するために接続を変更できます。



1. SMSパスワードレス接続をセットアップします。方法については、[パスワードレス接続](/passwordless)の「パスワードレスの実装」セクションをご覧ください。
2. [Management APIのアクセストークンを取得](/security/tokens/access-tokens/management-api-access-tokens)します。これは、パスワードレス接続を更新するために、Mangement APIを呼び出すために必要です。
3. [GET接続](/api/management/v2#!/Connections/get_connections)エンドポイントを使用して、テナントに関する接続についての情報を取得します。より具体的には、パスワードレスSMS接続のIDを取得する必要があります。そうすることで、接続自体を更新する後のAPI呼び出しでそれを使用できます。Management APIに以下の呼び出しを行う前に、`ACCESS_TOKEN`を手順1で取得したトークンに置き換えてください。
エンドポイントからの応答は、オブジェクトの配列です。各オブジェクトは、テナントと関係がある1つの接続を表しています。
4. 接続IDを特定します。手順２で[GET接続エンドポイント](/api/management/v2#!/Connections/get_connections)から返されたオブジェクトの配列を確認して、パスワードレス接続と関係があるIDを見つけることができます。パスワードレス接続のある特定のオブジェクトを見つけるには、`"name": "sms"`プロパティを検索できます。接続で、セットアッププロセス中にあなたが提供したTwilio情報が現在表示されていることに注目してください。
5. 接続を更新する。[接続の更新エンドポイント](/api/management/v2#!/Connections/patch_connections_by_id)に対してPATCH呼び出しを行うことで、これを実行できます。より具体的には、SMS Gatewayに関する情報を提供するために、接続`options`オブジェクトを更新します。
以下の項目を変更します。

* `twilio_sid`および`twilio_token`の両方のパラメーターを削除します。
* `provider`パラメーターを追加し、`sms_gateway`に設定します。
* `gateway_url`パラメーターを追加し、SMSゲートウェイのURLに設定します。Auth0は、ゲートウェイを使用してあなたに代わってメッセージを送信するために、このURLに到達できなければなりません。

ペイロードはこのようになっているはずです。

## 認証済み要求

SMSゲートウェイが、トークンベースの認証済み要求を受け入れたら、`options`オブジェクトに以下を追加できます。



`options`オブジェクトに`gateway_authentication`を含めた場合、Auth0は、SMSゲートウェイに要求を送信するときはいつでも、`認証`ヘッダーに[JSON Web Token](/security/tokens/json-web-tokens)を追加します。トークンは、`gateway_authentication.subject`および`gateway_authentication.audience`値を含み、`gateway_authentication.secret`で署名されます。

シークレットがBase64URLエンコードされている場合は、`secret_base64_encoded`を`true`に設定します。

接続を更新したら、Auth0は、ユーザーがパスワードレス接続にサインアップまたはログインするたびに、以下をSMSに送信します。



`options`オブジェクトの`forward_req_info`プロパティを`true`に設定した場合、ゲートウェイは、パスワードレスプロセスを開始するHTTP要求からも情報を受け取ります。これには、`/passwordless/start`およびユーザーエージェントを呼び出すクライアントのIPアドレスが含まれます。



## エラー処理

Auth0は、SMSゲートウェイから返されたHTTPコードのみを考慮し、他の応答を無視します（たとえば、応答本文や応答タイプ）。

SMSゲートウェイが200以外のHTTPコードを返した場合、`/passwordless/start`エンドポイントは、HTTP 400コードと以下のような応答を返します。



SMSゲートウェイがHTTP 401を返した場合、`error_description`は、**SMSゲートウェイ呼び出し中に認証に失敗しました：401**になります。（エラーの説明の言葉遣いは、いつでも変更される可能性がありますのでご注意ください）

Auth0では、カスタムSMSゲートウェイに対するHTTPの呼び出しについて、30秒のタイムアウトを強制できます。SMSゲートウェイがこの時間枠内に応答しなかった場合も、`/passwordless/start`エンドポイントはHTTP 400コードを返します。応答は、上記のフォーマットで行われ、`error_description`フィールドは、**SMSゲートウェイ呼び出し中にタイムアウト：<Timeout Code>**となります。（繰り返しになりますが、エラーの説明の言い回しは、いつでも変更される可能性があります）