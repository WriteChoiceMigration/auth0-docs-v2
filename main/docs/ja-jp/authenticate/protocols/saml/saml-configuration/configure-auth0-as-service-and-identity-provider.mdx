---
og:description: Describes how to configure SAML SSO with Auth0 as both the service
  provider and identity provider for testing.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0をサービス プロバイダーおよびIDプロバイダーとして使用したSAML SSOのテスト
og:url: https://auth0.com/docs/
permalink: configure-auth0-as-service-and-identity-provider
title: Auth0をサービス プロバイダーおよびIDプロバイダーとして使用したSAML SSOのテスト
twitter:description: Describes how to configure SAML SSO with Auth0 as both the service
  provider and identity provider for testing.
twitter:title: Auth0をサービス プロバイダーおよびIDプロバイダーとして使用したSAML SSOのテスト
---

You can configure Auth0 as both the service provider (SP) and the <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+provider">identity provider</Tooltip> (IdP) to test your <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip> <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=single+sign-on">single sign-on</Tooltip> (SSO) connection.

<Frame>![Protocols Auth0 as SAML SP and IdP Diagram](/images/cdy7uua7fh8z/7Ds9dLC3HaxGBLsG3ry7B9/0c08d51b6d6bb57ef6eff3796ca4cd21/saml-case3.png)</Frame>

Auth0は、SAML 1.1またはSAML 2.0を使用したSAML構成でSPとしてのAuth0の使用のみをサポートしますが、SAML 2.0を使用したSAML構成ではIdPとしてAuth0を使用できます。

Auth0を使用してSAML SSOを通じてユーザー認証を行うテスト用の簡単なサンプルアプリケーションをセットアップできます。このアプリケーションでは、1つのテナントをSAML SP、もう1つのテナントをSAML IdPとして使用します。1つのテナントに対して2つのフェデレーションを構成します。

## IdPテナントの作成

SAML IdPとして機能するセカンダリAuth0テナントがまだない場合は、作成する必要があります。

1. Go to the [Auth0 Dashboard](https://manage.auth0.com/#/), select your tenant name and select **Create Tenant**.

   <Frame>![Dashboard Tenant Drop-Down Menu Create Tenant](/images/cdy7uua7fh8z/53KetqhNIGDs6N5cqJdQtz/5efad1137eb8b04031b30137c2fc5ac5/2025-02-26_14-51-39.png)</Frame>
2. Enter a **Domain**, select a **Region**, and click **Create**.

## IdPテナントの構成

セカンダリテナントをIdPとして構成し、SPテナントを表すアプリケーションを登録します。

1. Switch to your IdP tenant. Open the tenant menu, select **Switch Tenant**, and then select your IdP tenant.
2. Navigate to [Dashboard > Applications > Applications](https://manage.auth0.com/#/applications) and select **Create Application**.
3. Enter a name for the application, such as `my-auth0-idp`, select **Regular Web Application** for the application type, and then select **Create**.
4. Go to the bottom of the **Settings** page, and select **Show Advanced Settings**.
5. Switch to the **Certificates** view, then select **Download Certificate**, and choose **PEM**. The certificate will download. You will use this certificate when you configure the SP tenant.
6. Switch to the **Endpoints** view, locate **SAML Protocol URL**, and copy its contents. You will use this URL when you configure the SP tenant.

## SAMLシーケンスをテストするユーザーを作成

1. Go to [Dashboard > User Management > Users](https://manage.auth0.com/#/users) and select **Create User**.
2. Enter an email address for your test user. The domain name should match the service provider tenant email domain that you will configure next. For example, if your user is `john.doe@exampleco.com`, you should enter `exampleco.com` for the email domain.
3. Enter a password for the test user.
4. Use the default value for **Connection**.
5. Select **Create**.

## サービス プロバイダー テナントの構成

SAMLプロトコルを使用してSSOのIdPテナントと通信するようにSPテナントを構成します。

1. Switch to your SP tenant. Open the tenant menu, select **Switch Tenant**, and then select your SP tenant.
2. Go to [Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise) and select **SAML**.
3. Select **Create Connection**.
4. Enter the following information, and select **Create**:

<table class="table"><thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connection Name</td>
<td>Enter any name, such as <code>SAML-Auth0-IDP</code>.</td>
</tr>
<tr>
<td>Sign In URL</td>
<td>Enter the SAML Protocol URL value that you copied in above.</td>
</tr>
<tr>
<td>Sign Out URL</td>
<td>Enter the same URL as for the Sign In URL above.</td>
</tr>
<tr>
<td>X509 Signing Certificate</td>
<td>Click on the red <strong>UPLOAD CERTIFICATE...</strong> button and select the <code>.pem</code> file you downloaded above.</td>
</tr>
</tbody>
</table>
5. Switch to the **Setup** view to see the metadata associated with the tenant. Copy and save the URL.
6. Open a new browser tab and navigate to the URL you copied previously. (If you are logged in on the Auth0 Docs site, the settings will pre-populate with the correct values.)

   1. Locate **Entity ID**, and then copy and save its contents. It will look like: `urn:auth0:{yourTenant}:{yourConnectionName}`. Replace `{yourConnectionName}` with the name of the connection you created for your IdP tenant.
   2. Locate **Metadata**, and copy and save the provided URL. It will look like: `https://{yourDomain}/samlp/metadata?connection={yourConnectionName}`. Replace `{yourConnectionName}` with the name of the connection you created for your IdP tenant.
   3. Go to the URL you previously copied to display the metadata for this connection in the SP tenant. Alternatively, your browser may prompt you to save the metadata file.
   4. Locate the row that starts with **AssertionConsumerService**, and copy and save the value of the **Location** field. It will be a URL of the form: `https://{yourDomain}/login/callback?connection={yourConnectionName}`. This is the URL on your SP tenant that receives the SAML assertion from the IdP tenant. In the next section, you will provide this URL to the IdP tenant so it knows where to send the SAML assertion.

## サービス プロバイダー メタデータをIdPに追加

SPテナントに関する情報をIdPテナントに追加して、SAML認証要求の受信方法と応答方法を認識できるようにします。

1. Switch to your IdP tenant. Open the tenant menu, select **Switch Tenant**, and then select your IdP tenant.
2. Go to [Dashboard > Applications > Applications](https://manage.auth0.com/#/applications) and select the name of the IdP application you created previously.
3. Switch to the **Addons** view.
4. Select **SAML2 Web App** to view its options, and locate the **Application Callback URL**. Paste the **AssertionConsumerService URL** that you copied previously.
5. In the **Settings** code block, locate the `audience` key, and uncomment it, then remove the comma from the end of the line and replace the original value (`urn:foo`) with the **Entity ID** value you copied previously (including the connection name you created in Step 4 when you configured your service provider tenant).
   The new line should look like: "`audience":"urn:auth0:{yourTenant}:{yourConnectionName}"`.
6. Select **Enable**.

## SAML接続をテストするためのアプリケーションの作成

1. In the same window, scroll up, and select **Debug**. A login screen will appear.
2. Log in with the credentials of the test user you created above. If your configuration is correct, it will display "It works!", and the encoded and decoded SAML response that would be sent to the IdP.
3. Check the decoded SAML response, locate `<saml:Audience>`, and make sure it matches the **Entity ID** you entered on the previous screen.
4. Select **Close this window**.

## 作成したSAML接続をテストするための簡単なアプリケーションを作成します。

サービスとIDプロバイダー間の接続をテストします

1. Switch to your SP tenant. Open the tenant menu, select **Switch Tenant**, and then select your SP tenant.
2. Go to [Dashboard > Applications > Applications](https://manage.auth0.com/#/applications) and select **Create Application**.
3. Enter an application name, select **Regular Web Application** as the application type, and then select **Create**.
4. Copy and save the **Domain** and **Client ID** values.
5. Locate the **Allowed Callback URLs** field, and enter `http://jwt.io`.
   SPテナントとIdPテナント間のSAML構成が機能していることを確認するためにテストします。
6. Select **Save Changes**.
7. Switch to the **Connections** view, locate the SAML connection you created under the **Enterprise** section, and enable it.

## 構成が正しくセットアップされている場合は、「成功しました!」と表示され、IdPテナントからAuth0テナントに送信されたSAML認証アサーションの内容がページに表示されます。

正しく構成されていない場合は、手順を再確認します。それでも問題が解決しない場合は、このドキュメントの最後にあるトラブルシューティングのセクションを参照してください。

1. Go to [Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise) and select **SAML**.
2. Locate the SAML connection you created, and select the **Try** arrow icon. Since you previously logged in while testing this connection, you should be sent directly to the "It works!" screen. If you see the login screen, log in using your test user's credentials.

テスト アプリケーション用のWebページを作成

SAMLログインシーケンスをトリガーするLockウィジェットを呼び出す簡単なWebページを作成します。

## アプリケーションをテスト

SPテナントで作成したAuth0 SAML接続を使用してIdPテナントに対してSSO認証を実行するサンプルHTMLアプリケーションをテストします。

1. Create an HTML page, and insert the following HTML and JavaScript code. Replace `{yourClientId}` and `{yourDomain}` with the actual values of the application you registered above. (If you did not note those values, you can find them in the **Application Settings** on your SP tenant.)

   ```html lines expandable
   <!DOCTYPE html>
   <html lang="en">
   <body>
     <button type="button" onclick="login()">Log in</button>
     <script src="https://cdn.auth0.com/js/auth0/9.19.0/auth0.min.js"></script>
     <script>
       var auth0 = new auth0.WebAuth({
         domain: YOUR_AUTH0_DOMAIN,
         clientID: YOUR_CLIENT_ID,
         redirectUri: URL_TO_THIS_PAGE,
         responseType: 'token id_token',
         scope: 'openid email profile'
       })

       auth0.parseHash(function(err, data) {
         if (err) {
           console.log(err)
         }

         if (data) {
           console.log('Login successful!')
           console.log(data)
         }
       })

       window.login = function() {
         auth0.authorize()
       }
     </script>

   </body>
   </html>
   ```


   

   
2. You can also replace `audience` with the appropriate value for your application, but for the purposes of this test, a placeholder is sufficient. If you do specify the `audience` parameter, ensure that it matches an identifier of an existing API you have configured in Auth0.
3. Save the HTML file where you can access it from a browser.

## テストシナリオのトラブルシューティング

テストの前に、毎回ブラウザーの履歴とクッキーを消去します。そうしないと、ブラウザーがHTMLページの最新バージョンを取得できないか、実行に影響する古いクッキーが残っている可能性があります。

1. Open the HTML file you created above with a browser. You should see a login button.
2. Click **Login**. You should see the Lock widget with one option. If you have other connections turned on for your application, the screen may look different. If you are prompted for an email address, make sure the email address you enter has the same domain name as the domain you entered in the **Settings** view for the application in the first tenant.
3. Click the blue button, which may say **saml** or **ACCESS**. Whether you are prompted for credentials or immediately redirected to the callback URL depends on whether you still have an active session.

## インタラクションのHTTPトレースをキャプチャします。多くのツールは、分析のためにブラウザーからHTTPトラフィックをキャプチャします。

* インターネットで「HTTP トレース」を検索して、ツールを見つけてインストールします。
* ログインシーケンスを最初から最後までキャプチャし、トレースを分析します。GETのシーケンスを追跡して、予想されるシーケンスのどこまで取得したかを確認します。元のサイトからSPテナント、次にIdPテナントへのリダイレクト、ログインする必要がある場合は資格情報のPOST、コールバックURLまたは SP テナントへのリダイレクト、そしてアプリケーションで指定された**コールバックURL**へのリダイレクトが表示されます。

  + ブラウザーでクッキーとJavaScriptが有効になっていることを確認してください。
  + HTML ファイルで指定された**コールバックURL**が、アプリケーションの**［Allowed Callback URLs（許可されたコールバック URL）］**フィールドにもリストされていることを確認します。これを行うには、[［Dashboard］>［Applications（アプリケーション）］>［Applications（アプリケーション）］](%24%7Bmanage_url%7D/#/applications)に移動し、アプリケーションの名前を選択して、**［Allowed Callback URLs（許可されたコールバック URL）］**を見つけます。
* [)ツールを使用してSAMLアサーションをデコードします。
* Ensure that the **Callback URL** specified in the HTML file is also listed in the **Allowed Callback URLs** field for your application. To do so, go to [Dashboard > Applications > Applications](https://manage.auth0.com/#/applications) and select the name of your application, then locate **Allowed Callback URLs**.
* Use the http://samltool.io tool to decode a SAML assertion.

## Learn more

* [SAML Single Sign-On Integrations](/docs/authenticate/protocols/saml/saml-sso-integrations)
* [Customize SAML Assertions](/docs/authenticate/protocols/saml/saml-configuration/customize-saml-assertions)
* [Deprovision Users in SAML Integrations](/docs/authenticate/protocols/saml/saml-configuration/deprovision-users-in-saml-integrations)
* [SAML Identity Provider Configuration Settings](/docs/authenticate/protocols/saml/saml-identity-provider-configuration-settings)
* [Sign and Encrypt SAML Requests](/docs/authenticate/protocols/saml/saml-sso-integrations/sign-and-encrypt-saml-requests)
* [Troubleshoot SAML Configurations](/docs/troubleshoot/authentication-issues/troubleshoot-saml-configurations)