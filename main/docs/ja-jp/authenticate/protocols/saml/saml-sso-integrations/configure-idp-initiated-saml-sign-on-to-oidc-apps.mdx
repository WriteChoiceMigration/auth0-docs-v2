---
og:description: Learn how to configure an Auth0 SAML connection to support Identity
  Provider-initiated sign-on to a SAML Identity Provider for OIDC applications.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: IdP起点SAMLサインオンをOIDCアプリに構成する
og:url: https://auth0.com/docs/
permalink: configure-idp-initiated-saml-sign-on-to-oidc-apps
title: IdP起点SAMLサインオンをOIDCアプリに構成する
twitter:description: Learn how to configure an Auth0 SAML connection to support Identity
  Provider-initiated sign-on to a SAML Identity Provider for OIDC applications.
twitter:title: IdP起点SAMLサインオンをOIDCアプリに構成する
---

Auth0はアプリケーションのために、IDプロバイダー（IdP）起点のSAML応答をOpenID Connect（OIDC）応答に変換する方法を提供しています。

OIDプロトコルはIdP起点の認証フローに対応しませんが、この方法では[フォームPOSTを使用した暗黙フロー](/login/flows/implicit-flow-with-form-post)を使ってIdP起点の認証フローを模倣することができます。



これを実装するには、以下を行う必要があります。

* カスタムログイン経路ハンドラーをアプリケーションに追加します。
* 以下を許可するようにSAML接続を更新します。

1. IdP起点のSAML応答の受信を受け付ける
2. サービスプロバイダー起点の認証要求を送信するデフォルトのアプリケーションにリダイレクトする



## 仕組み

1. ユーザーがSAML IdPのログインエンドポイントに移動します。
2. SAML IdPがログインページを返します。
3. ユーザーが資格情報をSAML IdPに送信します。
4. SAML IdPがユーザーのセッションを作成し、フォームPostとSAML応答のあるHTMLページを返します。
5. ページがHTTP `POST`呼び出しを行って、自動的にSAML応答をAuth0テナントに送信します。
6. Auth0テナントがユーザーのブラウザーでOIDCアプリケーションのカスタムログイン経路ハンドラーにリダイレクトし、DトークンをURLフラグメントとして渡します。
7. ブラウザーがOIDCアプリケーションのカスタムログイン経路ハンドラーを呼び出して、`connection`パラメーターとIDトークンを渡します。
8. OIDCアプリケーションがIDトークンを無視して`connection`パラメーターを解析し、セッションの`state`パラメーターを作成してから、ユーザーのブラウザーをAuth0テナントの`/authorize`エンドポイントにリダイレクトします。
9. ブラウザーがAuth0テナントの`/authorize`エンドポイントを呼び出して、提供された`connection`と`state`のパラメーターを渡します。
10. Auth0テナントがSAMLログイン要求を生成し、ユーザーのブラウザーをSAML IdPのログインエンドポイントにリダイレクトします。
11. ブラウザーがSAMLログイン要求をSAML IdPのログインエンドポイントに送信します。
12. SAML IdPがユーザーのセッションを見つけて、フォームPostとSAML応答のあるHTMLページを返します。
13. ページがHTTP `POST`呼び出しを行って、自動的にSAML応答をAuth0テナントに送信します。
14. Auth0テナントがユーザーのブラウザーをアプリケーションのログイン経路ハンドラーにリダイレクトします。
15. ブラウザーばアプリケーションのログイン経路ハンドラーを呼び出して、提供された`state`パラメーターとIDトークンを渡します。
16. OIDCアプリケーションが`state`パラメーターを検証して、IDトークンを解析し、ユーザーにアプリケーションセッションを作成します。

## カスタムログイン経路ハンドラーを作成する

カスタムログイン経路ハンドラーはアプリケーションのログインメソッドを呼び出します。ハンドラーは`connection`パラメーターを受け付けて、Auth0テナントに送信する認証要求に含めます。

カスタムログイン経路ハンドラーに関係付けるエンドポイントは、標準のログイン経路ハンドラーに関係付けているものとは別にすることをお勧めします。たとえば、標準のログイン経路ハンドラーを`/login`エンドポイントと関連付けている場合には、カスタムログイン経路ハンドラーを`/startlogin`エンドポイントと関連付けます。



### 例

[Auth0 Single Page App SDK](https://auth0.com/docs/libraries/auth0-single-page-app-sdk)を使用している場合には、カスタムログイン経路ハンドラーを追加して、ログインメソッドを更新し、以下のように接続パラメーターに対応させることができます。



## クエリ文字列を作成する

クエリ文字列には`redirect_uri`パラメーターを含めます。パラメーターの値はURLエンコードされ、以下で構成されなければなりません。

1. カスタムログイン経路ハンドラーに関連付けられているアプリケーションのエンドポイント
2. SAML接続名の値が指定された`connection`パラメーター

### 例

アプリケーションのエンドポイントが`https://exampleco.com/startlogin`でSAML接続名が`my-saml-connection`の場合、クエリ文字列は`redirect_uri=https%3A%2F%2Fexampleco.com%2Fstartlogin%3Fconnection%3Dmy-saml-connection`になります。

## アプリケーションを構成する

1. [［Auth0 Dashboard］>［Applications（アプリケーション）］>［Application（アプリケーション）］](https://manage.auth0.com/#/applications)に移動します。
2. Auth0にあるOIDCアプリケーションを表す新しいアプリケーションを作成します。
3. **［Allowed Callback URL（許可されているコールバックURL）］**に、カスタムログイン経路ハンドラーに関連付けられているアプリケーションのエンドポイントを含めて更新します。

## 接続を構成する

1. [［Auth0Dashboard］>［Authentication（認証）］>［Enterprise（エンタープライズ）］>［SAML］](https://manage.auth0.com/#/connections/enterprise/samlp)に移動します。
2. 新しいSAML接続を作成します。
3. **［IdP-Initiated SSO（IdP起点のSSO）］**ビューに切り替えます。
4. **［Accept Requests（要求を許可する）］**を選択します。
5. **［Default Application（デフォルトのアプリケーション）］**に、先ほど作成したアプリケーションを選択します。
6. **［Response Protocol（応答プロトコル）］**に**［OpenID Connect］**を選択します。
7. **［Query String（クエリ文字列）］**に、先ほど作成したクエリ文字列を入力します。