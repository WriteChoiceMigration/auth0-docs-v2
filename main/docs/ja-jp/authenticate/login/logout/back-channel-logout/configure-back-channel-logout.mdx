---
og:description: Describes how to configure OIDC back-channel logout with your Auth0
  services.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: OIDCバックチャネルログアウトを構成する
og:url: https://auth0.com/docs/
permalink: configure-back-channel-logout
title: OIDCバックチャネルログアウトを構成する
twitter:description: Describes how to configure OIDC back-channel logout with your
  Auth0 services.
twitter:title: OIDCバックチャネルログアウトを構成する
---

## 利用

OIDCバックチャネルログアウトは、すべてのエンタープライズプランのお客様が利用するためのものです。アプリケーションが要件を満たしているかを確認するには、OIDC標準の`/.well-known/*`メタデータエンドポイントを確認する必要があります。



## バックチャネルログアウトでの制約

バックチャネルログアウトURLは公開されたエンドポイントで呼び出され、特定の制約を守らなければなりません。

1. HTTPSプロトコルを使用する必要があります。暗号化されていない HTTPや他のプロトコルは許可されません。
2. Auth0のサブドメインを使用してはいけません。Auth0のサブドメインには以下が挙げられます。

* auth0.com
* auth0app.com
* webtask.io
* webtask.run
3. ドメインのないIPアドレスの使用は推奨されません。バックチャネルログアウトを使用するには、IPアドレスが公開IPでなければなりません。範囲が内部、予約済み、またはループバックのIPアドレスは許可されていません。

## Auth0を構成する

Auth0 DashboardまたはManagement APIを使用してログアウトトークンを取得するには、アプリケーションを登録します。



## アプリケーションを構成する

Auth0 DashboardまたはManagement APIを使用してバックチャネルログアウトを構成したら、技術やフレームワークに基づいて、アプリケーションがサービスを使用できるように構成します。

1. アプリケーションの種類に応じてエンドユーザーの認証を実装します。

1. エンドユーザーがアプリケーションにログイン可能で、セッションが作成されなければなりません。
2. IDトークンがAuth0から発行され、アプリケーションのバックエンドで処理するためにアクセスできなければなりません。
2. IDトークンが検証された後、ログインプロセスを拡張して`sid`クレームと、任意でsubクレームを保存します。

1. これらのクレームは、現在のアプリケーションセッションに対して保存されなければなりません。
2. セッション管理機能は、`sid`値によって特定のセッションを取得できる必要があります。
3. バックチャネルログアウトのエンドポイントを構成します。

1. エンドポイントは`HTTP POST`要求のみを処理する必要があります。
2. `logout_token`パラメーターを抽出し、仕様に従って通常のJWTとして検証します。
3. トークンに、JSONオブジェクト値と`http://schemas.openid.net/event/backchannel-logout`という名前のメンバーを含むeventsクレームが含まれていることを確認します。
4. トークンに`sid`クレームおよび/または`sub`クレームが含まれていることを確認します。
5. トークンに`nonce`クレームが含まれていないことを確認します。これは、不正使用を防止するために、ログアウトトークンとIDトークンを区別するのに必要です。
6. トークンが検証されると、受信した`sid`や`sub`値に対応するセッションを取得して終了します。実際のアプリケーションセッションの終了プロセスは、実装の詳細によって異なります。たとえば、このイベントはフロントエンドに知らせる必要があるかもしれません。

## OIDCバックチャネルログアウト要求の例

エンコードされたトークンのペイロード：





デコードされたトークンのペイロード：



## 予期される応答

* **HTTP 200**：特定のアプリケーションでユーザーのログアウトが確認されました。
* **HTTP 400**：不正な要求です。要求が理解不可能か、トークンが検証に失敗しました。Auth0はテナントログに問題を記録しますが、特定のセッションに対してさらに要求を送ろうとはしません。

## 問題のトラブルシューティング

### アプリケーションがログアウトイベントを取得しない

アプリケーションがログアウトイベント後にログアウト要求を取得しない場合には、以下を行います。

1. アプリケーションが、Auth0 DashboardでバックチャネルログアウトURLに登録されていることを確認します。
2. バックチャネルログアウトURLにAuth0テナントから到達できることを確認します。
3. 有効なセッションが確立されていることを確認します。エンドユーザーはAuth0を介して特定のアプリケーションにログインしなければなりません。
4. Auth0のテナントログで、ログアウトのメッセージ送信が失敗したというメッセージを確認します。
5. ログアウトが標準のログアウトエンドポイントを通してトリガーされていることを確認します。他のイベントはログアウトイベントをトリガーしません。
6. 可能であれば、Webサーバーのログとアプリケーションのファイアウォールのログで、阻止された要求を確認します。
7. バックチャネルログアウトエンドポイントで有効な証明書（自己署名ではない）を使用していることを確認します。

#### OIDCバックチャネルログアウトのテナントログが見つからない

この機能は、2023年10月3日から、すべてのテナントに対して段階的にリリースされました。`oidc_backchannel_logout_succeeded`には`sslo`、`oidc_backchannel_logout_failed`には`fslo`の[テナントログイベントコード](/logs/log-event-type-codes)が引き続き受信される場合があります。

### クライアントアプリが受信したログアウトトークンを検証できない

トランザクションが400エラーで失敗する場合には、以下を行います。

1. トークンが標準のBase64でエンコードされたJWTであることを確認します。Webサーバーによっては、長いパラメーターを切る詰めることがあります。詳細については、「[署名アルゴリズム](/applications/signing-algorithms)」をお読みください。
2. 可能であれば、トークンをキャプチャして、JWTであることを確認します。[JWT.IO](http://jwt.io)など、検証済みのソースを使用します。
3. 検証機能が[JSON Web Key Sets](/security/tokens/json-web-tokens/json-web-key-sets)（JWKS）を通してテナントの署名キーを動的に取得することを確認します。

### 応答タイムアウトエラー

Auth0はアプリケーションのOIDCバックチャネルログアウトの応答を5秒間待機します。その後、「Failed OIDC Back-Channel Logout request（OIDCバックチャネルログアウト要求の失敗）」を、応答の説明なくテナントログに記録します。