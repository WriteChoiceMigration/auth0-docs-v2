---
og:description: Learn about best practices for testing and debugging your Auth0 environment.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ルールのテストに関するベストプラクティス
og:url: https://auth0.com/docs/
permalink: rules-testing-best-practices
title: ルールのテストに関するベストプラクティス
twitter:description: Learn about best practices for testing and debugging your Auth0
  environment.
twitter:title: ルールのテストに関するベストプラクティス
---



Auth0 Dashboardには、ルールをテストしてデバッグするために、ルールを`TRY`（試す）機能があります。この機能では、モックの`user`と`context`オブジェクトを定義し、ルールに渡して実行することができます。ルールの実行が完了すると、結果の出力（コンソールのログを含む）が表示されます。これはルールの単体テストを一目で分かりやすいものにする反面、手動での作業がメインとなるため、[Mocha](https://mochajs.org/)や[rewire](https://www.npmjs.com/package/rewire)などのテスト自動化ツールは活用できません。

ベストプラクティスとして、また、SDLC（Software Development Life Cycle：ソフトウェア開発ライフサイクル）の推奨される対応として、運用環境への導入前にルールやルールの変更をテストする際には、Auth0で別のテスト用テナントを使用してください。

## 自動化

多少のボイラープレートを使用すれば、ルールがAuth0テナントに導入・実行され、変更することなく、CI/CD（継続的インテグレーションと継続的デプロイ）の自動化（単体）テスト環境で使用されるように実装できます。



上の例が示すように、Node.jsの[VM](https://www.w3schools.com/nodejs/ref_vm.asp)を使用すると、（独立したノードモジュールに）何らかの比較的単純なテストを実装して、ルールをテスト実行することができます。この例では、「Normalized Profile Claims（正規化プロファイルクレーム）」という名前のルールがファイルから読み込まれ、ルールの（JavaScript）コードの周りにボイラープレートが追加されて実行されます（ボイラープレートとは、ルールのコードを含んだ[ファイルを読み込む](https://nodejs.org/api/fs.html#fs_fs_readfilesync_path_options)ファイルシステム呼び出しの前後に追加される文字列です）。

`runInThisContext`の呼び出しに渡されたオプションオブジェクトは、例外エラーが発生した際のデバッグに役立つ情報を提供します。この関数の呼び出しについては、Node.jsの[ドキュメント](https://node.readthedocs.io/en/stable/api/vm/)を参照してください。

ルールのテスト中に渡された最初の2つのオブジェクトは`user`と`context`を表すオブジェクトです。これらはAuth0 Dashboardの`TRY`（試す）機能と同様に、スタブで代用することができます。第3パラメーターの`callback`関数は、パイプライン継続を模倣するように実装できるため、結果的に順序を追って後続のルールが実行されます。

渡される`callback`関数の中でテストを行うか、アサーションを検証することで、コールバック関数が少なくとも1回呼び出されることを検証できます。また、ルールがコールバックを複数回呼び出していないことを確認する実装を提供することもお勧めします。

さらに、Node.jsの`global`オブジェクトを使って、構成オブジェクトと、必要であれば`auth0`オブジェクトのインスタンスにもアクセスすることができます。上の例では、（上のセクションでも説明したように）推奨基準に沿って、デバッグに役立つグローバルな`configuration`オブジェクトが定義されています。

また、上の例では、Auth0 Deploy CLIが提供するファイルシステムのディレクトリ構造を利用しています。Auth0 Deploy CLIはルールを導入するのに便利です。