---
og:description: Learn how to use Hooks to change scopes and add custom claims in the
  access token obtained using the Client Credentials Flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: クライアントの資格情報フローでフックを使用してトークンをカスタマイズする
og:url: https://auth0.com/docs/
permalink: customize-tokens-using-hooks-with-client-credentials-flow
title: クライアントの資格情報フローでフックを使用してトークンをカスタマイズする
twitter:description: Learn how to use Hooks to change scopes and add custom claims
  in the access token obtained using the Client Credentials Flow.
twitter:title: クライアントの資格情報フローでフックを使用してトークンをカスタマイズする
---





[フック](/hooks)を追加することで、スコープを変更し、[クライアントの資格情報フロー](/login/flows/client-credentials-flow)で発行されたトークンのカスタムクレームを追加することができます。

フックによって、Node.jsコードを使用したAuth0の動作をカスタマイズすることができます。Auth0プラットフォーム（クライアントの資格情報フローなど）の特定の拡張ポイントに関連付けられた、安全で自己完結型の関数です。Auth0は実行時にフックを呼び出して、カスタムロジックを実行します。

フックは、Auth0 DashboardまたはManagement APIを使って管理できます。



## 前提条件

このチュートリアルを始める前に：

* [APIをAuth0に登録する](/get-started/set-up-apis)

* [適切なAPIのアクセス許可を追加](/apis/add-api-permissions)
* [Auth0にM2Mアプリケーションを登録する](/get-started/create-apps/machine-to-machine-apps)

* **［Application Type（アプリケーションの種類）］**に**［Machine to Machine Applications（マシンツーマシンアプリケーション）］**を選択します。
* 以前に登録したAPIを選択します。
* M2MアプリケーションがAPIを呼び出せるように認可します。

## ステップ

1. **フックを作成する**：トークンをカスタマイズするフックを作成します。
2. **フックをテストする**：クライアントの資格情報フローを実行し、アクセストークンをデコードすることで、新しいフックをテストします。

### フックを作成する

この例では以下を行います。

* 任意のクレーム（`https://foo.com/claim`）を[アクセストークン](/security/tokens/access-tokens)に追加する
* 追加の権限を構成済みAPIに追加する

トークンをカスタマイズするフックを作成します。拡張ポイントを選択するよう求められたら、`［Client Credentials Exchange（クライアントの認証情報の交換）］`を選択し、エディターに以下のコードを追加します。





### フックをテストする

作成したフックをテストするには、クライアントの資格情報の交換を実行し、アクセストークンを取得してデコードし、その内容を確認する必要があります。

#### トークンを取得する

トークンを取得するには、`POST`呼び出しを[クライアントの資格情報フローエンドポイント](/api/authentication#client-credentials-flow)に対して行います。CLIENT_ID、CLIENT_SECRET、API_IDENTIFIERの各プレースホルダーの値をアプリケーションのクライアントID、アプリケーションのクライアントシークレット、APIの識別子にそれぞれ、必ず置き換えてください。クライアントIDとクライアントシークレットは[アプリケーション](%24%7Bmanage_url%7D/#/applications)設定、API識別子は[API](%24%7Bmanage_url%7D/#/apis)設定でそれぞれ確認できます。



正常な応答に含まれるもの：

* `access_token`
* 有効期限（秒）（`expires_in`）
* `Bearer`として設定されたトークンのタイプ（`token_type`）
* `extra`権限（`scope`）（フックによって追加されたもの）



#### トークンをデコードする

アクセストークンをデコードし、その内容を確認するための最も簡単な方法は、[JWT.ioデバッガー](https://jwt.io/#debugger-io)を使用する方法です。

アクセストークンをコピーし、エディターに貼り付けます。JWTは自動的にデコードされ、その内容が表示されます。

**ペイロード**の最後の2項目は共に、フックによって設定されています。

* `"scope": "extra"`
* `"https://foo.com/claim": "bar"`