---
og:description: Describes how to build an assertion to use Private Key JWT Authentication.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 秘密鍵JWTで認証する
og:url: https://auth0.com/docs/
permalink: authenticate-with-private-key-jwt
title: 秘密鍵JWTで認証する
twitter:description: Describes how to build an assertion to use Private Key JWT Authentication.
twitter:title: 秘密鍵JWTで認証する
---

<Card title="Before you start">

You need to create a new application in Auth0 Dashboard or convert an existing application before you continue. To learn more, read [Configure Private Key JWT Authentication](/docs/get-started/applications/configure-private-key-jwt).

</Card>

アサーションを構築する

1. Build the client assertion. This assertion is a JWT signed by the private key when you generated the key pair. To learn how to generate a key pair, read [Configure Private Key JWT Authentication](/docs/get-started/applications/configure-private-key-jwt).
2. Use the assertion to authenticate against Auth0.

## Auth0のSDKのいずれかを使用して、アサーションを自動的に構築できます。SDKを使用しない場合、ご自身でアサーションを構築する必要があります。

アサーションとは、以下のプロパティとクレームを含む必要があるJSON Web Token（JWT）のことです。

The assertion is a <Tooltip tip="JSON Web Token (JWT): Standard ID Token format (and often Access Token format) used to represent claims securely between two parties." cta="View Glossary" href="/docs/glossary?term=JSON+Web+Token">JSON Web Token</Tooltip> (JWT) that should contain the following properties and claims:

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

All claims are required unless otherwise stated. To learn more about JWT claims, read [JSON Web Token Claims](/docs/secure/tokens/json-web-tokens/json-web-token-claims).

</Callout>

* `alg`：アサーションの署名に使用されるアルゴリズム。アルゴリズムはアプリケーションの資格情報を作成した際に指定されたアルゴリズムと一致している必要があります。

  + `kid`**：**（任意）Auth0が生成した資格情報の`kid`。`kid`は、資格情報を作成する際に作られます。
  + ペイロード
* `iss`**：**アプリケーションのクライアントID。この値はアプリケーション設定にあり、[［Auth0 Dashboard］>［Applications（アプリケーション）］>［Applications（アプリケーション］]()に移動して、**［Settings（設定）］**タブを選択すると見つかります。

  + `iss`**:** Your application's Client ID. You can find this value in your application settings under [Auth0 Dashboard > Applications > Applications](https://manage.auth0.com/dashboard/#/applications/) and select the **Settings** tab.
  + `sub`**:** Your application's Client ID. You also can find this value in your application settings. You can find this value in your application settings under [Auth0 Dashboard > Applications > Applications](https://manage.auth0.com/dashboard/#/applications/) and select the **Settings** tab.
  + `aud`**:** The URL of the Auth0 tenant or custom domain that receives the assertion. For example: `https://{yourTenant}.auth0.com/`**.** Include the trailing slash.

    <Callout icon="file-lines" color="#0EA5E9" iconType="regular">

    If you have configured a custom domain for your Auth0 tenant, this can be used as the `aud` claim. We recommend using the custom domain in this case.

    </Callout>
  + `jti`：クライアントが作成した一意のクレームID。Universally Unique Identifier（UUID）フォーマットの使用をお勧めします。
  + そしてトークンは、秘密鍵JWT認証のためにアプリケーションを作成または構成した際に生成された秘密鍵で署名される必要があります。その方法については、「[JSON Web Tokenの仕様]()」をご確認ください。

    <Warning>

    This JWT is a one-time use only token and should be considered as such by having a short expiry. We recommend setting a maximum of 1 minute.

    </Warning>

The token must then be signed with the private key you generated when you created or configured your application for Private Key JWT Authentication. To learn how, review the [JSON Web Token specification](https://www.rfc-editor.org/rfc/rfc7519#section-7.1).

We recommend you construct the token using standard tooling or third party libraries that support this functionality out of the box, rather than implementing from scratch yourself.  To learn more about supporting libraries, read the listing at [JWT.io](https://jwt.io/libraries).

### 以下の例では、Node.jsスクリプトが[joseパッケージ]()を使用してアサーションを生成しています。

In the example below, the Node.js script uses a [jose package](https://github.com/panva/jose) to generate the assertion:

```javascript lines expandable
const { SignJWT } = require('jose')
const crypto = require("crypto");
const uuid = require("uuid");

async function main() {
 const privateKeyPEM = crypto.createPrivateKey(/**
   Read the content of your private key here. We recommend to store your private key
   in a secure infrastructure. 
 */);

 const jwt = await new SignJWT({})
   .setProtectedHeader({ 
      alg: 'RS256', // or RS384 or PS256
      kid: '(OPTIONAL) KID_GENERATED_BY_AUTH0' 
   })
   .setIssuedAt()
   .setIssuer('CLIENT_ID')
   .setSubject('CLIENT_ID')
   .setAudience('https://YOUR_TENANT.auth0.com/') // or your CUSTOM_DOMAIN
   .setExpirationTime('1m')
   .setJti(uuid.v4())
   .sign(privateKeyPEM);
  console.log(jwt)
}

main();
```






以下に対応しています。

<Frame>![private key example](/images/cdy7uua7fh8z/4O8zb1gZnEmUQ6FrRkfmlc/a30b73e09d51ca0b4bf929b91571a80a/2023-03-13_16-53-54.png)</Frame>

必要な情報でJWTを生成したら、Auth0に対してアプリケーションを認証する準備が整います。

```json lines
{
  "alg": "RS256",
  "kid": "my kid"
}
{
  "iat": 1626684584,
  "iss": "my client id",
  "sub": "my client id",
  "aud": "https://mytenant.auth0.com/",
  "exp": 1626684644,
  "jti": "e4dc8ed1-b108-4901-8bbc-c07a791817e7"
}
```






アサーションをアクセストークンと交換する

## JWTアサーションをアクセストークンと交換するには、以下のパラメーターで認証APIの[トークンエンドポイント]()を呼び出します。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

The following example uses the [Client Credential Flow](/docs/get-started/authentication-and-authorization-flow/client-credentials-flow). Private Key JWT authentication can be used for other grant types that also allow replacing `client_secret` with `client_assertion`.

</Callout>

To exchange the JWT assertion for an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+token">access token</Tooltip>, call the Authentication API [token endpoint](https://auth0.com/docs/api/authentication#authenticate-user) with the following parameters:

* `$resource_server_identifier`：リソースサーバーの識別子。詳細については、「[APIを登録する](/get-started/set-up-apis)」お読みください。
* `$resource_server_identifier`: <Tooltip tip="Resource Server: Server hosting protected resources. Resource servers accept and respond to protected resource requests." cta="View Glossary" href="/docs/glossary?term=resource+server">resource server</Tooltip> identifier. To learn more, read [Register APIs](/docs/get-started/auth0-overview/set-up-apis).

```bash lines
curl --location --request POST 'https://$tenant/oauth/token' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data-urlencode 'grant_type=client_credentials' \
  --data-urlencode 'client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer' \
  --data-urlencode 'client_assertion=$client_assertion' \
  --data-urlencode 'audience=$resource_server_idenifier'
```






## [POST /oauth/revoke]()

In addition to the [https://$tenant/oauth/token](https://auth0.com/docs/api/authentication#get-token) endpoint, the following Auth0 Authentication API endpoints support `private_key_jwt` authentication for configured applications:

* [POST /oauth/revoke](https://auth0.com/docs/api/authentication#revoke-refresh-token)
* [POST /mfa/challenge](https://auth0.com/docs/api/authentication#challenge-request)
* [POST /passwordless/start](https://auth0.com/docs/api/authentication#get-code-or-link)

## アサーション内のクレームには次の制限があります。

`iss`：64文字

`sub`：64文字

* `jti`：64文字
* `alg`：16文字
* `jti`: 64 characters
* `alg`: 16 characters