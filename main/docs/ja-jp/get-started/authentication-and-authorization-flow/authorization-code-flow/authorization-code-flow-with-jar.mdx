---
og:description: Learn how to use JWT-Secured Authorization Requests (JAR) with the
  Authorization Code Flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: JWT-Secured Authorization Requests（JAR）を使った認可コードフロー
og:url: https://auth0.com/docs/
permalink: authorization-code-flow-with-jar
title: JWT-Secured Authorization Requests（JAR）を使った認可コードフロー
twitter:description: Learn how to use JWT-Secured Authorization Requests (JAR) with
  the Authorization Code Flow.
twitter:title: JWT-Secured Authorization Requests（JAR）を使った認可コードフロー
---



[JWTで保護された認可要求（JAR）](https://datatracker.ietf.org/doc/html/rfc9101)は、OAuth2プロトコルの拡張であり、認可要求パラメータの整合性を保護するためにセキュリティレイヤーを追加します。

## 前提条件

JARを使用するには、まず[RSAキーペアを生成する](/generate-rsa-key-pair)必要があります。次に、[JWTで保護された認可要求の構成](/configure-jar)の説明に従って、公開鍵をAuth0に登録します。

認可コードフロー中に、クライアントアプリケーションは`/authorize`または`/oauth/par`エンドポイントに送信するパラメーターを取得し、それらを[JSON Webトークン （JWT）](/security/tokens/json-web-tokens)にラップして、秘密鍵を使用して署名します。

認可サーバーは、アプリケーションの公開鍵を使用して署名を検証します。署名が有効な場合、認可サーバーは JARから要求パラメータを抽出し、通常どおり要求を処理します。その結果、パラメータ値は既知のソースから取得されることが保証され、仲介者によって改ざんされたりアクセスされたりすることはできません。

## JAR要求を生成する

JAR要求を生成するには、まず [JSON Webトークン（JWT）](/security/tokens/json-web-tokens)を作成する必要があります。[Auth0 JWTライブラリ](https://jwt.io/libraries)を使用すると、好みの言語でJWTを生成できます。

### ヘッダー

JAR要求の場合、JWTヘッダーには次のフィールドが含まれている必要があります：

* `alg`：JWTに署名するために使用されるアルゴリズム。RS256、RS384、またはPS256のいずれかである必要があります。
* `typ`：JWTの種類です。`jwt`または`oauth-authz-req+jwt`のいずれかである必要があります。

ヘッダーには、JWTの署名に使用されるキーを識別する`kid`フィールドも含まれる場合があります。`kid` が存在する場合、Auth0は[JAR構成](/configure-jar)中に登録された、一致するキーIDを持つ公開鍵を探し、そのキーを使用してJWTの署名を検証します。

### ペイロード

JWTペイロードには次のクレームが含まれている必要があります：

* `iss`：これにはアプリの`client_id`が含まれている必要があります
* `aud`：これは、プロトコルと末尾のスラッシュが付いたテナントのドメインである必要があります。例えば、`https://your_domain.auth0.com/`

JWTには、`/authorize`の呼び出しに必要なパラメータも含まれている必要があります。例：

* `client_id`：これにはアプリの`client_id`も含まれている必要があります
* `response_type`：Auth0に、実行するOAuth 2.0フローを示します。認可コード付与フローに`code`を使用します。

JWTには、`audience`、`scope`、`state`、`redirect_uri`など、要求されている認可フローのオプションパラメータが含まれる場合があります。

さらに、JWTには次のオプションのクレームが含まれる場合があります：

* `iat`：数値の日付である必要があります。
* `nbf`：過去の時間を表す数値の日付である必要があります。
* `exp`：将来の時刻を表す数値の日付である必要があります。
* `jti`：64バイト以下の文字列である必要があります。

### JWTの生成例

次のJavaScriptコードサンプルは、JavaScriptおよび[jsonwebtokenライブラリ](https://www.npmjs.com/package/jsonwebtoken?activeTab=readme)を使用してJWTを構築および署名する方法を示しています。生成されたJWTをコンソールに出力します：



### 認可エンドポイントを呼び出す

署名されたJWTを使用して`/authorize`エンドポイントを呼び出すには、新しいブラウザウィンドウを開きます。クライアントIDを`client_id`パラメータとして渡し、署名およびURLエンコードされたJWTを`request`パラメータとして渡します。