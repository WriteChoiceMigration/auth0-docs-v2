---
og:description: Learn how to use Rich Authorization Requests (RAR) with the Authorization
  Code Flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Rich Authorization Requests（RAR）を使った認可コードフロー
og:url: https://auth0.com/docs/
permalink: authorization-code-flow-with-rar
title: Rich Authorization Requests（RAR）を使った認可コードフロー
twitter:description: Learn how to use Rich Authorization Requests (RAR) with the Authorization
  Code Flow.
twitter:title: Rich Authorization Requests（RAR）を使った認可コードフロー
---



[Rich Authorization Requests (RAR)](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-rar)（リッチ認可要求(RAR)）はOAuth2プロトコルを拡張し、クライアントが認可コードフロー中にエンドユーザーなどのリソース所有者にきめ細かな認可データを要求して取得する方法を提供します。

従来のOAuth2フローでは、通常、クライアントはリソースサーバーから一連のスコープへのアクセスを要求し、リソース所有者はそれらのリソースへのアクセスをクライアントに許可します。ただし、このアプローチでは、クライアントに許可されたアクセスをきめ細かく制御できず、アクセスの過剰プロビジョニングにつながる可能性があります。これにより、セキュリティリスクが発生する可能性があります。

RARを使用すると、クライアントは`authorization_details`パラメーターを渡して、アクセスするリソースごとに特定の権限を要求できます。これにより、アクセスをよりきめ細かく制御でき、過剰プロビジョニングに関連するセキュリティリスクを軽減できます。

全体として、RARはOAuth2プロトコルの強力な拡張機能であり、クライアントとリソース所有者の両方に対して、リソースアクセスに対するセキュリティと制御を強化します。

## どのように使用すればよいですか?

API用に[configure RAR](/configure-rich-authorization-requests)（RARを構成）した後、`/par`エンドポイントに渡される要求に`authorization_details`パラメーターを追加できます。パラメーターはオブジェクトの配列です。各オブジェクトにはtypeフィールドが必要ですが、型は配列内で一意である必要はありません。認可コードフローを使用した例を次に示します。



各`authorization_details`要素は、`type`フィールドが含まれている限り、完全にカスタムにすることができます。

次のコードサンプルに示すように、`/oauth/token``****`エンドポイントで認可コードを交換すると、次のようになります。



アクセストークンと`authorization_details`配列を含む応答を受け取ります。



`authorization_details`配列は、クライアントがアクセストークンを検査することなく、付与された認可のスコープを理解するのに役立ちます。一般に、クライアントはアクセストークンを検査してはなりません。これは、[IETF’s JSON Web Token Profile for OAuth 2.0 Access Tokens](https://datatracker.ietf.org/doc/html/rfc9068#name-privacy-considerations)（IETFのOAuth 2.0アクセストークンのJSON Webトークンプロファイル）に詳細が記載されています。代わりに、リソースサーバーがアクセストークンを検査する必要があります。

要求されたオーディエンスが[［JWE access tokens（JWEアクセストークン）］](/security/tokens/json-web-tokens)を使用するように構成されたAPIである場合、`type`以外のすべてのフィールドは、`/oauth/token``****`エンドポイントからの応答の`authorization_details`要素から削除されます。アクセストークンの要求は影響を受けません。



### アクションで`authorization_details`にアクセスします

標準プロトコルのサポートに加えて、`event.transaction.requested_authorization_details`プロパティを使用して、ログイン後のアクション内のRARも公開します。このプロパティを使用して、多要素認証のステップアップなど、トランザクションに関する決定を行います。



## Auth0がサポートしていないものは何ですか?

現時点では、Auth0は次のことをサポートしていません:

* ActionsでのRARの更新。
* クライアントが検出できるようにRARタイプのアドバタイズ。

APIで許可されているタイプと一致する`type`（タイプ）プロパティがあるかどうかのチェックを超えて、RARオブジェクトを検証します。詳細については、[［Configure RAR（RARを構成）］](/configure-rich-authorization-requests)を参照してください。