---
og:description: Learn how Hooks can be used with the Client Credentials Exchange extensibility
  point, which is available for database connections and passwordless connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Client Credentials Exchange
og:url: https://auth0.com/docs/
permalink: client-credentials-exchange
title: Client Credentials Exchange
twitter:description: Learn how Hooks can be used with the Client Credentials Exchange
  extensibility point, which is available for database connections and passwordless
  connections.
twitter:title: Client Credentials Exchange
---



Client Credentials Exchange（クライアント資格情報交換）拡張ポイントでは、フックにより、クライアントの資格情報フローを使用して認証APIの[`POST /oauth/token`エンドポイント](/api/authentication#client-credentials-flow)からアクセストークンが発行される際にカスタムアクションを実行できます。たとえば、トークンが発行されないように拒否する、アクセストークンにカスタムクレームを追加する、またはそのスコープを修正することができます。詳細については、「[クライアントの資格情報フロー](/login/flows/client-credentials-flow)」をお読みください。

この拡張ポイントでのフックはブロッキング（同期的）であり、トリガーのプロセスの一部として実行されます。そのため、フックが完了するまでAuth0パイプラインの他の部分の実行が停止されます。





## スターターコードとパラメーター

Client Credentials Exchange（クライアント資格情報交換）拡張ポイントで実行されるフックを作成する際、以下のスターターコードが役立つかもしれません。Hook関数に渡され、使用されることができるパラメーターは、コード例の最上部にリストされています。



以下の点にご注意ください。

* サンプルコードの終わりにあるコールバック関数（`cb`）は、完了を知らせるもので、必ず含まれなければなりません。
* `access_token.scope = scope`という行は、すべての付与されたスコープがアクセストークンに存在するようにします。それを取り除くとすべてのスコープをリセットすることになり、トークンにはスクリプトで追加したスコープのみ含まれます。

### デフォルトの応答

Client Credentials Exchange（クライアント資格情報交換）拡張ポイントでフックを実行すると、デフォルトの応答オブジェクトは次のようになります。



### スターターコードの応答

スコープと追加クレームを使用してスターターコードをカスタマイズしたら、Hookエディタに埋め込まれたランナーを使用してフックをテストできます。ランナーは、Client Credentials Exchange（クライアント資格情報交換）で得られるものと同じ要求ボディと応答を使ってフックへの呼び出しをシミュレートします。





スターターコードに基づいたフックを実行する場合、応答オブジェクトは以下の通りになります。



## スクリプト例：アクセストークンに追加スコープを追加する

この例では、既存のスコープに加えてアクセストークンに追加のスコープを付与するためにフックを使用します。



詳しくは、「[スコープ](/apis/scopes)」をお読みください。

### 応答

このフックを実行すると、応答オブジェクトは次のようになります。



## スクリプト例：アクセストークンにクレームを追加する

この例では、アクセストークンに名前空間のカスタムクレームとその値を追加します。詳細については、「[名前空間カスタムクレームを作成する](/security/tokens/json-web-tokens/create-custom-claims)」をお読みください。

以下をクレームとして発行済みトークンに追加できます。

* 応答オブジェクトの`scope`プロパティ
* 名前空間プロパティ名のあるすべてのプロパティ

拡張ポイントは、その他すべての応答オブジェクトプロパティを無視します。





### 応答

このフックを実行すると、応答オブジェクトは次のようになります。



## スクリプト例：エラーを発生させる、またはアクセストークンを拒否する

この例では、カスタムのエラーオブジェクトを使用して、OAuth2エラー応答を生成します（詳細については、[IETF DatatrackerのOAuth2 RFC、セクション5.2](https://tools.ietf.org/html/rfc6749#section-5.2)をお読みください）。

コールバック内で次のような単純なJavaScriptエラーが返された場合に、



`/oauth/token`エンドポイントから`client_credentials`の付与を要求すると、Auth0は次のように応答します。



しかし、OAuth2エラー応答をさらに制御したい場合は、3種類のカスタムエラーオブジェクトを使用することもできます。

### InvalidScopeError



そして、`/oauth/token`エンドポイントから`client_credentials`の付与を要求すると、Auth0は次のように応答します。



### InvalidRequestError



`/oauth/token`エンドポイントから`client_credentials`の付与を要求すると、Auth0は次のように応答します。



### ServerError



そして、`/oauth/token`エンドポイントから`client_credentials`の付与を要求すると、Auth0は次のように応答します。