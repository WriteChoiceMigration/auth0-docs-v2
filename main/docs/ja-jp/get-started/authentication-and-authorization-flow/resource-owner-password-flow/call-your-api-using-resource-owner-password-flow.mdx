---
og:description: Learn how to call your own API from highly-trusted applications using
  the Resource Owner Password Flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: リソース所有者のパスワードフローを使ってAPIを呼び出す
og:url: https://auth0.com/docs/
permalink: call-your-api-using-resource-owner-password-flow
title: リソース所有者のパスワードフローを使ってAPIを呼び出す
twitter:description: Learn how to call your own API from highly-trusted applications
  using the Resource Owner Password Flow.
twitter:title: リソース所有者のパスワードフローを使ってAPIを呼び出す
---





Auth0は、[Authentication API](/api/authentication)を使用して、アプリがリソース所有者のパスワードフロー（Resource Owner Password Grant、またはROPGと呼ばれることもある）を簡単に実装できるようにします。APIを直接呼び出す方法については、このまま続けてお読みください。

## 前提条件

**このチュートリアルを始める前に：**

* [Auth0にアプリケーションを登録します](/get-started/create-apps/regular-web-apps)。

* **［Regular Web Apps（通常のWebアプリ）］**の**［Application Type（アプリケーションタイプ）］**を選択します。
* `**${account.callback}**`の**［Allowed Callback（許可されているコールバック）］URL**を追加します。このフィールドを未定義にすることはできません。未定義にすると、エラーメッセージが返されます。
* アプリケーションの**［Grant Types（付与タイプ）］**に**［Password（パスワード）］**が含まれていることを確認します。詳細については、「[付与タイプを更新する](/applications/update-grant-types)」をお読みください。
* アプリケーションでリフレッシュトークンを使用できるようにするには、アプリケーションの**［Grant Types（付与タイプ）］**に**［Refresh Token（リフレッシュトークン）］**が含まれていることを確認してください。詳細については、「[付与タイプを更新する](/applications/update-grant-types)」をお読みください。リフレッシュトークンの詳細については、「[リフレッシュトークン](/security/tokens/refresh-tokens)」をお読みください。
* [APIをAuth0に登録する](/get-started/set-up-apis)

* APIがリフレッシュトークンを受信して、以前のトークンの有効期限が切れたときに新しいトークンを取得できるようにする場合は、**［Allow Offline Access（オフラインアクセスの許可）］**を有効にします。
* Set up a connection（接続のセットアップ）

* ユーザー名とパスワードによるユーザー認証が可能な接続であることを確認します（例：[データベース接続](/applications/set-up-database-connections)、またはAD/LDAP、ADFS、Entra ID[エンタープライズ接続](/connections/identity-providers-enterprise))。
* 特定の接続にのみ影響を与えるように、[ルール](/rules)を更新または無効化します。リソース所有者のパスワー付与をテストしている際に`access_denied`エラーが発生した場合、アクセス制御ルールが原因である可能性があります。

## ステップ

1. [テナントを構成する](#configure-tenant)：**
**テナントのデフォルト接続を設定します。
2. [トークンを要求する](#request-tokens)： 
認可コードをトークンと交換します。
3. [APIを呼び出す](#call-api)：
取得したアクセストークンを使ってAPIを呼び出します。
4. [リフレッシュトークン](#refresh-tokens)：
既存のトークンが期限切れになったら、リフレッシュトークンを使用して新しいトークンを要求します。

任意：[サンプルユースケースを参考にしてください](#sample-use-cases)

任意：[レルムの対応を構成する](#configure-realm-support)

任意：[MFAの構成](#configure-mfa)

任意：[攻撃防御の設定](#configure-anomaly-detection)

### テナントを構成する

リソース所有者のパスワードフローは、ユーザー名とパスワードでユーザーを認証できる接続に依存しているため、テナントのデフォルト接続を設定する必要があります。

1. [［Auth0 Dashboard］>［Tenant Settings（テナント設定）］](%24%7Bmanage_url%7D/#/tenant)に移動し、下にスクロールして**［Default Directory（デフォルトディレクトリ）］**設定を見つけます。
2. 使用する接続の名前を入力します。ユーザー名とパスワードによるユーザー認証が可能であることを確認します。

### トークンを要求する



#### トークンURLへのPOSTの例



##### パラメーター



#### 応答

すべてが成功すると、`access_token`、`refresh_token`、`id_token`、`token_type`、および`expires_in`の値を含むペイロードとともに`HTTP 200`応答を受信します。











### APIを呼び出す

APIを呼び出すには、アプリケーションは、取得したアクセストークンをベアラートークンとしてHTTP要求の認証ヘッダーで渡さなければなりません。



### リフレッシュトークン



#### トークンURLへのPOSTの例



##### パラメーター



#### 応答







### サンプルユースケース

#### トークンをカスタマイズする

ルールを使用して、アクセストークンで返されたスコープを変更し、クレームをアクセスとIDトークンに追加することができます。（ルールの詳細については、「[Auth0ルール](/rules)」をお読みください。）これを行うには、ユーザーの認証後に実行される次のルールを追加します。



すべてのルールが実行された後、トークンでスコープが使用可能になります。



### レルムの対応を構成する

Auth0の拡張機能付与には、リソース所有者パスワード付与と似たような機能性がありますが、（別の接続にマッピングしている）別のユーザーディレクトリにして、フローで使用するものを個別に指定できるようになってます。

このバリエーションを使用するには、次のことを行う必要があります。

* `grant_type`要求パラメーターを`http://auth0.com/oauth/grant-type/password-realm`に設定します。
* `realm`という追加の要求パラメーターを送信し、それをユーザーが所属するレルムの名前に設定します。たとえば、内部の従業員用に`employees`という名前のデータベース接続を設定しており、そのユーザーがその接続に属している場合、`realm`を`employees`に設定します。



### MFAの構成

リソース所有者パスワードフローの使用が必要な反面、より強固な認証が要求される場合には、多要素認証（MFA）を追加することができます。方法については、「[MFAでリソース所有者のパスワードフローを使って認証する](/mfa/ropg-mfa)」をお読みください。

### 攻撃防御の設定

リソース所有者のパスワードフローと総当たり攻撃から保護する機能を併用した場合には、一部の防御機能が無効になる可能性があります。ただし、いくつかの問題は回避することができます。詳細については、「[リソース所有者のパスワードフローと攻撃防御のよくある不具合を回避する](/login/flows/avoid-common-issues-with-resource-owner-password-flow-and-attack-protection)」をお読みください。