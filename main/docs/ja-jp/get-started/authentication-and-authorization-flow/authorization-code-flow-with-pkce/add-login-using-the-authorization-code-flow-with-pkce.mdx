---
og:description: Learn how to add login to your native, mobile, or single-page application
  using the Authorization Code Flow with Proof Key for Code Exchange (PKCE).
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: PKCEを使った認可コードフローでログインを追加する
og:url: https://auth0.com/docs/
permalink: add-login-using-the-authorization-code-flow-with-pkce
title: PKCEを使った認可コードフローでログインを追加する
twitter:description: Learn how to add login to your native, mobile, or single-page
  application using the Authorization Code Flow with Proof Key for Code Exchange (PKCE).
twitter:title: PKCEを使った認可コードフローでログインを追加する
---

ネイティブやモバイル、シングルページのアプリケーションにログインを追加するのに、PKCEを使った認可コードフローを活用することができます。フローの仕組みやメリットについては、「[Proof Key for Code Exchange（PKCE）を使った認可コードフロー](/login/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce)」をお読みください。ネイティブやモバイル、シングルページのアプリケーションからAPIを呼び出す方法については、「[PKCEを使った認可コードフローで独自のAPIを呼び出す](/login/flows/call-your-api-using-the-authorization-code-flow-with-pkce)」をお読みください。

Proof Key for Code Exchange（PKCE）を使った認可コードフローを実装するには、以下のリソースを使用することができます。

* [Auth0 Mobile SDK](/libraries)と[Auth0 Single-Page App SDK](/libraries/auth0-single-page-app-sdk)：フローを実装する最も簡単な方法です。難しくて手間がかかる作業のほとんどが処理されます。[Mobile Quickstarts](/quickstart/native)と[Single-Page App Quickstarts](/quickstart/spa)でこのプロセスについて説明しています。
* [認証API](/api/authentication)：独自のソリューションを構築したい場合は、このまま読み続けて、APIを直接呼び出す方法を学習してください。

ログインに成功すると、アプリケーションがユーザーのIDトークンとアクセストークンにアクセスします。IDトークンには基本的なユーザープロファイル情報が含まれています。アクセストークンはAuth0の`/userinfo`エンドポイントや独自の保護されたAPIを呼び出すのに使用することができます。IDトークンの詳細については、「[IDトークン](/security/tokens/id-tokens)」をお読みください。アクセストークンの詳細については、「[アクセストークン](/security/tokens/access-tokens)」をお読みください。

## 前提条件

アプリをAuth0に登録する必要があります。詳細については、「[ネイティブアプリケーションを登録する](/get-started/create-apps/native-apps)」または「[シングルページWebアプリケーションを登録する](/get-started/create-apps/single-page-web-apps)」をお読みください。

* アプリケーションタイプに応じて、**［Native（ネイティブ）］**または**［Single-Page App（シングルページアプリ）］**の**［Application Type（アプリケーションタイプ）］**を選択します。
* `**YOUR_CALLBACK_URL**`の**［Allowed Callback URL（許可されているコールバックURL）］**を追加します。コールバックURLの形式は、使用しているアプリケーションタイプとプラットフォームによって異なります。アプリケーションタイプの形式とプラットフォームの詳細については、「[Mobile/Native Quickstarts](/quickstart/native)」と「[Single-Page App Quickstarts](/quickstart/spa)」を参照してください。
* アプリケーションの**［Grant Types（付与タイプ）］**に**［Authorization Code（認可コード）］**が必ず含まれていることを確認してください。詳細については、「[付与タイプを更新する](/applications/update-grant-types)」をお読みください。

## コードベリファイアを作成する



`code_verifier`を作成するアルゴリズムの詳細については、OAuth Proof Key for Code Exchange仕様の「[4.1 Client Creates a Code Verifier（クライアントがコード検証を作成）](https://datatracker.ietf.org/doc/html/rfc7636#section-4.1)」セクションをお読みください。

### Javascriptのサンプル



### Javaのサンプル



### Androidのサンプル



### Swift 5のサンプル



### Objective-Cのサンプル



## コードチャレンジを作成する



`code_challenge`が`code_verifier`からどのように派生するかの詳細については、OAuth Proof Key for Code Exchange仕様の「[4.2 Client Creates the Code Challenge（クライアントがコードチャレンジを作成）](https://datatracker.ietf.org/doc/html/rfc7636#section-4.)」セクションをお読みください。

### Javascriptのサンプル



### Javaのサンプル



### Swift 5のサンプル



### Objective-Cのサンプル



## ユーザーを認可する

ユーザーの認可を要求すると、`authorization_code`でアプリにリダイレクトされます。



### 認可URLの例



### パラメーター



たとえば、アプリにログインを追加する際の認可URLのHTMLスニペットは、以下のようになります。



### Response （レスポンス）

すべてが成功すると`、HTTP 302`応答を受け取ります。認可コードはURLの末尾に含まれます：



## トークンを要求する

`authorization_code`と`code_verifier`をトークンと交換します。



### トークンURLへのPOSTの例



### パラメーター



### Response （レスポンス）

すべてが成功すると、`access_token`、`refresh_token`、`id_token`、および`token_type`の値を含むペイロードとともに、HTTP 200の応答を受信します。







## ユースケース

### 基本的な認証要求

この例では、手順1でユーザーを認可する際に行う最も基本的な要求について説明します。Auth0のログイン画面を表示して、構成されている接続でユーザーがサインインできるようにします。



トークンを要求する際に、IDトークンには最も基本的なクレームが含まれます。IDトークンをデコードする際には、以下のようになります。



### ユーザーの名前とプロファイルの写真を要求する

通常のユーザー認証に加えて、この例では名前や写真など、追加のユーザー詳細情報を要求する方法について説明します。

ユーザーの名前や写真を要求するには、ユーザーを認可する際に、適切なスコープを追加する必要があります。



トークンを要求する際に、IDトークンには要求された名前と写真のクレームが含まれます。IDトークンをデコードする際には、以下のようになります。



### GitHubでのユーザーログインを要求する

通常のユーザー認証に加えて、この例では、ユーザーをGitHubなどのソーシャルIDプロバイダーへ直接送る方法について説明します。この例を利用するには、[［Auth0 Dashboard］ > ［Authentication（認証）］ > ［Social（ソーシャル）］](%24%7Bmanage_url%7D/#/connections/social)に移動して、適切な接続を構成する必要があります。**［Settings（設定）］**タブから接続名を取得します。

ユーザーをGitHubのログイン画面へ直接送るには、`connection`パラメーターを渡して、ユーザー認可時にその値を接続名（この場合は`github`）に設定します。



トークンを要求する際に、IDトークンにはGitHubから返されたユーザーの一意のIDを含む`sub`クレームが含まれます。IDトークンをデコードする際には、以下のようになります。