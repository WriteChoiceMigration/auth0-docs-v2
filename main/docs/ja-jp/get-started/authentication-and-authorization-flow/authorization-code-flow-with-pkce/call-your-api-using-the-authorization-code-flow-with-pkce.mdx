---
og:description: Learn how to call your API from a native, mobile, or single-page application
  using the Authorization Code flow using Proof Key for Code Exchange (PKCE).
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: PKCEを使った認可コードフローで独自のAPIを呼び出し
og:url: https://auth0.com/docs/
permalink: call-your-api-using-the-authorization-code-flow-with-pkce
title: PKCEを使った認可コードフローで独自のAPIを呼び出し
twitter:description: Learn how to call your API from a native, mobile, or single-page
  application using the Authorization Code flow using Proof Key for Code Exchange
  (PKCE).
twitter:title: PKCEを使った認可コードフローで独自のAPIを呼び出し
---



Auth0を使用すると、以下を使用して簡単にアプリでProof Key for Code Exchange（PKCE）を使用した認可コードフローを実装することができます。

* [Auth0 Mobile SDK](/libraries)と[Auth0 Single-Page App SDK](/libraries/auth0-single-page-app-sdk)：フローを実装する最も簡単な方法です。難しくて手間がかかる作業のほとんどが処理されます。[Mobile Quickstarts](/quickstart/native)と[Single-Page App Quickstarts](/quickstart/spa)でこのプロセスについて説明しています。
* [認証API](/api/authentication)：独自のソリューションを構築したい場合は、このまま読み続けて、APIを直接呼び出す方法を学習してください。

## 前提条件

**このチュートリアルを始める前に：**

* [Auth0にアプリケーションを登録します](/get-started/create-apps/native-apps)。

* アプリケーションタイプに応じて、**［Native（ネイティブ）］**または**［Single-Page App（シングルページアプリ）］**の**［Application Type（アプリケーションタイプ）］**を選択します。
* `**{yourCallbackUrl}**`の**［Allowed Callback URL（許可されているコールバックURL）］**を追加します。コールバックURLの形式は、使用しているアプリケーションタイプとプラットフォームによって異なります。アプリケーションタイプの形式とプラットフォームの詳細については、「[Mobile/Native Quickstarts](/quickstart/native)」と「[Single-Page App Quickstarts](/quickstart/spa)」を参照してください。
* アプリケーションの**［Grant Types（付与タイプ）］**に**［Authorization Code（認可コード）］**が必ず含まれていることを確認してください。詳細については、「[付与タイプを更新する](/applications/update-grant-types)」をお読みください。
* アプリケーションでリフレッシュトークンを使用できるようにするには、アプリケーションの**［Grant Types（付与タイプ）］**に**［Refresh Token（リフレッシュトークン）］**が含まれていることを確認してください。詳細については、「[付与タイプを更新する](/applications/update-grant-types)」をお読みください。リフレッシュトークンの詳細については、「[リフレッシュトークン](/security/tokens/refresh-tokens)」をお読みください。
* [APIをAuth0に登録する](/architecture-scenarios/mobile-api/part-2#create-the-api)

* APIがリフレッシュトークンを受信して、以前のトークンの有効期限が切れたときに新しいトークンを取得できるようにする場合は、**［Allow Offline Access（オフラインアクセスの許可）］**を有効にします。

## ステップ

1. [Code verifier（コード検証）を作成する](#create-code-verifier)： 
トークンを要求するためにAuth0に送信される`code_verifier`を生成します。
2. [コードチャレンジを作成する](#create-code-challenge)： 
`authorization_code`を要求するためにAuth0に送信される`code_verifier`から`code_challenge`を生成します。
3. [ユーザーを認可する](#authorize-user)： 
ユーザーの認可を要求すると、`authorization_code`でアプリにリダイレクトされます。
4. [トークンを要求する](#request-tokens)： 
`authorization_code`と`code_verifier`をトークンと交換します。
5. [APIを呼び出す](#call-api)：
取得したアクセストークンを使ってAPIを呼び出します。
6. [リフレッシュトークン](#refresh-tokens)：
既存のトークンが期限切れになったら、リフレッシュトークンを使用して新しいトークンを要求します。

任意：[サンプルユースケースを参考にしてください](#sample-use-cases)。

### コードベリファイアを作成する



#### Javascriptのサンプル



#### Javaのサンプル



#### Androidのサンプル



#### Swift 5のサンプル



#### Objective-Cのサンプル



### コードチャレンジを作成する



#### Javascriptのサンプル



#### Javaのサンプル



#### Swift 5のサンプル



#### Objective-Cのサンプル



### ユーザーを認可する



#### 認可URLの例



##### パラメーター





たとえば、APIを呼び出す際の認可URLのHTMLスニペットは、以下のようになります。



#### 応答

すべてが成功すると`、HTTP 302`応答を受け取ります。認可コードはURLの末尾に含まれます：



### トークンを要求する



#### トークンURLへのPOSTの例



##### パラメーター



#### 応答

すべてが成功すると、`access_token`、`refresh_token`、`id_token`、および`token_type`の値を含むペイロードとともに、HTTP 200の応答を受信します。







### APIを呼び出す

ネイティブ/モバイルアプリケーションからAPIを呼び出すには、アプリケーションは、取得したアクセストークンをBearerトークンとしてHTTP要求の認証ヘッダーで渡さなければなりません。



### リフレッシュトークン



#### トークンURLへのPOSTの例



##### パラメーター



#### 応答







### サンプルユースケース

#### トークンをカスタマイズする

ルールを使用して、アクセストークンで返されたスコープを変更し、クレームをアクセスとIDトークンに追加することができます。（ルールの詳細については、「[Auth0ルール](/rules)」をお読みください。）これを行うには、ユーザーの認証後に実行される次のルールを追加します。



すべてのルールが実行された後、トークンでスコープが使用可能になります。



#### サンプルアプリケーションを表示する：モバイルアプリ + API

サンプル実装の場合、[モバイル + API](/architecture-scenarios/application/mobile-api)アーキテクチャのシナリオを参照してください。この一連のチュートリアルには、付録に[GitHubで提供されているコードのサンプル](https://github.com/auth0-samples/auth0-pnp-exampleco-timesheets)があります。