---
og:description: Describes how to onboard with an M2M business case.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: セルフサービスマシンツーマシン
og:url: https://auth0.com/docs/
permalink: self-service-m2m
title: セルフサービスマシンツーマシン
twitter:description: Describes how to onboard with an M2M business case.
twitter:title: セルフサービスマシンツーマシン
---

ビジネスケースがAPIやバックエンドサーバーなどの非インタラクティブなオーディエンスにサービスを提供する場合は、マシンツーマシン（M2M）構成でオンボードします。

## ユースケース

次の場合は、M2Mオンボーディングパスを使用します。

* サービスツーサービス通信をサポートする
* 保護されたリソースまたはAPIにアクセスする必要があるサーバー上でスケジュールされたジョブまたはcronタスクが実行されている
* IoTデバイスがバックエンドサービスまたはAPIと通信できるようにする
* ユーザーの関与なし、またはユーザートークンの有効期限が切れた後に他のAPIレイヤーと通信する必要があるAPIレイヤーがある
* ユーザーが認証される前に呼び出す必要がある特権APIがある（つまり、Auth0テナントのアクションまたはカスタムデータベーススクリプトから）
* APIゲートウェイを使用してバックエンドサービスを管理する
* 非対話型アプリケーションや、daemonやバックエンドサービスなど人間との対話を含まないその他のツールを使用またはサポートする



## このガイドの使用方法

このガイドは、Auth0でM2M実装を作成するための経路です。検討すべき考慮事項、ベストプラクティス、概念を提供します。

* 「アーキテクチャ」では、ソフトウェア開発ライフサイクルと既存のインフラストラクチャをサポートするようにAuth0を構成することをお勧めします。
* 「アカウントの作成」では、Auth0でAPIインスタンスを作成する手順と、マシンツーマシン認証に必要な認証フロー（または権限許可）をサポートするアプリケーションを作成する手順を示します。
* 「認証」では、認証に使用する必要がある権限許可と、設定できるアクセストークンおよびアクセス許可（またはスコープ）について説明します。
* 「ブランディング」では、証明書の管理方法に応じて、カスタムドメインの構成方法に関する情報をどこで入手できるかをアドバイスします。
* 「デプロイメントの自動化」では、デプロイメントを支援するツールについて読むことができます。
* 「品質保証」では、ユニットテストと、Auth0 Dashboardで提供される準備チェックについて詳しく説明します。

## アーキテクチャ

Auth0アカウントとテナント、またはAuth0サービスのグループと構造を構成する前に、既存のエコシステムでAuth0の機能を最大限に活用できるように既存のインフラストラクチャのマップを作成します。

一般的なシナリオで説明したように、Auth0を構成する前に、アプリケーションドメイン、ネットワークドメイン、またはM2Mデバイスドメインに他の非対話型テクノロジーを考慮する必要があるかもしれません。M2Mシナリオの例を確認するには、「[サーバー + API](/architecture-scenarios/server-api/part-1)」を参照してください。Nodeを使ったハンズオン・ラボやAPIのデプロイをテストするには、[GitHubリポジトリ](https://www.google.com/url?q=https://github.com/auth0-training/labs-node-working-with-apis&sa=D&source=docs&ust=1723578190947730&usg=AOvVaw3IXRQG9ogH4pW6LEY047T6)にアクセスしてください。

現在の技術スタックを視覚化したり、Auth0が現在のソフトウェア開発ライフサイクル（SDLC）にどのように適合するかを計画したりできます。これは、必要なテナントの数を判断するのに役立ちます。

### 考慮事項

新しいアカウントを作成したり、最初のテナントを構成したりする前に、次の点を考慮する必要があります。

* 特定のエンドポイントを呼び出すためにAPIを分割またはグループ化する方法。

* これにより、アクセストークンのオーディエンスやその他のクレームが決定されます。
* リソースのサードパーティコンシューマーは、呼び出しごとにアクセストークンを要求する場合があります。呼び出しが多すぎると、[レート制限](/self-service-public)に影響する可能性があります。

## アカウントの作成

アーキテクチャの計画ができたので、Auth0アカウントとテナントを構成します。Auth0サービスにサインアップすると、最初の[テナント](/get-started/create-tenants)が作成されます。ここで、Auth0アセット、サービス、およびリソースを構成します。[サインアップ](https://auth0.com/signup)して開始します。



### テナントのプロビジョニング

アーキテクチャの計画ができたので、Auth0アカウントとを構成します。



#### APIの登録

このセクションでは、Auth0でAPIを作成します。





### アプリケーションの関連付け

アプリケーションとAPIの間に関連付けを作成して、アプリケーションがAPIからアクセストークンを要求できるようにする必要があります。クライアント権限許可について詳細は、認証のセクションで説明します。





## 認証

あるAPIを別のAPIから呼び出す場合、または認証されたユーザーコンテキストがない状況から呼び出す場合は、ユーザーではなくアプリケーションを認可する方法が必要です。これは、アプリケーションが認証され（`client_id`と`client_secret`を使用）、1回の呼び出しで認可される1ステッププロセスです。

非対話型アプリケーションまたはサービスの認証では、クライアント権限許可または認証フローを選択する必要があります。Auth 2.0[クライアントの資格情報フロー](https://tools.ietf.org/html/rfc6749#section-4.4)は、人間の介入を必要とせず、M2Mアプリケーションに最適です。



### クライアントの資格情報フローを構成する

Auth0 DashboardまたはManagement APIを使用して、アクセストークンと引き換えにクライアント資格情報を提供する認証フローを設定できます。

Auth0 DashboardまたはManagement APIを使用するには、「[付与タイプを更新する](/applications/update-grant-types)」の手順に従ってください。

### M2Mアクセストークン

トークンベースの認証では、非対話型クライアントは、[Authentication APIトークンエンドポイント](https://auth0.com/docs/customize/actions/flows-and-triggers/machine-to-machine-flow)への呼び出しで`client_id`と`client_secret`を提供し、[アクセストークン](/security/tokens/access-tokens)を取得します。このアクセストークンにより、保護されたAPIへのアクセスが許可されます。

デフォルトのプロファイルまたは形式は、2つのトークンプロファイルに関連付けられたAuth0トークンプロファイルです。トークンプロファイルをRFC 9068に変更することもできます。詳細については、「[アクセストークンのプロファイル](/access-token-profiles)」をお読みください。トークンが有効であることを確認するために、APIは[署名アルゴリズム](/applications/signing-algorithms)をチェックします。デフォルトの署名アルゴリズムは、キーベースのアルゴリズムであるRSA256です。



#### 例

`/oauth/token`エンドポイントへの要求は、次のサンプルのようになります。



応答は、次のサンプルのようになります。



#### トークンの有効期限

アクセストークンには、トークンの有効期間の制限があります。通信はバックチャネルで行われるため、リフレッシュトークンを使用してセッションを延長することはできません。アクセストークンの有効期限を1時間に設定することを検討してください。特定の環境に合わせて、セキュリティとパフォーマンスのバランスを取る必要がある場合があります。詳細については、「[アクセストークンのライフタイムを更新する](/security/tokens/access-tokens/update-access-token-lifetime)」を参照してください。

### Scopes（スコープ）

非対話型クライアントまたはサービスがAPIを呼び出す前に、APIが許可する権限またはスコープを定義する必要があります。Auth0 Dashboardでスコープを設定して、Authentication APIへの認証要求に含めることができます。APIスコープの使用方法についてその他の例は、「[APIスコープ](/apis/scopes/api-scopes)」を参照してください。

スコープを構成するには、Auth0 Dashboardの[APIの権限を追加](/apis/add-api-permissions)の手順に従うか、Management APIに提供されているサンプルを使用します。



## ブランディング

非対話型クライアントやバックチャネルで動作するサービスを提供する場合でも、既存のブランドの外観と雰囲気に合わせてエクスペリエンスをカスタマイズできます。

### カスタムドメイン

Auth0は、`/authorize`エンドポイントを呼び出してアクセストークンを要求するときに、カスタムドメインの使用をサポートします。



1. Auth0管理の証明書を使用してカスタムドメインを構成するには、「[Auth0管理証明書を使ってカスタムドメインを構成する](/custom-domains/auth0-managed-certificates)」の手順に従ってください。

1. 独自の証明書を管理する場合は、「[自己管理証明書を使ってカスタムドメインを構成する](/custom-domains/self-managed-certificates)」の手順に従ってください。
2. 「[カスタムドメインを使用したAPI構成](https://auth0.com/docs/customize/custom-domains/configure-features-to-use-custom-domains#apis)」を確認してください。カスタムドメインを組み込むには、API設定を調整する必要がある場合があります。

カスタムドメインで問題が発生した場合は、「[カスタムドメインのトラブルシューティング](/troubleshoot/troubleshoot-integration-and-extensibility/troubleshoot-custom-domains)」を確認してください。

## デプロイメント自動化

Auth0は、使用可能なデプロイメント自動化アプローチに関していくつかの異なるオプションをサポートしており、それぞれを組み合わせて使用することができます。



### CLIツールのデプロイ

アーキテクチャセクションで推奨されているように、開発、テスト、および本番用のAuth0テナントを用意する必要があります。これらのテナントは、品質チェックとテストのために同一の構成を共有する必要がありますが、環境間で構成が一致しないためにエラーが発生する可能性があります。たとえば、各環境には異なるクライアントIDとクライアントシークレットがあります。

これらの不一致エラーを軽減するには、Deploy CLIツールを使用して、Auth0インスタンスを既存のCI/CDパイプラインと統合できます。動的なキーワード置換を使用すると、同様の構成を共有するテナントの環境変数を置き換えることができます。詳細については、「[Deploy CLIツール](/deploy/deploy-cli-tool)」と「[キーワードの置換](/keyword-replacement)」をご覧ください。

### Real-time Webtask Logs拡張機能

Real-time Webtask Logs拡張機能は、`console.log`出力やその他の例外など、カスタムコードのすべてのログをリアルタイムで表示します。Auth0 Actionsまたはその他のカスタムロジックを使用している場合は、この拡張機能を使用してデバッグとトラブルシューティングを行うことができます。インストールと構成の詳細については、「[Real-time Webtask Logs拡張機能](/extensions/real-time-webtask-logs)」をご覧ください。

## 品質保証

品質保証は、本番稼働前に問題を特定する上で重要です。プロジェクトの性質に応じて、Auth0との統合の一環として検討する必要があるさまざまな種類の品質保証テストがあります。

* 予期しない本番負荷にさらされた場合、APIはどのように機能しますか?
* サードパーティアプリケーションによってレート制限はどのように影響を受けますか?

Auth0のウィジェットやユニバーサルログインのような機能を使用していない場合、多くのブラウザーやデバイスで、ユーザビリティやアクセシビリティのベストプラクティスをすぐに利用することはできません。機能要件が満たされ、予期しないイベントが正しく処理されるように、アプリケーションとAuth0の統合をテストするためのガイダンスと、Auth0 Actionsなどの個々の拡張モジュールのユニットテストが提供されています。また、Auth0の「[ペネトレーションテストポリシー](/support/policies/penetration-testing-policy)」を確認し、「[負荷テストポリシー](/support/policies/load-testing-policy)」と組み合わせて活用できるモックテストを完了して、予期しない負荷の下でもアプリケーションを確実に動作させることをお勧めします。

### ユニットテスト

ユニットテストは、Auth0 Actionsなどの拡張性のユニットを検証します。カスタムコードを使用している場合は、デプロイメント前にテストフレームワーク（[Mocha](https://mochajs.org/)など）を使用して追加コードをテストすることをお勧めします。

### モックテスト

Auth0の[負荷テストポリシー](/support/policies/load-testing-policy)と負荷テストの必要性のバランスを取るために、Auth0のエンドポイントのモックテストを作成するのが一般的です。これは、テストを制約することなく、構成が想定されたインターフェイスでの動作を確認するための有効な方法です。[MockServer](http://www.mock-server.com/)、[JSON Server](https://github.com/typicode/json-server)、さらに[Postman](https://learning.getpostman.com/docs/postman/mock_servers/setting_up_mock/)などのツールも使用できます。

## Deployment（デプロイ）

「[デプロイメントとモニタリング](/deploy)」のセクションでは、デプロイメントのベストプラクティスに関するガイダンスを提供しています。「[導入前](/deploy/pre-deployment)[の確認事項](/deploy/pre-deployment)」、特に組み込みの「[Auth0 Dashboard準備状況チェック](/deploy/pre-deployment/how-to-run-production-checks)」を確認することをお勧めします。

準備チェックを確認するには、[［Auth0 Dashboard］>［Run Readiness Checks（準備状況チェックの実行）］](%24%7Bmanage_url%7D/#/production-checks)を選択し、テナント名と環境タグの下のドロップダウンメニューを選択します。

フィルターを使用して、選択したアプリケーションに準備状況チェックを適用できます。**これらのチェックは、構成済みのAPIには適用されません**。

特定の構成に適用されないチェックについては、**［Dismiss（閉じる）］**を選択して最終結果から削除できます。

本番稼働前に最終チェックの「[デプロイメントのベストプラクティス](/not-found/70zpztJMDHy4q0bwO4Xzgn/deployment-best-practices)」を確認し、[ログ](/logs)を利用してサービスを監視することをお勧めします。