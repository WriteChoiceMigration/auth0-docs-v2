---
og:description: Understand the principle of scopes and how it is used with APIs.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: APIスコープ
og:url: https://auth0.com/docs/
permalink: api-scopes
title: APIスコープ
twitter:description: Understand the principle of scopes and how it is used with APIs.
twitter:title: APIスコープ
---

API開発者は、次のことを行います。

1. Decide which information you would like applications to be able to access on a user's behalf.
2. Define these access levels as custom scopes. (To learn what scopes are read [Scopes](/docs/get-started/apis/scopes).)
3. Identify these scopes so that calling applications can use them.

## APIスコープの使用方法

APIスコープは、さまざまな方法で使用できます。

* 呼び出す側のアプリケーションがサードパーティ（外部）アプリケーションであるAPI内で。この場合、呼び出す側のアプリケーションは、ユーザーに対し、要求されたスコープへのアクセスを認可するよう要求します。ユーザーは、要求を承認または拒否します。
* 呼び出す側のアプリケーションがファーストパーティアプリケーションであるか、同じAuth0ドメインの下で、呼び出しているAPIとして登録されたアプリケーションであるAPI内で。この場合、デフォルトではユーザーの同意は要求されませんが、同意の要求を構成することができます。
* 呼び出す側のアプリケーションが、ファーストパーティまたはサードパーティのバックエンドサービスであり、ユーザーが存在しないAPI内で。この場合、ユーザーの同意が要求されることはありません。

これらの例では、トークンを使用したアクセスを制限するために、スコープを使用します。その場合、APIにトークン以外のロジックも適用し、アクセス制御を強化することができます。

For an example showing how to request custom API access for your application, read [Sample Use Cases: Scopes and Claims](/docs/get-started/apis/scopes/sample-use-cases-scopes-and-claims).

### 例：サードパーティアプリケーションによって呼び出されるAPI

オンライン決済アプリケーションに銀行口座情報を提供するAPIをビルドするとしましょう。アプリは、複数の時点で口座残高や資金振替を読み取る必要があります。それには、APIのために2つのスコープ、つまり、口座残高の読み取りを認可するスコープ（`read:balance`）と、資金振替を認可するスコープ（`transfer:funds`）を作成します。APIは、Auth0で登録されています。

呼び出す側のアプリケーションは、ユーザーに対し、要求されたスコープへのアクセスを認可するよう要求します。ユーザーは、要求を承認または拒否します。アプリは、`read:balance`スコープを要求に含めることでユーザーの残高の読み取りアクセスを要求したり、`transfer:funds`スコープを要求に含めることで資金振替へのアクセスを要求したり、`read:balance`と`transfer:funds`の両方のスコープを要求に含めることでユーザーの残高の読み取りアクセスと資金振替へのアクセスの両方を要求できます。

さて、アプリがAPIを呼び出すとき、そこには、ユーザーが自身のコンテンツへのアクセスを認可したということを確認し、ユーザーがどのスコープを承認したかを示すトークンが含まれています。APIは、承認されたスコープに従い、ユーザーが認可した情報だけを呼び出す側のアプリケーションに提供します。

### 例：ファーストパーティアプリケーションによって呼び出されるAPI

Let's say you are building an API that provides data to an events application, which you have also written. You [implement role-based access control (RBAC)](/docs/manage-users/access-control/rbac), creating a role of `organizer` and a role of `participant`. Users with a role of `organizer` need to create and update events, whereas users with a role of `participant` need to view events and register for events. To do this, you create four scopes for your API: one that authorizes create access for events(`create:events`), one that authorizes update access for events (`update:events`), one that authorizes read-only access for events (`view:events`), and one that authorizes registration access for events (`register:events`). Both your API and event application are registered with Auth0, and the **Allow Skipping User Consent** for first-party applications option is enabled for your API. You have installed the Authorization Extension and configured an `organizer` role and created the `create:events` and `update:events` scopes for it, and assigned it to User A. You have also configured a `participant` role and created the `view:events` and `register:events` scopes for it, and assigned it to User B.

ユーザーAは、呼び出す側のアプリケーションで認証を行います。それによって必要なスコープが要求されますが、ファーストパーティアプリケーションであるため、ユーザーの同意は求められません。アプリは、`create:events`、`update:events`、`view:events`、`register:events`のいずれかのスコープの組み合わせを要求する可能性がありますが、ユーザーAは`organizer`ロールを持っていると認識されるため、`create:events`スコープと`update:events`スコープのみが付与されます。

さて、アプリがAPIを呼び出すとき、そこにはトークンが含まれます。そのトークンは、認証されたユーザーのロールに関連するスコープのみに対して認可を受けていることを確認します。

### 例：バックエンドサービスによって呼び出されるAPI

たとえば、あなたは医療従事者で、MRI検査を実施する度に大量の画像データを作成するAPIを持っているとしましょう。画像データは、ローカルで6か月間保管されますが、病院が規制に準拠するためには、長期間にわたる保管が必要です。そのため、病院には、画像データを毎晩コピーしてオフサイトのコールドストレージに保管し、ローカルの医療データを6か月の保管期間の後にすべて削除するサービスがあります。

それには、APIのために2つのスコープ、つまり、画像データの読み取りアクセスを認可するスコープ（`read:images`）と、画像データの削除アクセスを認可するスコープ（`delete:images`）を作成します。APIと自動サービスは、Auth0に登録されており、自動サービスがAPIのトークンを要求することも認可されています。

呼び出す側の自動サービスは、必要なスコープを要求しますが、ユーザーがいないので同意は求められません。サービスは、`read:images`スコープを要求に含めることで画像データの読み取りアクセスを要求したり、`delete:images`スコープを要求に含めることで削除アクセスを要求したり、`read:images`と`delete:images`の両方のスコープを要求に含めることで読み取りアクセスと削除アクセスの両方を要求したりする場合があります。

さて、自動サービスがAPIを呼ぶとき、そこには要求されたスコープに対する認可があることを検証するトークンが含まれます。

## APIスコープの制限

An application can include any scope defined for an API in its request. Instead of allowing all available scopes to be requested, however, you can limit scopes for certain users. For example, a user of your application can be given a role so that requests on their behalf are limited to just the scopes assigned to that role. To do this, you can [use the Authorization Extension](/docs/customize/extensions/authorization-extension) and create a custom rule. To learn more about Rules, read [Auth0 Rules](/docs/customize/rules).

To learn about this approach in more depth, read our [SPA+API Architecture Scenario](/docs/get-started/architecture-scenarios/spa-api/part-1). Specifically, you can review the [Configure the Authorization Extension](/docs/get-started/architecture-scenarios/spa-api/part-2#configure-the-authorization-extension) section to learn how to configure the Authorization Extension and create a custom Rule that will ensure scopes are granted based on a user's role.

## Learn more

* [Sample Use Cases: Scopes and Claims](/docs/get-started/apis/scopes/sample-use-cases-scopes-and-claims)
* [Add API Permissions](/docs/get-started/apis/add-api-permissions)
* [Customize Consent Prompts](/docs/customize/login-pages/customize-consent-prompts)
* [Configure Logical API for Multiple APIs](/docs/get-started/apis/set-logical-api)
* [Get Management API Access Tokens for Production](/docs/secure/tokens/access-tokens/management-api-access-tokens/get-management-api-access-tokens-for-production)
* [Get Management API Access Tokens for Testing](/docs/secure/tokens/access-tokens/management-api-access-tokens/get-management-api-access-tokens-for-testing)