---
og:description: Auth0 Configuration for the SPA + API architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0構成（SPA + API）
og:url: https://auth0.com/docs/
permalink: part-2
title: Auth0構成（SPA + API）
twitter:description: Auth0 Configuration for the SPA + API architecture scenario
twitter:title: Auth0構成（SPA + API）
---

In this section we will review all the configurations we need to apply at the [Auth0 Dashboard](https://manage.auth0.com/#).

## APIを作成する

Navigate to the [APIs section](https://manage.auth0.com/#/apis) of the dashboard, and click the **Create API** button.

APIについて、以下の詳細を入力するよう求められます。

* **［Name（名前）］**：APIのフレンドリー名。いずれの機能にも影響しません。
* **［Identifier（識別子）］**：APIに一意の識別子。URLの使用を推奨していますが、公開されたURLである必要はありません。Auth0がこのAPIを呼び出すことはありません。この値は後から変更することはできません。
* **<Tooltip tip="Signing Algorithm: Algorithm used to digitally sign tokens to ensure the token has not been tampered with." cta="View Glossary" href="/docs/glossary?term=Signing+Algorithm">Signing Algorithm</Tooltip>**: the algorithm to sign the tokens with. The available values are `HS256` and `RS256`. When selecting RS256 the token will be signed with the tenant's private key. To learn more about signing algorithms, see [Signing Algorithms](/docs/get-started/applications/signing-algorithms).

<Frame>![Dashboard - Applications - APIs - Create API - Popup](/images/cdy7uua7fh8z/4kIH4BQc4vDel2zhJ6lwCE/094cff6e8e1788c39796eb28ab1925ca/2024-06-27_14-50-24.png)</Frame>

必要な情報を入力し、**［Create（作成）］**ボタンをクリックします。

## スコープを構成する

アプリケーションが作成されたら、認可の際にアプリケーションが要求できるスコープを構成する必要があります。

APIの設定で、［Permissions（アクセス許可）］タブに移動します。このセクションでは、ビジネスケースのスコープ（`read:timesheets`、`create:timesheets`、`delete:timesheets`、`approve:timesheets`）を追加することができます。

<Frame>![Dashboard - Applications - APIs - Permissions](/images/cdy7uua7fh8z/xxMOKezob6gNHJ0CcKhcg/ccbb9bbab29576a96ed8425329ecffb4/dashboard-apis-edit_view-permissions.png)</Frame>

## アプリケーションを作成する

Autho0には、アプリケーションの種類が4つあります。

* **Native App** (used by mobile or desktop apps),
* **シングルページWebアプリ**
* **Regular Web App** and
* **Machine to Machine App** (used by CLIs, Daemons, or services running on your backend).

このシナリオでは、SPA用に新しいアプリケーションを作成するため、シングルページアプリケーションのタイプを選びます。

To create a new Application, navigate to the [dashboard](https://manage.auth0.com/#) and click on the [Applications](https://manage.auth0.com/#/applications) menu option on the left. Click the **+ Create Application** button.

アプリケーションの名前を設定し（ここでは`Timesheets SPA`とします）、タイプに`Single-Page Web App`を選択します。

**［Create（作成）］**をクリックします。

今のところは以上です。SPA実装を完了したら、ダッシュボードとこのアプリケーションの設定をもう一度確認し、構成にいくつかの変更を加えます。

## 認可拡張機能を設定する

You will need to ensure that the Authorization Extension is installed for your tenant. You can refer to the [Authorization Extension documentation](/docs/customize/extensions/authorization-extension) for details on how to do this.

### アクセス許可を定義する

次に、すでに定義済みのスコープ（`read:timesheets`、`create:timesheets`、`delete:timesheets`、`approve:timesheets`）に従って、必要なアクセス許可を定義する必要があります。

認可拡張機能で**［Permissions（アクセス許可）］**タブをクリックし、**［Create Permission（アクセス許可の作成）］**ボタンをクリックします。

ダイアログで、各アクセス許可の詳細を指定します。

アクセス許可の名前が、対応するスコープと完全に同一であることを確認します。

<Frame>![Dashboard - Extensions - Authorization Extension - Create Permission](/images/cdy7uua7fh8z/6G4X14X3A73IDRwOrkmttq/e0c20c44a32e0b39a6d8fb72731ffbaf/create-permission.png)</Frame>

引き続き、残りのすべてのスコープにアクセス許可を作成します。

### ロールを定義する

次に、従業員とマネージャーという2つのロールを構成しましょう。

**［Roles（ロール）］**タブで、**［Create Role（ロールの作成）］**ボタンをクリックし、**［Timesheets SPA（タイムシートSPA）］**アプリケーションを選択します。

**［Name（名前）］**と**［Description（説明）］**を`Employee`に設定し、`delete:timesheets`、`create:timesheets`、および`read:timesheets`のアクセス許可を選択します。**［Save（保存）］**をクリックします。

次に、同じ手順で`Manager`ロールを作成し、すべてのアクセス許可が選択されていることを確認します。

### ユーザーをロールに割り当てる

すべてのユーザーを`Manager`または`Employee`ロールに割り当てる必要があります。

認可拡張機能の**［Users（ユーザー）］**タブに移動し、ユーザーを選択します。

ユーザー情報画面で、**［Roles（ロール）］**タブに移動します。**［Add Role to User（ユーザーにロールを追加）］**ボタンをクリックし、適切なロールを選択します。

### 認可拡張機能を構成する

また、認可拡張機能に関するルールが公開されていることも確認する必要があります。

これを実行するには、認可拡張機能の右上にあるユーザーアバターをクリックして、**［Configuration（構成）］**を選択します。

**［Permissions（アクセス許可）］**が有効であることを確認し、**［Publish Rule（ルールの公開）］**をクリックします。

### トークンのスコープを検証するルールを作成する

The final step in this process is to create a Rule to check if the scopes contained in an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip> are valid based on the permissions assigned to the user. Any scopes which are not valid for a user should be removed from the Access Token.

In your <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>, go to the **Rules** tab. You should see the Rule created by the Authorization Extension. Click on the **Create Rule** button and select the **Empty Rule** template. You can give the Rule a name, such as **Access Token Scopes**, and then specify the following code for the Rule:

```javascript lines
function (user, context, callback) {
  var permissions = user.permissions || [];
  var requestedScopes = context.request.body.scope || context.request.query.scope;
  var filteredScopes = requestedScopes.split(' ').filter( function(x) {
    return x.indexOf(':') < 0;
  });

  var allScopes = filteredScopes.concat(permissions);
  context.accessToken.scope = allScopes.join(' ');

  callback(null, user, context);
}
```






上記のコードは、ユーザーのアクセス許可に有効な正しい形式のスコープ（例：`action:area`、`delete:timesheets`）のみが、すべてのアクセストークンに含まれることを確実にします。作業が完了したら、**［Save（保存）］**ボタンをクリックします。

ルールは、［Rules（ルール）］ページに表示されている順番に実行されます。そのため、作成した新しいルールが認可拡張機能のルールより下に来るようにしてください。そうすれば、認可拡張機能のルールより後に実行されます。