---
og:description: Learn about authentication users through Organizations for multi-tenant
  architectures.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: シングルIDプロバイダー：認証
og:url: https://auth0.com/docs/
permalink: authentication
title: シングルIDプロバイダー：認証
twitter:description: Learn about authentication users through Organizations for multi-tenant
  architectures.
twitter:title: シングルIDプロバイダー：認証
---

弊社のアーキテクチャシナリオでは、推奨されるベストプラクティスとして[ユニバーサルログイン](/login/universal-login)の使用など、[B2B認証](/architecture-scenarios/b2b/authentication)に関する汎用ガイダンスを提供しているため、ここに記載されるガイダンスと共に確認することをお勧めします。



ユーザーを認証するには、第1要素資格情報の処理が必要です。これがAuth0によって実行されるか、サードパーティのIDプロバイダー（IdP）によって実行されるかを問わず、Auth0 Organizations機能を使用する場合は、Auth0[ユニバーサルログインエクスペリエンス](/login/universal-login/universal-experience)機能も使用する必要があります。



## データベース接続

Hoekstra & Associatesの例を使って、Auth0データベース接続を介して認証されたユーザーを使った認証の実装の流れを見てみましょう。説明されているワークフローのほとんどは、通常、テクノロジースタックに関連するAuth0 SDKまたはライブラリーを使用して処理されます：

1. Hoekstra & AssociatesのJenniferはブラウザを開き、Travel0 Corporate BookingのHoekstra & Associatesのインスタンスに移動します。

1. JenniferがTravel0 Corporate BookingのHoekstra & Associatesのインスタンスでセッションクッキーをすでに有する場合、通常システムにログインしているので、ここで終了となります。詳細については、[シングルサインオン](/single-sign-on)を参照してください。
2. Hoekstra & AssociatesのTravel0 Corporate Bookingのインスタンスは、[認可コードフロー](/login/flows/authorization-code-flow)（[PKCE](/login/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce)の有無を問わず）を使用して、`/authorize`エンドポイントを呼び出し、[Auth0 SDK](/libraries)またはサードパーティライブラリーを使用してパラメーターを渡すことにより、Travel0 Auth0テナントにリダイレクトします：

1. `redirect_uri`: [`https://hoekstra.corp.travel0.net/login/callback`](https://hoekstra.corp.travel0.net/login/callback)
2. `response_type`: `code`
3. `state`：このセッションで生成された一意の[state](/attack-protection/state-parameters)
4. `scope`: `openid profile` ...
5. ユーザーに関して必要な情報に応じた、追加で必要な[OIDCスコープ](/apis/scopes/openid-connect-scopes)。
6. `client_id`：Hoekstra & AssociatesのTravel0 Corporate Bookingインスタンスのため、Travel0 Auth0テナントで作成されたアプリケーションに関連付けられているクライアントID
7. `organization`：使用するAuth0 Organization。組織が事前にわかっている場合は、`/authorize`への要求にこのパラメーターを含めることができます。これは、`organization=`organization_idの形式で指定されます。organization_idは、Auth0テナント内の対応するAuth0 Organization定義に関連付けられている識別子に設定されます。または、`/authorize`の呼び出しから`organization`パラメーターを省略し、第1要素認証の一部として適切な組織を選択するようにユーザーに求めるようAuth0テナントを構成することもできます。詳細については、「[Organizationの動作を定義する](/organizations/define-organization-behavior)」を参照してください。
3. Travel0 Auth0テナントは、ユーザーから資格情報を収集するために`/login`にリダイレクトします。JenniferがすでにHoekstra & Associatesでデータベースセッションを有する場合、手順3aおよび4はスキップされます。詳細については、[シングルサインオン](/single-sign-on)を参照してください。

1. 「[ブランディング](/architecture-scenarios/multiple-organization-architecture/single-identity-provider-organizations/branding)」で説明した通り、組織固有のブランドコラテラルを含めるように構成できる、ユニバーサルログインページが表示されます。
4. ユーザーが資格情報を入力し、［`login`（ログイン）］をクリックします。
5. Travel0 Auth0テナントは、ユーザーのクレデンシャルをチェックします。有効な場合は、[ルール](/rules)パイプラインが実行されます。ルールは、「[認可](/architecture-scenarios/multiple-organization-architecture/single-identity-provider-organizations/authorization)」で説明した通り、アクセス制御を取り扱うために使われます。ユーザーの資格情報が無効な場合には、ユーザーに再入力が要求されます。
6. 第1要素認証とルールの実行が成功すると、ユーザーは手順2で渡された`state`と`code`とともに、`redirect_uri`（[`https://hoekstra.corp.travel0.net/login/callback`](https://hoekstra.corp.travel0.net/login/callback)）にリダイレクトされます。
7. Hoekstra & AssociatesのTravel0 Corporate Bookingインスタンスが`state`を検証し、[`https://auth.travel0.net/oauth/token`](https://auth.travel0.net/oauth/token)でTravel0 Auth0のテナントを呼び出して、[IDトークン](https://auth0.com/docs/tokens/id-tokens)と引き換えに`code`とその`client id`および`client secret`を渡します。次に、IDトークンを使用して[`https://hoekstra.corp.travel0.net`](https://hoekstra.corp.travel0.net)のセッションが生成されます。
8. Hoekstra & AssociatesインスタンスのTravel0 Corporate Bookingインスタンスは、ユーザーに適切なページを表示します。

## エンタープライズ接続

エンタープライズ接続を介した認証は、非常によく似たプロセスに従います。MetaHexa Bankの例を使って、MetaHexa Bankへのエンタープライズ接続を介して認証されたユーザーに対して、この認証実装がどのように行われるかを見てみましょう。繰り返しますが、説明されているワークフローのほとんどは、通常、テクノロジースタックに関連付けられている関連するAuth0 SDKまたはライブラリーを使用して処理されます。

1. MetaHexa BankのAminthaがブラウザーを開き、MetaHexa BankのTravel0 Corporate Bookingのインスタンスに移動します。

1. AminthaがすでにMetaHexa BankのTravel0 Corporate Bookingのインスタンスのセッションクッキーを有する場合、通常システムにログインしているので、ここで終了します。詳細については、「[シングルサインオン](/single-sign-on)」を参照してください。
2. MetaHexa BankのTravel0 Corporate Bookingのインスタンスは、通常は[Auth0 SDK](/libraries)またはサードパーティライブラリーを使用して、`/authorize`エンドポイントを呼び出してパラメーターを渡すことにより、[認可コードフロー](/login/flows/authorization-code-flow)（[PKCE](/login/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce)の有無を問わず）を使用してTravel0 Auth0テナントにリダイレクトします：

1. `redirect_uri`：[`https://metahexa.corp.travel0.net/login/callback`](https://metahexa.corp.travel0.net/login/callback)
2. `response_type`: `code`
3. `state`：このセッションで生成された一意の[state](/attack-protection/state-parameters)
4. `scope`: `openid profile` ...
5. ユーザーに関して必要な情報に応じた、追加で必要な[OIDCスコープ](/apis/scopes/openid-connect-scopes)。
6. `client_id`：MetaHexa BankのTravel0 Corporate Bookingインスタンスのために、Travel0のAuth0テナントで作成されたアプリケーションに関連付けられているクライアントID。
7. `organization`：使用するAuth0 Organization。組織が事前にわかっている場合は、`/authorize`への要求にこのパラメーターを含めることができます。これは、`organization=`organization_idの形式で指定されます。organization_idは、Auth0テナント内の対応するAuth0 Organization定義に関連付けられている識別子に設定されます。または、`/authorize`の呼び出しから`organization`パラメーターを省略し、第1要素認証の一部として適切な組織を選択するようにユーザーに求めるようAuth0テナントを構成することもできます。詳細については、「[Organizationの動作を定義する](/organizations/define-organization-behavior)」を参照してください。
8. `connection`：MetaHexa Bank向けに構成された、Auth0 Enterprise Connectionの名称です。
3. Travel Auth0テナントは、第1要素の資格情報を認証するためにMetaHexa IdPにリダイレクトします。

1. ログインページが表示され、ユーザーが資格情報を入力します。AminthaがすでにMetaHexa IdPとのセッションを有する場合、ステップ3aと4はスキップされます。詳細については、「[シングルサインオン（SSO）](/single-sign-on)」を参照してください。
4. ユーザーが資格情報を入力し、［`login`（ログイン）］をクリックします。
5. 第1要素認証が成功すると、[ルール](/rules)パイプラインが実行されます。ルールは、「[認可](/architecture-scenarios/multiple-organization-architecture/single-identity-provider-organizations/authorization)」で説明した通り、アクセス制御を取り扱うために使われます。ユーザーの資格情報が無効な場合には、ユーザーに再入力が要求されます。



手順6から8は「[データベース接続](#database-connection)」シナリオと同じですが、ユーザーはジェニファーでなくてアミンサで、Hoekstra & AssociatesでなくMetaHexa Bank（`metahexa.corp.travel0.net`）が使われます。

## ソーシャル接続

ソーシャル接続による認証は、[エンタープライズ接続](#enterprise-connection)に関連付けられている認証と同様のパターンに従いますが、アップストリームIdPは特定のorganizationではなくソーシャルプロバイダーに関連付けられます。



ソーシャル接続では、ユーザーの分離をorganizationごとに一貫してモデル化することはできません。[カスタムソーシャル接続](/connections/social/oauth2)を使用するなどして、ソーシャルプロバイダーへの複数の接続を作成することで、ユーザーの分離をモデル化したくなる場合がありますが、これは行わないでください。こうした戦略により、複数の接続定義で同一のユーザーIDが作成されることになり、将来必ず問題が発生します。