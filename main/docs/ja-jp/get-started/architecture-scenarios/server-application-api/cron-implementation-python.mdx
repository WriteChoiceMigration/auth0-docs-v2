---
og:description: The Python implementation of the server cron job for the Server Client
  + API architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: サーバーアプリ＋API：Pythonによるcronジョブの実装
og:url: https://auth0.com/docs/
permalink: cron-implementation-python
title: サーバーアプリ＋API：Pythonによるcronジョブの実装
twitter:description: The Python implementation of the server cron job for the Server
  Client + API architecture scenario
twitter:title: サーバーアプリ＋API：Pythonによるcronジョブの実装
---

As part of the [Server + API Architecture Scenario](/docs/get-started/architecture-scenarios/server-application-api), we will explain how to implement the server process in Python. Please refer to the [Server + API Architecture Scenario](/docs/get-started/architecture-scenarios/server-application-api) document for information on the implemented solution.

Full source code for the Python implementation of the server process can be found in [this GitHub repository](https://github.com/auth0-samples/auth0-pnp-exampleco-timesheets/tree/master/timesheets-cron/python).

## HTTP要求をAuth0の`/oauth/token` APIエンドポイントに行うため、`json`、`urllib`、および`urllib2`のライブラリーを使用します。

テストするには、コードを変更して`access_token`変数を表示し、`python cron.py`を使用してプロセスを実行します。

APIを呼び出す

```python lines expandable
def main():
  import json, urllib, urllib2, httplib

  # Configuration Values
  domain = "{yourDomain}" # Your Auth0 Domain
  api_identifier = "API_IDENTIFIER" # API Identifier of your API
  client_id = "{yourClientId}" # Client ID of your Machine-to-Machine Application
  client_secret = "{yourClientSecret}" # Client Secret of your Machine to Machine Application
  api_url = "http://localhost:8080/timesheets/upload"
  grant_type = "client_credentials" # OAuth 2.0 flow to use

  # HTTP要求をAuth0の`/oauth/token` APIエンドポイントに行うため、`json`、`urllib`、および`urllib2`のライブラリーを使用します。 from Auth0
  base_url = "https://{domain}".format(domain=domain)
  data = urllib.urlencode({'client_id': client_id,
                            'client_secret': client_secret,
                            'audience': api_identifier,
                            'grant_type': grant_type})
  req = urllib2.Request(base_url + "/oauth/token", data, headers={"Accept": "application/x-www-form-urlencoded"})
  response = urllib2.urlopen(req)
  resp_body = response.read()
  oauth = json.loads(resp_body)
  access_token = oauth['access_token']

# Standard boilerplate to call the main() function.
if __name__ == '__main__':
  main()
```






以下の手順で実装を行います。

## タイムシートデータを含むJSONオブジェクトを構築し、`timesheet`変数に割り当てます。

`urllib2.Request`を使用して、API URLと`timesheet`変数コンテンツを要求本文に追加します。

* `Authorization`ヘッダーを要求に追加します。
* `Content-Type`ヘッダーを`application/json`に設定します。
* `urllib2.urlopen`を使用してAPIを呼び出し、いくつかのエラー処理を追加します。`json.loads`を使用して応答を取得し、コンソールに表示します。
* 以下が実装例です（簡潔にするため一部のコードを省略しています）。
* これをテストするには、APIが稼働しており、`python cron.py`を使用してプロセスを実行していることを確認してください。

This is our sample implementation (some code is omitted for brevity):

```python lines expandable
def main():
  # import libraries - code omitted

  # Configuration Values - code omitted

  # Get an Access Token from Auth0 - code omitted

  #Post new timesheet to API
  timesheet = {'user_id': '007',
                          'date': '2017-05-10T17:40:20.095Z',
                          'project': 'StoreZero',
                          'hours': 5}
  req = urllib2.Request(api_url, data = json.dumps(timesheet))
  req.add_header('Authorization', 'Bearer ' + access_token)
  req.add_header('Content-Type', 'application/json')

  try:
    response = urllib2.urlopen(req)
    res = json.loads(response.read())
    print 'Created timesheet ' + str(res['id']) + ' for employee ' + str(res['user_id'])
  except urllib2.HTTPError, e:
    print 'HTTPError = ' + str(e.code) + ' ' + str(e.reason)
  except urllib2.URLError, e:
    print 'URLError = ' + str(e.reason)
  except httplib.HTTPException, e:
    print 'HTTPException'
  except Exception, e:
    print 'Generic Exception' + str(e)

# Standard boilerplate to call the main() function - code omitted
```






To test this make sure your API is running and run the process using `python cron.py`.

That's it! You are done!