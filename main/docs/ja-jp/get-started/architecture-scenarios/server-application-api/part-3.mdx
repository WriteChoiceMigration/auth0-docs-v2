---
og:description: Application Implementation for the Server + API architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: アプリケーションの実装（サーバーアプリ + API）
og:url: https://auth0.com/docs/
permalink: part-3
title: アプリケーションの実装（サーバーアプリ + API）
twitter:description: Application Implementation for the Server + API architecture
  scenario
twitter:title: アプリケーションの実装（サーバーアプリ + API）
---

In this section of the tutorial, we will take an in-depth look into our API and its associated Machine-to-Machine Application. To start at the beginning, read [Server Applications with API](/docs/get-started/architecture-scenarios/server-application-api).

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

For simplicity, we will keep our implementation solely focused on authentication and authorization. As you will see in the samples, the input timesheet entry will be hard-coded, and the API will not persist the timesheet entry. Instead, it will simply echo back some of the info.

</Callout>

## APIエンドポイントを定義する

**APIエンドポイントは**リソース（データの集合）を表す静的URIです。

たとえば、レストランAPIには`/orders`や`/customers`などのエンドポイントがあるかもしれません。このAPIに接続するアプリケーションは、関連するHTTPメソッド（`POST`、`GET`、`PUT`、`PATCH`、`DELETE`）を使ってAPIエンドポイントを呼び出すことにより、CRUD操作（作成、読み取り、更新、削除）を実行することができます。

ExampleCoのTimesheets APIでは、エンドポイントを構成してタイムシートエントリを作成する必要があります。

<table class="table"><thead>
<tr>
<th><strong>HTTP method</strong></th>
<th><strong>API endpoint</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST</code></td>
<td><code>/timesheets/upload</code></td>
<td>Creates a new timesheet entry</td>
</tr>
</tbody>
</table>

```json lines
{
  'user_id': '007',
  'date': '2017-05-10T17:40:20.095Z',
  'project': 'StoreZero',
  'hours': 5
}
```






APIは要求を正しく処理すると、`HTTP 201 Created`ステータスコードともに、JSONオブジェクトを含んだボディーを返します。このJSONオブジェクトには、新規作成されたタイムシートを記述するメッセージプロパティが含まれています。

```json lines
{
"message": "Created timesheet 14 for employee 007."
}
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

See the implementation in [Node.js](/docs/get-started/architecture-scenarios/server-application-api/api-implementation-nodejs#1-define-the-api-endpoint).

</Callout>

### APIエンドポイントを保護する

APIエンドポイントを保護するには、APIアプリケーション内でミドルウェア関数を実装し、トークンを処理する必要があります。この関数は、トークンがAPI要求に含まれているかを確認し、トークンを検証してから、要求されたアクションの実行に必要なスコープの有無を確認します。

If all criteria are satisfied, the API application responds with the message mentioned previously. If there are any issues with the provided <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+token">access token</Tooltip> (or it’s not provided at all), the API application sends a response with the `HTTP 401 Unauthorized` status code.

**See the implementation in** [**Node.js**](/docs/get-started/architecture-scenarios/server-application-api/api-implementation-nodejs#2-secure-the-api-endpoint)**.**

#### このためには、[アプリケーションの設定](%24%7Bmanage_url%7D/#/applications)にある以下の構成値が必要です。

To get an access token without using our application sample implementation, call the Auth0 Authentication API's [Get Token](https://auth0.com/docs/api/authentication#get-token54) endpoint with the following payload:

{/* codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet */}


```json lines
{
  audience: "{yourApiIdentifier}",
  grant_type: "client_credentials",
  client_id: "${account.client_id}",
  client_secret: "${account.client_secret}"
}
```






## アクセストークンでAPIのエンドポイントはセキュリティ保護されましたが、APIを呼び出すプロセスに新しいタイムシートのエントリをPOSTする権限があるかは未確認のままです。

前述のように、それぞれのアクセストークンには、アプリケーションに付与されたアクセス権限のリストが含まれます。これらの権限は、`scope`要求パラメーターを使って定義されます。これを構成する方法については、「[スコープを構成する](/get-started/architecture-scenarios/server-application-api/part-3#configure-the-scopes)」記述のある段落をお読みください。

As discussed earlier, each access token may include a list of the permissions that have been granted to the application. These permissions are defined using the `scope` request parameter. To learn how to configure this, see the [Configure the Scopes](/docs/get-started/architecture-scenarios/server-application-api/part-3#configure-the-scopes) paragraph.

マシンツーマシンアプリケーションを実装する

**See the implementation in** [**Node.js**](/docs/get-started/architecture-scenarios/server-application-api/api-implementation-nodejs#3-check-the-client-permissions)**.**

### アクセストークン取得する

まず、Auth0の`/oauth/token` APIエンドポイントを呼び出して、アクセストークンを取得します。

### このためには、[アプリケーションの設定](%24%7Bmanage_url%7D/#/applications)にある以下の構成値が必要です。

**Domain（ドメイン）**：Auth0ドメイン（テナント識別子でもある）です。この値は、APIのURL「`

To do so, we will need the following configuration values you can find in your [application settings](https://manage.auth0.com/#/applications):

* **Domain**: Auth0 Domain and also your tenant identifier. This value will be a part of the API URL: `https://{yourTenant}/oauth/token`.
* **<Tooltip tip="Audience: Unique identifier of the audience for an issued token. Named aud in a token, its value contains the ID of either an application (Client ID) for an ID Token or an API (API Identifier) for an Access Token." cta="View Glossary" href="/docs/glossary?term=Audience">Audience</Tooltip>**: API identifier.
* **<Tooltip tip="Client ID: Identification value given to your registered resource from Auth0." cta="View Glossary" href="/docs/glossary?term=Client+ID">Client ID</Tooltip>**: Auth0 Application's Client ID.
* **<Tooltip tip="Client Secret: Secret used by a client (application) to authenticate with the Authorization Server; it should be known to only the client and the Authorization Server and must be sufficiently random to not be guessable." cta="View Glossary" href="/docs/glossary?term=Client+Secret">Client Secret</Tooltip>**: Auth0 application's Client Secret.

Our implementation should perform a `POST` operation to the `https://{yourDomain}/oauth/token` endpoint with a payload in the following format:

{/* codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet */}


```json lines
{
  "audience": "{yourApiIdentifier}",
  "grant_type": "client_credentials",
  "client_id": "${account.client_id}",
  "client_secret": "${account.client_secret}"
}
```






To learn more, see [Call Your API Using the Client Credentials Flow](/docs/get-started/authentication-and-authorization-flow/client-credentials-flow/call-your-api-using-the-client-credentials-flow).

**See the implementation in** [**Python**](/docs/get-started/architecture-scenarios/server-application-api/cron-implementation-python#get-an-access-token).

## コードに埋め込まれたタイムシートエントリをJSON形式で構築する

アクセストークンを`Authorization`ヘッダーとして要求に追加する

HTTP `POST`要求を行う

* 応答を解析し、ターミナルに出力する（任意）
* Add the access token as an `Authorization` header to our request.
* Make the HTTP `POST` request.
* Parse the response, and print it in the terminal (optional).

**See the implementation in** [**Python**](/docs/get-started/architecture-scenarios/server-application-api/cron-implementation-python#invoke-the-api).