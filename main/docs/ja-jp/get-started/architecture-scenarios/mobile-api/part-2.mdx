---
og:description: Auth0 Configuration for the Mobile + API architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0の構成（モバイルアプリ + API）
og:url: https://auth0.com/docs/
permalink: part-2
title: Auth0の構成（モバイルアプリ + API）
twitter:description: Auth0 Configuration for the Mobile + API architecture scenario
twitter:title: Auth0の構成（モバイルアプリ + API）
---

In this section we will review all the configurations we need to apply at the [Auth0 Dashboard](https://manage.auth0.com/#).

## APIを作成する

Click on the [APIs menu option](https://manage.auth0.com/#/apis) on the left, and click the Create API button.

APIについて、以下の詳細を入力する必要があります。

* **［Name（名前）］**：APIのフレンドリー名。機能性には影響しません。
* **［Identifier（識別子）］**：APIに一意の識別子。URLの使用を推奨していますが、公開されたURLである必要はありません。Auth0がこのAPIを呼び出すことはありません。この値は後から変更することはできません。
* **<Tooltip tip="Signing Algorithm: Algorithm used to digitally sign tokens to ensure the token has not been tampered with." cta="View Glossary" href="/docs/glossary?term=Signing+Algorithm">Signing Algorithm</Tooltip>**: the algorithm to sign the tokens with. The available values are `HS256` and `RS256`. When selecting RS256 the token will be signed with the tenant's private key. To learn more about signing algorithms, see [Signing Algorithms](/docs/get-started/applications/signing-algorithms).

<Frame>![Dashboard - Applications - APIs - Create API - Popup](/images/cdy7uua7fh8z/4kIH4BQc4vDel2zhJ6lwCE/094cff6e8e1788c39796eb28ab1925ca/2024-06-27_14-50-24.png)</Frame>

必要な情報を入力し、**［Create（作成）］**ボタンをクリックします。

#### 署名アルゴリズム

When you create an API you have to select the algorithm your tokens will be signed with. The signature is used to verify that the sender of the <Tooltip tip="JSON Web Token (JWT): Standard ID Token format (and often Access Token format) used to represent claims securely between two parties." cta="View Glossary" href="/docs/glossary?term=JWT">JWT</Tooltip> is who it says it is and to ensure that the message wasn't changed along the way.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

The signature is part of a JWT. If you are unfamiliar with JWT structure, please see [JSON Web Token Structure](/docs/secure/tokens/json-web-tokens/json-web-token-structure).

</Callout>

署名部分を作成するには、エンコードされたヘッダー、エンコードされたペイロード、シークレット、ヘッダーで指定されたアルゴリズムを使用して、それに署名します。APIに選択するのは、JWTヘッダーに含まれている`HS256`または `RS256`のアルゴリズムです。

* **RS256** is an [asymmetric algorithm](https://en.wikipedia.org/wiki/Public-key_cryptography) which means that there are two keys: one public and one private (secret). Auth0 has the secret key, which is used to generate the signature, and the consumer of the JWT has the public key, which is used to validate the signature.
* **HS256** is a [symmetric algorithm](https://en.wikipedia.org/wiki/Symmetric-key_algorithm) which means that there is only one secret key, shared between the two parties. The same key is used both to generate the signature and to validate it. Special care should be taken in order for the key to remain confidential.

**RS256**の使用が最も安全で推奨されます。それには以下のような理由があります。

* RS256では、秘密鍵の所有者（Auth0）のみがトークンに署名できる一方、誰でも公開鍵を使ってトークンの有効性を確認できます。
* HS256では、秘密鍵が侵害されると、新しいシークレットでAPIをデプロイし直す必要があります。RS256では、複数のオーディエンスに有効なトークンを要求できます。
* RS256では、新しいシークレットを使ってAPIをデプロイし直すことなく、鍵のローテーションを実装できます。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

For a more detailed overview of the JWT signing algorithms refer to: [JSON Web Token (JWT) 署名アルゴリズム Overview](https://auth0.com/blog/json-web-token-signing-algorithms-overview/).

</Callout>

### アクセス許可を構成する

アプリケーションが作成されたら、認可の際にアプリケーションが要求できるアクセス許可を構成する必要があります。

APIの設定で、**［Permissions（アクセス許可）］**タブに移動します。このセクションでは、以前に説明した4つのスコープ（`read:timesheets`、`create:timesheets`、`delete:timesheets`、`approve:timesheets`）すべてを追加することができます。

<Frame>![Dashboard - Applications - APIs - Permissions](/images/cdy7uua7fh8z/xxMOKezob6gNHJ0CcKhcg/ccbb9bbab29576a96ed8425329ecffb4/dashboard-apis-edit_view-permissions.png)</Frame>

## アプリケーションを作成する

Autho0には、**ネイティブアプリ**（モバイルアプリまたはデスクトップアプリで使用）、**シングルページWebアプリ**、**通常のWebアプリ**、**マシンツーマシンアプリ**（CLI、デーモン、またはバックエンドで実行中のサービスで使用）の4つのタイプのアプリケーションがあります。このシナリオでは、モバイルアプリケーション用に新しいアプリケーションを作成するため、アプリケーションタイプに［Native （ネイティブ）］を選びます。

To create a new Application, navigate to the [dashboard](https://manage.auth0.com/#) and click on the [Applications](https://manage.auth0.com/#/applications) menu option on the left. Click the **+ Create Application** button.

アプリケーションの名前を設定し（ここでは「`Timesheets Mobile`」とします）、タイプに`［Native App（ネイティブアプリ）］`を選択します。

**［Create（作成）］**をクリックします。

## 認可拡張機能を構成する

You will need to ensure that the Authorization Extension is installed for your tenant. You can refer to the [Authorization Extension documentation](/docs/customize/extensions/authorization-extension) for details on how to do this.

### アクセス許可を定義する

すでに定義済みのスコープに関するアクセス許可を定義する必要があります。［Authorization Extension（認可拡張機能）］で［Permissions（アクセス許可）］タブをクリックし、**［Create Permission（アクセス許可の作成）］**ボタンをクリックします。ダイアログで、各アクセス許可の詳細を指定します。アクセス許可の名前が、対応するスコープと完全に同一であることを確認します。

引き続き、残りのすべてのスコープにアクセス許可を作成します。

### ロールを定義する

［Roles（ロール）］タブに移動し、2つのロールを作成します。**［Create Role（ロールの作成）］**ボタンをクリックし、**［Timesheets SPA（タイムシートSPA）］**アプリケーションを選択します。ロールに「Employee（従業員）」という名前と説明を付けて、`delete:timesheets`、`create:timesheets`と`read:timesheets`のアクセス許可を選択します。**［Save (保存)］**をクリックします。

次に、同じ手順で「**Manager（マネージャー）**」ロールを作成し、すべてのアクセス許可が選択されていることを確認します。

<Frame>![Dashboard - Extensions - Authorization Extension - Create Manager Role](/images/cdy7uua7fh8z/3ver0yyJpTLypmcIDzwSNt/d880e8ae74e6e973c7ce1c8b0f7e7c87/create-manager-role.png)</Frame>

### ユーザーをロールに割り当てる

すべてのユーザーを「Manager （マネージャー）」または「User（ユーザー）」ロールに割り当てる必要があります。［Authorization Extension（認可拡張機能）］の［Users（ユーザー）］タブに移動し、ユーザーを選択します。ユーザー情報画面で、［Roles（ロール）］タブに移動します。**［Add Role to User（ユーザーにロールを追加）］**ボタンをクリックし、ユーザーに適切なロールを選択することで、ユーザーにロールを追加することができます。

### 認可拡張機能を構成する

また、認可拡張機能に関するルールが公開されていることも確認する必要があります。これを実行するには、［Authorization Extension（認可拡張機能）］の右上にあるユーザーアバターをクリックして、**［Configuration（構成）］**オプションを選択します。

**［Permissions（アクセス許可）］**が有効になっていることを確認してから、**［Publish Rule（ルールの公開）］**ボタンをクリックします。

### トークンのスコープを検証するルールを作成する

The final step in this process is to create a Rule which will validate that the scopes contained in an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip> is valid based on the permissions assigned to the user. Any scopes which are not valid for a user should be removed from the Access Token.

In your <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>, go to the Rules tab. You should see the Rule created by the Authorization Extension.

**［Create Role（ルールの作成）］**ボタンをクリックし、**［Empty Rule（空のルール）］**テンプレートを選択します。このルールに「**Access Token Scopes（アクセストークンスのコープ）**」のような名前を付けて、そのルールに次のコードを指定することができます。

```javascript lines
function (user, context, callback) {
  if (context.clientName !== 'Timesheets SPA') {
    return callback(null, user, context);
  }

  var permissions = user.permissions || [];
  var requestedScopes = context.request.body.scope || context.request.query.scope;
  var filteredScopes = requestedScopes.split(' ').filter( function(x) {
    return x.indexOf(':') < 0;
  });
  Array.prototype.push.apply(filteredScopes, permissions);
  context.accessToken.scope = filteredScopes.join(' ');

  callback(null, user, context);
}
```






上記のコードは、ユーザーの権限に有効な正しい形式のスコープ（例：`action:area`、`delete:timesheets`）のみが、すべてのアクセストークンに含まれることを確実にします。作業が完了したら、**［Save（保存）］** ボタンをクリックします。

ルールは、［Rules（ルール）］ページに表示されている順番に実行されます。そのため、作成した新しいルールが認可拡張機能のルールより下に来るようにしてください。そうすれば、認可拡張機能のルールより後に実行されます。

PREVIOUS TUTORIAL [1. Solution Overview](/docs/get-started/architecture-scenarios/mobile-api/part-1)

NEXT TUTORIAL [3. API + Mobile Implementation](/docs/get-started/architecture-scenarios/mobile-api/api-implementation-nodejs)