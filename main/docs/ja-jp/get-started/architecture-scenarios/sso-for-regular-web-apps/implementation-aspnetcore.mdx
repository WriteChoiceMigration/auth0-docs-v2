---
og:description: The ASP.NET Core implementation for the Single Sign-on (SSO) for Regular
  Web Apps architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ASP.NET Coreの実装（Webアプリ + SSO）
og:url: https://auth0.com/docs/
permalink: implementation-aspnetcore
title: ASP.NET Coreの実装（Webアプリ + SSO）
twitter:description: The ASP.NET Core implementation for the Single Sign-on (SSO)
  for Regular Web Apps architecture scenario
twitter:title: ASP.NET Coreの実装（Webアプリ + SSO）
---

ASP.NET Coreの実装で使用する全ソースコードは、[こちらのGitHubリポジトリ](https://github.com/auth0-samples/auth0-pnp-webapp-oidc)でご覧いただけます。

## クッキーおよびOIDCミドルウェアを構成する

このガイドの目的のために、シンプルなホスト型ログインを使用します。標準クッキーと、ASP.NET Coreで利用できるOIDCミドルウェアを使用できるため、NuGetパッケージをインストールしてください。



その後、アプリケーションのミドルウェアパイプライン内でクッキーとOIDCミドルウェアを構成します。



上記のコードでは、2つの異なるタイプの認証ミドルウェアを構成しました。

1つ目は、`UseCookieAuthentication`の呼び出しに登録されたクッキーミドルウェアです。2つ目は、`UseOpenIdConnectAuthentication`の呼び出しで実行されるOIDCミドルウェアです。

ユーザーがOIDCミドルウェアを使用してAuth0にサインインすると、ユーザーの情報はセッションクッキー内に自動的に保存されます。上記の通りにミドルウェアを構成するだけで、ユーザーセッションは管理されます。

OpenID Connect（OIDC）ミドルウェアはまた、ユーザーが認証されたらAuth0から送信されるIDトークンからクレームすべてを抽出し、それを`ClaimsIdentity`のクレームとして追加します。

## ログアウトを実装する

`AuthenticationManager`クラスの`SignOutAsync`メソッドを使用し、サインアウトしたい認証スキームを伝えて、アプリケーションセッションとAuth0セッションの両方をコントロールできます。

クッキーミドルウェアのサインアウトと、それによるアプリケーションの認証クッキーの消去の例として、以下の呼び出しを作成できます。



同様に、`SignOutAsync`メソッドを呼び出し、サインアウトするために認証スキームとして`Auth0`を伝えることで、ユーザーをAuth0からログアウトできます。



ただし上記が機能するためには、`OnRedirectToIdentityProviderForSignOut`イベントを処理して、OIDCミドルウェアを登録するときに別の構成を追加する必要があります。イベント内で、Auth0クッキーを消去する[Auth0ログアウトエンドポイント](https://auth0.com/docs/api/authentication/reference#logout)にリダイレクトする必要があります。



また、Auth0 Dashboard内のアプリケーションのために、アプリケーションのURLを**［Allowed Logout URLs（許可されているログアウトURL）］**に追加する必要があります。詳細については、[ログアウト](https://auth0.com/docs/logout)を参照してください。

## 管理者権限の実装

グループをASP.NET Coreアプリケーションに組み入れる最も簡単な方法は、ASP.NET Coreで利用可能な組み込みの[ロールベースの認可](https://docs.asp.net/en/latest/security/authorization/roles.html)を使用することです。これを達成するには、ユーザーが割り当てられるそれぞれのグループについて、



上記タイプのクレームを追加する必要があります。

クレームが追加されたら、クレームを`[Authorize(Roles = "Admin")]`属性で装飾することで、簡単に特定のアクションを`Admin`のみに利用可能にできます。また、コントローラー内で`User.IsInRole("Admin")`を呼び出して、ユーザーがコードの特定のロールかどうかを確認できます。

ASP.NET OIDCミドルウェアは、JWTで返されたすべてのクレームを、クレームとして`ClaimsIdentity`に自動的に追加します。このため、`authorization`クレームから情報を抽出し、クレームのJSONボディーを逆シリアル化して、グループごとに、`http://schemas.microsoft.com/ws/2008/06/identity/claims/role`クレームを`ClaimsIdentity`に追加する必要があります。



その後、管理者にタイムシートの承認を許可するアクションを追加できます。