---
og:description: Understand how user accounts can be linked in Auth0 from various identity
  providers.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ユーザーアカウントのリンク
og:url: https://auth0.com/docs/
permalink: user-account-linking
sidebarTitle: ユーザーアカウントのリンク
title: ユーザーアカウントのリンク
twitter:description: Understand how user accounts can be linked in Auth0 from various
  identity providers.
twitter:title: ユーザーアカウントのリンク
---

Auth0 supports the linking of user accounts from various <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+providers">identity providers</Tooltip>. This allows a user to authenticate from any of their accounts and still be recognized by your app and associated with the same user profile.

<Card title="Availability varies by Auth0 plan">

Both your specific login implementation and your Auth0 plan or custom agreement affect whether this feature is available. To learn more, read [Pricing](https://auth0.com/pricing).

</Card>

Auth0 treats all identities as separate by default. For example, if a user logs in first against the Auth0 database and then via Google or Facebook, these two attempts would appear to Auth0 as two separate users. You can implement functionality to enable a user to explicitly link accounts. In this scenario, the user would log in with an initial provider, perhaps Google. Your application would provide a link or button to enable them to link another account to the first one. The user would click on this link/button and your application would make a call so that when the user logs in with the second provider, the second account is linked with the first.

## アカウントをリンクする利点

* ユーザーが、IDプロバイダーごとに個別のプロファイルを作成せずに、任意のIDプロバイダーを使用してログインできること
* Allows registered users to use a new social or <Tooltip tip="Passwordless: Form of authentication that does not rely on a password as the first factor." cta="View Glossary" href="/docs/glossary?term=passwordless">passwordless</Tooltip> login but continue using their existing profile
* パスワードレスログインを使用して登録したユーザーが、より詳細なプロファイルを有するアカウントにリンクできるようになること
* アプリケーションが、様々な接続に保存されているユーザープロファイルデータを取得できるようになること

## 注意事項

アカウントリンクが安全でないと、悪意のあるアクターが正当なユーザーアカウントにアクセスできるようになってしまいます。以下の点を常に念頭に置いてください：

For both manual and automatic account links, your tenant should request authentication for **both** accounts before linking occurs.

また、**すべての**手動アカウントリンクで、ユーザーに資格情報の入力を求める必要があります。

## 仕組み

アカウントをリンクするプロセスでは、2つの既存のユーザープロファイルが1つにマージされます。アカウントをリンクする場合は、**プライマリアカウント**と**セカンダリアカウント**を指定する必要があります。

次の例では、サンプルのプライマリアカウントとセカンダリアカウントに対して、リンクされたプロファイルがどのようになるかを説明しています。

<CodeGroup>
```json Profile of primary account lines expandable
{
  "email": "your0@email.com",
  "email_verified": true,
  "name": "John Doe",
  "given_name": "John",
  "family_name": "Doe",
  "picture": "https://lh3.googleusercontent..../photo.jpg",
  "gender": "male",
  "locale": "en",
  "user_id": "google-oauth2|115015401343387192604",
  "identities": [
    {
      "provider": "google-oauth2",
      "user_id": "115015401343387192604",
      "connection": "google-oauth2",
      "isSocial": true
    }
  ],
  "user_metadata": {
    "color": "red"
  },
  "app_metadata": {
    "roles": [
      "Admin"
    ]
  },
  ...
}
```

```json Profile of secondary account lines
{
  "phone_number": "+14258831929",
  "phone_verified": true,
  "name": "+14258831929",
  "updated_at": "2015-10-08T18:35:18.102Z",
  "user_id": "sms|560ebaeef609ee1adaa7c551",
  "identities": [
    {
      "user_id": "560ebaeef609ee1adaa7c551",
      "provider": "sms",
      "connection": "sms",
      "isSocial": false
    }
  ],
  "user_metadata": {
    "color": "blue"
  },
  "app_metadata": {
    "roles": [
      "AppAdmin"
    ]
  },
  ...
}
```

```json Linked profile lines expandable
{
  "email": "your0@email.com",
  "email_verified": true,
  "name": "John Doe",
  "given_name": "John",
  "family_name": "Doe",
  "picture": "https://lh3.googleusercontent..../photo.jpg",
  "gender": "male",
  "locale": "en",
  "user_id": "google-oauth2|115015401343387192604",
  "identities": [
    {
      "provider": "google-oauth2",
      "user_id": "115015401343387192604",
      "connection": "google-oauth2",
      "isSocial": true
    },
    {
      "profileData": {
        "phone_number": "+14258831929",
        "phone_verified": true,
        "name": "+14258831929"
      },
      "user_id": "560ebaeef609ee1adaa7c551",
      "provider": "sms",
      "connection": "sms",
      "isSocial": false
    }
  ],
  "user_metadata": {
    "color": "red"
  },
  "app_metadata": {
    "roles": [
      "Admin"
    ]
  },
  ...
}
```
</CodeGroup>

以下にご注意ください：

* `user_id`およびその他のすべてのメインプロファイルのプロパティは、引き続きプライマリIDのプロパティであること
* `user.identities`配列の最初のIDが、プライマリIDであること
* これで、セカンダリアカウントがプライマリプロファイルの`user.identities`配列に埋め込まれること
* セカンダリアカウントの属性は、配列内の対応するIDの`profileData`フィールド内に配置されること
* プライマリアカウントの`user_metadata`と`app_metadata`は、変更されていないこと
* セカンダリアカウントの`user_metadata`と`app_metadata`は、破棄されること
* ユーザープロファイルと関連付けられたIDの自動マージは、行われないこと
* セカンダリアカウントは、ユーザーリストから削除されること
* プライマリアカウントを削除すると、セカンダリアカウントも削除されること

### メタデータのマージ

Metadata is not automatically merged during account linking. If you want to merge it, you have to do it manually using the Manage API [`/users/patch_users_by_id`](https://auth0.com/docs/api/v2#!/Users/patch_users_by_id) endpoint.

The [Auth0 Node.js SDK for APIv2](https://github.com/auth0/node-auth0/) is also available.

To learn more, read [Understand How Metadata Works in User Profiles](/docs/manage-users/user-accounts/metadata)

## アカウントリンクを実装するには、次の2つの方法があります：

ユーザー主導のアカウントリンク：ユーザーが、アプリの管理者画面を使用してアカウントをリンクできるようにします。

* 推奨されるアカウントリンク：同じメールアドレスを持つアカウントを特定し、アプリ内でユーザーにそれらをリンクするよう促します。
* ユーザー主導のアカウントリンク

### 通常、アカウントリンクは認証されたユーザーが主導します。貴社のアプリは、ユーザーのプロフィールページにある、**［Link accounts（アカウントのリンク）］**ボタンのようなUIを有していなければなりません。

シングルページアプリケーションでユーザー主導のアカウントリンクを実装する方法について詳しくは、[「Client-Side Account Linking（クライアント側のアカウントリンク）」](/users/references/link-accounts-client-side-scenario)をご一読ください。通常のウェブアプリケーションでユーザー主導のアカウントリンクを実装する方法について詳しくは、[「Server-Side Account Linking（サーバー側のアカウントリンク）」](/users/references/link-accounts-server-side-scenario)をご一読ください。

To learn more about how to implement user-initiated account linking in a Single Page Application, read [Client-Side Account Linking](/docs/manage-users/user-accounts/user-account-linking/user-initiated-account-linking-client-side-implementation). To learn more about how to implement user-initiated account linking in a Regular Web Application, read [Server-Side Account Linking](/docs/manage-users/user-accounts/user-account-linking/suggested-account-linking-server-side-implementation).

### 同じメールアドレスを持つアカウントを特定し、ユーザーにリンクするよう促すことができます。たとえば、ユーザーはuser@gmail.comでGoogleのアカウントを作成し、同じメールアドレスにリンクされたアカウントでFacebookにログインできます。

You can find accounts with the same email, and prompt the users to link them. For example, a user can create an account with Google with the `user@gmail.com`, and then log in with Facebook, with an account linked to the same email.

また、[Account Link拡張機能](/extensions/account-link)を使用しても、同じ結果を得ることができます。

You can also use the [Account Link Extension](/docs/customize/extensions/account-link-extension) to achieve the same outcome.

<Warning>

Previously, in some cases, you could use ID Tokens to link and unlink user accounts. This functionality is being deprecated. You will have to use Access Tokens in all cases.

</Warning>

## Learn more

* [Link User Accounts](/docs/manage-users/user-accounts/user-account-linking/link-user-accounts)
* [Unlink User Accounts](/docs/manage-users/user-accounts/user-account-linking/unlink-user-accounts)
* [User-Initiated Account Linking: Client-Side Implementation](/docs/manage-users/user-accounts/user-account-linking/user-initiated-account-linking-client-side-implementation)
* [User Account Linking: Server-Side Implementation](/docs/manage-users/user-accounts/user-account-linking/suggested-account-linking-server-side-implementation)