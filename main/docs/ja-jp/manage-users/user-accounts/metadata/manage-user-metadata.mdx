---
og:description: Learn how to use the post-login Action trigger to modify user_metadata
  and app_metadata as part of a user’s login flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ログイン後のアクショントリガーでユーザーメタデータを管理する
og:url: https://auth0.com/docs/
permalink: manage-user-metadata
title: ログイン後のアクショントリガーでユーザーメタデータを管理する
twitter:description: Learn how to use the post-login Action trigger to modify user_metadata
  and app_metadata as part of a user’s login flow.
twitter:title: ログイン後のアクショントリガーでユーザーメタデータを管理する
---

Auth0 provides a rich system for storing [metadata](/docs/manage-users/user-accounts/metadata) on the Auth0 user profile. You can configure a `post-login` trigger to modify `user_metadata` and `app_metadata` as part of a user’s login flow. Post-login triggers are useful for tasks such as storing application-specific data on the user profile, capturing user operation logs, mapping <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip> attributes to the metadata field, or caching expensive operation values on the User profile for re-used in future logins.

ここでは、アクションの初めに、ユーザーに高コストなタスクがすでに実行されているかの確認を追加しています。メタデータフィールドが存在する場合は、関数から戻ります。

```js lines
exports.onExecutePostLogin = async (event, api) => {
  if (event.user.app_metadata.didAnExpensiveTask) {
    console.log(`Skipping the expensive task because it already occurred for ${event.user.email}.`);
    return;
  }
  // do and expensive task
  api.user.setAppMetadata("didAnExpensiveTask", true);
};
```






アクションの終わりに、`api.user.setAppMetadata`を呼び出して、ユーザーオブジェクトにある一部のメタデータを保存したいと示します。各トリガーの実行終了時に、アクションはユーザープロファイルを単一操作で更新します。`setUserMetadata`アクションが複数回呼び出された場合（同じフローの異なるアクションで呼び出された場合であっても）、ユーザープロファイルの更新はトリガーの実行が終わったときの1回だけになります。

ベストプラクティス

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Multiple `setUserMetadata` or `setAppMetadata` calls will be batched together into a single user profile update at the end of the trigger’s execution, even if they are made by different Actions.

</Callout>

## Auth0のプロファイルに保管するデータは多すぎないようにします。このデータは、認証と認可に使用されることを目的としています。ユーザーが自分の`user_metadata`フィールドを編集できるため、機微データを保管してはいけません。Auth0のメタデータと検索機能は、市場調査や高い検索・更新の頻度が必要なものを想定して設計されていません。Auth0をそのような目的で使用すると、ほぼ確実にシステムの拡張性や性能に問題が生じます。データを外部システムに保管して、Auth0にポインター（ユーザーID）を保管した方が、バックエンドシステムが必要に応じてデータを取得できます。

レート制限

## リダイレクト

<Warning>

Setting user and app metadata is subject to your tenant’s rate limits and may affect login throughput.

</Warning>

Even though a single call is made to update the user profile, that operation is still subject to your tenant’s "Write User" [rate limits](/docs/troubleshoot/customer-support/operational-policies/rate-limit-policy/management-api-endpoint-rate-limits). If the Rate Limit is hit when attempting to update metadata, Actions will retry the request as long as a `429` HTTP status code is returned. The delay between retries is governed by the value of the `X-RateLimit-Reset` header returned as part of the `429` response.

## Redirects

In the event of a Redirect invoked with `api.redirect.sendUserTo()`, any pending user or app metadata updates will be applied to the user profile before the user is redirected to the external site. To learn more, see [Redirecting With Actions](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/redirect-with-actions).

## Learn more

* [Redirect with Actions](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/redirect-with-actions)