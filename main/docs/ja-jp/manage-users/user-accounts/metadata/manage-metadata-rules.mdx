---
og:description: Learn how to manage with app metadata, user metadata, and client metadata
  using Rules.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ルールを使用してメタデータを管理
og:url: https://auth0.com/docs/
permalink: manage-metadata-rules
title: ルールを使用してメタデータを管理
twitter:description: Learn how to manage with app metadata, user metadata, and client
  metadata using Rules.
twitter:title: ルールを使用してメタデータを管理
---

<Warning>

The End of Life (EOL) date of Rules and Hooks will be **November 18, 2026**, and they are no longer available to new tenants created as of **October 16, 2023**. Existing tenants with active Hooks will retain Hooks product access through end of life.

We highly recommend that you use Actions to extend Auth0. With Actions, you have access to rich type information, inline documentation, and public `npm` packages, and can connect external integrations that enhance your overall extensibility experience. To learn more about what Actions offer, read [Understand How Auth0 Actions Work](/docs/customize/actions/actions-overview).

To help with your migration, we offer guides that will help you [migrate from Rules to Actions](/docs/customize/actions/migrate/migrate-from-rules-to-actions) and [migrate from Hooks to Actions](/docs/customize/actions/migrate/migrate-from-hooks-to-actions). We also have a dedicated [Move to Actions](https://auth0.com/extensibility/movetoactions) page that highlights feature comparisons, [an Actions demo](https://www.youtube.com/watch?v=UesFSY1klrI), and other resources to help you on your migration journey.

To read more about the Rules and Hooks deprecation, read our blog post: [Preparing for Rules and Hooks End of Life](https://auth0.com/blog/preparing-for-rules-and-hooks-end-of-life/).

</Warning>

You can read, update, and delete metadata using [Auth0 Rules](/docs/customize/rules). In the following sections, we will refer to this example where the user and their information is represented by the following JSON snippet:

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": {
    "roles": [ "writer" ]
  },
  "user_metadata": {
    "preferences": {
      "color": "blue"
    }
  }
}
```






## Management APIでルールを使用してメタデータを読み取ることができます。次のように、`user_metadata`でプロファイル関連の情報を検索することもできます。

You can read metadata using rules with the <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>. You can also search for profile-related information in `user_metadata`, such as:

* `ニックネーム`
* `given_name`
* `family_name`
* 例として、電子メールアドレスが`jane.doe@example.com`のユーザーに対して次のメタデータが保存されているとします。

By default, user profile attributes provided by <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+providers">identity providers</Tooltip> other than Auth0 (such as Google, Facebook, or X) are not directly editable because they are updated from the identity provider each time the user logs in. Fore more information on attributes from identity providers, read [Configure Identity Provider Connection for User Profile Updates](/docs/manage-users/user-accounts/user-profiles/configure-connection-sync-with-auth0).

To be able to edit the `name`, `nickname`, `given_name`, `family_name`, or `picture` root attributes on the normalized user profile, you must [configure your connection sync with Auth0](/docs/manage-users/user-accounts/user-profiles/configure-connection-sync-with-auth0) so that user attributes will be updated from the identity provider only on user profile creation. These root attributes will then be available to be edited individually or by bulk imports

上記のメタデータの例を使用すると、次のように[Auth0ルール](/rules)または[Management API](/users/guides/manage-user-metadata)の呼び出しでデータセットから特定の項目を参照できます。

```json lines
{
    "email": "jane.doe@example.com",
    "user_metadata": {
        "hobby": "surfing"
    },
    "app_metadata": {
        "plan": "full"
    }
}
```






Using the example metadata above, you can refer to specific items from the dataset in [Auth0 Rules](/docs/customize/rules) or via a call to the [Management API](/docs/manage-users/user-accounts/metadata) as follows:

```js lines
console.log(user.email); // "jane.doe@example.com"
console.log(user.user_metadata.hobby); // "surfing"
console.log(user.app_metadata.plan); // "full"
```






Any valid JSON snippet can be used as metadata, but note that `user.app_metadata` is `Undefined` by default.

アプリメタデータの読み取り

### ユーザーのロールに基づいて決定を行うことができます。

ユーザーメタデータの読み取り

```javascript lines
function(user, context, callback){
  user.app_metadata = user.app_metadata || {};
  if (user.app_metadata.roles.indexOf('writer')){
    // code to be executed
  }
  ...
}
```






### 色の好みなど、特定の設定に基づいて決定を下すことができます。

アプリケーションメタデータの読み取り（clientMetadata）

```javascript lines
function(user, context, callback){
  user.user_metadata = user.user_metadata || {};
  if (user.user_metadata.preferences.color === 'black'){
    // code to be executed
  }
  ...
}
```






### アプリケーションメタデータ（`clientMetadata`）は、`コンテキスト`オブジェクトのオプションの最上位プロパティです。既存のアプリケーションには、このプロパティの値はありません。

メタデータの更新

```javascript lines
function(user, context, callback){
  context.clientMetadata = context.clientMetadata || {};
  if (context.clientMetadata.usersuppliedkey1 === 'black'){
    // this code would not be executed for the user
  }
  ...
}
```






## アプリメタデータの更新

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Use Rules to map SAML attributes that Auth0 receives from the IdP into `user_metadata` or `app_metadata`.

</Callout>

### 管理者ロールをユーザーに追加するには:

これにより、ユーザープロファイルの詳細が次のJSON表記になります。

```javascript lines
function(user, context, callback){
  user.app_metadata = user.app_metadata || {};
  // update the app_metadata that will be part of the response
  user.app_metadata.roles = user.app_metadata.roles || [];
  user.app_metadata.roles.push('administrator');

  // persist the app_metadata update
  auth0.users.updateAppMetadata(user.user_id, user.app_metadata)
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
    });
}
```






メタデータの削除

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": {
    "roles": [ "writer", "administrator" ]
  },
  "user_metadata": {
    "preferences": {
      "color": "blue"
    }
  }
}
```






### ユーザーの`fontSize`設定をユーザープロファイルに追加するには:

これにより、ユーザープロファイルの詳細が次のJSON表記になります。

```javascript lines
function(user, context, callback){
  user.user_metadata = user.user_metadata || {};
  // update the user_metadata that will be part of the response
  user.user_metadata.preferences = user.user_metadata.preferences || {};
  user.user_metadata.preferences.fontSize = 12;

  // persist the user_metadata update
  auth0.users.updateUserMetadata(user.user_id, user.user_metadata)
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
    });
}
```






メタデータの削除

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": {
    "roles": [ "writer" ]
  },
  "user_metadata": {
    "preferences": {
      "color": "blue",
      "fontSize": 12
    }
  }
}
```






### ルールの処理時間を短縮するには、同じルールで`app_metadata`と`user_metadata`の両方を更新します。

これにより、ユーザープロファイルの詳細が次のJSON表記になります。

```javascript lines expandable
function(user, context, callback){

  var q = require('q');

  user.app_metadata = user.app_metadata || {};
  user.user_metadata = user.user_metadata || {};
  // update the user_metadata that will be part of the response
  user.user_metadata.preferences = user.user_metadata.preferences || {};
  user.user_metadata.preferences.fontSize = 12;

  // update the app_metadata that will be part of the response
  user.app_metadata.roles = user.app_metadata.roles || [];
  user.app_metadata.roles.push('admin');

  // persist the app_metadata update
  var appMetadataPromise  = auth0.users.updateAppMetadata(user.user_id, user.app_metadata);

  // persist the user_metadata update
  var userMetadataPromise = auth0.users.updateUserMetadata(user.user_id, user.user_metadata);

  // using q library to wait for all promises to complete
  q.all([userMetadataPromise, appMetadataPromise])
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
    });
}
```






メタデータの削除

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": {
    "roles": [ "writer", "admin" ]
  },
  "user_metadata": {
    "preferences": {
      "color": "blue",
      "fontSize": 12
    }
  }
}
```






## アプリメタデータのプロパティと値を削除します

### プロパティを削除するには、プロパティの値を`null`に設定します。

ユーザーのロールの削除の例

#### ユーザーのロールを削除するには、次のサンプルルールを使用します。

これにより、ユーザープロファイルが次のJSON表記になります。

```javascript lines
function(user, context, callback){
  user.app_metadata = user.app_metadata || {};
  // update the app_metadata that will be part of the response
  user.app_metadata.roles = null;

  // persist the app_metadata update
  auth0.users.updateAppMetadata(user.user_id, user.app_metadata)
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
    });
}
```






ユーザーメタデータのプロパティと値を削除

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": { },
  "user_metadata": {
    "preferences": {
      "color": "blue"
    }
  }
}
```






#### プロパティの単一の値を削除するには、その特定の値を削除します。たとえば、ユーザープロファイルから`ライター`ロールを削除するには:

これにより、ユーザープロファイルが次のJSON表記になります。

```javascript lines
function(user, context, callback){
  user.app_metadata = user.app_metadata || {};
  user.app_metadata.roles = user.app_metadata.roles || [];

  var index = user.app_metadata.roles.indexOf('writer');

  if (index !== -1){
    // update the app_metadata that will be part of the response
    user.app_metadata.roles.splice(index, 1);
  }

  // persist the app_metadata update
  auth0.users.updateAppMetadata(user.user_id, user.app_metadata)
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
    });
}
```






ユーザーメタデータのプロパティと値を削除

```json lines
{
  "user_id": "google-oauth2|1234",
  "email": "john.doe@gmail.com",
  "app_metadata": {
    "roles": [ ]
  },
  "user_metadata": {
    "preferences": {
      "color": "blue"
    }
  }
}
```






ユーザーの色の設定を削除するには:

### これにより、ユーザープロファイルの詳細が次のJSON表記になります。

To delete the user's color preference:

```javascript lines
function(user, context, callback){
  user.user_metadata = user.user_metadata || {};
  // update the user_metadata that will be part of the response
  user.user_metadata.preferences = user.user_metadata.preferences || {};
  delete user.user_metadata.preferences.color;

  // persist the user_metadata update
  auth0.users.updateUserMetadata(user.user_id, user.user_metadata)
    .then(function(){
      callback(null, user, context);
    })
    .catch(function(err){
      callback(err);
  });
}
```






メタデータの削除

```json lines
{
  "user_id": "jdoe",
  "email": "john.doe@example.com",
  "app_metadata": {
    "roles": [ "writer" ]
  },
  "user_metadata": {
    "preferences": { }
  }
}
```






## Learn more

* [Use the Management API from within Rules](/docs/customize/rules/use-management-api)
* [Context Object Properties in Rules](/docs/customize/rules/context-object)
* [Auth0 Rules](/docs/customize/rules)