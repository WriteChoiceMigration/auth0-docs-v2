---
description: ''
og:description: Describes how browser changes, such as the SameSite cookie attribute,
  affects your web applications that embed content from third-party domains.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: sameSiteクッキー属性の変更
og:url: https://auth0.com/docs/
permalink: samesite-cookie-attribute-changes
title: sameSiteクッキー属性の変更
twitter:description: Describes how browser changes, such as the SameSite cookie attribute,
  affects your web applications that embed content from third-party domains.
twitter:title: sameSiteクッキー属性の変更
---

認証とセッションの維持に使用されるCookieは、属性を設定することで保護できます。Auth0は、次の目的でCookieを使用します。

* `form_post`を使用したOIDC Enterprise
* <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip> HTTP-POST Binding
* Webメッセージ（別名`checkSession`）

## SameSite属性

You can add [SameSite cookie](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite) attributes in the `set-cookie` HTTP response header to restricts browser behavior. It may prevent the browser from sending the cookie's `key=value` pair based on the type of interaction that triggered the HTTP request.

よく知られているCookie属性には次のものがあります。

| Attribute | Description |
| --- | --- |
| `strict` | Send the cookie if the user is navigating within the website origin bounds |
| `lax` | Send the cookie if the user is navigating between domains but not for 3rd party contexts (iframes or posts) |
| `none` | Send the cookie with requests crossing the website origin bounds. Unless other conditions are present (i.e., third-party cookies are blocked), do not send the cookie. |

ブラウザは、受信時にヘッダーを解析し、それに応じてCookie jarを更新します。

| Attribute | Description |
| --- | --- |
| `httpOnly` | Allows a cookie to be sent only with HTTP requests; not readable using Javascript's `document.cookie` |
| `secure` | Allows the browser to send the cookie only to a secure context; whether the context is considered secure or not is browser-dependent, but this typically requires the use of HTTPS |
| `max-age / expires` | Controls whether the cookie is a **session** cookie (e.g., dropped when your browser terminates its session) or **persistent** (e.g., the cookie persists beyond the browser session) |

ブラウザCookieの変更

## `samesite`属性が設定されていないクッキーは、`lax`に設定されます

`sameSite=none`のCookieは、セキュリティ保護が必要です。保護されていない場合、ブラウザーに保存できません

* これらの変更は、セキュリティの強化とCSRF攻撃からの防御を目的としています。
* これらの変更は、次のCookieに影響します。

`auth0`（ユーザーセッションを処理）

`auth0-mf`（多要素認証に関連する情報を処理）

* `did`（デバイス/ユーザーエージェントの識別子）
* `auth0-mf` (handles information relevant to <Tooltip tip="Multi-factor authentication (MFA): User authentication process that uses a factor in addition to username and password such as a code via SMS." cta="View Glossary" href="/docs/glossary?term=multi-factor+authentication">multi-factor authentication</Tooltip>)
* `SameSite`属性を`none`に設定し、CookieでHTTPSの使用を要求します（環境に関係なく）

レガシーブラウザが`SameSite`を`None`に設定できないときにフォールバックCookieを設定します。これらのフォールバックCookieは、`auth0_compat`、`auth0-mf_compat`および`did_compat`です。

* 下の図は、新しいインタラクション中に何が起こるかを示しています。エンドユーザーは、以前に訪問したことのないページを要求します。訪問者が戻ってきたときにサーバーがレンダリング方法を変更し、表示されたCookieを設定します。`set-cookie`ヘッダーの灰色の部分は、実際のCookie `key=value`です。赤い部分は、ブラウザがCookie jarに保存するCookie属性で、後で要求に Cookie `key+value`のペアを含めるかどうかを決定します。
* 次の図は、同じブラウジングセッションを使用して同じ要求を行った場合に何が起こるかを示しています。要求は同じサーバーに送信され、Cookie 属性は表示された Cookie の送信を禁止していないため、要求にCookieヘッダーとして自動的に含められます。サーバーは、このCookieを受信したという事実に基づいて、異なる応答をします。

影響のある機能

<Frame>![sameSite Cookie Attributes Fresh Interaction Flow](/images/cdy7uua7fh8z/ItaoOzUnri9dkCkZ3V0dj/e64711c0f3ae5c361fe2321e3666b1cf/cookie-fresh-interaction.png)</Frame>

次の表は、`SameSite`属性の変更がアプリにどのような影響を与えるかを示しています。

<Frame>![sameSite Cookie Attributes Cookie Return Interaction flow](/images/cdy7uua7fh8z/4dc2HWnmPBOV6cvdKbNM6g/50149f55e38fdf7453944932a3ef9d1c/cookie-return-interaction.png)</Frame>

## セッションのあるWebアプリ（ユーザー設定、ショッピングカートなどを保存するため）を使用していて、ユーザーがGoogle、Github、Auth0などのIDプロバイダーを使用してサインインできるようにする場合、その機能を実現するためにCookieに依存します。ブラウザのCookieの動作の変更により、ユーザー エクスペリエンスが損なわれる可能性があります。たとえば、Google Chromeは、Webアプリケーションと互換性がない可能性がある変更を展開した最初のブラウザベンダーです。

たとえば、新しいUIを構築し、Auth0ゲートウェイ経由でプロキシするサービスがいくつかあるとします。このゲートウェイで、Cookieセッションを作成します。クロスオリジン要求を行うと、Javascriptコンソールに次の警告が表示される場合があります。

| App Behavior | Affected by Change |
| --- | --- |
| Cookies set as `sameSite=none` when the website is not `https://` | Yes |
| Cookies don't have explicit `sameSite` attribute value set and are required in a cross-origin context (such as HTTP form\_post, embedding an iframe) | Yes |
| Native apps (everything not cookies + web based) | No (M2M) |
| Already setting an explicit `sameSite` cookie attribute value | No |
| Different subdomain on the same eTLD+1 (app is on the same eTLD+1 as the custom domain Auth0 tenant) | Potentially |

If you are using a web app with sessions (e.g. for saving user preferences, shopping carts, etc.), and you allow users to sign in using <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+providers">identity providers</Tooltip> such as Google, Github, or Auth0, then you rely on cookies to achieve that functionality. There are browser cookie behavior changes that may break the user experience. Google Chrome, for example, is the first browser vendor to roll out a change that might not be compatible with your web application.

この変更に備えるには、次の操作を行う必要があります。

[サポートされていないブラウザ]()のリストを確認します。

`A cookie associated with a cross-site resource (URL) was set without the SameSite attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are set with SameSite=None and Secure. You can review cookies in developer tools under Application>Storage>Cookies and see more details at https://www.chromestatus.com/feature/5088147346030592 and https://www.chromestatus.com/feature/5633521622188032`

## Auth0 とやり取りするときに`response_mode=form_post`を使用する場合は、アプリケーションで`SameSite=none`を使用するように設定します（Chromeは`localhost`の場合でも例外を設けないことに注意してください）

`SameSite`属性が`None`に等しい場合は、Cookieをセキュアとして設定します。そうでない場合、ブラウザによって拒否されます。コールバックURLにHTTPを使用する場合、そのようなCookieを使用して認証要求のstate/nonceをバインドすると、コールバックURLが壊れます。したがって、HTTPSを使用するか、`SameSite=lax`に設定する必要があります。

* Review the list of [unsupported browsers](https://www.chromium.org/updates/same-site/incompatible-clients).
* Set your application to use `SameSite=none` if it uses `response_mode=form_post` when interacting with Auth0 (note that Chrome makes no exceptions, even for `localhost`)
* Set your cookie as secure if its `SameSite` attribute equals `None.` Otherwise, it will be rejected by the browser. If you use HTTP for your Callback URLs, these will break if you use such cookies for binding the authorization request state/<Tooltip tip="Nonce: Arbitrary number issued once in an authentication protocol to detect and prevent replay attacks." cta="View Glossary" href="/docs/glossary?term=nonce">nonce</Tooltip>. Therefore, you must either use HTTPS or set `SameSite=lax`