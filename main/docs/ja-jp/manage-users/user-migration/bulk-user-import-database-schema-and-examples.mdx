---
og:description: Learn how to perform bulk user imports with the Management API.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 一括ユーザーインポートのデータベーススキーマと例
og:url: https://auth0.com/docs/
permalink: bulk-user-import-database-schema-and-examples
title: 一括ユーザーインポートのデータベーススキーマと例
twitter:description: Learn how to perform bulk user imports with the Management API.
twitter:title: 一括ユーザーインポートのデータベーススキーマと例
---

ユーザーファイルには、ユーザーの情報をJSON形式の配列として含める必要があります。



## ユーザーのJSONスキーマ

以下のJSONスキーマは有効なユーザーを記述しています。



JSONスキーマの詳細については、[jsonschema.org](http://json-schema.org)をご覧ください。

## プロパティ

ユーザーは以下のプロパティを使用してインポートすることができます。



`app_metadata`と`user_metadata`の詳細については、「[ユーザープロファイルでのメタデータの使い方](/users/metadata)」をお読みください。

## アプリメタデータ

`user.app_metadata`オブジェクトには、以下のいずれのプロパティも含めては**いけません**。

* `__tenant`
* `_id`
* `blocked`
* `clientID`
* `created_at`
* `email_verified`
* `email`
* `globalClientID`
* `global_client_id`
* `identities`
* `lastIP`
* `lastLogin`
* `loginsCount`
* `metadata`
* `multifactor_last_modified`
* `multifactor`
* `updated_at`
* `user_id`

## カスタムパスワードハッシュ

`user.custom_password_hash`オブジェクトは、ユーザーのパスワードハッシュが他のアルゴリズムで作成された場合に、`user.password_hash`プロパティの代わりに使用できます。このフィールドと`password_hash`が相互に排他的であることに注意してください。

`user.custom_password_hash`オブジェクトは以下のプロパティに対応しています。



### カスタムパスワードハッシュを更新する

ユーザーが最初にインポートされた`custom_password_hash`を使ってログインしなかった場合、一括インポートの処理中に`custom_password_hash`を更新できます。たとえば、以下のJSONは、`custom_password_hash`に異なる値を指定して、[`/api/v2/jobs/users-imports`](https://auth0.com/docs/api/management/v2?_ga=2.169020323.346193905.1601302257-746691936.1587131255#!/Jobs/post_users_imports)エンドポイントに2回送信することができます。2回目の送信では、`upsert`フラグを`true`に設定します。



browserling.comで[Bcryptパスワードジェネレーター](https://www.browserling.com/tools/bcrypt)を使用して、bcryptパスワードハッシュを生成することができます。

### 対応しているハッシュアルゴリズム

Auth0は現在、以下のユーザーパスワードハッシュのインポートに対応しています。

* [Argon2](https://github.com/p-h-c/phc-winner-argon2)
* [bcrypt](https://auth0.com/blog/hashing-in-action-understanding-bcrypt/)
* [LDAP](https://tools.ietf.org/html/rfc2307#section-5.3)（`RFC-2307 "userPassword"`）
* [HMAC](https://tools.ietf.org/html/rfc2104)
* [MD4](https://tools.ietf.org/html/rfc1320)
* [MD5](https://tools.ietf.org/html/rfc1321)
* [SHA1](https://tools.ietf.org/html/rfc3174)
* [SHA256およびSHA512](https://tools.ietf.org/html/rfc4634)
* [PBKDF2](https://tools.ietf.org/html/rfc2898#section-5.2)
* [scrypt](https://datatracker.ietf.org/doc/rfc7914/)

`custom_password_hash`を提供する際には、以下のセクションを考慮してください。

#### Argon2

`algorithm`が`argon2`に設定されている場合には：

* `hash.encoding`は`utf8`でなければなりません。
* `hash.salt`は使用できません。
* `hash.value`は、GitHubの[P-H-C / phc-string-format](https://github.com/P-H-C/phc-string-format/blob/master/phc-sf-spec.md)で指定されているように、PHC文字列形式でなければなりませんまた、GitHubの[Auth0 / magic](https://github.com/auth0/magic#magicpasswordhash--magicverifypassword)で指定されている要件に従う必要があります。
* `hash.value`にはbase64エンコードされたソルトが含まれなければなりません（`PHC`のドキュメントで指定されています）。

#### bcrypt

`algorithm`が`bcrypt`に設定されている場合には：

* `hash.encoding`は`utf8`でなければなりません。
* `hash.salt`は使用できません。
* `hash.value`には以下の1つのプレフィックスが含まれなければなりません。

* `$2a$`
* `$2b$`
* `$2y$`

`$2$`、`$sha1$`や`$2x$`など、他のプレフィックスには現在対応していません。

たとえば、次はコストパラメーターの値を10に指定して「`hello`」の文字列から生成したものです：

`$2b$10$nFguVi9LsCAcvTZFKQlRKeLVydo8ETv483lkNsSFI/Wl1Rz1Ypo1K`

`algorithm`が`hmac`に設定されている場合には：

`algorithm`が`ldap`に設定されている場合には：

#### HMAC

`algorithm`が`md4`、`md5`、`sha1`、`sha256`、または`sha512`に設定されている場合には：

* `hash.encoding`は`hex`または`base64`でなければなりません。
* `hash.digest`は必須で、以下のいずれかでなければなりません。

* `md4`
* `md5`
* `ripemd160`
* `sha1`
* `sha224`
* `sha256`
* `sha384`
* `sha512`
* `whirlpool`
* `hash.key.value`は必須です。
* `hash.key.encoding`は`base64`、`hex`、または`utf8`でなければなりません。

#### LDAP

`algorithm`が`pbkdf2`に設定されている場合には：

* `hash.encoding`は`utf8`でなければなりません。
* `salt`は使用できません。
* `hash.value`では、IETF Datatrackerに掲載の[RFC-2307セクション5.3](https://tools.ietf.org/html/rfc2307#section-5.3)で説明されている形式を厳守する必要があります。
* スキーマは`md5|smd5|sha*|ssha*`のいずれかになります。詳細については[こちら](https://www.openldap.org/faq/data/cache/347.html)を参照してください。
* [crypt](https://www.openldap.org/faq/data/cache/344.html)スキーマは、動作がシステムや実装に依存するため、**非対応**であることに注意してください。詳細については、[Open LDAPが提供するAdmin Guideの「4.4.2.CRYPT password storage scheme」](https://www.openldap.org/doc/admin24/guide.html#CRYPT%20password%20storage%20scheme)をお読みください。

#### MDおよびSHA

`algorithm`が`scrypt`に設定されている場合には：

* `hash.encoding`は`hex`または`base64`でなければなりません。

#### PBKDF2

`user.mfa_factors`配列には、ユーザーのMFA登録が含まれます。詳細については、「[Auth0での多要素認証](/mfa)」をお読みください。登録をインポートすると、インポート後にユーザーがMFAに再登録する必要がなくなります。以下の登録タイプに対応しています。

* `hash.encoding`は`utf8`でなければなりません。
* `hash.salt`は使用できません。
* `hash.value`は、GitHubの[P-H-C / phc-string-format](https://github.com/P-H-C/phc-string-format/blob/master/phc-sf-spec.md)で指定されているように、PHC文字列形式でなければなりません
* `hash.value`にはB64エンコードされたソルトが含まれなければなりません（埋め込み文字「`=`」を省略したbase64で、`PHC`のドキュメントで指定されています）。
* `hash.value`には、`i`（iterations）と`l`（keylen）パラメーターが含まれなければなりません。これらのパラメーターを省略すると、デフォルトの`i=100000`および`l=64`が使用されます。
* `id`は`pbkdf2-<digest>`形式（`pbkdf2-sha512`、`pbkdf2-md5`など）でなければなりません。以下のダイジェストに対応しています。

* `RSA-MD4`
* `RSA-MD5`
* `RSA-MDC2`
* `RSA-RIPEMD160`
* `RSA-SHA1`
* `RSA-SHA1-2`
* `RSA-SHA224`
* `RSA-SHA256`
* `RSA-SHA384`
* `RSA-SHA512`
* `md4`
* `md4WithRSAEncryption`
* `md5`
* `md5WithRSAEncryption`
* `mdc2`
* `mdc2WithRSA`
* `ripemd`
* `ripemd160`
* `ripemd160WithRSA`
* `rmd160`
* `sha1`
* `sha1WithRSAEncryption`
* `sha224`
* `sha224WithRSAEncryption`
* `sha256`
* `sha256WithRSAEncryption`
* `sha384`
* `sha384WithRSAEncryption`
* `sha512`
* `sha512WithRSAEncryption`
* `ssl3-md5`
* `ssl3-sha1`
* `whirlpool`

#### `scrypt`



* `hash.encoding`は`hex`または`base64`でなければなりません。
* `keylen`パラメーターは必須です。
* `cost`パラメーターを使用することができます。指定しない場合には、デフォルトの16384が使用されます。
* `blockSize`パラメーターを使用することができます。指定しない場合には、デフォルトの8が使用されます。
* `parallelization`パラメーターを使用することができます。指定しない場合には、デフォルトの1が使用されます。

### MFA要素

以下の内容のあるファイルが有効です。



## 例

### 基本例

以下は、提供されたハッシュのあるユーザーの例です。



### カスタムパスワードハッシュの例

ご推察のとおり、`user.mfa_factors`配列は、ユーザーのMFA登録を提供できるようにします。以下の登録タイプに対応しています。

以下は、MFA要素のあるユーザーの例です。

### MFA要素の例



* 電話：SMSベースの検証に使用されます。
* TOTP：MFAタイプのアプリ（Google Authenticator、Microsoft Authenticator、Authy、1Password、LastPass）で使用するOTPシークレットです。
* メール：メールベースの検証に使用されます。

以下は、MFA要素のあるユーザーの例です。