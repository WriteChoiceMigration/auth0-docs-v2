---
description: ''
og:description: Learn how tokens work with Auth0's Organizations feature and how to
  authenticate users belonging to an organization.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: トークンとOrganizations（組織）を使用する
og:url: https://auth0.com/docs/
permalink: using-tokens
title: トークンとOrganizations（組織）を使用する
twitter:description: Learn how tokens work with Auth0's Organizations feature and
  how to authenticate users belonging to an organization.
twitter:title: トークンとOrganizations（組織）を使用する
---



Auth0から返されるIDトークンとアクセストークンのほとんどはJSON Web Tokens（JWT）で、さまざまなクレームを含んでいます。クレームとは、対象について主張された（つまり、立証はされていない）こまごまとした情報のことです。たとえば、[IDトークン](/security/tokens/id-tokens)（必ずJWT）には、認証しようとしているユーザーの名前が「John Doe」であると主張する`name`クレームが含まれています。

JWTクレームには以下の2種類があります。

* **登録済み**：サードパーティまたは外部のアプリケーションとの相互運用性を確保するために[JWT仕様](https://tools.ietf.org/html/rfc7519)で定義されたクレーム。[OpenID Connect（OIDC）](/protocols/openid-connect-protocol)標準クレームは予約済みクレームです。
* **カスタム**：独自に定義したクレーム。未登録で衝突耐性のあるパブリッククレームか、または衝突の可能性がある未登録で非公開のプライベートクレームである可能性があります。予約済みクレームや他のカスタムクレームとの衝突を避けるため、[名前空間](/security/tokens/json-web-tokens/create-custom-claims)などを使用してこれらのクレームに慎重に名前を付けてください。同じ名前で異なる情報のある2つのクレームを扱うことは困難な場合があります。

クレームの詳細については、「[JSON Web Tokenクレーム](/security/tokens/json-web-tokens/json-web-token-claims)」をお読みください。

## 組織を通してユーザーを認証する

組織を通じてユーザーを認証するには、`/authorize`エンドポイントへの呼び出しに`organization`パラメーターが追加されます。以下は、ユーザーが組織を通してログインした際に返されるトークンの例です。



### IDトークン

次の例では、`https://marketplace/roles`と`https://namespace.exampleco.com/`はトークンに追加されたカスタムクレームであり、含まれている他のクレームは標準クレームであることに注意してください。



### アクセストークン



## 組織へのマシンツーマシンアクセス

マシンツーマシンのユースケースでは、`/oauth/token`エンドポイントへのクライアント資格情報要求に`organization`パラメーターが追加され、アプリケーションはユーザーではなく自分自身のアクセストークンを取得できます。



次のコードサンプルは、マシンツーマシンのユースケースで返されるアクセストークンの例です。



## トークンを検証する

`/authorize`エンドポイントまたは`/oauth/token`エンドポイントへの呼び出しに`organization`パラメーターが追加されると、Auth0 SDKは`org_id`クレームを自動的に検証し、生成されたトークンの一部として返します。ただし、セキュリティを保護するために、追加の検証はトークンを受け取ったときに行います。



**Webアプリケーション**

`/authorize`エンドポイントに`organization`パラメーターが渡されなかったけれど、IDトークンに`org_id`クレームが存在する場合、アプリケーションはクレームを検証して、受け取った値が予期されるか既知であること、および支払いを行う顧客など、アプリケーションが信頼するエンティティに対応していることを保証します。クレームが検証できない場合には、アプリケーションはトークンが無効であると判断します。

**API**

`org_id`クレームがある場合には、APIがクレームを検証して、受け取った値が既知または予期されたものであり、アプリケーションが信頼するエンティティ（顧客など）に対応していることを保証します。クレームが検証できない場合には、APIはトークンが無効であると判断します。

特に：

* `iss`（発行者）クレームがAuth0によって発行されたトークンであることを確認する必要があります。
* `org_id`クレームの値がアプリケーションに既知の値であることを確認する必要があります。これは、組織IDの既知リストに照らし合わせて検証することができます。あるいは、現在の要求のURLと併せて確認できるかもしれません。たとえば、IDトークンを検証する際に、どの組織を使用するべきなのかをサブドメインが示唆することもあります。

通常、トークンがAuth0によって発行されたことを確認するには、発行者を検証するだけで十分です。ただし、組織の場合には、Auth0テナント内の組織であること保証するために、追加で確認しなければなりません。

APIサーバーが`org_id`に基づいてデータとリソースへのアクセスをセグメント化することも非常に重要です。これにより、アクセストークンで指定された組織に対応する`org_id`値を受け取ったときに、その組織に関する情報のみにアクセスしたり変更したりできるようになります。