---
og:description: Describes the workflow with the auth0-spa-js SDK to support multi-site
  session management.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0 SDKでマルチサイトセッションを管理する
og:url: https://auth0.com/docs/
permalink: manage-multi-site-sessions
title: Auth0 SDKでマルチサイトセッションを管理する
twitter:description: Describes the workflow with the auth0-spa-js SDK to support multi-site
  session management.
twitter:title: Auth0 SDKでマルチサイトセッションを管理する
---

## 短命セッション

This workflow shows how the auth0-spa-js SDK should be implemented to support multi-site session management. In this scenario, it is assumed that the tenant <Tooltip tip="Single Sign-On (SSO): Service that, after a user logs into one applicaton, automatically logs that user in to other applications." cta="View Glossary" href="/docs/glossary?term=SSO">SSO</Tooltip> Inactivity Timeout is set to 300 seconds, and the <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+Token">ID Token</Tooltip> Expiration of each SPA application is set to 150 seconds. This is considered a "short-lived" session.

### SDKの特徴

#### PKCEフロー

For all methods of retrieving an ID Token or <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip>, the SDK manages all the intricacies of the Proof Key for Code Exchange workflow. No additional effort or configuration is needed for this to work.

#### ディープリンク

ユーザーエクスペリエンスを改善するため、SDKには`loginWithRedirect()`メソッドに`appState`パラメーターが含まれています。現在のアプリについての詳細は、認証の成功時に返されるAuthサーバーへの要求の部分としてパッケージ化されます。これは、ユーザージャーニーをシームレスに継続できるようにします。

クイックスタートでは、`PrivateRoute`コンポーネントが`targetUrl`の状態パラメーターを設定し、`index.js`の`onRedirectCallback`関数がこの値を解凍して、認証完了時にユーザーをリダイレクトします。

#### トークンの保管

To keep the returned tokens stored in the safest manner possible all tokens are placed into a local cache. The ID and Access Tokens are stored as pairs with the <Tooltip tip="Audience: Unique identifier of the audience for an issued token. Named aud in a token, its value contains the ID of either an application (Client ID) for an ID Token or an API (API Identifier) for an Access Token." cta="View Glossary" href="/docs/glossary?term=audience">audience</Tooltip> and scope values being used to retrieve the tokens as needed.

また、IDトークンまたはアクセストークンのいずれかの有効期限が切れると、キャッシュトークンは削除されるため、キャッシュ内にあるトークンはまだ有効であると判断できます。

#### APIを呼び出す

The `getTokenSilently()` method is used to leverage the token cache first, and if none exists, will launch an invisible iframe to retrieve a new token. For this purpose all requests to APIs can use this method to construct the bearer token header without the need for additional logic to handle for expired tokens.

ユーザーにセッションを継続するよう警告する

#### ユーザーがAuth0セッションを更新するアクションを行っていない場合、Auth0は、明示的にセッションの継続を選択するようユーザーに警告することを推奨します。

このアプローチの意図は、ユーザーが存在しなくなった場合にセッションが非アクティブになれるようにしつつ、それ以外の場合、資格情報をもう一度求めることなくセッションを継続できるようにサイレントトークンリフレッシュをトリガーする手段を提供することです。

非アクティブタイマーとタイムアウトのモーダルについては、「[アプリケーション特有のログアウトURL](/users/sessions/configure-session-lifetime-settings)」をお読みください。

To learn more about inactivity timers and timeout modals, read [Application-specific logout URLs](/docs/manage-users/sessions/configure-session-lifetime-settings).

### 最初の認証

1. Initial Authentication
2. Maintaining Auth0 Session
3. ユーザーにセッション延長を促す
4. Prompting user to extend session
5. ユーザーが明示的にアプリケーションからログアウト
6. User returns to initial app after logging out

#### Auth0セッションを維持する

1. New tab is opened
2. Requests to login
3. User enters credentials
4. SSO cookie (with expiration) is set
5. Token exchange performed

<Frame>![Diagram of Initial Authentication flow](/images/cdy7uua7fh8z/2voC3vs36CJJlpDu4xl06Y/310fe5afe79ad7d083833baa2690dfa4/initial-authentication.png)</Frame>

#### シームレスSSO

1. User requests data from protected resource
2. `getTokenSilently()` called
3. Resource retrieved
4. User updates data from protected resource
5. `getTokenSilently()` called

   1. Iframe opened
   2. Token exchange performed
6. Resource is updated

<Frame>![Diagram of maintaining a session](/images/cdy7uua7fh8z/7CI29ouvhuJ4TFC1G2C5n8/4d2bd0c9372a6cc16e75fc76f438a0bd/maintain-auth0-session.png)</Frame>

#### ユーザーにセッション延長を促す

1. User navigates to a private route
2. Check with `isAuthenticated()`
3. If false, `loginWithRedirect()`

<Frame>![Diagram of seamless SSO flow for sessions](/images/cdy7uua7fh8z/38heJlnN0letWMVhpTtXad/4d4127150fb818522ea29eea28ccc00e/seamless-sso.png)</Frame>

#### getTokenSilently()

1. At 240 seconds prompt user with keep session alive with modal that lasts 60 seconds
2. If they choose to maintain session, `getTokenSilently()`

<Frame>![Diagram of prompting a user to maintain a session](/images/cdy7uua7fh8z/6kH2G3oclCfSudwd0hJEUM/70651da37771c9945c5a34dcad409d9f/prompt-user-extend-session.png)</Frame>

#### ユーザーが明示的にアプリケーションからログアウト

1. User chooses to logout
2. `logout()` called

   1. Token cache cleared
   2. Call `/oidc/logout`
   3. Clear SSO cookie & delete session data
   4. Redirect user to logout page

<Frame>![Diagram of a user logging out](/images/cdy7uua7fh8z/4b55FKM2vZBoskXTPY4nxs/1a9e69437677f2cfac9a3d8e6bff7ffe/user-explicitly-logs-out-of-app.png)</Frame>

#### ユーザーがログアウト後、当初のアプリケーションに戻る

1. User requests data from protected resource
2. `getTokenSilently()` called
3. Application-dependent behavior

<Frame>![Diagram of user returning to application after logging out](/images/cdy7uua7fh8z/3geXGwsXkIgFkwopoGoLMx/01685b6b8e8473c6ce6f26e59b402cf3/user-returns-to-initial-app.png)</Frame>

## 長寿命セッション

Auth0は、エンタープライズプラン向けの長寿命セッションをサポートしています。長寿命セッションセッションを使用すると、最長100日間の非アクティブ（アイドルタイムアウト）および最長1年間の合計期間（絶対タイムアウト）によるセッション制限を構成できます。四半期ごと、月ごと、またはその他のタイムラインがある場合、これによってエンドユーザーの負担を減らし、リスクの低いコンテンツと機能へのアクセスを提供できます。また、メディア企業は、コンテンツへのシームレスなアクセスを通じてユーザーエクスペリエンスを改善するため、長寿命セッションを活用できます。また、ユーザーエクスペリエンスとセキュリティに関する要件に基づき、長寿命セッションとパスワード認証のいずれかを選択することもできます。

Workflow details would change in the case of a long-lived session where the application session would most likely be shorter than the [Single Sign-on (SSO)](/docs/authenticate/single-sign-on) session.

To learn more, read [Configure Session Lifetime Limits](/docs/manage-users/sessions/configure-session-lifetime-settings) and [Update Access Token Lifetime](/docs/secure/tokens/access-tokens/update-access-token-lifetime).

##

## Learn more

* [Troubleshoot Invalid Token Errors](/docs/troubleshoot/basic-issues/invalid-token-errors)
* [Check API Calls](/docs/troubleshoot/authentication-issues/check-api-calls)