---
description: ''
og:description: Keeping your user logged in with Auth0.swift
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0.swift：トークンを保存および更新する
og:url: https://auth0.com/docs/
permalink: auth0-swift-save-and-renew-tokens
title: Auth0.swift：トークンを保存および更新する
twitter:description: Keeping your user logged in with Auth0.swift
twitter:title: Auth0.swift：トークンを保存および更新する
---

When an authentication is performed with the `offline_access` scope included, it will return a <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=Refresh+Token">Refresh Token</Tooltip> that can be used to request a new token without asking for credentials again.

## まず、`Auth0`モジュールをインポートします。

[Auth0.swift](https://github.com/auth0/Auth0.swift) provides a utility class to streamline the process of storing and renewing credentials. You can access the `accessToken` or `idToken` properties from the [Credentials](https://github.com/auth0/Auth0.swift/blob/master/Auth0/Credentials.swift) instance. This is the preferred method to manage user credentials.

次に、ユニバーサルログインページを表示します。

`import Auth0`

Next present the <Tooltip tip="Universal Login: Your application redirects to Universal Login, hosted on Auth0's Authorization Server, to verify a user's identity." cta="View Glossary" href="/docs/glossary?term=Universal+Login">Universal Login</Tooltip> page:

```swift lines
let credentialsManager = CredentialsManager(authentication: Auth0.authentication())

Auth0
    .webAuth()
    .scope("openid profile offline_access")
    .start { result in
        switch result {
        case .success(let credentials):
            // Pass the credentials over to the まず、`Auth0`モジュールをインポートします。
            credentialsManager.store(credentials: credentials)
        case .failure(let error):
            // Handle error
        }
}
```

<Warning>

The Keychain items do not get deleted after your app is uninstalled. We recommend to always clear all of your app's Keychain items on first launch.

</Warning>

### アプリの起動時にクイックチェックを実行して、マネージャーに更新可能な資格情報が保存されていることを確認すると便利です。保存されていない場合は、ユーザーを認証画面に移動できます。

ユーザーの資格情報の取得

```swift lines
guard credentialsManager.canRenew() else {
    // Present login page
}
```

### ユーザーの資格情報は以下のようにして取得できます。

ユーザーの資格情報の更新は、トークンが期限切れになったときとまったく同じように行われます。資格情報マネージャーが資格情報を自動的に更新し、更新された資格情報をキーチェーンに保存して、資格情報かエラーのいずれかを含む`Result`を返します。

```swift lines
credentialsManager.credentials { result in 
    switch result {
    case .success(let credentials):
        // Valid credentials; you can access token properties such as
        // `idToken`, `accessToken`
    case .failure(let error):
        // Handle error, present login page
    }
}
```

代替の方法 - SimpleKeychain

## このセクションは、資格情報マネージャーを使用したくない開発者向けです。システムキーチェーンより軽いラッパーであるSimpleKeychainユーティリティが含まれており、トークンを安全に保存するために使用できます。

まず、`SimpleKeychain`モジュールをインポートします。

次に、インスタンスを作成して、必要なトークンを保存します。この場合、認証に成功した後、キーチェーンに`access_token`と`refresh_token`を保存します。

`import SimpleKeychain`

これらを保存したら、いつでも新しい[Credentials]()インスタンスを要求できます。

```swift lines
let keychain = SimpleKeychain(service: "Auth0")

Auth0
    .webAuth()
    .scope("openid profile offline_access")
    .start { result in
        switch result {
        case .success(let credentials):
            guard let refreshToken = credentials.refreshToken else { 
                // Handle error 
                return
            }
            // Store the tokens
            do {
                try keychain.set(credentials.accessToken, forKey: "access_token")
                try keychain.set(refreshToken, forKey: "refresh_token")
            } catch {
                // Handle error
            }
            // You might want to route to your app's main flow at this point
        case .failure(let error):
            // Handle error
        }
}
```

Once you have those stored, you can at any point request a fresh [Credentials](https://github.com/auth0/Auth0.swift/blob/master/Auth0/Credentials.swift) instance.

### Renewing User Credentials

```swift lines expandable
let keychain = SimpleKeychain(service: "Auth0")

Auth0
    .authentication()
    .renew(withRefreshToken: refreshToken)
    .start { result in
        switch(result) {
        case .success(let credentials):
            // If you have Refresh Token Rotation enabled, you get a 
            // new refresh token
            // Otherwise you only get a new access token
            guard let refreshToken = credentials.refreshToken else { 
                // Handle error 
                return
            }
            // Store the new tokens
            do {
                try keychain.set(credentials.accessToken, forKey: "access_token")
                try keychain.set(refreshToken, forKey: "refresh_token")
            } catch {
                // Handle error
            }
        case .failure(let error):
            // Handle error
        }
}
```