---
description: ''
og:description: Describes the Auth0 SDK for Angular Single Page Apps
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: シングルページアプリ用Auth0 Angular SDK
og:url: https://auth0.com/docs/
permalink: auth0-angular-spa
title: シングルページアプリ用Auth0 Angular SDK
twitter:description: Describes the Auth0 SDK for Angular Single Page Apps
twitter:title: シングルページアプリ用Auth0 Angular SDK
---

Auth0 Angular SDKは、Auth0を使用してAngularアプリケーションで認証と認可を実装するためのJavaScriptライブラリです。サービス、認証ガードとHTTPインターセプターを提供して、Angularアプリ内で一般的な認証タスクを処理できるようにします。

The Auth0 Angular SDK handles grant and protocol details, token expiration and renewal, as well as token storage and caching. Under the hood, it implements [Universal Login](/docs/authenticate/login/auth0-universal-login) and the [Authorization Code Grant Flow with PKCE](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce).

The library is [hosted on GitHub](https://github.com/auth0/auth0-angular) where you can [read more about the API](https://auth0.github.io/auth0-angular/).

## インストール

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

The Angular SDK is compatible with Angular SPAs version 14 and above.

</Callout>

Use the [Angular CLI](https://cli.angular.io/) to install the SDK into your project:

`ng add @auth0/auth0-angular`

## SDKの統合を始めるには、プロジェクトに`AuthModule`をインポートし、Auth0クライアントアプリに構成します。

ログイン

```jsx lines
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { AppComponent } from './app.component';

// Import the module from the SDK
import { AuthModule } from '@auth0/auth0-angular';

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,

    // Import the module into the application, with configuration
    AuthModule.forRoot({
      domain: 'YOUR_AUTH0_DOMAIN',
      clientId: 'YOUR_AUTH0_CLIENT_ID',
      authorizationParams: {
        redirect_uri: window.location.origin,
      },
    }),
  ],

  bootstrap: [AppComponent],
})
export class AppModule {}
```

## SDKはAngularの依存性注入システムに完全に対応しています。始めるには、`AuthService`タイプをコンポーネントにインポートして、コンストラクターに注入します。

そして、ユーザーログインを始めるために、サービスで`loginWithRedirect`または`loginWithPopup`メソッドを呼び出します。

ログアウト

```jsx lines
import { Component } from '@angular/core';

// Import the AuthService type from the SDK
import { AuthService } from '@auth0/auth0-angular';

@Component({
  selector: 'app-login',
  template: '<button (click)="login">Log in</button>',
  styles: [],
})
export class LoginComponent {
  // Inject the authentication service into your component through the constructor
  constructor(public auth: AuthService) {}

  login(): void {
    // Call this to redirect the user to the login page
    this.auth.loginWithRedirect();
  }
}
```

## 認証状態

Use `logout` to log your users out. Make sure `returnTo` is specified in **Allowed 認証状態 URLs** in your <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>.

```jsx lines
import { Component } from '@angular/core';

// Import the AuthService type from the SDK
import { AuthService } from '@auth0/auth0-angular';

@Component({
  selector: 'app-logout',
  template: '<button (click)="logout">Log out</button>',
  styles: [],
})
export class LogoutComponent {
  // Inject the authentication service into your component through the constructor
  constructor(@Inject(DOCUMENT) private doc: Document, public auth: AuthService) {}

  login(): void {
    // Call this to redirect the user to the login page
    this.auth.logout({ 
      logoutParams: { 
        returnTo: this.doc.location.origin 
      }
    });
  }
}
```

## ユーザープロファイル

認証されたユーザーのユーザープロファイルは`user$`オブザーバブルを通して公開されます。

```html lines
<div *ngIf="auth.isAuthenticated$ | async">
  <app-login></app-login>
</div>
```

## このオブザーバブルは内部的に`isAuthenticated$`オブザーバブルと連鎖しているため、ユーザーがログインしたかを手動で確認する必要はありません。認証されたユーザーが使用可能になると、値を流し始めます。

ルートの保護

```html lines
<ul *ngIf="auth.user$ | async as user">
  <li>{{ user.name }}</li>
  <li>{{ user.email }}</li>
</ul>
```

経路コンポーネントは組み込みの`AuthGuard`を使用して保護します。認証されていない状態でこのルートにアクセスすると、ユーザーはログインページにリダイレクトされ、ログイン後にこのページに戻ってきます。

## 認証ガードは、`canActivate`フック（子経路を使用している場合には`canActivateChild`）を使って経路に追加する必要があります。

また、認証ガードは`canLoad`フックにも対応し、ユーザーの認証時にモジュールの遅延読み込みを防げるようになっています。

APIを呼び出す

```jsx lines expandable
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { HomeComponent } from './unprotected/unprotected.component';
import { ProtectedComponent } from './protected/protected.component';

// Import the authentication guard
import { AuthGuard } from '@auth0/auth0-angular';

const routes: Routes = [
  {
    path: 'protected',
    component: ProtectedComponent,

    // 認証ガードは、`canActivate`フック（子経路を使用している場合には`canActivateChild`）を使って経路に追加する必要があります。 by registering the auth guard in the `canActivate` hook
    canActivate: [AuthGuard],
  },
  {
    path: '',
    component: HomeComponent,
    pathMatch: 'full',
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}
```

SDKには組み込みの`HttpInterceptor`が含まれています。これは、Angularの`HttpClient`サービスを使って要求が行われた際に`Authorization`ヘッダーを注入し、自動的にアクセストークンをアタッチします。

## 呼び出しサイトでトークンや他の認可待ち行列を提供するために、追加で必要なものは一切ありません。インターセプターとモジュール構成によって処理されます。

The SDK contains a built-in `HttpInterceptor` that automatically attaches <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+tokens">access tokens</Tooltip> by injecting an `Authorization` header when requests are made using Angular's `HttpClient` service.

まず、Auth0 HTTPインターセプターをアプリに統合するために必要なタイプをインポートします。

### **注意：**インターセプターは他のインターセプターと連鎖するように設計されているため、アプリケーションモジュールに（自動で登録するのではなく）手動で登録する必要があります。自動で正しい場所に挿入される保証はありません。

HTTPインターセプターを構成する

```jsx lines
// Import the interceptor module and the Angular types you'll need
import { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';
import { AuthHttpInterceptor } from '@auth0/auth0-angular';

// Register the interceptor with your app module in the `providers` array
@NgModule({
  declarations: [],
  imports: [
    BrowserModule,
    HttpClientModule,     // Register this so that you can make API calls using HttpClient
    AppRoutingModule,
    AuthModule.forRoot(...),
  ],
  providers: [
    { provide: HTTP_INTERCEPTORS, useClass: AuthHttpInterceptor, multi: true },
  ],
  bootstrap: [AppComponent],
})
```

必要に応じて、各種の構成方法があります。経路の指定では、文字列を使用したり、送信されるトークンに影響するオプションをオブジェクトに含めて使用したりできます。また、使用するHTTP動詞によっては一致させることもできます。経路のURIにはワイルドカードを使用して、経路のグループを指定することもできます。

### **注意：**HTTP呼び出しが行われ、構成に指定されている経路と一致しない場合には、インターセプターが迂回され、`Authorization`ヘッダーは含まれません。

下の例は、どの経路に`Authorization`ヘッダーを含めるべきかをSDKに指示する一般的な方法です。

**Note:** If an HTTP call is made but does not match a route specified in the configuration, the interceptor will be bypassed and the `Authorization` header will not be included.

APIを呼び出す

```jsx lines expandable
// Modify your existing SDK configuration to include the httpInterceptor config
AuthModule.forRoot({
  domain: 'YOUR_AUTH0_DOMAIN',
  clientId: 'YOUR_AUTH0_CLIENT_ID',
  authorizationParams: {
    redirect_uri: window.location.origin,
  },

  // The AuthHttpInterceptor configuration
  httpInterceptor: {
    allowedList: [
      // Attach access tokens to any calls to '/api' (exact match)
      '/api',

      // Attach access tokens to any calls that start with '/api/'
      '/api/*',

      // Match anything starting with /api/accounts, but also specify the audience and scope the attached
      // access token must have
      {
        uri: '/api/accounts/*',
        tokenOptions: {
          authorizationParams: {
            audience: 'http://my-api/',
            scope: 'read:accounts',
          }
        },
      },

      // Matching on HTTP method
      {
        uri: '/api/orders',
        httpMethod: 'post',
        tokenOptions: {
          authorizationParams: {
            audience: 'http://my-api/',
            scope: 'write:orders',
          }
        },
      },

      // Using an absolute URI
      {
        uri: 'https://your-domain.auth0.com/api/v2/users',
        tokenOptions: {
          authorizationParams: {
            audience: 'https://your-domain.com/api/v2/',
            scope: 'read:users',
          }
        },
      },
    ],
  },
});
```

**Note:** `tokenOptions` is passed directly to the `getTokenSilently` method on the underlying SPA SDK. Please see [the documentation](https://auth0.github.io/auth0-spa-js/interfaces/gettokensilentlyoptions.html) for more detail on the properties that are accepted.

### 呼び出しサイトでトークンや他の認可待ち行列を提供するために、追加で必要なものは一切ありません。インターセプターとモジュール構成によって処理されます。

Make your API call using Angular's `HttpClient` service. Access tokens should automatically be included via the `Authorization` header for routes that match the configuration.

```jsx lines
export class MyComponent {
  constructor(private http: HttpClient) {}

  callApi(): void {
    this.http.get('/api').subscribe(result => console.log(result));
  }
}
```

Note that there is nothing additional required at the call site to provide tokens or other authorization queues; that is all handled by the interceptor and the module configuration.