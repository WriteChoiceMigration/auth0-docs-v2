---
og:description: How to secure a Google Cloud Endpoints API with Auth0.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Auth0でGoogle Cloud Endpointsをセキュリティ保護する
og:url: https://auth0.com/docs/
permalink: google-cloud-endpoints
title: Auth0でGoogle Cloud Endpointsをセキュリティ保護する
twitter:description: How to secure a Google Cloud Endpoints API with Auth0.
twitter:title: Auth0でGoogle Cloud Endpointsをセキュリティ保護する
---

[Google Cloud Endpoints（GCE）](https://cloud.google.com/endpoints/)は、APIの作成、維持、およびセキュリティ保護などの機能を提供するAPI管理システムです。GCEは[OpenAPI](https://www.openapis.org/)を使用して、APIのエンドポイント、入出力、エラー、およびセキュリティ記述を定義します。

OpenAPI仕様の詳細については、GitHubの[OpenAPI Specification（OpenAPIの仕様）](https://github.com/OAI/OpenAPI-Specification)リポジトリを参照してください。

このチュートリアルでは、Auth0を使用してGoogle Cloud Endpointsをセキュリティ保護する方法を説明します。

## 前提条件

開始する前に、GCE APIをデプロイしておく必要があります。まだAPIを作成していない場合は、Googleドキュメントにある「[Cloud Endpointsのクイックスタート](https://cloud.google.com/endpoints/docs/quickstart-endpoints)」を読み、作業を完了させます。

このクイックスタートでは、3文字の[IATAコード](https://en.wikipedia.org/wiki/IATA_airport_code)から空港名を返す`/airportName`という単一のエンドポイントを持つ簡単なGCE APIを作成する手順を説明しています。



## Auth0でAPIを定義する

[［Auth0 Dashboard］ > ［Applications（アプリケーション）］ > ［APIs］](%24%7Bmanage_url%7D/#/apis)に進み、新しいAPIを作成します。

次のステップで使用するために、（上のスクリーンショットにある`http://google_api`）**［API Audience（APIオーディエンス）］**のIDをメモしておいてください。

## API構成を更新する

次に、GCE API用のOpenAPI構成ファイルを更新します。クイックスタート中に作成されたサンプルAPIでは、このファイルは`openapi.yaml`となっています。

### セキュリティ定義を追加する

この構成ファイルを開き、新しく`securityDefinitions`セクションを追加します。このセクションに、以下のフィールドを持つ新しい定義（`auth0_jwt`）を追加します。





### エンドポイントを更新する

次に、前のステップで作成した`securityDefinition`を使用して`security`フィールドを追加し、エンドポイントを更新します。



上の例では、`security`フィールドがGCEプロキシに、`/airportName`パスが`auth0-jwt`でセキュリティ保護されていることが期待されていることを伝えています。

OpenAPIの構成が更新されると、以下のようになります。



### APIを再デプロイする

次に、GCE APIを再デプロイして、構成変更を適用します。[Cloud Endpointsのクイックスタート](https://cloud.google.com/endpoints/docs/quickstart-endpoints)に従った場合は、GoogleのCloud Shellに以下を入力することで再デプロイすることができます。



## APIをテストする

再デプロイが完了したら、セキュリティなしでAPIを再度呼び出します。



以下のような応答が返されます。



期待どおりの結果です。

次に、[Auth0 Dashboard](%24%7Bmanage_url%7D/#/apis)のGoogle Endpoints API定義の**［Test（テスト）］**ページに移動し、［Response（応答）］の下にあるアクセストークンをコピーします。

Authorization Header（認可ヘッダー）に`Bearer {ACCESS_TOKEN}`を設定し、APIに対して`GET`要求を実行することで、認可されたアクセスを取得します。



これで作業完了です。