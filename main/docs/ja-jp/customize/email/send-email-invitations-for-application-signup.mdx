---
og:description: Describes how to customize the signup process to invite users to signup
  for an account in the context of a specific Auth0 application.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: アプリケーションサインアップのためのメール招待状を送信する
og:url: https://auth0.com/docs/
permalink: send-email-invitations-for-application-signup
title: アプリケーションサインアップのためのメール招待状を送信する
twitter:description: Describes how to customize the signup process to invite users
  to signup for an account in the context of a specific Auth0 application.
twitter:title: アプリケーションサインアップのためのメール招待状を送信する
---

ユーザーのサインアップを制限したり、アプリケーションのアカウントを一括作成したりするために、アプリケーションはユーザーの招待を使用してユーザーをプロビジョニングできます。

<Warning>

Organization member invitation differs from the user invitation workflow in this article. This article discusses how to generate invitations to sign up for an account in the context of a specific application. If you are working with Organizations and want to learn how to invite members to organizations via email, read [Invite Organization Members](/docs/manage-users/organizations/configure-organizations/invite-members) instead.

</Warning>

一般的なユーザーの招待ワークフローは以下の手順に従います。

1. Administrator creates a user account.
2. Administrator sends a registration email invitation to the user.
3. User follows a link in the invitation email to set up a password for the account.
4. User creates and verifies a password.
5. User signs in.

## 招待状の作成

ユーザーの招待は基本的に、招待として再利用されたパスワード変更リンクです。ユーザー招待メールは、「パスワード変更」テンプレートから派生します。Auth0 では、ユーザーの招待を実装するための一般的なアプローチが2つあります。

* [Customize an email template](/docs/customize/email/email-templates) and use it to [send a change password email](/docs/customize/email/manage-email-flow).
* パスワード変更チケットを作成します。

You can allow a user to access an existing account that you have created on their behalf. Then, send the user a unique link to set their password. You generate the unique link by creating a Password Change ticket where your invitation app calls the `/password-change` [Management API endpoint](https://auth0.com/docs/api/management/v2/#!/Tickets/post_password_change). You will need to:

* [Create an Auth0 database user](/docs/authenticate/database-connections) with the `user.email_verified` parameter set to `false`. You can use the [Create a User](https://auth0.com/docs/api/management/v2/#!/Users/post_users) endpoint.
* Have access to and [configure an external email service](/docs/customize/email/smtp-email-providers)
* [Get a Management API access token](/docs/secure/tokens/access-tokens/management-api-access-tokens/get-management-api-access-tokens-for-testing)

### パスワード変更チケットを作成する

1. Specify the user using `user_id` or email and `connection_id` to the [Management API endpoint](https://auth0.com/docs/api/management/v2#!/Tickets/post_password_change).
2. Specify where the redirect sends the user. The `result_url` parameter is the redirect location your application sends the user after they set their password. In this case, the `result_url` should be your app login page. To learn more, read [Redirect Users After Login](/docs/authenticate/login/redirect-users-after-login). You may also use the `client_id` parameter shown below; after the customer verifies their email, they are redirected to your client's Default Login URI.
3. Specify the lifespan of the invitation link. Use the `ttl_sec` parameter to set how long the invitation link will remain active. The `ttl_sec` parameter should align with your relevant security concerns. The link is a one-time use, so once the user has set their password, it is not vulnerable to reuse.
4. Verify the email address. If sent to a registered email account, set the `mark_email_as_verified` parameter as `true`. You **should not** set the email verification to `true` if the email account is not registered. A successful request to this endpoint will return a ticket URL. You will use that URL to create the user invitation.

For more information, read [Configure Default Login Routes](/docs/authenticate/login/auth0-universal-login/configure-default-login-routes).

```bash lines
curl -- request POST \
  --url 'https://{yourAuth0Tenant}/api/v2/tickets/password-change' \
  --header "Content-Type: application/json" \
  --data '{"user_id":,{yourUserID}","client_id":"{yourClientID","ttl_sec":0,"mark_email_as_verified":true,"includeEmailInRedirect":false}'
```






### クエリーパラメーターチケットURLを追加する

クエリーパラメーターをURLに追加して、パスワードリセットUIをカスタマイズできます。返されるURLには、ユーザーがパスワードとその後に続く`#`を設定できる一意のコード値が含まれます。`#`より前の部分は編集しないでください。

パラメーターを追加して、設定パスワードワークフローUIを指定します。例：

```http lines
#type=invite
```






パラメーターを追加してターゲットアプリを識別します。例：

```http lines
#app=AppName
```






### メールテンプレート作成する

The email invitation needs to be sent with your existing email service provider. [Customize the password change email template](/docs/customize/email/email-templates) so the language in the email aligns with your use case. Include the link generated from the steps above. The text in the email should explain:

* ユーザーアカウントを要求する次の手順。
* リンクの有効期限。
* 有効期限が切れた場合の新しい招待を生成するための手順。

たとえば、招待するユーザーを作成するときに、このユーザーアカウントが招待されたことを示すプロパティを`user.app_metadata`に追加することができます。さらに、メールテンプレートでこのプロパティをチェックできます。

```liquid lines
{% if user.app_metadata.invitedToMyApp == true %}
  // user invitation email
{% else %}
  // password change email
{% endif %}
```






## パスワードリセットUIをカスタマイズする

Once the user clicks the link in the invitation they will be brought to the <Tooltip tip="Universal Login: Your application redirects to Universal Login, hosted on Auth0's Authorization Server, to verify a user's identity." cta="View Glossary" href="/docs/glossary?term=Universal+Login">Universal Login</Tooltip> Password Reset page where they will set a password for their account. Since this page is used both for the forgot password workflow and for your user invitations, you will want to use the query parameters you defined earlier to identify the invite workflow and customize the UI accordingly. To learn more, read [Customize Password Reset Page](/docs/customize/login-pages/classic-login/customize-password-reset-page) for Classic Login or [Customize Universal Login](/docs/customize/login-pages/universal-login) for Universal Login.

## ユーザーエクスペリエンスを完了する

大半のケースにおいて、ユーザーがパスワードを設定すると、対象アプリへのアクセスを許可します。ターゲットアプリは次の手順でログインシーケンスを開始します。

1. User submits password.
2. Change password screen redirects return URL.
3. Target app redirects to `/authorize`.
4. User submits their credentials.
5. User is authenticated into the app.

ワークフローにはリダイレクトが含まれますが、パスワード設定フォームからログインフォームへの移行がエンドユーザーにとってシームレスに見える可能性があります。

クラシックログインを使用している場合、パスワード変更チケットの作成時に設定した`result_url`は、ユーザーがパスワードを作成した後にリダイレクトされる場所になります。この場合、ログインワークフローを開始できるように、URLをユーザーが招待されたサイトに配置する必要があります。ターゲットアプリは、`success`パラメーターを解析してエラーが発生していないことを確認してから、すぐにAuth0へのリダイレクトを開始してユーザーをログインさせる必要があります。

ユーザーエクスペリエンスを最適化するには、ターゲットアプリで`email`パラメータを解析し、それを`login_hint`パラメータとして認証要求に含めることができます。これにより、ログインフォームにユーザーのメールアドレスが事前に入力されます。

## Learn more

* [Customize Email Templates](/docs/customize/email/email-templates)
* [Customize Email Handling](/docs/customize/email/manage-email-flow)
* [Configure External SMTP Email Providers](/docs/customize/email/smtp-email-providers)