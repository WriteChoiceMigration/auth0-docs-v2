---
og:description: Learn how to configure a progressive profile form using Forms for
  Actions
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ユースケース：Formsを使用してプログレッシブプロファイルフォームを構成する
og:url: https://auth0.com/docs/
permalink: configure-progressive-profile-form
title: ユースケース：Formsを使用してプログレッシブプロファイルフォームを構成する
twitter:description: Learn how to configure a progressive profile form using Forms
  for Actions
twitter:title: ユースケース：Formsを使用してプログレッシブプロファイルフォームを構成する
---

<Card title="Before you start">

1. Create a [Machine-to-Machine Application](/docs/get-started/auth0-overview/create-applications/machine-to-machine-apps) with the following scopes enabled:

* `read:users`
* `update:users`
* `create:users`
* `read:users_app_metadata`
* `update:users_app_metadata`
* `create:users_app_metadata`

2. Add a [Vault connection](/docs/customize/forms/vault) using the M2M application credentials.

</Card>

Forms for Actionsを使用すると、プログレッシブプロファイリングフローを作成して、会社名や役職などの不足している情報を収集し、それらを`user_metadata`属性として保管するようユーザーに求めるタイミングを決定できます。

<Frame>![Dashboard > Actions > Forms > Form](/images/cdy7uua7fh8z/xUx9YmnHvnAqL19JvNtNP/60dae88f893d4ebe8e3523421e960596/Progressive-profle-overview.png)</Frame>

The sections below outline how you can create a progressive profile form using nodes and flows, along with steps for adding your form to a [Post Login Action](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger).

## Create a form from scratch

Follow these steps to create a form to gather information:

1. Open the Form editor by selecting **Auth0 Dashboard > Actions > Forms.**
2. Select **Create Form** > **Start from scratch**.

By default, a new form contains a Start node, a Step node, and an Ending screen node.

<Frame>![Dashboard > Forms > Use Cases > Form](/images/cdy7uua7fh8z/2TZ9jSjgEcARFpULI6hz4R/a4319a1bd482f2ee5cc23100fdb2f42c/New-form-Forms-for-action-use-case.png)</Frame>

### ステップノードを構成する

The Step node is the graphical interface visible to users. Add [Fields](/docs/customize/forms/nodes-and-components) to the Step node to collect the user's company name and job title values by following these steps:

1. Drag a **Rich text** field from the **Components menu** into the **Step** node.

   * **Rich text（リッチテキスト）**：カスタムメッセージを入力します。

     + **例**：`Complete your profile! We need you to complete your profile to personalize your experience.`（プロファイルの完成！エクスペリエンスをパーソナライズするには、プロファイルを完成させる必要があります。）
   * **［Save（保存）］**を選択します。
2. Drag a **Text** field into the **Step** node.

   * **Id**：`company_name`を入力します。
   * **Label（ラベル）**：チェックボックスを有効にします。
   * **Label（ラベル）**：`Company name`（会社名）を入力します。
   * **Required（必須）**：チェックボックスを有効にします。
   * **［Save（保存）］**を選択します。
3. Drag a **Text** field into the **Step** node.

   1. **ID**: Enter `job_title`.
   2. **Label**: Enter `Job title`.
   3. **Label（ラベル）**：チェックボックスを有効にします。
   4. **Required（必須）**：チェックボックスを有効にします。
   5. **［Save（保存）］**を選択します。
4. Select **Publish** to save.

<Frame>![Dashboard > Actions > Forms > Form > Step node](/images/cdy7uua7fh8z/6H1lRzwKyYioQyQJ9MtIoM/aa248e92fc028a68a5b92ff361a11644/progressive-profile-step.png)</Frame>

### Configure the flow node

Add a **Flow** node after the **Step** node to update the `user_metadata` and resume the authentication flow by following these steps:

1. Select **Flow** from the bottom of the Form editor.
2. Remove the existing link between the **Step** and **Ending Screen** nodes.
3. Select the new **Flow** > **Click to add a flow** > **Create a new flow.**

   * **［Name（名前）］**フィールドに`Update user_metadata`（user_metadata更新）と入力します。
   * **［Create（作成）］**を選択します。
   * **［Save（保存）］**を選択します。
4. Link the **Flow** node to the **Step** and **Ending Screen** nodes as pictured below.
5. Select **Publish** to save.

<Frame>![Dashboard > Actions > Forms > Form](/images/cdy7uua7fh8z/5C91DaWn4LGtJT9BF87ssu/095171d0c452a287c44bfde12fd6d13f/link-nodes.png)</Frame>

Auth0ユーザー更新アクションをフローに追加するには、次の手順に従います。

1. Select the **Update user_metadata** flow, then select the **Edit Flow** to open the Flow editor in a new tab.
2. Below the **Start** action, select the **+** icon to add an **Update user** action. Complete the fields below, then select **Save** to continue.

   * **Connection（接続）**：ドロップダウンからM2MアプリケーションへのVault接続を選択します。
   * **User ID（ユーザーID）**：`{{context.user.user_id}}`と入力します。
   * **Body（ボディー）**：以下のコードをコピーして貼り付け、`job_title`と`company_name`のプロパティを含むuser_metadataを更新します。

      ```json lines
      {
         "user_metadata": {
            "job_title": "{{fields.job_title}}",
            "company_name": "{{fields.company_name}}"
         }
      }
      ```

   * **［Save（保存）］**を選択します。
3. Select **Publish** to save.

<Frame>![Dashboard > Actions > Forms > Flows](/images/cdy7uua7fh8z/65Jx4W5oIZJyyvA8z4HqIx/0661b1a8ca6361c54fc4fef07ba59f0b/update-user.png)</Frame>

### フォームのレンダーコードを取得する

フォームのレンダーコードを取得して、カスタムのログイン後アクションでフォームを視覚的にレンダリングするには、以下の手順に従います。

* From the Form editor, select **`<> Render`**.
* **［Copy（コピー）］**を選択します。

<Frame>![Dashboard > Actions > Forms > Form > Embed](/images/cdy7uua7fh8z/2EIUzc539sq9lwoTKbjoJv/496a864c0fc44a782c9cadca119dbfb0/embed.png)</Frame>

## ログイン後のアクションを作成する

ログイン後のアクションを作成してフォームをレンダリングするには、次の手順に従います。

1. Navigate to **Auth0 Dashboard > Actions > Flows > Login.**
2. Select the **+** icon and select **Build from scratch**:

   * **Name（名前）**：`Render Progressive Profile Form`（プログレッシブプロファイルフォームのレンダリング）と入力します。
   * **Trigger（トリガー）**：［`Login / Post Login`（ログイン/ログイン後）］を選択します。
   * **Runtime（ランタイム）**：推奨バージョンを選択します。
3. **［Create（作成）］**を選択します。

ログイン後のアクションを構成するには、以下を行います。

1. Delete the existing code from the Code editor.
2. Paste the form embed code into the Code editor.
3. Edit the code to define the conditional logic that will render the form.

   ```javascript lines
   /**
   * @param {Event} event - Details about the user and the context in which they are logging in.
   * @param {PostLoginAPI} api - Interface whose methods can be used to change the behavior of the login.
   */
   exports.onExecutePostLogin = async (event, api) => {
     const FORM_ID = 'REPLACE_WITH_YOUR_FORM_ID';

     if (
       event.stats.logins_count > 2 &&
       !event.user.user_metadata.company_name &&
       !event.user.user_metadata.job_title
     ) {
       api.prompt.render(FORM_ID);
     }
   }

   exports.onContinuePostLogin = async (event, api) => { }
   ```


   

   

   <Callout icon="file-lines" color="#0EA5E9" iconType="regular">

   The example code above will render the form when a user has a login count > 2 and is missing the user metadata company_name and job_title properties.

   </Callout>
4. Select **Deploy.**
5. Drag and Drop the **Render Progressive Profile Form** Action to the **Login** flow.

   <Frame>![Dashboard > Forms > Use Cases Progressive Profile Login Action](/images/cdy7uua7fh8z/1QjjZdpTqTxx012UDN4xk9/99fba5ef4068a5688f1762eea7f42976/renderprogessiveprofile.png)</Frame>
6. Select **Apply**.

### Test implementation

次の手順に従って実装をテストします。

1. Log in with an existing user whose login count is greater than 2 and their `user_metadata` attributes `company_name` and `job_title` have no values.
2. The post-login action in the Login flow will render the form and prompt for the information.
3. Select **Auth0 Dashboard > User Management > Users,** locate the user and verify that the `user_metadata` attributes `company_name` and `job_title` contain information.