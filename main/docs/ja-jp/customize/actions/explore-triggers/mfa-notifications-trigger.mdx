---
og:description: Learn about Action's Send Phone Message flow and the send-phone-message
  Action trigger, which runs for the enrollment and challenge process if you have
  used SMS as a factor for Multi-factor Authentication (MFA).
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 携帯へのメッセージ送信フロー
og:url: https://auth0.com/docs/
permalink: mfa-notifications-trigger
title: 携帯へのメッセージ送信フロー
twitter:description: Learn about Action's Send Phone Message flow and the send-phone-message
  Action trigger, which runs for the enrollment and challenge process if you have
  used SMS as a factor for Multi-factor Authentication (MFA).
twitter:title: 携帯へのメッセージ送信フロー
---

The 携帯へのメッセージ送信 trigger allows you to execute code when using SMS/Voice as a factor for [Multi-factor Authentication (MFA)](/docs/secure/multi-factor-authentication). When using a [custom provider](/docs/secure/multi-factor-authentication/multi-factor-authentication-factors/configure-sms-voice-notifications-mfa#custom-phone-messaging-providers) to send the messages, this flow's `send-phone-message` trigger is required to configure your custom provider.

<Frame>![Diagram of the Actions 携帯へのメッセージ送信 Flow.](/images/cdy7uua7fh8z/FSkVXDdknDJq1hsK08EYu/e031ec0067a5460afae8d9ed5d462288/send-phone-message-flow.png)</Frame>

このフロー内のアクションはブロッキング（同期的）であり、トリガーのプロセスの一部として実行されます。そのため、アクションが完了するまでAuth0パイプラインの他の部分の実行が停止されます。

## トリガー

### 携帯へのメッセージ送信

The `send-phone-message` trigger will run for the enrollment process and the challenge process (`event.message_options.action`). It will also run for the `voice` message type when using the New experience for <Tooltip tip="Universal Login: Your application redirects to Universal Login, hosted on Auth0's Authorization Server, to verify a user's identity." cta="View Glossary" href="/docs/glossary?term=Universal+Login">Universal Login</Tooltip> (`event.message_options.message_type === 'voice'`).

#### [イベントオブジェクト](/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object):送信されるメッセージや、チャレンジまたは登録されるユーザーに関するコンテキスト情報が提供されます。

* [Event object](/docs/customize/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object): Provides contextual information about the message to be sent and the user to be challenged or enrolled.
* [API object](/docs/customize/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-api-object): Provides methods for changing the behavior of the flow.

## カスタムSMSプロバイダーを使用する

### Use a custom SMS provider

```javascript lines
const AWS = require("aws-sdk");

/**
 * Handler that will be called during the execution of a SendPhoneMessage flow.
 *
 * @param {Event} event - Details about the user and the context in which they are logging in.
 */
exports.onExecuteSendPhoneMessage = async (event) => {
  const text = event.message_options.text;
  const recipient = event.message_options.recipient;

  const awsSNS = new AWS.SNS({
    apiVersion: "2010-03-31",
    region: event.secrets.AWS_REGION,
    credentials: new AWS.Credentials(event.secrets.AWS_ACCESS_KEY_ID, event.secrets.AWS_SECRET_ACCESS_KEY)
  });

  const params = { Message: text, PhoneNumber: recipient };

  return awsSNS
    .publish(params)
    .promise();
};
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

For this Action to execute properly, the Action must contain secrets named `AWS_REGION`, `AWS_ACCESS_KEY_ID`, and `AWS_SECRET_ACCESS_KEY`, and must have a dependency on the `aws-sdk` NPM package.

</Callout>