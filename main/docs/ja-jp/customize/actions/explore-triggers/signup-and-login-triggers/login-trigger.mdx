---
og:description: Learn about the Actions Login Flow and the post-login Action trigger,
  which is executed after a user logs in and when a Refresh Token is requested.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ログイントリガー
og:url: https://auth0.com/docs/
permalink: login-trigger
sidebarTitle: ログイントリガー
title: ログイントリガー
twitter:description: Learn about the Actions Login Flow and the post-login Action
  trigger, which is executed after a user logs in and when a Refresh Token is requested.
twitter:title: ログイントリガー
---

ログイントリガーは、ユーザーがAuth0テナント上のアプリケーションに対して正常に認証された場合に実行されます。これにはサインアップ後の認証も含まれます。

このトリガー内のアクションはブロッキング（同期的）であり、トリガーのプロセスの一部として実行されます。そのため、アクションが完了するまでAuth0パイプラインの他の部分の実行が停止されます。

## トリガー

### ログイン/ログイン後

`post-login`トリガーは、ユーザーがログインした後とリフレッシュトークンが要求されたときに実行される関数です。

#### 参照

* [イベントオブジェクト](/signup-and-login-triggers/login-trigger/post-login-event-object)：Auth0を通してログインする1人のユーザーについてのコンテキスト情報を提供します。
* [APIオブジェクト](/signup-and-login-triggers/login-trigger/post-login-api-object)：フローの動作を変更するためのメソッドを提供します。

## 一般的なユースケース

### アクセス制御

ログイン後のアクションを使用すると、アプリケーションにアクセスしようとしているユーザーへのアクセスを拒否するためのカスタムロジックを提供できます。



### 特定のアプリケーションに平日のみのアクセスを許可する

アクセスを平日のみに限定したいアプリケーションがある場合は、次のアクションを作成できます。



### APIを呼び出すユーザーのすべてにアクセスを拒否する

たとえば、APIを呼び出すユーザーのすべてに対して、アクセスを拒否したいとします。この場合は、[［Dashboard］>［Applications（アプリケーション）］>［APIs］](https://manage.auth0.com/#/apis)の**［API Audience（APIオーディエンス）］**フィールドにあるAPIのオーディエンスの値に基づいてアクセスを拒否する必要があります。これを行うには、以下のアクションを作成します。



### ユーザーのロールをIDおよびアクセストークンに追加する

Auth0が発行したトークンにユーザーロールを追加するには、`event.authorization`オブジェクトと`api.idToken.setCustomClaim`および`api.accessToken.setCustomClaim`メソッドを使用します。



* カスタムクレームには特定の用語を含めることができないため、URI形式の名前空間クレームの使用を強くお勧めします。詳細については、[カスタムクレームに関する当社のドキュメント](/security/tokens/json-web-tokens/create-custom-claims)を参照してください。
* 要求元のアプリケーションに返されるJWTは、トリガー処理の終わりに作成され、署名されます。最終の署名済みJWTはアクションでは処理できません。

### ユーザープロファイルを充実させる

Auth0には[ユーザープロファイル](/users/user-profiles/normalized-user-profiles)にメタデータを保存するためのシステムがあります。ログイン中にユーザープロファイルの`user_metadata`または`app_metadata`を設定するには、`api.user.setUserMetadata`または`api.user.setAppMetadata`関数を使用します。



ログイン後のアクションがすべて実行し終わると、Actionsが1回の操作でユーザープロファイルを更新します。この操作は、ユーザー書き込みに対する[レート制限](/support/policies/rate-limit-policy/management-api-endpoint-rate-limits)の対象となります。

### カスタムMFAポリシーを適用する

ログイン後のアクションを使用すると、アプリケーションのニーズに応じて、ユーザーのMFAを動的に要求できます。



ログインでMFAを有効にするには、MFAプロバイダーを構成する必要があります。詳細については、「[多要素認証](/mfa)」をお読みください。

### パスキーの煩わしさを軽減する

ログイン後のアクションを使用すると、パスキーで認証したユーザーのMFAを動的にスキップすることで、煩わしさを軽減できます。



接続にパスキーとMFAが有効化されている必要があります。詳細については、「[パスキー](/passkeys)」と「[多要素認証](/mfa)」をお読みください。

### ユーザーを外部サイトにリダイレクトする

[リダイレクトルール](/rules/redirect-users)と同様に、ログイン後のアクションを使用してユーザーを外部サイトに送信できます。完了すると、ユーザーをAuth0にリダイレクトで戻し、ログインフローを続行できます。以下の例では、リダイレクトのアクションを使ってユーザーに好きな色の指定を求めています。



ユーザーがリダイレクトされている間、アクションパイプラインは停止されます。ユーザーがAuth0のログインプロセスを続行すると、アクションパイプラインは中断された場所から再開されます。リダイレクト前に実行されたアクションは再度実行されません。

リダイレクトのアクションについては、「[アクションを使用してリダイレクトする](/signup-and-login-triggers/login-trigger/redirect-with-actions)」をお読みください。

### アクセストークンのスコープを変更する

アクセストークンに関連付けられたスコープを変更する場合は、オーディエンス仕様に関するベストプラクティスに従ってください。

* スコープを追加する前に、必ず予期されているオーディエンスを確認してください。
* スコープを追加するときには、信頼できない入力を使用してはけません。