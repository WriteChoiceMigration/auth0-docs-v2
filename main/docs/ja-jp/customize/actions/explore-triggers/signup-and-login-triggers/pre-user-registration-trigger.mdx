---
og:description: Learn about the Pre User Registration Flow, which runs when a user
  attempts to register through a Database or Passwordless connection. It can be used
  to add metadata to the user profile before it is created or to deny a registration.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: ユーザー登録前フロー
og:url: https://auth0.com/docs/
permalink: pre-user-registration-trigger
sidebarTitle: ユーザー登録前フロー
title: ユーザー登録前フロー
twitter:description: Learn about the Pre User Registration Flow, which runs when a
  user attempts to register through a Database or Passwordless connection. It can
  be used to add metadata to the user profile before it is created or to deny a registration.
twitter:title: ユーザー登録前フロー
---

The Pre User Registration（ユーザー登録前） trigger runs before a user is added to a Database or <Tooltip tip="Passwordless: Form of authentication that does not rely on a password as the first factor." cta="View Glossary" href="/docs/glossary?term=Passwordless">Passwordless</Tooltip> Connection.

<Frame>![Diagram showing the Actions Pre User Registration Flow.](/images/cdy7uua7fh8z/2KtUcZhaBcT12GxjhBJZFG/9633b4454ac1c06c0deed6c97e70fe7d/pre-user-registration-flow.png)</Frame>

このフロー内のアクションはブロッキング（同期的）であり、トリガーのプロセスの一部として実行されます。そのため、アクションが完了するまでAuth0パイプラインの他の部分の実行が停止されます。

## トリガー

### Pre User Registration（ユーザー登録前）

リファレンス

<Warning>

You cannot currently use `pre-user-registration` Actions to add metadata to passwordless users.

</Warning>

#### [イベントオブジェクト](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)：新しいユーザーを登録するための要求についてのコンテキスト情報を提供します。

* [Event object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object): Provides contextual information about the request to register a new user.
* [API object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object): Provides methods for changing the behavior of the flow.

## 位置で登録を拒否する

### pre-user-registrationのアクションは、ユーザーのサインアップを防ぐために使用されます。

メタデータをユーザープロファイルに設定する

```javascript lines
/**
 * @param {Event} event - Details about registration event.
 * @param {PreUserRegistrationAPI} api
 */
exports.onExecutePreUserRegistration = async (event, api) => {
  if (event.request.geoip.continentCode === "NA") {

    // localize the error message 
    const LOCALIZED_MESSAGES = {
      en: 'You are not allowed to register.',
      es: 'No tienes permitido registrarte.'
    };

    const userMessage = LOCALIZED_MESSAGES[event.request.language] || LOCALIZED_MESSAGES['en'];
    api.access.deny('no_signups_from_north_america', userMessage);
  }
};
```






### pre-user-registrationのアクションは、作成される前にメタデータをユーザープロファイルに追加するために使用することができます。

ユーザープロファイルに、別のシステムからのユーザーIDを保存する

<Warning>

You cannot currently use `pre-user-registration` Actions to add metadata to passwordless users.

</Warning>

```javascript lines
/**
 * @param {Event} event - Details about registration event.
 * @param {PreUserRegistrationAPI} api
 */
exports.onExecutePreUserRegistration = async (event, api) => {
  api.user.setUserMetadata("screen_name", "username");  
};
```






### pre-user-registrationのアクションはユーザープロファイルに、別のシステムからのユーザーIDを保存するために使用することができます。

A pre-user registration Action can be used to store a user ID from another system in the user profile.

```javascript lines expandable
const axios = require('axios');

const REQUEST_TIMEOUT = 2000; // Example timeout

/**
* Handler that will be called during the execution of a PreUserRegistration flow.
*
* @param {Event} event - Details about the context and user that is attempting to register.
* @param {PreUserRegistrationAPI} api - Interface whose methods can be used to change the behavior of the signup.
*/
exports.onExecutePreUserRegistration = async (event, api) => {
  try {
    // Set a secret USER_SERVICE_URL = 'https://yourservice.com'
    const remoteUser = await axios.get(event.secrets.USER_SERVICE_URL, {
      timeout: REQUEST_TIMEOUT,
      params: {
        email: event.user.email 
      }
    });

    if (remoteUser) {
      api.user.setAppMetadata('my-api-user-id', remoteUser.id); 
    }
  } catch (err) {
    api.validation.error('custom_error', 'Custom Error');
  }
};
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

To use an `npm` library like `axios`, you must add the library to the Action as a dependency. To learn more, read the "Add a dependency" section in [Write Your First Action](/docs/customize/actions/write-your-first-action).

</Callout>

### Deny access to specific JA3/JA4 fingerprints

The `event.security_context` object contains the JA3/JA4 fingerprint values for the current transaction.

```js lines
exports.onExecutePreUserRegistration = async (event, api) => {
  const clientJa4 = event?.security_context?.ja4;
  console.log('[ACTION]', {clientJa4});
  const badFingerprints = ['t13d1517h2_8daaf6152771_b6f405a00624','t13d1516h2_8daaf6152771_d8a2da3f94cd'];
  if (clientJa4 && badFingerprints.includes(clientJa4)){
    api.access.deny('suspicious_tls_fingerprint', 'Your TLS fingerprint has been flagged as suspicious');
  }
};
```