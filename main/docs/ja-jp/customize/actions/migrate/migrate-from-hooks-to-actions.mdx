---
og:description: Learn how to migrate your existing Auth0 Hooks code to Auth0 Actions
  code.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: HooksからActionsへの移行
og:url: https://auth0.com/docs/
permalink: migrate-from-hooks-to-actions
title: HooksからActionsへの移行
twitter:description: Learn how to migrate your existing Auth0 Hooks code to Auth0
  Actions code.
twitter:title: HooksからActionsへの移行
---

既存のHooksをActionsに変換する際には、その種類のフックに対応するトリガーを新しいアクションと関連付ける必要があります。提供するマッピングの識別に沿って以下の手順に従えば、ほぼ同一の機能性に保てるはずです。

## 移行を計画する

Deployed Actions run after active Hooks, so you can either convert Hooks one at a time in the Dashboard or all at once using the <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>.

コードを変換してから、アクションをアクティブにし、フックを非アクティブにする必要があります。アクションの有効化とフックの無効化は、連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。

このため、パイプラインを段階的に移行することをお勧めします。フックコードの一部をアクションコードに変換し、ステージング環境でテストしてから、一度に1つずつライブに移行します。アクティブなHooksはActionsのデプロイ前に作動するため、フック内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。

<Card title="Tips when planning your migration">

* Use flags to avoid duplicating expensive or one-time operations.
* Make sure to run changes at a time when impact and traffic will be lowest.
* Consider using the [Auth0 Deploy CLI](/docs/deploy-monitor/deploy-cli-tool) to script, test, and quickly implement the migration all at once or iteratively.

</Card>

## 制限事項を理解する

ActionsはHooksでできることの大部分を処理できますが、移行を開始する前にいくつかの制限事項に注意する必要があります（注：HooksとActionsはどちらも移行中に実行できます）。

* Actions cannot persist data, like <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+tokens">access tokens</Tooltip> or API responses, across executions.
* Actions are not provided with [an access token for the Management API](/docs/customize/rules/use-management-api) or [access to the global `auth0` object](/docs/customize/actions/action-coding-guidelines#global-object) as in Hooks.

For the full list of limitations, see [Actions Limitations](/docs/customize/actions/limitations).

## コードを変換する

フックをアクションに変換するには、フック固有のコードをActionsコードに置き換える必要があります。このセクションでは、機能するフックを同等のアクションに変換するためのタスクについて説明します。

<Card title="Tips when converting code">

* In general, look for the read-only properties of objects passed into the Hooks function on the Actions `event` object.
* Use the Actions Code Editor in the Auth0 Dashboard to write your code; it will help by highlighting errors and supplying auto-complete suggestions.
* Before you go live, thoroughly [test your new Actions](/docs/customize/actions/test-actions) in a [staging or test environment](/docs/get-started/auth0-overview/create-tenants/set-up-multiple-environments).

</Card>

### フックコードを新しいアクションにコピーする

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

We recommend copying your Hook code into a new Action and using the Actions Code Editor in the Auth0 Dashboard; it will help you identify outstanding issues with your code.

</Callout>

1. Log in to your production tenant, and copy the code from the Hook you want to convert.
2. Switch to a non-production tenant, and navigate to [Auth0 Dashboard > Actions > Library](https://manage.auth0.com/#/select-tenant?path=/actions/library).
3. Select **Build Custom**, then:

   * 変換するフックの名前と一致するアクションの**Name（名前）**を入力します。
   * Locate **Trigger**, and select the appropriate trigger**:**

		<table class="table"><thead>
		<tr>
		<th>Type of Hook</th>
		<th>Actions Trigger</th>
		</tr>
		</thead>
		<tbody>
		<tr>
		<td>Client Credentials Exchange</td>
		<td>M2M/Client-Credentials</td>
		</tr>
		<tr>
		<td>Pre-User-Registration</td>
		<td>Pre User Registration</td>
		</tr>
		<tr>
		<td>Post-User-Registration</td>
		<td>Post User Registration</td>
		</tr>
		<tr>
		<td>Post-Change-Password</td>
		<td>Post Change Password</td>
		</tr>
		<tr>
		<td>Send Phone Message</td>
		<td>Send Phone Message</td>
		</tr>
		</tbody>
		</table>
		
   * **［Runtime（ランタイム）］**で、**［Node 16］**を選択します。
   * **［Create（作成）］**を選択します。
4. In the code block of the Actions Code Editor, paste the Hook code you want to convert below the exported function.
5. Make the changes detailed in the rest of this article as you move the code into the function.
   関数宣言を変更する

### Hooksの関数はデフォルトのエクスポートを使ってエクスポートされますが、Actionsの関数は名前を付けてエクスポートされます。名前付きエクスポートは、変換するフックの種類によって変化します。マッピングには以下が含まれます。

依存関係を変換する

<table class="table"><thead>
<tr>
<th>Type of Hook</th>
<th>Named Export</th>
</tr>
</thead>
<tbody>
<tr>
<td>Client Credentials Exchange</td>
<td><code>onExecuteCredentialsExchange</code></td>
</tr>
<tr>
<td>Pre-User Registration</td>
<td><code>onExecutePreUserRegistration</code></td>
</tr>
<tr>
<td>Post-User Registration</td>
<td><code>onExecutePostUserRegistration</code></td>
</tr>
<tr>
<td>Post-Change Password</td>
<td><code>onExecutePostChangePassword</code></td>
</tr>
<tr>
<td>Send Phone Message</td>
<td><code>onExecuteSendPhoneMessage</code></td>
</tr>
</tbody>
</table>

Actionsの[クライアント資格情報交換のAPIオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object)を使用できます：

```javascript lines
module.exports = async function myHooksFunction(){}
```






**After**

```javascript lines
// 新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。
exports.onExecuteCredentialsExchange = async (event, api) => {}

// Pre-User Registration
exports.onExecutePreUserRegistration = async (event, api) => {}

// Post-User Registration
exports.onExecutePostUserRegistration = async (event) => {}

// Post-Change Password
exports.onExecutePostChangePassword = async (event) => {}

// Send Phone Message
exports.onExecuteSendPhoneMessage = async (event) => {}
```






### シークレットを変換する

HooksとActionsはシークレットを類似した方法で処理します。どちらも、シークレットは、UIまたはManagement APIを使ってフックやアクションごとに追加され、コードに含められます。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

If your `npm` modules are not on the latest version, this is a great time to get up to date!

</Callout>

1. Search for `require` statements inside your Hook code.
2. Remove version numbers, but make a note of them.
3. Add the dependency by following the steps in the "Add a Dependency" section of [Write Your First Action](/docs/customize/actions/write-your-first-action) (if the dependency is not a [core NodeJS module](https://github.com/nodejs/node/tree/master/lib); if the dependency is a core NodeJS module, you do not need to include it).
4. Move the found `require` statements outside of the `function` declaration.

### シークレットをHooksからActionsに変換するには、以下の手順で行います。

フックの場合と同様に、Auth0は保管時のすべてのシークレット値を暗号化します。

データへのアクセス方法を変更する

1. Save the values needed for the specific Action you are working on.
2. Add a Secret for each value you need to access from inside the Action. To learn how, read the **Add a Secret** section in [Write Your First Action](/docs/customize/actions/write-your-first-action).
3. Convert your code:

Actionsの[クライアント資格情報交換のAPIオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object)を使用できます：

```javascript lines
async function (user, context, cb) {
    const { SECRET_NAME } = context.webtask.secrets;

    // ... additional code
}
```






**After**

```javascript lines
async (event, api) => {
    const { SECRET_NAME } = event.secrets;

	// ... additional code
};
```






[クライアント資格情報の交換 - Actionsイベントオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)

### [パスワード変更後- Actionsイベントオブジェクト](/actions/explore-triggers/post-change-password-trigger/post-change-password-event-object)

[ユーザー登録後 - Actionsイベントオブジェクト](/signup-and-login-triggers/post-user-registration-trigger/post-user-registration-event-object)

[ユーザー登録前 - Actionsイベントオブジェクト](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)

* [Client Credentials Exchange - Actions Event Object](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)
* [Post-Change Password - Actions Event Object](/docs/customize/actions/explore-triggers/password-reset-triggers/post-change-password-trigger/post-change-password-event-object)
* [Post-User Registration - Actions Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/post-user-registration-trigger/post-user-registration-event-object)
* [Pre-User Registration - Actions Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)
* [Send Phone Message - Actions Event Object](/docs/customize/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object)

Actionsの[クライアント資格情報交換のAPIオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object)を使用できます：

```javascript lines
async function (user, context, cb) {
	const clientId = context.clientID;
	const tenant = context.connection.tenant

	// ... additional code
}
```






**After**

```javascript lines
async (event, api) => {
	const clientId = event.client.client_id;
	const tenant = event.tenant.id;

	// ... additional code
};
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Unlike the Hooks `context` object, data stored on or modified in properties of the `event` object does not persist in subsequent Actions. If your Hook is setting data on these properties to trigger core functionality, you will need to use the `api` interface available in the [Machine to Machine](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object) and [Pre User Registration](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object) Actions Flows to persist data across Actions.

</Callout>

### Pre User Registration（ユーザー登録前）

Pre User Registration Hook（ユーザー登録前のフック）でアクセストークンにクレームを追加する場合には以下を使用していました。

移行を完了する

#### 新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。

If you were adding extra claims to the access token in a 新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。 Hook:

```javascript lines
// 新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。 Hook
module.exports = function(client, scope, audience, context, cb) {
  var access_token = {};
  access_token.scope = scope;

  access_token['https://example.com/claim'] = 'bar';
  cb(null, access_token);
};
```






You can now use the Actions [Client Credentials Exchange API Object](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object):

```javascript lines
// 新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。 Action
exports.onExecuteCredentialsExchange = async (event, api) => {
  api.accessToken.setCustomClaim("https://example.com/claim", 'bar');  
};
```






#### Pre User Registration

If you were adding extra claims to the access token in a Pre User Registration Hook:

```javascript lines
// Pre User Registration Hook
module.exports = function (user, context, cb) {
	if (user.app_metadata.condition === "success") {
      var response = {};
      response.user = { user_metadata: { favorite_color: "purple" } };
      // This Hook succeeded, proceed with the next Hook.
	  return callback(null, response);
	}

	if (user.app_metadata.condition === "failure") {
		// This Hook failed, stop the login with an error response.
		return callback(new Error("Failure message"));
	}

	// ... additional code
};
```






You can now use the [Pre User Registration API Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object):

```javascript lines
// Pre User Registration Action
exports.onExecutePreUserRegistration = async (event, api) => {
	if (event.user.app_metadata.condition === "success") {
		// This Action succeeded, proceed with next Action.
		api.user.setUserMetadata("favorite_color", "purple");
		return;
	}

	if (event.user.app_metadata.condition === "failure") {
		// This Action failed, stop the call with an error response.
		return api.access.deny("Failure message");
	}

	// ... additional code
};
```






## Complete the migration

Once your new Actions code has been written and tested, you must activate the Action and deactivate the Hook. These two tasks can be done quickly in succession, but depending on the order, there might be a short period of time where either both or neither are running. Because active Hooks run before deployed Actions, you can keep some logic in Rules as you build and test other logic in Actions.