---
og:description: Learn how to migrate your existing Auth0 Hooks code to Auth0 Actions
  code.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: HooksからActionsへの移行
og:url: https://auth0.com/docs/
permalink: migrate-from-hooks-to-actions
title: HooksからActionsへの移行
twitter:description: Learn how to migrate your existing Auth0 Hooks code to Auth0
  Actions code.
twitter:title: HooksからActionsへの移行
---

既存のHooksをActionsに変換する際には、その種類のフックに対応するトリガーを新しいアクションと関連付ける必要があります。提供するマッピングの識別に沿って以下の手順に従えば、ほぼ同一の機能性に保てるはずです。

## 移行を計画する

デプロイされたActionsはアクティブなHooksの後に実行されるため、Dashboardでフックを一度に1つずつ変換することも、Management APIを使用して一度にすべて変換することもできます。

コードを変換してから、アクションをアクティブにし、フックを非アクティブにする必要があります。アクションの有効化とフックの無効化は、連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。

このため、パイプラインを段階的に移行することをお勧めします。フックコードの一部をアクションコードに変換し、ステージング環境でテストしてから、一度に1つずつライブに移行します。アクティブなHooksはActionsのデプロイ前に作動するため、フック内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。



## 制限事項を理解する

ActionsはHooksでできることの大部分を処理できますが、移行を開始する前にいくつかの制限事項に注意する必要があります（注：HooksとActionsはどちらも移行中に実行できます）。

* Actionsは、アクセストークンやAPI応答などのデータを複数の実行にわたって保持することはできません。
* Actionsには、Hooksのように[Management APIのアクセストークン](https://auth0.com/docs/customize/rules/use-management-api)や[グローバル`auth0`オブジェクト](https://auth0.com/docs/best-practices/rules-best-practices/rules-environment-best-practices#global-object)へのアクセスが提供されていません。

すべての制限事項については、「[Actionsの制限事項](/actions/limitations)」を参照してください。

## コードを変換する

フックをアクションに変換するには、フック固有のコードをActionsコードに置き換える必要があります。このセクションでは、機能するフックを同等のアクションに変換するためのタスクについて説明します。



### フックコードを新しいアクションにコピーする



1. 運用テナントにログインし、変換元となるフックのコードをコピーします。
2. 非運用テナントに切り替えて、[［Auth0 Dashboard］ > ［Actions（アクション）］ > ［Library（ライブラリ）］](%24%7Bmanage_url%7D/select-tenant?path=/actions/library)に移動します。
3. **［Build Custom（カスタムの構築）］**を選択した後、

* 変換するフックの名前と一致するアクションの**Name（名前）**を入力します。
* **［Trigger（トリガー）］**で、適切なトリガーを選択します**。
**
* **［Runtime（ランタイム）］**で、**［Node 16］**を選択します。
* **［Create（作成）］**を選択します。
4. Actionsコードエディターのコードブロックで、変換したいフックコードをエクスポートされた関数の下に貼り付けます。
5. コードを関数に移動するときに、この記事で後述している変更を加えます。Actionsの新しいトリガーに関連付けられた`event`オブジェクトについてもお読みください。このガイドの後半で「[データへのアクセス方法を変更する](#change-how-data-is-accessed)」セクションに移動すると、関連するドキュメントへのリンクが表示されます。

### 関数宣言を変更する

Hooksの関数はデフォルトのエクスポートを使ってエクスポートされますが、Actionsの関数は名前を付けてエクスポートされます。名前付きエクスポートは、変換するフックの種類によって変化します。マッピングには以下が含まれます。



**変更前**



**変更後**



### 依存関係を変換する

HooksとActionsは依存関係を類似した方法で処理します。どちらも、依存関係は、UIまたはManagement APIを使って個別に追加され、コードに含められます。どちらの場合も、`npm`レジストリで利用可能なパッケージを要求することができます。

****

1. フックコード内の`require`ステートメントを検索してください。
2. バージョン番号を削除しますが、これらの番号はメモしておいてください。
3. 依存関係が[コアNodeJSモジュール](https://github.com/nodejs/node/tree/master/lib)でない場合は、「[初めてアクションを作成する](/actions/write-your-first-action)」の「依存関係を追加する」セクションの手順に従って依存関係を追加してください。依存関係がコアNodeJSモジュールである場合は、追加する必要はありません。
4. 見つけた`require`ステートメントを`function`宣言の外に移動してください。

### シークレットを変換する

HooksとActionsはシークレットを類似した方法で処理します。どちらも、シークレットは、UIまたはManagement APIを使ってフックやアクションごとに追加され、コードに含められます。

シークレットをHooksからActionsに変換するには、以下の手順で行います。

1. 操作中の特定のアクションに必要な値を保存します。
2. アクション内からアクセスする必要がある値ごとにシークレットを追加します。方法については、「[初めてアクションを作成する](/actions/write-your-first-action)」の「**シークレットを追加する**」セクションをお読みください。
3. コードを変換します。

**変更前**

****

**変更後**



フックの場合と同様に、Auth0は保管時のすべてのシークレット値を暗号化します。

### データへのアクセス方法を変更する

フックでは、ユーザーやクライアン、要求についてのデータ、およびその他のコンテキストデータがフック関数に渡される複数の因数に保管されます。Actionsでは、このデータは再形成され、`event`オブジェクトに移動します。プロパティの多くはそのまま移行されましたが、わかりやすくするために一部が結合されました。

`event`オブジェクトは、変換するフックの種類によって変化します：

* [クライアント資格情報の交換 - Actionsイベントオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)
* [パスワード変更後- Actionsイベントオブジェクト](/actions/explore-triggers/post-change-password-trigger/post-change-password-event-object)
* [ユーザー登録後 - Actionsイベントオブジェクト](/signup-and-login-triggers/post-user-registration-trigger/post-user-registration-event-object)
* [ユーザー登録前 - Actionsイベントオブジェクト](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)
* [電話メッセージの送信 - Actionsイベントオブジェクト](/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object)

**変更前**

****

**変更後**

****

****

### コールバックを変換する

フックの処理が終了したら、`callback()`関数を呼び出して、実行を完了する必要があります。それとは逆に、Actionsはコールバックのメカニズムを使用しないため、Actionsの関数から`callback()`のすべてのインスタンスを削除する必要があります。

`callback()`関数を使ってクライアント資格情報交換やユーザー登録前のフックで要求を失敗させたりユーザーを更新したりしていた場合でも、Actionsでは新しい`api`インターフェースを通じてこれを行うことができます。

#### Client Credentials Exchange（クライアント資格情報の交換）

Client Credentials Exchange Hook（クライアント資格情報の交換フック）でアクセストークンにクレームを追加する場合には以下を使用していました。



Actionsの[クライアント資格情報交換のAPIオブジェクト](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object)を使用できます：



#### Pre User Registration（ユーザー登録前）

Pre User Registration Hook（ユーザー登録前のフック）でアクセストークンにクレームを追加する場合には以下を使用していました。



[Pre User Registration（ユーザー登録前）のAPIオブジェクト](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object)を使用できます：



## 移行を完了する

新しいActionsコードを作成してテストしたら、アクションを有効にし、フックを無効にする必要があります。これらの2つのタスクは連続してすばやく実行できますが、順序によっては、両方が実行されない、またはどちらも実行されない時間が短期間発生する場合があります。アクティブなHooksはActionsのデプロイ前に作動するので、ルール内のいくつかのロジックを構築した状態で維持しつつ、その他のロジックをActionsでテストできます。