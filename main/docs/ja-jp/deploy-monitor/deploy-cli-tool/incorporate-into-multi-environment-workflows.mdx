---
og:description: Learn how to support multi-tenant, multi-environment workflows when
  using the Auth0 Deploy CLI.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 複数環境のワークフローに組み込む
og:url: https://auth0.com/docs/
permalink: incorporate-into-multi-environment-workflows
title: 複数環境のワークフローに組み込む
twitter:description: Learn how to support multi-tenant, multi-environment workflows
  when using the Auth0 Deploy CLI.
twitter:title: 複数環境のワークフローに組み込む
---

Deploy CLIはテナントと環境が複数あるコンテキスト内での動作に対応しています。CI/CDの開発ワークフローに統合すると、Auth0での変更内容を機能の開発から運用までの全般に反映させることができます。

一般的には以下のワークフローをお勧めします。

1. Create a separate Auth0 tenant for each environment (development, staging, production).
2. Create a single repository of resource configuration files for all environments.
3. Add a step in your CI/CD pipeline when deploying to environments that applies the Auth0 resource configurations to the appropriate Auth0 tenant.

## 環境のテナント

それぞれの環境には、Auth0のテナントやアカウントを個別にすることをお勧めします。例：

<table class="table"><thead>
<tr>
<th><strong>Environment</strong></th>
<th><strong>Tenant</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Development</td>
<td><code>travel0-dev</code></td>
</tr>
<tr>
<td>Testing</td>
<td><code>travel0-uat</code></td>
</tr>
<tr>
<td>Staging</td>
<td><code>travel0-stage</code></td>
</tr>
<tr>
<td>Production</td>
<td><code>travel0-prod</code></td>
</tr>
</tbody>
</table>

## リソース構成リポジトリ

When exported, your Auth0 tenant state will be represented as a set of resource configuration files, either in a [YAML or directory format](/docs/deploy-monitor/deploy-cli-tool/available-resource-configuration-formats). In a multi-environment context it is expected to have a single repository of resource configurations that is applied to all environments. In practice, this may exist as a directory in your project’s codebase or in a separate codebase altogether.

デプロイすることなく変更が行えるように、それぞれのテナントにはリポジトリ内に少なくとも1つのブランチが必要です。そうすれば、作業ブランチがプライマリーブランチ（`main`や`master`など）と結合するときにのみ、変更がデプロイされます。このセットアップでは、それぞれの環境に継続した統合タスクを使用して、プライマリーブランチが更新を受け取ると、対象環境へ自動的に変更をデプロイできます。

ワークフローはおそらく以下のようになります。

1. Make changes to development.
2. Merge changes to testing (or uat).
3. Test changes to uat. When ready, move and merge the changes to staging.
4. Test staging. When ready, move and merge the changes to production.

予防措置として、手動でトリガーした場合にのみデプロイするように、運用環境を設定しておくことをお勧めします。

## 単一方向フロー

The multi-environment workflow works best when changes are propagated “up” in a single direction. Changes to the resource configuration files should first be applied to the lowest level environment (such as development) and then incrementally applied up through all other environments until applied to production. This unidirectional practice ensures sufficient testing and approval for changes to your tenant. Once set, it is recommended to not apply configurations directly to production through other means such as the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> or <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip> unless those changes are captured by a subsequent Deploy CLI export. Otherwise, those changes are subject to overwrite.

## 環境に特有の値

While it is expected that all environments will share the same set of resource configuration files, environment-specific values can be expressed through separate tool configuration files and dynamic [Keyword Replacement](/docs/deploy-monitor/deploy-cli-tool/keyword-replacement).

## 個別の構成ファイル

それぞれの環境に個別のツール構成ファイルを指定すると、リソース構成ファイルを環境に依存することなく使用しながら、それぞれの環境に必要な対応を提供できます。それぞれの環境には少なくとも個別の資格情報が必要になりますが、それぞれの環境について、特定のリソースを除外したり、削除の有効化や動的なキーワード置換を行ったりできます。

### ファイル構造の例

```text lines
project-root
│
└───auth0
│   │   config-dev.json   # Dev env config file
│   │   config-test.json  # Test env config file
│   │   config-prod.json  # Prod env config file
│   │   ... all other resource configuration files
│
└───src
    │   ... your project code
```






## キーワード置換の動的値

Once separate configuration files are adopted for each environment, keyword replacement through the `AUTH0_KEYWORD_REPLACE_MAPPINGS` configuration property can be used to express the dynamic replacement values depending on the environment. For example, you may find it necessary to have a separate set of allowed origins for your clients. To learn more, read [Keyword Replacement](/docs/deploy-monitor/deploy-cli-tool/keyword-replacement).

### config-dev.jsonの例

```json lines
{
  "AUTH0_DOMAIN": "travel0-dev.us.auth0.com",
  "AUTH0_CLIENT_ID": "PdwQpGy62sHcsV6ufZNEVrV4GDlDhm74",
  "AUTH0_ALLOW_DELETE": true,
  "AUTH0_KEYWORD_REPLACE_MAPPINGS": {
    "ENV": "dev",
    "ALLOWED_ORIGINS": ["http://localhost:3000", "http://dev.travel0.com"]
  }
}
```






### config-prod.jsonの例

```json lines
{
  "AUTH0_DOMAIN": "travel0.us.auth0.com",
  "AUTH0_CLIENT_ID": "vZCEFsDYzXc1x9IomB8dF185e4cdVah5",
  "AUTH0_ALLOW_DELETE": false,
  "AUTH0_KEYWORD_REPLACE_MAPPINGS": {
    "ENV": "prod",
    "ALLOWED_ORIGINS": ["http://travel0.com"]
  }
}
```