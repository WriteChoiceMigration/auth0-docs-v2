---
og:description: Learn about best practices for performance.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: パフォーマンスのベストプラクティス
og:url: https://auth0.com/docs/
permalink: performance-best-practices
title: パフォーマンスのベストプラクティス
twitter:description: Learn about best practices for performance.
twitter:title: パフォーマンスのベストプラクティス
---

Rules execute as part of a pipeline where artifacts for authenticity are generated, as described in [Custom Database Anatomy Best Practices](/docs/authenticate/database-connections/custom-db/custom-database-connections-scripts/anatomy). As such, an enabled rule will execute for every login operation (interactive or otherwise), every silent authentication, and every time a user-credentials-related <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip> is generated for an API call. This means that even in small scale deployments, performance can be a concern, which will only be exacerbated as the scale of deployment increases.

## 不要な実行を避ける

条件付きロジックに基づいて実行することを選択します。たとえば、特定のアプリケーションのみに対してルールを実行するには、特定のclientIDについて調べるか、複数アプリケーションに共通する、特定の`clientMetadata`（特に、1つの`clientMetadata`という値に対して確認を行う場合）が存在するかどうか確認します。`clientMetadata`を使うと、新しいクライアントの追加（およびルールコードの読み取り）もさらに簡単になります。特に、大量のアプリケーションが定義されている場合は、環境間で必要なコード変更または構成値を減らすことで行えます。

Client metadata for an application can be set manually via the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> by going to [Application Settings > Advanced Settings > Application Metadata](https://manage.auth0.com/#/applications/) or programmatically via the use of the Auth0 <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>'s [Update a client endpoint](https://auth0.com/docs/api/management/v2#!/Clients/patch_clients_by_id).

## 早期に終了する

For optimal performance, write rules that complete as soon as possible. For example, if a rule has three checks to decide if it should run, use the first check to eliminate the majority of cases, followed by the check to eliminate the next largest set of cases, and so on and so forth. At the end of each check, remember to execute the callback function, ideally combined with a (JavaScript) `return` in order to exit the (rule) function. To learn more, read [Rules Execution Best Practices.](/docs/rules-best-practices/rules-execution-best-practices)

## API要求を最小化する

APIへの呼び出し、特に、サードパーティAPIへの呼び出しを実行すると、ログイン応答時間が低下する恐れがあります。呼び出しが遅れたことで、ルールタイムアウトエラーが発生し、最終的に認証エラーが発生する可能性があります。弊社では、API要求をルール内で可能な限り最小限に抑え、有料サービスへの過剰な呼び出しを避けるようお勧めします。さらに、APIサードパーティなどへの送信を制限することで、潜在的なセキュリティリスクへの曝露も回避するようお勧めします。

有料サービスへの呼び出しを制限する

### SMSメッセージをTwilioで送信するなどの有料サービスを呼び出すルールがある場合は、これらのサービスを必要な場合にのみ使用するようにします。こうすることで、パフォーマンスが向上するだけでなく、追加料金を避けることにもなります。有料サービスへの呼び出しを減らすには、以下のようにします。

パブリックサインアップを禁止し、サインアップして有料サービスへの呼び出しをトリガーできるユーザー数を減らします。

* ルールが許可されたユーザーのサブセットまたは他の適切な条件に対してのみトリガーされることを確認します。たとえば、有料サービスへの呼び出しをトリガーする前に、ユーザーが特定のメールドメイン、ロール/グループ、またはサブスクリプションレベルを持っているかどうかをチェックするロジックを追加したい場合もあるでしょう。
* Management APIへの呼び出しを制限する

### Auth0 Management APIへの呼び出しを避けるようにしてください。Auth0 Management APIにはレート制限がかかっています。これは、`auth0`オブジェクトを使用する場合でも考えられます（このため、控えめに使用してください）。詳細については、「[Management APIエンドポイントレート制限](/support/policies/rate-limit-policy/management-api-endpoint-rate-limits)」をお読みください。

Try to avoid calls to the Auth0 Management API. The Auth0 Management API is rate limited, which will still be a consideration even when using the `auth0` object (so be sure to use it sparingly). To learn more, read [Management API Endpoint Rate Limits](/docs/troubleshoot/customer-support/operational-policies/rate-limit-policy/management-api-endpoint-rate-limits).

In addition, Management API functions take varying degrees of time to perform, so will incur varying degrees of latency; calling the Management API's [List or Search users endpoint](https://auth0.com/docs/api/management/v2#!/Users/get_users), for example, should be kept to a minimum and performed only where absolutely necessary—even when executed via the `auth0` object.

### ルールの`context`オブジェクトに使用できる接続関連のプロパティを拡張したため、`context`オブジェクトから接続情報を取得でき、Auth0 Management APIを呼び出す必要がなくなりました。詳細については、「[ルールのコンテキストオブジェクトプロパティ](/rules/context-object)」をお読みください。

We have expanded connection-related properties available to the rules `context` object, so you can obtain connection info from the `context` object instead of needing to call the Auth0 Management API. To learn more, read [Context Object Properties in Rules](/docs/customize/rules/context-object).

To see this in action, if you are using the **Check if user email domain matches configured domain** rule template, [check out the latest version on Github](https://github.com/auth0/rules/blob/master/src/rules/check-domains-against-connection-aliases.js) or navigate to [Auth0 Dashboard > Auth Pipeline > Rules](https://manage.auth0.com/#/rules/new), and select **Create**. Note: the recent changes will not alter functionality but will improve the performance of rules that had once relied on calls to the Management API.

API呼び出し時に明示的なタイムアウトを使用する

## APIを呼び出したり、外部サービスにアクセスしたりする場合、明示的なタイムアウトを指定することを検討してください。選択する特定のタイムアウトは通常、ユースケースに応じて異なりますが、一般的には、外部サービスのパフォーマンス特性を念頭に置きながら、できるだけ低いものを選択することが推奨されます。

明示的または暗示的なタイムアウト処理のどちらを選ぶにしても、タイムアウトが期限切れになったために発生する可能性のあるエラーや例外の状態に必ず応じるようにします。詳細については、「[エラー処理に関するベストプラクティス](/not-found/70zpztJMDHy4q0bwO4Xzgn/error-handling-best-practices)」をお読みください。

Whether you choose to use explicit timeouts or implicit timeout processing, always be sure to cater to error and/or exception conditions that may occur as a result of any timeout period expiration. To learn more, read [Error Handling Best Practices](/docs/troubleshoot/error-handling-best-practices).

## レート制限を超えた場合は、Auth0への呼び出し回数を減らす必要があります。具体的な方法はユースケースによって異なりますが、いくつか推奨事項を挙げておきます。

`/.well-known/*`応答をキャッシュする：この情報の変更は頻度が少ないため、通常はキャッシュして、Auth0に呼び出す回数を減らすことができます。

* ユーザーに関する情報の取得には、 `/userinfo`の呼び出しではなく、 `id_token`の要求を検討します。
* 一括削除や一括ロック解除など、一括での呼び出しを減らします。
* Reduce bulk calls, such as bulk delete or bulk unlock.

## Learn more

* [Rules Best Practices](/docs/rules-best-practices)
* [Error Handling Best Practices](/docs/troubleshoot/error-handling-best-practices)
* [Debugging Best Practices](/docs/troubleshoot/debugging-best-practices)