---
og:description: Learn how to migrate from Auth0 Search v2 to v3.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 検索v2からv3への移行
og:url: https://auth0.com/docs/
permalink: migrate-v2-v3
title: 検索v2からv3への移行
twitter:description: Learn how to migrate from Auth0 Search v2 to v3.
twitter:title: 検索v2からv3への移行
---

User search v2 has reached its end of life as of **June 30, 2019**. We highly recommend migrating user search functionality to [search engine v3](/docs/manage-users/user-search) (`search_engine=v3`) as soon as possible.

## 移行に関する検討事項

移行を開始する前に、知っておくべきことがいくつかあります。

* v2が使用できなくなる前にクエリで検索エンジンv3が使用されるようにするには、すべての`GET /api/v2/users`エンドポイントの呼び出しを更新して、`search_engine=v3`パラメーターを含める必要があります。これにより、更新する必要があるクエリがあるかどうかを確認できるため、v2が使用できなくなったときにダウンタイムが発生することはありません。
* [影響を受けるSDK](#impacted-sdks)を通じてユーザー検索操作を行っている場合も、上記のように`search_engine=v3`パラメーターを渡す必要があります。
* 正規化されたユーザーフィールド（`email`、`name`、`given_name`、`family_name`、および`nickname`）の検索値は、大文字と小文字を区別しません。その他すべてのフィールド（すべての`app_metadata/user_metadatafi-rudo`/`user_metadata`フィールドを含む）は、大文字と小文字を区別します。
* v3 limits the number of users you can retrieve to 1000. If you are reaching this limit, we recommend that you redefine your search query to obtain more granular results. If you need a list of more than 1000 users at a given time, we recommend that you use the [Export Job](https://auth0.com/docs/api/management/v2#!/Jobs/post_users_exports) API endpoint or [User Import / Export Extension](/docs/manage-users/user-migration/user-import-export-extension) instead.
* 範囲検索とワイルドカード検索は、`app_metadata`/`user_metadata`フィールドで使用できません。
* ユーザーフィールドは、v2のようにトークン化されていないため、`user_id:auth0`は値が`auth0|12345`である`user_id`と一致しません。代わりに、`user_id:auth0*`を使用してください。
* プレフィックスの照合にはワイルドカードを使用できます。たとえば、`name:j*`です。ワイルドカードのその他の使用（サフィックスの照合など）の場合、リテラルは3文字以上である必要があります。例えば、`name:*usa`は使用できますが、`name:*sa`は使用できません。
* `.raw`フィールド拡張機能は、サポートされなくなったため、削除する必要があります。v3では、フィールドは提供された値全体と照合され、v2のようにトークン化されることはありません（`.raw`サフィックスなし）。
* `connection`フィールドはv3でサポートされていません。代わりに、その`identities.connection`エイリアスを使用してください。

## 移行するクエリ

<table class="table"><thead>
<tr>
<th>Use case</th>
<th>v2</th>
<th>v3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Search by date</td>
<td><code>updated_at:&gt;=2018-01-15</code></td>
<td><code>updated_at:[2018-01-15 TO *]</code></td>
</tr>
<tr>
<td>Search by date</td>
<td><code>updated_at:&gt;2018-01-15</code></td>
<td>
<code>
updated_at:\{2018-01-15 TO *]
</code>
</td>
</tr>
<tr>
<td>Search by date</td>
<td><code>updated_at:&lt;=2018-01-15</code></td>
<td><code>updated_at:[* TO 2018-01-15]</code></td>
</tr>
<tr>
<td>Search by date</td>
<td><code>updated_at:&lt;2018-01-15</code></td>
<td><code>updated_at:[* TO 2018-01-15}</code></td>
</tr>
<tr>
<td>Search by date</td>
<td><code>last_login:&lt;=2017-12</code></td>
<td><code>last_login:[* TO 2017-12]</code></td>
</tr>
<tr>
<td>String exact match</td>
<td><code>name.raw:"john richard doe"</code></td>
<td><code>name:"john richard doe"</code></td>
</tr>
<tr>
<td>Phrase contains a word</td>
<td><code>name:"richard"</code>, <code>name:richard</code></td>
<td><code>name:*richard*</code></td>
</tr>
<tr>
<td>Phrase contains a word (with less than 3 characters)</td>
<td><code>name:*ri</code>,<code>name:*a</code>, <code>name:*ab*</code></td>
<td><em>(not supported)</em></td>
</tr>
</tbody>
</table>

## 影響を受けるSDK

次のSDKはユーザー検索エンジンを利用します。これらのSDKを使用している場合は、以下に一覧されているバージョン（またはそれ以降）を使用していること、およびユーザー検索操作を実行するときに`search_engine=v3`パラメーターを渡します。

<table class="table"><thead>
<tr>
<th>SDK</th>
<th>Version with support for v3</th>
<th>Impacted methods</th>
<th>Considerations</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/auth0/auth0-java">Auth0 Java</a></td>
<td>1.8.0</td>
<td>com.auth0.client.mgmt.UsersEntity.list</td>
<td>Provide a <code>UserFilter</code> with <code>withSearchEngine("v3")</code></td>
</tr>
<tr>
<td><a href="https://github.com/auth0/auth0-python">Auth0 Python</a></td>
<td>3.0.0</td>
<td>management.Users.list</td>
<td>Provide the parameter <code>search_engine='v3'</code></td>
</tr>
<tr>
<td><a href="https://github.com/auth0/node-auth0">Auth0 Node</a></td>
<td>2.0.0</td>
<td>UsersManager.getAll, ManagementClient.getUsers</td>
<td>Provide the parameter <code>search_engine:'v3'</code></td>
</tr>
<tr>
<td><a href="https://github.com/auth0/auth0.net">Auth0 .NET</a></td>
<td>3.0.0 or 4.0.0</td>
<td>Auth0.ManagementApi.IUsersClient.GetAllAsync</td>
<td>Provide a <code>GetUsersRequest</code> object with <code>SearchEngine</code> = <code>"v3"</code></td>
</tr>
<tr>
<td><a href="https://github.com/auth0/auth0-php">Auth0 PHP</a></td>
<td>5.2.0</td>
<td>Auth0.SDK.API.Management.Users.getAll</td>
<td>Provide the parameter <code>'search_engine' =&gt; 'v3'</code></td>
</tr>
<tr>
<td><a href="https://github.com/auth0/ruby-auth0">Auth0 Ruby</a></td>
<td>4.5.0</td>
<td>Auth0.Api.V2.Users.users</td>
<td>Provide the parameter <code>search_engine: 'v3'</code></td>
</tr>
</tbody>
</table>

## 影響を受ける拡張機能

次の拡張機能はユーザー検索エンジンを利用します。これらの拡張機能をインストールしている場合は、以下に一覧されているバージョン（またはそれ以降）を使用していることを確認してください。

<table class="table"><thead>
<tr>
<th>Extension</th>
<th>Version support for v3</th>
<th>Considerations</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/docs/customize/extensions/authorization-extension">Authorization Extension</a></td>
<td>2.5.0+</td>
<td>If you are using an earlier version, you need to manually update the extension from the <a href="https://manage.auth0.com/#/extensions">Extensions</a> page.</td>
</tr>
<tr>
<td><a href="/docs/customize/extensions/delegated-administration-extension">Delegated Administration</a></td>
<td>3.1+</td>
<td>If you are using an earlier version, you need to manually update the extension from the <a href="https://manage.auth0.com/#/extensions">Extensions</a> page. The <code>SEARCH_ENGINE</code> configuration setting no longer exists in 3.1, because only User Search v3 is available.</td>
</tr>
</tbody>
</table>

## テナントログを利用してユーザー検索v2の使用状況を見つける

You can leverage the [logs](/docs/deploy-monitor/logs) in the [Dashboard](https://manage.auth0.com/#/logs) to find calls to the `/api/v2/users` endpoint that use the User Search v2 engine, including calls performed by SDKs. Those logs will help you identify where code changes might be needed in your applications.

v3では異なる結果が生成される可能性があるクエリ

* v3との互換性がない構文を使用したクエリ
* v3のページング要件を満たさないクエリ
* ログエントリーに追加の詳細が指定されていない場合は、おそらくクエリにv3との互換性があります。ただし、変更を運用環境にデプロイする前にクエリをテストすることをお勧めします。

同じ種類のログは60分間に1つしか生成されないことに注意してください。これは、ユーザー検索エンドポイントに対して複数の呼び出しを行ったとしても、1時間あたり各タイプのログが1つしか表示されないことを意味します。

Please note that only one log of the same type will be generated within 60 minutes. This means that even though you may be doing multiple calls to the User Search endpoint, you will only see one log of each type per hour.