---
og:description: Describes the migration steps you need to take because Auth0 is deprecating
  the usage of the /passwordless/start endpoint from confidential applications without
  a client secret in the request.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 機密アプリケーションからパスワードレスエンドポイントへ移行する
og:url: https://auth0.com/docs/
permalink: migrate-to-passwordless
title: 機密アプリケーションからパスワードレスエンドポイントへ移行する
twitter:description: Describes the migration steps you need to take because Auth0
  is deprecating the usage of the /passwordless/start endpoint from confidential applications
  without a client secret in the request.
twitter:title: 機密アプリケーションからパスワードレスエンドポイントへ移行する
---

アプリケーションに代わった呼び出しをAuth0が認証できない場合に、機密アプリケーションから`/passwordless/start`エンドポイントを使用することが廃止されます。

<Tooltip tip="OAuth 2.0: Authorization framework that defines authorization protocols and workflows." cta="View Glossary" href="/docs/glossary?term=OAuth">OAuth</Tooltip> uses the term 'confidential' for applications that can store secrets. In Auth0, those are 'Regular Web Applications', which serve web pages from a backend app. Single Page Applications and Native Applications are considered 'public' applications, and are not affected by this change.

Auth0が`/passwordless/start`に対する呼び出しを認証できるのは、パラメーターに`client_secret`が含まれているか、呼び出しがユニバーサルログインのカスタムログインページか行われて`state`パラメーターが転送される場合です。

## 影響のある機能

If any of your applications currently call the `/passwordless/start` endpoint directly to begin <Tooltip tip="Passwordless: Form of authentication that does not rely on a password as the first factor." cta="View Glossary" href="/docs/glossary?term=passwordless">passwordless</Tooltip> authentication from a Web Application, and you are not sending the `client_secret` as a parameter, this deprecation does affect you.

ユニバーサルログインページを使ってパスワードレス認証を実装し、Auth0ライブラリーの初期化にデフォルトの方法を変更した場合にも、影響を受ける可能性があります。

You can verify whether you are affected by checking the [tenant logs](https://manage.auth0.com/#/logs), filtering by "Deprecation Notice" and check for logs saying "Enforce client authentication for passwordless connections". You can also perform this search directly with the following query: `type:depnote AND description:*passwordless*`. Note that this specific query will only work for public cloud tenants, as private cloud logs cannot be searched on the description field.

## アクション

アプリケーションを正しく認証することなく、`/passwordless/start`エンドポイントを呼び出している場合には、以下を行います。

* 以下の指示に従って、`/passwordless/start`を正しく呼び出すようにコードを調整する
* Check your [tenant logs](https://manage.auth0.com/#/logs) to verify the change was made correctly and no deprecation logs are being generated for "Enforce client authentication for passwordless connections".
* **［Advanced Tenant Settings（高度なテナント設定）］**の**［Migrations（移行）］**セクションで、**［Enforce client authentication for passwordless connections（パスワードレス接続のクライアント認証を強制する）］**を有効にします。

影響を受けるユースケースもいくつかありますが、それぞれでの移行パスは比較的単純です。

### バックエンドからのAPI呼び出し

For any calls from your backend to the `/passwordless/start` endpoint, your call must include the <Tooltip tip="Client Secret: Secret used by a client (application) to authenticate with the Authorization Server; it should be known to only the client and the Authorization Server and must be sufficiently random to not be guessable." cta="View Glossary" href="/docs/glossary?term=client+secret">client secret</Tooltip> as a parameter.

SDKを使用している場合には、パスワードレスフローを開始するメソッドにパラメーターを追加します。これはSDKごとに異なり、すべてのSDKが更新されているわけではありません。更新されていないSDKを使用している場合は、更新されるまで、HTTP呼び出しを直接行っても構いません。

{/* codeblockOld.header.login.logInButton codeblockOld.header.login.configureSnippet */}

```json lines
POST https://{yourDomain}/passwordless/start
    Content-Type: application/json
    {
      "client_id": "{yourClientId}",
      "client_secret": "{yourClientSecret}",
      "connection": "email|sms",
      "email": "{userEmailAddress}", //set for connection=email
      "phone_number": "{userPhoneNumber}", //set for connection=sms
      "send": "link|code",
      "authParams": { 
          "scope": "openid",
          "state": "{yourState}"
        }
      }
```






ユニバーサルログインページのページAuth0.jsまたはLock.js

### Webアプリケーションのパスワードレス認証にユニバーサルログインページが使用されている場合は、Lock.jsまたはAuth0.js使って`/passwordless/start`エンドポイントを呼び出しています。

クライアントシークレットはWebページに保管できないため、呼び出しを認証するには、ユニバーサルログインページで受け取った`state`パラメーターを`/passwordless/start`エンドポイントに転送する必要があります。そのパラメーターは、カスタムログインページの`config.internalOptions`フィールドに保管されます。

ログインページをカスタマイズするためのデフォルトのテンプレートは、Lock.jsまたはauth0.jsを初期化する際に以下のように使用します。

カスタムページの実装で、そのコードが削除されていないことを確認してください。

```javascript lines
var lock = new Auth0Lock(
  config.clientID, 
  config.auth0Domain, 
  {
    auth: {
      // .. other fields set
      params: {
       scope: config.internalOptions.scope,
       _csrf: config.internalOptions._csrf,
       state: config.internalOptions.state,
      }
    }
  });
```






```javascript lines
var params = Object.assign({
    scope: config.internalOptions.scope,
    _csrf: config.internalOptions._csrf,
    state: config.internalOptions.state,
  }, {
    // ...auth params
  });

var webAuth = new auth0.WebAuth(params);
```






Webアプリケーションのクライアントから/passwordless/startを呼び出す

### レート制限

認証された`/passwordless/start`要求は、通常の認証済みのAPI要求として扱われ、認証APIのグローバルレート制限が適用されます。

### Rate Limits

A consequence of adding client authentication to `/passwordless/start` is that Auth0 can trust the headers sent with the request. If you set the `auth0-forwarded-for` header, the IP address will show in the logs and be used for <Tooltip tip="Attack Protection: Features that Auth0 provides to detect and mitigate attacks, including brute-force protection, suspicious IP throttling, breached password detection, bot detection, and adaptive multi-factor authentication." cta="View Glossary" href="/docs/glossary?term=attack+protection">attack protection</Tooltip> purposes.

Authenticated `/passwordless/start` requests will be treated as regular Authenticated API requests and the corresponding global Authentication API rate limit will apply.