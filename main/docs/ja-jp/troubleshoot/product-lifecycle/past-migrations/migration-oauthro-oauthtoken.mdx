---
og:description: Describes how to migrate your password API calls and responses from
  /oauth/ro to /oauth/token.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: リソース所有者のパスワードフローを移行する
og:url: https://auth0.com/docs/
permalink: migration-oauthro-oauthtoken
title: リソース所有者のパスワードフローを移行する
twitter:description: Describes how to migrate your password API calls and responses
  from /oauth/ro to /oauth/token.
twitter:title: リソース所有者のパスワードフローを移行する
---

Support for <Tooltip tip="Resource Owner: Entity (such as a user or application) capable of granting access to a protected resource." cta="View Glossary" href="/docs/glossary?term=resource+owner">resource owner</Tooltip> password was added to `/oauth/token`. Usage of the `/oauth/ro` endpoint was deprecated on 08 July 2017. The `/oauth/ro` endpoint was previously used to exchange a one-time password (OTP) received by the end-user email or SMS for an <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip> and an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+token">access token</Tooltip>. Auth0 has implemented a new API that replaces `/oauth/ro` for this use case and we recommend that you migrate to using the new endpoint.

## 影響のある機能

This change affects you if you use the [Resource Owner Password Flow](/docs/get-started/authentication-and-authorization-flow/resource-owner-password-flow)(sometimes called Resource Owner Password Grant or ROPG) and call `/oauth/ro` directly without the use of any Auth0 libraries or SDKs. Auth0 libraries such as Lock or Auth0.js have been updated to stop using `/oauth/ro` internally. If you use the lock-<Tooltip tip="Passwordless: Form of authentication that does not rely on a password as the first factor." cta="View Glossary" href="/docs/glossary?term=passwordless">passwordless</Tooltip> library, you can now use Passwordless Mode in Lock instead.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

When a user's `/oauth/ro` based access token has expired, Auth0 forces them to reauthenticate (forced logout required) because the `/oauth/ro` refresh token cannot be used to call `/oauth/token` for a new access token. All currently logged in user's must log in again during an `/oauth/ro` to `/oauth/token` migration.

</Callout>

## アクション

### 更求での変更

これまで、`/oauth/ro`への要求には、以下のようなペイロードが含まれていました。

```json lines
{
  "grant_type": "password",
  "client_id": "123",
  "username": "alice",
  "password": "A3ddj3w", 
  "connection": "my-database-connection",
  "scope": "openid email favorite_color offline_access",
  "device": "my-device-name"
}
```






新しい実装には、以下のような変更があります。

* トークン交換を実行するエンドポイントは`/oauth/token`になりました。
* Auth0独自の付与タイプは、特定の接続（またはレルム）からユーザーを認証するために使用されます。
* Auth0では、カスタムAPIで定義されたスコープの他に、標準OIDCスコープがサポートされます。
* 上記の`favorite_color`など、これらのどのカテゴリーにも該当しないスコープは、有効なスコープではなくなりました。
* `device`パラメーターは削除されました。
* `audience`パラメーターは任意です。

以下は、`/oauth/token`への要求のペイロードの例です。

```json lines
{
  "grant_type": "http://auth0.com/oauth/grant-type/password-realm",
  "client_id": "123",
  "username": "alice",
  "password": "A3ddj3w",
  "realm": "my-database-connection",
  "scope": "openid email offline_access",
  "audience": "https://api.example.com"
}
```






* ここでは、付与タイプは標準の`password`でなく、`password-realm`として指定されています。
* `client_id`、`username`と`password`パラメーターに変更はありません。
* パスワードレルムの付与タイプを使用しているため、`realm`が含まれています。これが、前の呼び出しで取得した`connection`パラメーターで置き換えられます。
* `scope`パラメーターはほとんど同じですが、OIDC以外の値は受け入れません。
* The `audience` parameter can be added, indicating the API <Tooltip tip="Audience: Unique identifier of the audience for an issued token. Named aud in a token, its value contains the ID of either an application (Client ID) for an ID Token or an API (API Identifier) for an Access Token." cta="View Glossary" href="/docs/glossary?term=audience">audience</Tooltip> the token will be intended for.

### 応答での変更

返されるアクセストークンは、`/userinfo`エンドポイント（`audience`パラメーターで指定のAPIにRS256を署名アルゴリズムが使われている場合）と任意のカスタムAPI（指定されている場合）の呼び出しに使用できます。

```json lines
{
  "access_token": "SlAV32hkKG",
  "token_type": "Bearer",
  "refresh_token": "8xLOxBtZp8",
  "expires_in": 3600,
  "id_token": "eyJ..."
}
```






* The returned access token is valid for calling the `/userinfo` endpoint (provided that the API specified by the `audience` param uses RS256 as <Tooltip tip="Signing Algorithm: Algorithm used to digitally sign tokens to ensure the token has not been tampered with." cta="View Glossary" href="/docs/glossary?term=signing+algorithm">signing algorithm</Tooltip>) and optionally the custom API if one was specified.
* The ID token will be forcibly signed using RS256 if requested by a <Tooltip tip="Public Client: Client (application) that cannot hold credentials securely. Examples include a native desktop or mobile application and a JavaScript-based client-side web application (such as a single-page app (SPA))." cta="View Glossary" href="/docs/glossary?term=public+client">public client</Tooltip>.
* A <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=Refresh+Token">Refresh Token</Tooltip> will be returned only if the `offline_access` scope was granted and the API has **Allow offline access** set.

移行を確認する

```json lines
{
  "access_token": "eyJ...",
  "token_type": "Bearer",
  "refresh_token": "8xLOxBtZp8",
  "expires_in": 3600,
  "id_token": "eyJ..."
}
```






### このスイッチをオフにしてログインできなくなった場合は、レガシーコードの全インスタンスがアプリケーションからまだ完全に削除されていません。

1. Once you have migrated your codebase and are sure that your apps are not calling the endpoint, go to the [Dashboard > Tenant Settings > Advanced](https://manage.auth0.com/#/tenant/advanced).
2. Scroll down to **Migrations** and toggle off **Legacy** `/oauth/ro` **Endpoint**. Turning off this switch disables the deprecated endpoint for your tenant, preventing it from being used.

移行が運用環境で正常に動作している場合には、このスイッチをオフにしたままにできます。これで、廃止された機能は今後使用されることがなくなります。

Once migrations have been successfully performed in production environments, the switch can be toggled off and left off, to ensure that the deprecated features can no longer be used.