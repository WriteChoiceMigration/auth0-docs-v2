---
og:description: Describes how to migrate your Passwordless API calls and responses
  from /oauth/ro to /oauth/token.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: リソース所有者のパスワードレス資格情報交換を移行する
og:url: https://auth0.com/docs/
permalink: resource-owner-passwordless-credentials-exchange
title: リソース所有者のパスワードレス資格情報交換を移行する
twitter:description: Describes how to migrate your Passwordless API calls and responses
  from /oauth/ro to /oauth/token.
twitter:title: リソース所有者のパスワードレス資格情報交換を移行する
---

Support for <Tooltip tip="Resource Owner: Entity (such as a user or application) capable of granting access to a protected resource." cta="View Glossary" href="/docs/glossary?term=resource+owner">resource owner</Tooltip> password was added to `/oauth/token`. Usage of the `/oauth/ro` endpoint was deprecated on 08 July 2017. The `/oauth/ro` endpoint was previously used to exchange a one-time password (OTP) received by the end-user email or SMS for an <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip> and an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+token">access token</Tooltip>. Auth0 has implemented a new API that replaces `/oauth/ro` for this use case and we recommend that you migrate to using the new endpoint.

## 影響のある機能

This change affects you if you use the resource owner <Tooltip tip="Passwordless: Form of authentication that does not rely on a password as the first factor." cta="View Glossary" href="/docs/glossary?term=passwordless">passwordless</Tooltip> credentials exchange and call `/oauth/ro` directly without the use of any Auth0 libraries or SDKs.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

When a user's `/oauth/ro` based access token has expired, Auth0 forces them to reauthenticate (forced logout required) because the `/oauth/ro` refresh token cannot be used to call `/oauth/token` for a new access token. All currently logged in user's must log in again during an `/oauth/ro` to `/oauth/token` migration.

</Callout>

## アクション

### 要求の変更内容

これまで、`/oauth/ro`への要求には、以下のようなペイロードが含まれていました。

```json lines
{
  "grant_type": "password",
  "client_id": "123",
  "username": "alice",
  "password": "A3ddj3w", 
  "connection": "my-database-connection",
  "scope": "openid email favorite_color offline_access",
  "device": "my-device-name"
}
```



新しい実装では以下が変更されています。

* トークン交換を実行するエンドポイントは`/oauth/token`になりました。
* Auth0独自の付与タイプは、特定の接続（またはレルム）からユーザーを認証するために使用されます。
* Auth0では、カスタムAPIで定義されたスコープの他に、標準OIDCスコープがサポートされます。
* 上記の`favorite_color`など、これらのどのカテゴリーにも該当しないスコープは、有効なスコープではなくなりました。
* `device`パラメーターは削除されています。
* `audience`パラメーターは任意です。

以下は、`/oauth/token`への要求のペイロードの例です。

```json lines
{
  "grant_type" : "http://auth0.com/oauth/grant-type/passwordless/otp",
  "client_id": "{yourClientId}",
  "client_secret": "{yourClientSecret}", // only for web apps, native apps don’t have a client secret
  "username": "{userEmailAddress}", // or "{userPhoneNumber}"
  "otp": "CODE",
  "realm": "email", // or "sms" 
  "audience" : "{yourApiIdentifier}", // in case you need an access token for a specific API
  "scopes": "openid profile email" // whatever scopes you need
}
```






* The grant type is specified here as `http://auth0.com/oauth/grant-type/passwordless/otp`.
* `client_id`と`username`パラメーターに変更はありません。
* The `client_secret` needs to be specified for <Tooltip tip="Confidential Client: A client (application) that can hold credentials securely by using a trusted backend server. Examples include a web application with a secure backend and a machine-to-machine (M2M) application." cta="View Glossary" href="/docs/glossary?term=confidential+clients">confidential clients</Tooltip> (e.g. regular web apps).
* ワンタイムパスワードは`password`パラメーターではなく、`otp`パラメーターに含めて送信する必要があります。
* `realm`は接続を識別するために使用され、以前の呼び出しからの`connection`パラメーターを置き換えます。
* `scope`パラメーターはほとんど同じですが、OIDC以外の値は受け入れません。
* The `audience` parameter can be added, indicating the API <Tooltip tip="Audience: Unique identifier of the audience for an issued token. Named aud in a token, its value contains the ID of either an application (Client ID) for an ID Token or an API (API Identifier) for an Access Token." cta="View Glossary" href="/docs/glossary?term=audience">audience</Tooltip> the token will be intended for.

### 応答での変更

返されるアクセストークンは、`/userinfo`エンドポイント（`audience`パラメーターで指定のAPIにRS256を署名アルゴリズムが使われている場合）と任意のカスタムAPI（指定されている場合）の呼び出しに使用できます。

```json lines
{
  "access_token": "SlAV32hkKG",
  "token_type": "Bearer",
  "refresh_token": "8xLOxBtZp8",
  "expires_in": 3600,
  "id_token": "eyJ..."
}
```






* The returned access token is valid for calling the `/userinfo` endpoint (provided that the API specified by the `audience` param uses RS256 as <Tooltip tip="Signing Algorithm: Algorithm used to digitally sign tokens to ensure the token has not been tampered with." cta="View Glossary" href="/docs/glossary?term=signing+algorithm">signing algorithm</Tooltip>) and optionally the custom API if one was specified.
* The ID token will be forcibly signed using RS256 if requested by a <Tooltip tip="Public Client: Client (application) that cannot hold credentials securely. Examples include a native desktop or mobile application and a JavaScript-based client-side web application (such as a single-page app (SPA))." cta="View Glossary" href="/docs/glossary?term=public+client">public client</Tooltip>.
* A <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=refresh+token">refresh token</Tooltip> will be returned only if the `offline_access` scope was granted and the API has **Allow offline access** set.

SDK使用でのコード変更

```json lines
{
  "access_token": "eyJ...",
  "token_type": "Bearer",
  "refresh_token": "8xLOxBtZp8",
  "expires_in": 3600,
  "id_token": "eyJ..."
}
```






### Auth0が提供するAndroidまたはiOS用のネイティブライブラリーをアプリケーションが使用している場合には、ライブラリーのバージョンを必ず以下の最小バージョン以降にしてください。また、ライブラリーを構成する際には、必ず［`OIDC Conformant`（OIDC準拠）］フラグを`true`に設定してください。

移行を確認する

<table class="table"><thead>
<tr>
<th>Library</th>
<th>Minimum Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Android SDK</td>
<td>1.2</td>
</tr>
<tr>
<td>Lock Android</td>
<td>2.17</td>
</tr>
<tr>
<td>Swift SDK</td>
<td>1.20.0</td>
</tr>
<tr>
<td>Lock iOS</td>
<td>2.14.0</td>
</tr>
</tbody>
</table>

### このスイッチをオフにしてログインできなくなった場合は、レガシーコードの全インスタンスがアプリケーションからまだ完全に削除されていません。

1. To verify whether you are using the deprecated endpoint, check the [tenant logs](https://manage.auth0.com/#/logs), filter by **Deprecation Notice** and then check for logs that say `oauth/ro` **passwordless: This feature is being deprecated**. You can also perform this search directly with the following query: `type:depnote AND description:*passwordless*`.
2. Once you have migrated your codebase and are sure that your apps are not calling the endpoint, go to the [Dashboard](https://manage.auth0.com/#/tenant/advanced) under **Tenant Settings > Advanced**.
3. Scroll down to **Migrations** and toggle off **Legacy** `/oauth/ro` **Endpoint**. Turning off this switch disables the deprecated endpoint for your tenant, preventing it from being used.

移行が運用環境で正常に動作している場合には、このスイッチをオフにしたままにできます。これで、廃止された機能は今後使用されることがなくなります。

Once migrations have been successfully performed in production environments, the switch can be toggled off and left off, to ensure that the deprecated features can no longer be used.

## Learn more

* [Migrate Your Resource Owner Password Flow](/docs/troubleshoot/product-lifecycle/past-migrations/migration-oauthro-oauthtoken)