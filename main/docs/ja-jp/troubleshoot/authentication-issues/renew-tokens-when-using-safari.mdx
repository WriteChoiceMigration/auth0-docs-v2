---
og:description: Issues with token renewal in Safari when ITP is enabled.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Safariの使用でトークン更新の問題を解決する
og:url: https://auth0.com/docs/
permalink: renew-tokens-when-using-safari
title: Safariの使用でトークン更新の問題を解決する
twitter:description: Issues with token renewal in Safari when ITP is enabled.
twitter:title: Safariの使用でトークン更新の問題を解決する
---

In some cases, renewing tokens with silent authentication does not work as expected with the latest version of the Safari browser. Recent versions of the Safari browser introduced a new feature called [Intelligent Tracking Prevention (ITP)](https://webkit.org/blog/category/privacy/). ITP is designed to prevent websites from tracking user activity across multiple websites. By default, ITP is active. You can determine if the Safari version you are using has ITP by going to the **Preferences > Privacy** tab and seeing if the **Prevent cross-site tracking** option is checked.

## ITPとブラウザーの動作

Enabling ITP causes the browser to behave as if you had disabled third-party cookies in the browser, which makes it impossible to obtain a new token without displaying anything to the user. This is akin to the way <Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Connect (OIDC) uses iframes for handling [sessions](/docs/manage-users/sessions) in SPAs.

In the SPA SDK (which is our recommendation) `getTokenSilently` performs [silent authentication](/docs/authenticate/login/configure-silent-authentication) unless you configure the SDK to use rotating <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=refresh+tokens">refresh tokens</Tooltip>.

## 回避策

Recent advancements in user privacy controls in browsers adversely impact the user experience by preventing access to third-party cookies. You can use [Refresh Token Rotation](/docs/secure/tokens/refresh-tokens/refresh-token-rotation) as an alternative that provides a secure method for using refresh tokens in SPAs while providing end-users with seamless access to resources without the disruption in UX caused by browser privacy technology like ITP.

Alternatively, you can work around the issues posed by ITP by using Auth0's [custom domains](/docs/customize/custom-domains) functionality, particularly if the <Tooltip tip="Custom Domain: Third-party domain with a specialized, or vanity, name." cta="View Glossary" href="/docs/glossary?term=custom+domain">custom domain</Tooltip> lives on a subdomain of the application's website domain. For example, if your application is hosted on **example.com**, the custom domain would need to be of the format **subdomain.example.com**.

## ITPのデバッグモード

[Safari Technology Preview](https://developer.apple.com/safari/technology-preview/) offers an "Intelligent Tracking Prevention Debug Mode" that you can use to troubleshoot ITP issues. You can find instructions on how to debug ITP in [this blog post from WebKit](https://webkit.org/blog/8387/itp-debug-mode-in-safari-technology-preview-62/).

**注意**：この説明には、テスト目的で、カスタムドメインに追跡機能があると永続的に分類する方法が記載されています。しかし、新しいバージョンのSafari Technology Previewでは、この設定のためにUser Defaultsを保管するためのドメインが、`com.apple.SafariTechnologyPreview`から`com.apple.WebKit.Networking`に変更されています。手順で説明されているコマンドに問題がある場合には、以下を試してみてください。

* サイトに追跡機能があると分類する：
  `defaults write com.apple.WebKit.Networking ResourceLoadStatisticsManualPrevalentResource example.com`
* 設定を検査する：
  `defaults read com.apple.WebKit.Networking ResourceLoadStatisticsManualPrevalentResource`
* 設定を削除する：
  `defaults delete com.apple.WebKit.Networking ResourceLoadStatisticsManualPrevalentResource`

設定を有効にするには、変更するたびに、Safari Technology Previewを再起動する必要があります。