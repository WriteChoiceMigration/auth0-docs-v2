---
og:description: Describes troubleshooting for SAML configuration issues.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: SAML構成のトラブルシューティング
og:url: https://auth0.com/docs/
permalink: troubleshoot-saml-configurations
title: SAML構成のトラブルシューティング
twitter:description: Describes troubleshooting for SAML configuration issues.
twitter:title: SAML構成のトラブルシューティング
---

トラブルシューティングでは、構成を理解することが大切です。

* **Is Auth0 serving as the <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip> Service Provider (SP), the SAML <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=Identity+Provider">Identity Provider</Tooltip> (IdP), or both?**

  SPは認証のためにユーザーをどこかにリダイレクトします。IdPは、ユーザーにログインを求め、入力された情報を検証して、ユーザーを認証します。アプリケーションがSAMLで認証するためにユーザーをAuth0にリダイレクトするのであれば、Auth0はIdPです。Auth0がリモートIdPへの接続を使ってユーザーをSAMLでリダイレクトするのであれば、Auth0はリモートIdPに対するSPです。Auth0はSP、IdPまたはその両方の役割を果たすことができます。
* **認証フローが使用するのは、SP起点のモデルですか、IdP起点のモデルですか、それともその両方ですか？**

  SP起点の認証フローは、ユーザーがSPのアプリケーションに移動して、ログインのためにIdPにリダイレクトされることから始まります。IdP起点のフローでは、ユーザーがIdPに移動してログインすると、SPのアプリケーションにリダイレクトされます。

  エンタープライズの設定内では、IdP起点のフローが最も汎用されます。
* **ユーザープロファイルにあるどの属性がIdP（ログイン時）や各アプリケーション内でユーザーの識別に使用されますか？**

  命名属性がIdPとアプリケーション間で異なる場合には、正しいユーザープロファイル属性がアプリケーションに送信されるように、Auth0内で適切なマッピングを構成する必要があります。

  + これまでの事例から判断すると、メールアドレスを一意の識別子として使うのが最も簡単な反面、プライバシーに関して問題が懸念されます。
  + 一般的に、エンタープライズ組織ではIdPについて何らかの内部IDが使用されますが、これらは外部のSaaSアプリケーションにとって有意な別の属性にマッピングする必要があります。
* **認証要求は署名されていますか？**
* **認証アサーションは暗号化されていますか？**

トラブルシューティングでは、情報を集めて、以下の質問に答えられるようにすることをお勧めします。

1. How many users experience the issue? Just one user? All users?
2. Is this an issue with a new setup, or is this an existing integration that's stopped working?
3. How many applications does the issue affect?
4. What is the expected behavior? What is the behavior you're seeing?
5. How far through the login sequence does the user get?

## 影響を受けているユーザーを確認する

* ユーザーのプロファイルやブラウザー、問題が起きているデバイスを確認します。
* 影響を受けているユーザーについて、すべてのブラウザーで問題が起きている（データの問題を示唆している）のか、特定のブラウザーだけで問題が起きている（ブラウザー特有の問題を示唆している）のかを確認します。
* ブラウザーでJavaScriptとクッキーが有効化されているかを確認します。
* CapsLockキーが解除されていることを確認します。
* ユーザーがモバイルデバイスを使用している場合には、認証や認可に影響を与えるソフトウェアがあるか（何らかの必須ソフトウェアが実行されていないなど）を確認します。
* Check to see if the user can access some of the app's key URLs, such as the IdP's <Tooltip tip="Single Sign-On (SSO): Service that, after a user logs into one applicaton, automatically logs that user in to other applications." cta="View Glossary" href="/docs/glossary?term=Single+Sign-on">Single Sign-on</Tooltip> (SSO) URL (indicating a network connectivity issue).

## サービスプロバイダーとしてのAuth0をトラブルシューティングする

### 一般的なエラー

以下は、Auth0がサービスプロバイダーの場合に起きがちなエラーとその対処方法です。

#### エラー：接続が無効です

このメッセージは、アプリケーションにアクティブな接続が関係付けられていないことを示しています。

`"error": "invalid_request",
"error_description": "the connection was disabled"`

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select a connection type.
2. Select the name of your Connection.
3. Select the **Applications** view.
4. Enable at least one Application (if you don't see any in the list, you will need to create an application before proceeding).

#### エラー：IdP起点のログインが有効化されていません

This error typically occurs because the ACS URL configured in the IdP used the default Auth0 tenant domain, whereas the authentication transaction was started by calling the <Tooltip tip="Custom Domain: Third-party domain with a specialized, or vanity, name." cta="View Glossary" href="/docs/glossary?term=Custom+Domain">Custom Domain</Tooltip> `/authorize` endpoint.

`"invalid_request": "IdP-Initiated login is not enabled for connection 'CONNECTION_NAME'."`

SP起点のフローでこのエラーが表示される場合、次のいずれかが欠けているか、空である可能性があります。

* `RelayState`パラメーター
* SAML応答に含まれる`InResponseTo`属性

これらが欠けている場合、Auth0はログインをIdP起点として扱います。エラーを解消するには、構成をチェックして、両方のフィールドが適切に入力されていることを確認してください。

これを解決するには以下を行います。

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select a connection type.
2. Select the name of your Connection.
3. Select the **IdP-Initiated SSO** view.
4. Locate **IdP-Initiated SSO Behavior**, and select **Accept Requests** to enable IdP-initiated logins.
5. Select the **Default Application** and the **Response Protocol** used by that application, and (optionally) specify any additional parameters you want to be passed to the application.

#### Error: InResponseTo attribute does not match the ID in AuthNRequest

このエラーは、SAML応答の`InResponseTo`属性がAuth0に認識されない場合に発生します。可能性のある原因には以下が含まれます。

* クッキーがブロックされている
* 最も最近のSAML要求とIDが一致しない
* ドメインの使用が合致しない

テナントがカスタムドメインを使用している場合、ログインフローがカスタムドメインで開始し、正規ドメインで完了すると不一致が発生します。たとえば、ユーザーが次のカスタムドメインで始めたとします：

```http wrap lines
https://auth.{yourDomain}.com/authorize?client_id=abc123&redirect_uri=https://jwt.io&response_type=code&scope=openid&audience=https://example.com&connection=mysamlconnection
```






ところが、IDプロバイダーは次の正規ドメインを使って、ACS URLにSAML応答を返すように構成されています：

```http lines
https://{yourTenant}.auth0.com/login/callback
```






IDがSAML応答の`InResponseTo`属性で別のドメインに返されると、そのレコードを持たないAuth0テナントが上記のエラーを返します。

これを解決するには以下を行います。

ログインフローでは一環して同じドメインを使用します。当初の`/authorize`要求に含めるドメインを変更するか、IDプロバイダーに使用するACS URLを変更します。

#### エラー：IdP起点のデフォルトアプリが構成されていません

このエラーは一般的に、IdP起点のフローが有効化されているのに、フローの実行に必要な情報が指定されていない場合に発生します。

`"invalid_request": "Default App for IdP-Initiated is not configured. Make sure to configure that from connection settings or include client_id in RelayState parameter."`

ACS URLには、当初の認証要求と同じドメインを使う必要があります。カスタムドメインを使用する場合には、必ず、カスタムドメインのコールバックURLを使用します。

SP起点のフローでこのエラーが表示される場合、次のいずれかが欠けているか、空である可能性があります。

* `RelayState`パラメーター
* SAML応答に含まれる`InResponseTo`属性

これらが欠けている場合、Auth0はログインをIdP起点として扱います。エラーを解消するには、構成をチェックして、両方のフィールドが適切に入力されていることを確認してください。

これを解決するには以下を行います。

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select a connection type.
2. Select the name of your Connection.
3. Select the **IdP-Initiated SSO** view.
4. Select the **Default Application** and the **Response Protocol** used by that application, and (optionally) specify any additional parameters you want to be passed to the application.

#### エラー：RelayStateがありません

このエラーは、IDプロバイダーが応答で`RelayState`パラメーターを返さない場合に発生します。

IDプロバイダーに問い合わせて、`RelayState`パラメーターが必ず返されるようにしてください。

#### エラー：オーディエンスが無効です

このエラーは、IDプロバイダーのSAML応答にある`audience`値がAuth0で予期する値と一致しない場合に発生します。この値に、Auth0は接続のエンティティIDを期待します。

接続のエンティティIDを確認するには、以下を行います。

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select a connection type.
2. Select the name of your Connection.
3. Select the **Setup** view, and locate the **Common Settings** section; your **Entity ID** is the second parameter provided.

IDプロバイダーがSAML応答で正しい`audience`値を送信することを確認します。

#### 不正なプロトコルが指定されました

One common error is specifying the incorrect response protocol on the IdP-Initiated tab. The response protocol is the one used between Auth0 and the Application (not the remote identity provider). For example, if you set this value to **SAML** when your Application expects **<Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Connect** or **<Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=WS-Fed">WS-Fed</Tooltip>** results in errors due to the incorrect configuration.

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select a connection type.
2. Select the name of your Connection.
3. Select the **IdP-Initiated SSO** view, locate **Response Protocol**, and check its value.

#### ユーザーがIdPからログアウトしていません

ADFSがSAML IdPとして構成されている場合、ADFSの証明書利用者信頼の`Name ID`属性がマッピングされていないと、ログアウトフローが失敗します。たとえば、フェデレーションパラメーターの`v2/logout?federated&...`では、ユーザーはADFS SAMLログアウトエンドポイントにリダイレクトされずに、アプリケーションのコールバックURLに直接リダイレクトで戻されます。この場合、結果的に、ユーザーはIdPからログアウトされません。

SAMLログインに関する問題

### SAMLログインのトラブルシューティングでは、主に4つの確認するべき段階があります。

段階1：ユーザーがIdPに正常にリダイレクトされ、ログインできている

* 段階2：IdPにログインした後、ユーザーが正常なログインイベントレコードと共にAuth0に戻されている
* 段階3：Auth0での正常なログインイベントの後、正しいユーザープロファイルがAuth0に存在している
* 段階4：ユーザーがアプリケーションへ正常にリダイレクトで戻され、アプリケーションにアクセスできている
* 以下のセクションでは、それぞれの段階を確認する方法と、該当する段階で問題があるかを判断する方法について説明します。

IdPのログインページが表示されない

#### ログにログイン成功のイベントが表示されない

1. Navigate to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select **SAML**.
2. Locate your connection, and select its **Try** (triangle/play) icon to test the interaction between Auth0 and the remote IdP. If the Connection does **not** work, continue with the steps detailed in this section. If it does, proceed to the next section.
3. Next to the SAML connection, click **Settings** (represented by the gear icon).

   <Frame>![Dashboard Authentication Enterprise SAML Connection Settings](/images/cdy7uua7fh8z/6s8p4aMck06YnPStr493sA/3e10e74fd75b504a04b0e3bb3dfb82f2/dashboard-authentication-enterprise-saml-connection-settings.png)</Frame>
4. Check and confirm the following with the IdP administrator:

   1. That the Sign In URL is the correct Single Sign-on (SSO) URL. This is the URL that Auth0 will redirect the user to for authentication.
   2. If the IdP expects HTTP-POST binding or HTTP-Redirect binding. You can switch the default binding in the **Settings** tab.
   3. If your authentication requests should be signed. If so, which signing algorithm does the IdP expect you to use? (Note that authentication requests are not commonly signed.) If you're sending signed requests, enable the Connection Settings **Sign Request** toggle and make sure the **Signing Algorithm** value matches what the IdP expects.
   4. Ask the IdP administrator to check for log entries that might provide information on the problem.

#### この場合、ユーザーはIDプロバイダーに正常にログインしていますが、Auth0ログにはログイン成功のイベントが表示されていません。

ユーザープロファイル属性が正しくない

1. Check the [Logs](https://manage.auth0.com/#/logs) and [Users](https://manage.auth0.com/#/users) pages in the Auth0 Dashboard to see if Auth0 shows a successful login event. If Auth0's logs don't show a successful login event, there is probably an issue with the SAML Authentication Assertion returned by the IdP or Auth0 is unable to consume the assertion.
2. Check the information that Auth0 sends to the application by [capturing an HTTP trace of the login sequence](/docs/troubleshoot/troubleshooting-tools/generate-and-analyze-har-files) and analyzing the HTTP trace.

   <Warning>

   Before sharing a HAR file with anyone (including Auth0), ensure that you remove or obfuscate all sensitive data, such as:

   * Confidential user information
   * Personal identifiable information (PII)
   * Confidential application information

   To learn more, read the following articles on [Auth0 Community](https://community.auth0.com):

   * [Sanitizing HTTP Traces](https://community.auth0.com/t/sanitizing-http-traces/119488)
   * [How to Sanitize an HTTP Trace File Automatically](https://community.auth0.com/t/how-to-sanitize-a-http-trace-file-automatically/120583)
   * [How to Manually Redact Sensitive Information](https://community.auth0.com/t/how-to-manually-redact-sensitive-information/122554)
   * [HAR File is Too Large to Upload to the Support Case](https://community.auth0.com/t/har-file-is-too-large-to-upload-to-the-support-case/122488)
   </Warning>
3. You can view the HTTP trace in a HAR file analyzer, such as [Google's HAR Analyzer](https://toolbox.googleapps.com/apps/har_analyzer/).

   1. Scan through the sequence of URLs invoked in the HTTP trace.

      1. The first few will be URLs for your application.
      2. There will then be a redirect to an Auth0 URL (such as `{yourDomain}`).
   2. After one or more intervening URLs, there will be a POST back to Auth0 containing the SAML assertion with user information. The URL should be for the Assertion Consumer Service (ACS) of Auth0, which consumes the assertion and extracts the needed information.
   3. Click on the row for the POST call in the HAR analyzer.
   4. Switch to the POST Data tab, and look for the SAML response.
   5. Copy and paste the SAML response into a [SAML debugger](https://samltool.io/).
   6. Remove the "SAML response" at the beginning, as well as anything beginning with `&RelayState=` at the end.
4. After retrieving and decoding the SAML message, check the following fields:

<table class="table"><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Destination</td>
<td>Check that the destination for the SAML response is the correct Auth0 Tenant and Connection (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Status Field</td>
<td>This field should indicate success. (<code>&lt;samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/&gt;</code>).</td>
</tr>
<tr>
<td>Recipient</td>
<td>Check that the <code>&lt;saml:SubjectConfirmation</code> Method element contains correct tenant and connection in the “Recipient” field (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Audience</td>
<td>Check that the SAML Audience restriction field contains the correct tenant and connection information (`<saml:AudienceRestriction><saml:Audience>urn:auth0:{TENANT}:{CONNECTION}</saml:Audience>`).</td>
</tr>
<tr>
<td>Naming</td>
<td>The attribute identified by the <code>NameIdentifier</code> field should be known to the application. If it's not, the identifier should be some other attribute within the assertion (such as an internal IdP identifier for the user or an email address).</td>
</tr>
<tr>
<td>Signature Key</td>
<td>Check that the value indicated by the <code>X509Certificate</code> element matches the value provided to your connection.</td>
</tr>
<tr>
<td>Certificate</td>
<td>Compare the certificate sent to the one that you provided to the application</td>
</tr>
</tbody>
</table>

#### この場合、ユーザーはIdPに正常にログインし、Auth0ログにログイン成功のイベントが表示されますが、ユーザーのプロファイル属性が正しくありません。ユーザーについて以下が該当するかを確認します

以下を行って、ユーザーのAuth0プロファイルが正しく入力されているかを確認します。

ユーザーがアプリケーションにアクセスできない

1. Go to the [Dashboard > User Management > Users](https://manage.auth0.com/#/users).
2. Find and click on the specific user to open up their profile. If there are multiple rows for a given user, be sure to open up the record associated with the SAML Connection.
3. On the user's profile, you can view their details in one of two ways. You can use the **Details** tab or the **Raw JSON** tab. This shows you what attributes Auth0 has received from the identity provider.
4. If the attribute is missing, check to see if the attribute was included in the assertion. You can do this by decoding the SAML assertion, or you can enable debugging for the connection.

   1. To enable debugging for the connection, navigate to [Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise).
   2. Open the list of **SAML** IdP connections, click **Settings**, and enable **Debug Mode**.

      <Frame>![Troubleshoot SAML Connections Enable Debug Mode screen](/images/cdy7uua7fh8z/1F6npTHy1P0c0ygXfbndBD/6185e73705d078e9bf458460000ee2ad/2025-02-27_15-32-02.png)</Frame>
   3. With **Debug Mode** enabled, **Warning During Login** log entries [in the Dashboard](https://manage.auth0.com/#/logs) have an `original_profile` property listing every attribute included in the SAML assertion by the Identity Provider. You can use this list to see the information that the IdP is sending and to help you create the mappings. If the missing attribute is not in the assertion at all, please work with the IdP to make sure it is included.
5. If an attribute value exists in the Auth0 user profile, but is not mapped to the right attribute, you can correct this via the Connection Mapping capability.

   1. You can do this by navigating to [Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise).
   2. Open the list of **SAML** IdP connections and go to the **Mappings** tab.

      <Frame>![Troubleshoot SAML Connections Mappings Tab Screen](/images/cdy7uua7fh8z/BPMjuhqE17E5vWcHukcKf/df55785b4874411199b8dd84f1576cad/2025-02-27_14-14-14.png)</Frame>
   3. Within the provided editor, there is a JSON snippet you can edit to configure your mappings. The name on the left is the Auth0 user profile attribute to which the assertion value will be mapped. The value on the right is the identifier in the SAML assertion from which the attribute comes. When Auth0 incorporates unmapped SAML attributes into the user profile, attribute identifiers containing dots `.` are replaced with semicolons `:`. While configuring your mappings, ensure the identifiers you provide match those in the SAML assertion.

#### この場合、ユーザーはIdPに正常にログインし、Auth0ログにログイン成功のイベントが表示され、正しいユーザープロファイル属性ですが、ユーザーがアプリケーションにアクセスできません。

SAMLレスポンダーまたはSAMLオーソリティのエラーが原因で要求を行えない

1. Check your application's log files to see if there are any error messages indicating why the user is unable to access the application. The two most common causes for this issue are:

   1. Missing user profile information.
   2. Incorrect or missing authorization information.
2. Check the information that Auth0 sends to the application by [capturing an HTTP trace of the login sequence](/docs/troubleshoot/troubleshooting-tools/generate-and-analyze-har-files) and analyzing the HTTP trace. You can view the HTTP trace in a HAR file analyzer, such as [Google's HAR Analyzer](https://toolbox.googleapps.com/apps/har_analyzer/).

   <Warning>

   Before sharing a HAR file with anyone (including Auth0), ensure that you remove or obfuscate all sensitive data, such as:

   * Confidential user information
   * Personal identifiable information (PII)
   * Confidential application information

   To learn more, read the following articles on [Auth0 Community](https://community.auth0.com):

   * [Sanitizing HTTP Traces](https://community.auth0.com/t/sanitizing-http-traces/119488)
   * [How to Sanitize an HTTP Trace File Automatically](https://community.auth0.com/t/how-to-sanitize-a-http-trace-file-automatically/120583)
   * [How to Manually Redact Sensitive Information](https://community.auth0.com/t/how-to-manually-redact-sensitive-information/122554)
   * [HAR File is Too Large to Upload to the Support Case](https://community.auth0.com/t/har-file-is-too-large-to-upload-to-the-support-case/122488)
   </Warning>

   1. Scan through the sequence of URLs invoked in the HTTP trace.

      1. The first few will be URLs for your application.
      2. There will then be a redirect to an Auth0 URL (such as `{yourDomain}`).
   2. After one or more intervening URLs, there will be a POST back to Auth0 containing the SAML assertion with user information. The URL should be for the Assertion Consumer Service (ACS) of Auth0, which consumes the assertion and extracts the needed information.
   3. Click on the row for the POST call in the HAR analyzer.
   4. Switch to the POST Data tab, and look for the SAML response.
   5. Copy and paste the SAML response into a [SAML debugger](https://samltool.io/).
   6. Remove the SAML response at the beginning, as well as anything beginning with `&RelayState=` at the end.
3. After retrieving and decoding the SAML message, check the following fields:

<table class="table"><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Destination</td>
<td>Check that the destination for the SAML response is the correct Auth0 Tenant and Connection (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Status Field</td>
<td>This field should indicate success. (<code>&lt;samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/&gt;</code>).</td>
</tr>
<tr>
<td>Recipient</td>
<td>Check that the <code>&lt;saml:SubjectConfirmation</code> Method element contains correct tenant and connection in the “Recipient” field (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Audience</td>
<td>Check that the SAML Audience restriction field contains the correct tenant and connection information (`<saml:AudienceRestriction><saml:Audience>urn:auth0:{TENANT}:{CONNECTION}</saml:Audience>`).</td>
</tr>
<tr>
<td>Naming</td>
<td>The attribute identified by the <code>NameIdentifier</code> field should be known to the application. If it's not, the identifier should be some other attribute within the assertion (such as an internal IdP identifier for the user or an email address).</td>
</tr>
<tr>
<td>Signature Key</td>
<td>Check that the value indicated by the <code>X509Certificate</code> element matches the value provided to your connection.</td>
</tr>
<tr>
<td>Certificate</td>
<td>Compare the certificate sent to the one that you provided to the application</td>
</tr>
</tbody>
</table>
4. If your authorization flow uses an OIDC-conformant protocol, you can capture a HAR trace and view it using [Google's HAR Analyzer](https://toolbox.googleapps.com/apps/har_analyzer/).

   1. Scan through the sequence of URLs in the trace, and look for the following:

      1. The first few will be URLs for your application.
      2. There will then be a redirect to an Auth0 URL (such as `{yourDomain}`).
   2. Further down is your application's callback URL. Make sure that it's correct.
   3. Retrieve the ID Token from this call, and paste it into [a JWT decoder](https://jwt.io/). Check that the claims in the token contain the information needed by the application.
5. If you're using an IdP-initiated flow (for example, the user starts at the identity provider in a portal application), be sure that:

   1. The Assertion Consumer Service (ACS) URL at the identity provider includes the connection name (for example `https://{yourDomain}/login/callback?connection=CONNECTION_NAME`)
   2. The IdP-initiated configuration tab for the Connection is properly filled in, including:

      1. The IdP-initiated SSO behavior is set to **Accept Requests**;
      2. The application to which the user should be sent;
      3. The protocol between the application and Auth0 (which is not necessarily **SAML** like the connection, and most likely is **OpenID Connect**);
      4. Any protocol-specific values to include in the query string, such as `scope`, `response_type`, `redirect_uri`, and `audience`. These values should match the ones expected by the application when using an SP-initiated flow.
   3. Disable your rules temporarily to make sure that nothing is interfering with the login process.
   4. If you've enabled multi-factor authentication (MFA), disable it temporarily to make sure that it is not interfering with the login process.
   5. Check that the SAML Connection works in an SP-Initiated flow by using **Try** to run a Connection test.

#### エラーは次のように表示されることがあります。

IDプロバイダーとしてのAuth0をトラブルシューティングする

`<samlp:Status>
\<samlp:StatusCodeValue="urn:oasis:names:tc:SAML:2.0:status:Responder" />
</samlp:Status>`

1. Make sure that the signature algorithm on your Auth0 connection is the same as the configuration on the ADFS side: either `rsa-sha256` or `rsa-sha1`.
2. Alternatively, you can contact your ADFS administrator to learn the expected signing method or to see if their logs contain further information about the reason for the error.

## SAMLログインのトラブルシューティングでは、主に4つの確認するべき段階があります。

段階1：ユーザーがIdPに正常にリダイレクトされ、ログインできている

* 段階2：IdPにログインした後、ユーザーが正常なログインイベントレコードと共にAuth0に戻されている
* 段階3：Auth0での正常なログインイベントの後、正しいユーザープロファイルがAuth0に存在している
* 段階4：ユーザーがアプリケーションへ正常にリダイレクトで戻され、アプリケーションにアクセスできている
* ログにログイン成功のイベントが表示されない

### この場合、ユーザーはIdPに正常にログインしていますが、Auth0ログにはログイン成功のイベントが表示されていません。

ユーザープロファイル属性が正しくない

1. If you're using an Auth0 Database Connection:

   1. Check that the user exists and the entered password is correct.
   2. Disable your rules temporarily to make sure that nothing is interfering with the login process.
   3. If you've enabled multi-factor authentication (MFA), disable it temporarily to make sure that it is not interfering with the login process.
2. If you're using an Auth0 Database Connection or a remote SAML connection, check that the SAML Connection works by using **Try** to run a Connection test.

### この場合、ユーザーはIdPに正常にログインし、Auth0ログにログイン成功のイベントが表示されますが、ユーザーのプロファイル属性が正しくありません。ユーザーについて以下が該当するかを確認します

ユーザーが正常にログインしているように見える

* Auth0 Dashboardの［Logs（ログ）］ページと［Users（ユーザー）］ページにログイン成功のイベントが表示されている
* The Logs and Users pages in the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> should successful login events

ユーザーがアプリケーションにアクセスできない

1. Go to the [Dashboard > User Management > Users](https://manage.auth0.com/#/users).
2. Find and click on the specific user to open up their profile. If there are multiple rows for a given user, be sure to open up the record associated with the SAML Connection.
3. On the user's profile, you can view their details in one of two ways. You can use the **Details** tab or the **Raw JSON** tab. This shows you what attributes Auth0 has received from the identity provider. If an attribute is missing, check with the identity provider to confirm that it has the attribute and that it is returning that attribute to Auth0.

### この場合、ユーザーはIdPに正常にログインし、Auth0ログにログイン成功のイベントが表示され、正しいユーザープロファイル属性ですが、ユーザーがアプリケーションにアクセスできません。

LogoutRequestエラーに一致するアクティブセッションが見つからない

1. ユーザーがアプリケーションにアクセスできない

   1. Go to [Dashboard > User Management > Users](https://manage.auth0.com/#/users).
   2. Find and click on the specific user to open up their profile. If there are multiple rows for a given user, be sure to open up the record associated with the SAML Connection.
   3. On the user's profile, view their details in one of two ways. You can use the **Details** tab or the **Raw JSON** tab. This shows you what attributes Auth0 has received from the identity provider. Ensure that the profile includes all of the details required by the application. If a user attribute is missing, check with the identity provider to confirm that it has the attribute and that it is returning that attribute to Auth0.
2. Check the application's log files to see if there are any error messages indicating why the user is unable to access the application. The two most common causes for this issue are missing user profile information or incorrect/missing authorization information.
3. Check the information that Auth0 sends to the application by [capturing an HTTP trace of the login sequence](/docs/troubleshoot/troubleshooting-tools/generate-and-analyze-har-files) and analyzing the HTTP trace. You can view the HTTP trace in a HAR file analyzer, such as [Google's HAR Analyzer](https://toolbox.googleapps.com/apps/har_analyzer/).

   <Warning>

   Before sharing a HAR file with anyone (including Auth0), ensure that you remove or obfuscate all sensitive data, such as:

   * Confidential user information
   * Personal identifiable information (PII)
   * Confidential application information

   To learn more, read the following articles on [Auth0 Community](https://community.auth0.com):

   * [Sanitizing HTTP Traces](https://community.auth0.com/t/sanitizing-http-traces/119488)
   * [How to Sanitize an HTTP Trace File Automatically](https://community.auth0.com/t/how-to-sanitize-a-http-trace-file-automatically/120583)
   * [How to Manually Redact Sensitive Information](https://community.auth0.com/t/how-to-manually-redact-sensitive-information/122554)
   * [HAR File is Too Large to Upload to the Support Case](https://community.auth0.com/t/har-file-is-too-large-to-upload-to-the-support-case/122488)
   </Warning>

   1. Scan through the sequence of URLs invoked in the HTTP trace.

      1. The first few will be URLs for your application.
      2. There will then be a redirect to an Auth0 URL (such as `{yourDomain}`).
   2. After one or more intervening URLs, there will be a POST back to Auth0 containing the SAML assertion with user information. The URL should be for the Assertion Consumer Service (ACS) of Auth0, which consumes the assertion and extracts the needed information.
   3. Click on the row for the POST call in the HAR analyzer.
   4. Switch to the POST Data tab, and look for the SAML response.
   5. Copy and paste the SAML response into a [SAML debugger](https://samltool.io/).
   6. Remove the SAML response at the beginning, as well as anything beginning with `&RelayState=` at the end.
4. After retrieving and decoding the SAML message, check the following fields:

<table class="table"><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Destination</td>
<td>Check that the destination for the SAML response is the correct Auth0 Tenant and Connection (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Status Field</td>
<td>This field should indicate success. (<code>&lt;samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/&gt;</code>).</td>
</tr>
<tr>
<td>Recipient</td>
<td>Check that the <code>&lt;saml:SubjectConfirmation</code> Method element contains correct tenant and connection in the “Recipient” field (`https://{TENANT}.auth0.com/login/callback?connection={CONNECTION}`).</td>
</tr>
<tr>
<td>Audience</td>
<td>Check that the SAML Audience restriction field contains the correct tenant and connection information (`<saml:AudienceRestriction><saml:Audience>urn:auth0:{TENANT}:{CONNECTION}</saml:Audience>`).</td>
</tr>
<tr>
<td>Naming</td>
<td>The attribute identified by the <code>NameIdentifier</code> field should be known to the application. If it's not, the identifier should be some other attribute within the assertion (such as an internal IdP identifier for the user or an email address).</td>
</tr>
<tr>
<td>Signature Key</td>
<td>Check that the value indicated by the <code>X509Certificate</code> element matches the value provided to your connection.</td>
</tr>
<tr>
<td>Certificate</td>
<td>Compare the certificate sent to the one that you provided to the application</td>
</tr>
</tbody>
</table>
5. Ensure that the SAML assertion contains any additional information required by the application and that the information is present in the attributes expected by the application.

   1. If you need to alter the assertion sent from Auth0 to your application, you can add or map attributes using rules.

      1. Log into Auth0 and navigate to **Rules**.
      2. Click **Create Rule** and, on the next page, choose the **Change your SAML configuration** template.
      3. In the rules editor, uncomment the lines you want to use. Use lines 9-17 in the template to map attributes as needed. You can also add lines to implement mappings. The left side of each line specifies the identifier for the attribute in the assertion. The right side of each line references the Auth0 user profile attribute whose value will be used to populate the outgoing assertion sent to the application.

         ```text lines
         //context.samlConfiguration.mappings = {    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier":      "user_id",    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress":        "email",    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name":                "name",    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname":           "given_name",    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname":             "family_name",    
             // "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn":                 "upn",    
             // "http://schemas.xmlsoap.org/claims/Group":                                   "groups"    
             // };
         ```

         

         

### SAMLログアウト要求に含まれる`SessionIndex`と`NameID`の値は、サービスプロバイダーがオリジナルのSAMLアサーションで受け取る値と一致しなければなりません。

サポートに問い合わせる

## 上記のトラブルシューティングの手順で問題が解消されない場合には、Auth0のサポートセンターでチケットを作成し、サポートをリクエストしてください。その際には、以下の情報を提供してください。

If the troubleshooting steps listed above don't solve the issues, please request assistance from Auth0 by opening up a ticket in the Support Center. Be sure to include the following information:

1. The number of users experiencing this issue. One? All?
2. Whether this issue involves a new setup or if it involves an existing integration that suddenly stopped working
3. The number of applications affected
4. What the expected behavior is, as well as what the current behavior is
5. How far through the login sequence the user gets
6. The name of the application registered in Auth0 and the identity protocol it uses
7. The name of the Connection involved
8. Whether or not you're using the Auth0 Lock widget (if so, what version?)
9. Is a customized version of Lock used?
10. An HTTP trace of the SSO interaction in [a .har file](/docs/troubleshoot/troubleshooting-tools/generate-and-analyze-har-files)

    <Warning>

    Before sharing a HAR file with anyone (including Auth0), ensure that you remove or obfuscate all sensitive data, such as:

    * Confidential user information
    * Personal identifiable information (PII)
    * Confidential application information

    To learn more, read the following articles on [Auth0 Community](https://community.auth0.com):

    * [Sanitizing HTTP Traces](https://community.auth0.com/t/sanitizing-http-traces/119488)
    * [How to Sanitize an HTTP Trace File Automatically](https://community.auth0.com/t/how-to-sanitize-a-http-trace-file-automatically/120583)
    * [How to Manually Redact Sensitive Information](https://community.auth0.com/t/how-to-manually-redact-sensitive-information/122554)
    * [HAR File is Too Large to Upload to the Support Case](https://community.auth0.com/t/har-file-is-too-large-to-upload-to-the-support-case/122488)
    </Warning>
11. An Auth0 log entry for the failed authentication
12. An authentication log file from any third-party applications (such as Sharepoint) involved

## Learn more

* [SAML Single Sign-On Integrations](/docs/authenticate/protocols/saml/saml-sso-integrations)
* [Test SAML SSO with Auth0 as Service Provider and Identity Provider](/docs/authenticate/protocols/saml/saml-configuration/configure-auth0-as-service-and-identity-provider)