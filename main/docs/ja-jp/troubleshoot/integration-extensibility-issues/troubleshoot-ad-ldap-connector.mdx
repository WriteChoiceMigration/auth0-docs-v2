---
og:description: Common issues and troubleshooting information for the AD/LDAP Connector.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: AD/LDAPコネクタのトラブルシューティング
og:url: https://auth0.com/docs/
permalink: troubleshoot-ad-ldap-connector
title: AD/LDAPコネクタのトラブルシューティング
twitter:description: Common issues and troubleshooting information for the AD/LDAP
  Connector.
twitter:title: AD/LDAPコネクタのトラブルシューティング
---

If you are experiencing issues with your [AD/LDAP Connector](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector), read below to learn how to troubleshoot common issues.

## トラブルシューティングツールは、AD/LDAPコネクタ管理コンソールで実行することも、Admin Consoleの外部でプログラムを手動で実行することもできます。

証明書の問題を検出するには、[AD/LDAPコネクタ構成ファイル](/extensions/ad-ldap-connector/ad-ldap-connector-config-file-schema)で`CONNECTIONS_API_V2_KEY`変数を設定します。

To detect issues with certificates, set the `CONNECTIONS_API_V2_KEY` variable in the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema).

### トラブルシューティングツールは、Admin Consoleで実行できます。

Admin Consoleの外部

1. Switch to the **Troubleshooting** view to read the logs.

   <Frame>![Troubleshoot AD/LDAP Connector Admin Console Troubleshooting Screen](/images/cdy7uua7fh8z/3N6GgZVMaYUcY48GK8IKgU/92a469b9375dbcd9e3c35adaef6709d5/connector-admin-console-troubleshooter.png)</Frame>
2. Select **Run** to detect the most common problems related to the AD/LDAP Connector.

### Admin Consoleの外部でトラブルシューティングツールを起動できます。

Windowsマシンで、提供されたコマンドファイルを実行してトラブルシューティングツールを起動します。

#### Windowsマシンで、提供されたコマンドファイルを実行してトラブルシューティングツールを起動します。

例：`C:\Program Files (x86)\Auth0\AD LDAP Connector\troubleshoot.cmd`.

1. Locate the AD/LDAP Connector folder (`AD LDAP Connector`).
2. Run the `troubleshoot.cmd` file.

Linuxマシンで、提供されているNode.jsプログラムを実行して、トラブルシューティングツールを起動します。

<Frame>![Troubleshoot AD/LDAP Connector Troubleshooting Tool Screen](/images/cdy7uua7fh8z/5LOU1ZyB69cPe8rVa9lVPd/c5c7419ae736a3992ddd2a436b26a3e0/connector-troubleshooter.png)</Frame>

#### Linuxマシンで、提供されているNode.jsプログラムを実行して、トラブルシューティングツールを起動します。

インストールと構成の問題

1. Open a new terminal window.
2. Change the working directory to the AD/LDAP Connector folder (`AD LDAP Connector`).
3. Run the `node troubleshoot.js` command.

## **［Save（保存）］**をクリックすると、AD/LDAP Connector Admin Consoleによって一連のテストが実行され、提供された情報が検証されます。テストの結果は、**［Configuration log（構成ログ）］**の見出しの下に表示されます。

Admin Consoleは、次のテストを実行します

**Test 1（テスト1）**：指定されたLDAPサーバーおよびポートへのTCP接続の確立を試みます。テスト1が失敗した場合は、このような接続を妨げる可能性のある基本的なネットワーク接続とファイアウォール設定を確認します。

* **Test 2（テスト2）**：指定されたLDAPサーバーおよびポートで、指定されたユーザー名とパスワードを使用してLDAPバインドの実行を試みます。テスト2が失敗した場合は、LDAP接続文字列、検索パス、ユーザー名、およびパスワードを確認します。
* **Test 3（テスト3）**：指定されたユーザー名の権限を確認するために、ディレクトリに対してLDAP検索を試行します。テスト3が失敗した場合は、ターゲットディレクトリ内のユーザー名の権限を確認します。
* **Test 4（テスト4）**：Auth0サーバーへの接続確立を試行します。テスト4が失敗した場合は、このような接続を妨げる可能性のあるネットワーク接続とファイアウォール設定を確認します。
* 一般的な問題と解決策

## いくつかの一般的な問題とその解決策について説明します。

認証要求の処理に時間がかかりすぎます

### デフォルトでは、Auth0 AD/LDAPコネクタは、Active Directoryからユーザーのグループメンバーシップをインポートし、`［user（ユーザー）］`オブジェクトにそれらを含めます。

この動作では、AD/LDAPコネクタがActive Directoryに対して追加のクエリを実行する必要があります。これにより、認証プロセスの時間が大幅に長くなる可能性があります。

ユーザープロファイルにグループを返す必要がない場合、Auth0は、[AD/LDAP Connector構成ファイル](/extensions/ad-ldap-connector/ad-ldap-connector-config-file-schema)で`GROUPS`変数を明示的に無効にすることを推奨します。

If you do not need groups to be returned on the user profile, Auth0 recommends that you explicitly disable the `GROUPS` variable in the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema).

### AD/LDAPコネクタをホストするマシンのCPU使用率が常に高い場合（例えば、使用率が60%以上持続する場合）、いくつかの緩和策があります。

重要でないサービスのアンインストール

#### CPUサイクルを消費している可能性のあるホストマシン上の重要でないサービスをアンインストールします。

グループインポート構成の変更

#### ユーザープロファイルでグループを返す必要がない場合は、[［Authentication requests take too long to process（認証要求の処理に時間がかかりすぎる）］](#authentication-requests-take-too-long-to-process)の説明に従ってグループインポートを無効にします。

ユーザープロファイルでグループを返す必要がある場合は、Auth0ユーザープロファイルで返されるグループを調査します。ネストされたグループと再帰グループに対するクエリは、高いCPU利用を引き起こす可能性があります。可能であれば、グループインポートを無効にしてテストして、グループクエリの影響を評価します。

影響を軽減するには、AD/LDAPサーバーで再帰的または問題のあるグループ割り当てを修正するか、[AD/LDAPコネクタ構成ファイル](/extensions/ad-ldap-connector/ad-ldap-connector-config-file-schema)の`GROUPS_CACHE_SECONDS`変数の値を増やします。

To mitigate the impact, fix any recursive or otherwise problematic group assignments in your AD/LDAP server, and/or increase the value of the `GROUPS_CACHE_SECONDS` variable in the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema).

#### 最初にAD/LDAPコネクタを展開してから、アクティブユーザーの数が増加しているかどうかを確認します。これは、独自の[監視ソリューション](/monitor-auth0/streams)を使用して評価することも、[Auth0アクティブユーザーレポート](/monitor-subscription-usage)から推定値を取得することもできます。

Check if the number of active users using the AD/LDAP Connector has increased since you initially deployed it. You can evaluate this by using your own [monitoring solution](/docs/customize/log-streams), or you can get an estimate from the [Auth0 active users report](/docs/troubleshoot/customer-support/manage-subscriptions/monitor-subscription-usage).

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

In Microsoft Windowsマシンで、提供されたコマンドファイルを実行してトラブルシューティングツールを起動します。 Server environments, Microsoft System Center Operations Manager (SCOM) can be configured to monitor and alert on the service status of the AD/LDAP Connector. For more information, see [Monitor AD/LDAP Connector with System Center Operations Manager](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-scom).

</Callout>

If the number of active users has increased, and all steps above have already been followed, you may need to upgrade your host machine’s hardware specifications, or configure a [High Availability environment](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-high-availability).

### コネクタでは、サーバー上のクロックをAuth0サービスと同期する必要があります。許容される最大しきい値は5秒です。

クロックスキューがある場合は、トラブルシューターとコネクタログにこのような出力が表示されます。

サーバーのクロックが最新であることを確認します。時間が正しくない場合、認証要求が失敗します。これは、ネットワークタイムプロトコル (NTP) を使用して同期サーバーをポーリングするようにシステムが適切に構成されていることを確認することで解決できます。Windows環境では、NTPプロバイダーは通常、同じドメインコントローラです。ドメインコントローラが外部サービスと同期されていることを確認します。

```text lines
12:18:55 - info: * Testing clock skew...
12:18:55 - error: × コネクタでは、サーバー上のクロックをAuth0サービスと同期する必要があります。許容される最大しきい値は5秒です。 detected:
12:18:55 - error: > Local time: 2020-05-04 12:18:55
12:18:55 - error: > Auth0 time: 2020-05-04 12:19:10
```






Active Directory環境を外部タイムサーバーと同期する方法については、renanrodrigues.comの[［How to configure NTP server in Active Directory（Active DirectoryでNTPサーバーを構成する方法）］]()をお読みください。

To learn how to synchronize your Active Directory environment with an external time server, read [How to configure NTP server in Active Directory, Step by step on renanrodrigues.com](https://www.renanrodrigues.com/post/how-to-configure-ntp-server-in-active-directory-step-by-step).

If you are unsure if your server's clock is in sync with NTP, go to https://nist.time.gov and compare the time on that page with the time in the server where the connector is running. You shouldn't notice more than a one (1) second difference between them.

### AD/LDAPコネクタは、LDAPサーバーに到達できるサーバーにインストールする必要があります。AD/LDAPコネクタとLDAPサーバーの間にファイアウォールとVPN接続を配置すると、接続の問題が発生する可能性があります。

Active Directoryを使用してWindowsネットワークを構成する場合は、`nltest`コマンドを使用します。たとえば、特定のマシンが`Fabrikam.local`ドメインに到達できるかどうかをテストするには、`nltest/dsgetdc:fabrikam.local`を使用します。

現在のサーバーがどのドメインに接続されているかを確認するには、`nltest/dsgetdc:`を使用します。

ドメインが存在しないか、到達できない場合、`nltest`はエラーメッセージを返します：`DC名の取得に失敗しました:Status = 1355 0x54b ERROR_NO_SUCH_DOMAIN`.

UNABLE_TO_VERIFY_LEAF_SIGNATUREエラーメッセージ（プライベートクラウド）

### このエラーは、プライベートクラウドと組み合わせたAD/LDAPコネクタに適用されます。

このエラーメッセージは、AD/LDAP Connectorがプライベートクラウドで構成されたSSL証明書を検証できない場合に、その起動に失敗したときに発生します。これは、ルート証明書（または中間証明書）がマシンの証明書ストア（Windows）にない場合に発生する可能性があります。これを解決するには、AD/LDAPコネクタがインストールされているマシンの**［Local Machine（ローカルマシン）］>［Trusted Root（信頼ルート）］**証明書ストアに証明書チェーンをインポートします。

プロキシの背後にあるコネクタ

### コネクタをホストしているコンピューターがプロキシの背後にある場合は、`HTTP_PROXY`システム環境変数を設定するか、[AD/LDAPコネクタ構成ファイル](/extensions/ad-ldap-connector/ad-ldap-connector-config-file-schema)で`HTTP_PROXY`変数を設定できます。認証されたプロキシを使用する場合、URLは `

If the machine hosting the connector is behind a proxy, you can set an `HTTP_PROXY` system environment variable, or you can set the `HTTP_PROXY` variable in the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema). If using an authenticated proxy, the URL must be in the format `http://USERNAME:PASSWORD@SERVER_URL:PORT`.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

If you set system environment variables, or modify the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema), you must restart the AD/LDAP Connector for the changes to take effect.

</Callout>

プロキシURLを構成し、AD/LDAPコネクタを再起動しても`SELF_SIGNED_CERT_IN_CHAIN`エラーが発生する場合は、サーバーがプロキシのルート証明書を信頼していることを確認してください。Windowsコンピューターでは、`certmgr.msc`を開いてプロキシの証明書を検索することで、これを確認できます。詳細については、[［ウィキペディアのプロキシAuto Config（PAC）］]()をお読みください。

インターネット接続がありません

If you have configured a proxy URL and restarted the AD/LDAP Connector, but are still seeing `SELF_SIGNED_CERT_IN_CHAIN` errors, make sure that your server is trusting the root certificate of the proxy. On a Windowsマシンで、提供されたコマンドファイルを実行してトラブルシューティングツールを起動します。 machine, you can check this by opening `certmgr.msc` and looking for your proxy's certificate. To learn more, read [Proxy auto config (PAC) on Wikipedia](https://en.wikipedia.org/wiki/Proxy_auto-config).

### これを確認するには、ブラウザを開き、`

Ensure that your server can connect to your Auth0 tenant (`https://{yourDomain}`).

To verify this, open a browser and navigate to `https://{yourDomain}/test`.

### Kerberosの問題

Kerberos要求の詳細ログを有効にするには：

### Kerberosが有効になっているにもかかわらず、ユーザーがユーザー名/パスワードを要求される場合は、IPアドレス設定が適切に構成されていることを確認します。詳細については、[［Configure AD/LDAP Connector Authentication with Kerberos（Kerberosを使用したAD/LDAPコネクタ認証の構成）］](/extensions/ad-ldap-connector/configure-ad-ldap-connector-with-kerberos)を参照してください。

ADのユーザープロファイルの変更は、アプリにすぐに反映されません

1. Add `DEBUG=kerberos-server` as a system environment variable.
2. Restart the AD/LDAP Connector.
3. Log in.
4. Check the logs for more information.

If you have Kerberos enabled, but your users are being prompted for username/password, verify that the IP address setting is properly configured. For more information, see [Configure AD/LDAP Connector Authentication with Kerberos](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/configure-ad-ldap-connector-with-kerberos).

### これらの設定の構成により、ユーザーがアプリケーションにログインしたときにディレクトリの変更がユーザーのプロファイルに反映される即時性が決まります。一部のAD/LDAPインストールでは、ユーザー属性の同期に数分かかる場合があります。

Auth0サーバーでのキャッシュ

1. **Auth0 server**: Caches both the user’s credentials and their profile.
2. **AD/LDAP Connector**: Caches a user’s group memberships.

Auth0サーバーは、ユーザー名とパスワードのハッシュを含む、ユーザーの最後に正常に認証されたプロファイルをキャッシュします。デフォルトで有効になっていますが、無効にすることもできます。

#### この第1レベルのキャッシュの目的は、ネットワークの停止中など、ADが使用できない場合に認証トランザクションの可用性を最大化することです。AD/LDAPコネクタまたはAD/LDAPサーバーが使用できない場合にのみアクティブになります。

AD/LDAPコネクタでのキャッシュ

AD/LDAPコネクタは、ユーザーのグループメンバーシップをキャッシュします。このキャッシュの有効期限は[AD/LDAPコネクタ設定ファイル](/extensions/ad-ldap-connector/ad-ldap-connector-config-file-schema)の`GROUPS_CACHE_SECONDS`変数によって決定され、デフォルト値は600（秒）です。

#### このセカンドレベルキャッシュの目的は実行時間を最小化することです。デフォルトでは、AD/LDAPコネクタはユーザーのすべてのグループメンバーシップを再帰的に取得します。これは、一部のAD/LDAPインストールでは負荷の高いプロセスになる可能性があります。このキャッシュは、AD/LDAPコネクタを再起動するたびに削除されます。

The AD/LDAP Connector caches a user’s group memberships. This cache’s lifetime is determined by the `GROUPS_CACHE_SECONDS` variable in the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema), with a default value of 600 (seconds).

サーバーのオープンインバウンドポートの要件を回避するために、AD/LDAPコネクタはAuth0のサーバークラスター内の利用可能なノードにWebソケット接続を作成し、Auth0からの受信メッセージをリッスンするためにオープン状態を維持します。

### 約1日1回（ただし、状況により頻度が異なる場合がある）、各サーバーノードは接続を終了し、内部導入プロセスを実行できるようにします。AD/LDAPコネクタは閉じた接続を検出してプロセスを終了し、サービススタックがプロセスを再起動し、使用可能なノードへの新しい接続を作成し、操作を再開できるようにします。

ダウンタイムを回避するには、キャッシュを有効にします。

［postUrl is required（posturlが必要）］エラーを受信します

KerberosをサポートするAD/LDAP接続を使用するには、カスタムドメインで動作するように**［Ticket（チケット）］**エンドポイントを更新する必要があります。

1. Go to [Auth0 Dashboard > Authentication > Enterprise](https://manage.auth0.com/#/connections/enterprise), and select the **Active Directory/LDAP** connection type.
2. Select your AD/LDAP connection.
3. Switch to the **Applications** view, and enable the connection for the desired application(s).
4. Select **Save**.

### 発行者証明書をローカルに確認できません

You may encounter this error if you have not completed additional configuration for a [custom domain](/docs/customize/custom-domains).

In order to use AD/LDAP connections with Kerberos support, you will need to update the **Ticket** endpoint to work with the <Tooltip tip="Custom Domain: Third-party domain with a specialized, or vanity, name." cta="View Glossary" href="/docs/glossary?term=custom+domain">custom domain</Tooltip>:

1. Open the [AD/LDAP Connector configuration file](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema).
2. Set the `PROVISIONING_TICKET` configuration variable to `https://{yourDomain}/p/ad/jUG0dN0R`.
3. Restart the AD/LDAP Connector.

### 統合プラットフォーム環境を使用している場合は、AD/LDAPコネクタがインストールされているマシンの信頼済みストアに[ISRGルートX2証明書]()を追加します。

Auth0サポートにお問い合わせ

* If your tenant is in the public cloud environment, verify that you have the [ISRG Root X1 certificate](https://letsencrypt.org/certificates/#root-certificates) in your Trusted Store on the machine with the installed AD/LDAP Connector.
* If you are on the converged platform environment, add the [ISRG Root X2 certificate](https://letsencrypt.org/certificates/#root-certificates) to the Trusted Store on the machine with the installed AD/LDAP Connector.

If you are configuring a [High Availability environment](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-high-availability) and are encountering this error on an additional machine, verify that the Trusted Root Certificate Authorities on the additional machine matches the Trusted Root Certificate Authorities on the initial machine.

## Linux:`/var/log/auth0-adldap.log`

If you are unable to resolve any of these issues on your own, contact [Auth0 Support](/docs/troubleshoot/customer-support/open-and-manage-support-tickets).

To help the Support team troubleshoot your issue, include the following items in your support ticket:

1. Description of the issue.
2. An [export of your AD/LDAP configuration files](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/import-export-ad-ldap-connector-configs).
3. A copy of the service log file(s):

   * Windows: `C:\Program Files (x86)\Auth0\AD LDAP Connector\logs.log`
   * Linux: `/var/log/auth0-adldap.log`
4. The version number of your AD/LDAP Connector.

   <Frame>![Troubleshoot AD/LDAP Connector Console Screen](/images/cdy7uua7fh8z/4TxfMbN76vRwaON9RKzt6F/81327d0c830082a0d78a89f005edfc87/adldap-connector-version.png)</Frame>

## Learn more

* [AD/LDAP Connector System Requirements](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-requirements)
* [Import and Export AD/LDAP Connector Configurations](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/import-export-ad-ldap-connector-configs)
* [Set Up AD/LDAP Connector Test Environment](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-test-environment)
* [Update AD/LDAP Connectors](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/update-ad-ldap-connectors)
* [AD/LDAP Connector Configuration File Schema](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-config-file-schema)
* [Monitor AD/LDAP Connector with System Center Operations Manager](/docs/authenticate/identity-providers/enterprise-identity-providers/active-directory-ldap/ad-ldap-connector/ad-ldap-connector-scom)