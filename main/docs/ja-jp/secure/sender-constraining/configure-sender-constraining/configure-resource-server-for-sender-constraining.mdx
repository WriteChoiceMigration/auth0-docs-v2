---
permalink: configure-resource-server-for-sender-constraining
title: Sender Constraining用にリソースサーバーを構成する
---



APIのSender Constrainingを有効にすると、リソースサーバーは、クライアントが証明書バウンドアクセストークンでリソースサーバーを呼び出した時はいつでもSender Constrainingを強制しなければなりません。以下により、リソースサーバーがこれを強制します。

1. 確率されたmTLS接続にクライアント証明書を要求する
2. クライアント証明書のサムプリントがアクセストークンのサムプリントと一致するか検証

Sender Constraining用にリソースサーバーを構成するには、「[リソースサーバーのSender Constrainingを有効にする](#enable-sender-constraining-for-a-resource-server)」をご覧ください。

## クライアント証明書の検証

認可サーバーまたはカスタマーエッジとは異なり、リソースサーバーは、証明書チェーン全体の代わりに、クライアント証明書のサムプリントのみを検証する必要があります。mTLS Sender Constrainingのために、リソースサーバーは、アクセストークンの `cnf`クレームを確認します。



上記の`cnf`クレームの例では、`x5t#S256`は、アクセストークンが`A4DtL2JmUMhAsvJj5tKyn64SqzmuXbMrJa0n761y5v0`のサムプリントのmTLSクライアント証明書にバインドされていることを示します。クライアント証明書の検証に合格するには、リソースサーバーは、クライアント証明書に`A4DtL2JmUMhAsvJj5tKyn64SqzmuXbMrJa0n761y5v0`と一致するサムプリントがあることを検証しなければなりません。サムプリントの計算方法の詳細については、RFC 8705の「 [JWT証明書サムプリント確認方法](https://www.rfc-editor.org/rfc/rfc8705#name-jwt-certificate-thumbprint-)」のセクションをご覧ください。

クライアント証明書が送信されなかった場合、またはクライアント証明書のサムプリントが一致しなかった場合、リソースサーバーは、 `HTTP 401`ステータスコードおよび`invalid_token`エラーコードを使用して、要求を拒否します。詳細については、RFC 8705の「[相互TLSクライアント証明書バウンドアクセストークン](https://www.rfc-editor.org/rfc/rfc8705#name-mutual-tls-client-certifica)」および「[リソースサーバー](https://www.rfc-editor.org/rfc/rfc8705#name-resource-server)」のセクションをご覧ください。

mTLSを使用するためにクライアントを徐々に移行するリソースサーバーについては、2つのドメインにAPIを公開することを検討するといいでしょう。1つは、非mTLSクライアントのための非mTLSドメイン、そしてもう１つはmTLS対応クライアントのためのmTLS有効ドメインです。または、mTLS有効ドメインにまったく別のmTLSのみのリソースサーバーを作成することもできます。

## Auth0でリソースサーバー用にSender Constrainingを構成する

Auth0が発行するアクセストークンは、リソースサーバーのAPIにアクセスする必要がある送信者（つまり、クライアントアプリケーション）に制限できます。

[Auth0 Dashboard](%24%7Bmanage_url%7D/#/apis)または[Management API](https://auth0.com/docs/api/management/v2)を使用して、リソースサーバーのSender Constrainingを有効にできます。