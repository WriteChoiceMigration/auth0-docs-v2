---
og:description: Learn how to revoke a refresh token if it gets compromised using the
  Authentication API, the Management API, or the Auth0 Dashboard.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: リフレッシュトークンの取り消し
og:url: https://auth0.com/docs/
permalink: revoke-refresh-tokens
title: リフレッシュトークンの取り消し
twitter:description: Learn how to revoke a refresh token if it gets compromised using
  the Authentication API, the Management API, or the Auth0 Dashboard.
twitter:title: リフレッシュトークンの取り消し
---

リフレッシュトークンが侵害された場合に備えて、リフレッシュトークンを取り消すことができます。Auth0は、トークンが悪意のある攻撃者にさらされている可能性があるかのように、トークンの失効を処理します。

また、クライアントが新しいアクセス トークンを取得するためにリフレッシュトークンを交換するたびに、新しいリフレッシュトークンも返されるように、[リフレッシュトークンのローテーション](/security/tokens/refresh-tokens/refresh-token-rotation)を使用することもできます。このため、侵入を受けると永久にリソースへのアクセスを許してしまうような、寿命の長いリフレッシュトークンはなくなりました。リフレッシュトークンは交換され続け、失効し続けるため、脅威の軽減に繋がっています。

次の方法でリフレッシュトークンを無効化することができます。

* ダッシュボード内
* 認証`/oauth/revoke`エンドポイントにPOST要求を行う
* Management API`/api/v2/device-credentials`エンドポイントにPOST要求を行う

## トークンと付与を更新する

付与により、アプリケーションはユーザー資格情報を公開することなく、別のエンティティ上のリソースにアクセスできるようになります。トークンは付与の文脈で発行され、付与が無効化されると、その付与の文脈で発行されたすべてのトークンも無効化されます。一方、トークンが無効化された場合、必ずしも付与が無効化されるわけではありません。

DashboardまたはManagement APIを使用して、デバイスがAuth0のユーザーからリンク解除されたときに、Dashboardのテナント設定で取り消し動作を選択できます。



1. Go to [［Dashboard］ > ［Tenant Settings（テナント設定）］ > ［Advanced（詳細）］](%24%7Bmanage_url%7D/#/tenant/advanced)に移動し、**［Settings（設定）］**セクションにスクロールします。
2. 失効をどのように動作させたいかに応じて、**リフレッシュトークン失効削除許可トグル**を有効または無効にします。

1. リフレッシュトークンを無効化する際に基礎となる許可を削除するには、トグルを有効にします。取り消し要求ごとに、特定のトークンだけでなく、同じ認可付与に基づくその他すべてのトークンを無効にします。つまり、同じユーザー、アプリケーション、オーディエンスに発行されたリフレッシュトークンがすべて取り消されます。
2. リフレッシュトークンを無効化する際に基礎となる許可を保持するには、トグルを無効にします。デバイスのリンクが解除されると、関連付けられたリフレッシュトークンのみが取り消され、許可はそのまま残ります。

## Dashboardの使用

Dashboardを使用して、トークンを発行したアプリケーションへのユーザーの承認済みアクセスを取り消すことができます。これにより、リフレッシュトークンが無効になります。これは、トークン自体を取り消すのと機能的に同じです。

1. [［Dashboard］>［User Management（ユーザー管理）］>［Users（ユーザー）］](%24%7Bmanage_url%7D/#/users)に移動し、ユーザー名をクリックして表示します。
2. **［Authorized Application（認可アプリケーション）］**タブを選択します。このページには、ユーザーがアクセスを許可したすべてのアプリケーションが一覧表示されます。
3. 承認済みアプリケーションへのユーザーのアクセスを取り消して、リフレッシュトークンを無効にするには、**［Revoke（取り消し）］**をクリックします。

## Authentication APIを使用する

リフレッシュトークンを取り消すには、`https://${account.namespace}/oauth/revoke`に`POST`要求を送信します。

`/oauth/revoke`エンドポイントは、特定のトークンだけでなく、許可全体を取り消します。リフレッシュトークンを取り消すには、`/api/v2/device-credentials`エンドポイントを使用します。APIは最初にアプリケーションの資格情報を検証し、次にトークンが取り消し要求を行ったアプリケーションに発行されたかどうかを確認します。この検証が失敗すると、要求は拒否され、アプリケーションにエラーが通知されます。次に、APIはトークンを無効にします。無効化は直ちに行われ、取り消し後はトークンを再び使用することはできません。取り消し要求ごとに、同じ承認許可に対して発行されたすべてのトークンが無効になります。



ここでは、



アプリケーションは、リフレッシュトークンが発行されたものと一致する必要があります。

### クライアントシークレットなしでトークンを取り消す

クライアントシークレットを安全に保管できないアプリケーション（ネイティブアプリなど）の場合、`/oauth/revoke`エンドポイントはクライアントシークレットなしでのアクセスをサポートします。ただし、アプリケーション自体の`tokenEndpointAuthMethod`プロパティが`none`に設定されている必要があります。`tokenEndpointAuthMethod`値は、[［Dashboard］ > ［Applications（アプリケーション）］ > ［Applications（アプリケーション）］](%24%7Bmanage_url%7D/#/applications)から、またはManagement APIを使用して変更できます。

要求が有効な場合、リフレッシュトークンは取り消され、応答は`HTTP 200`で、応答本文は空です。それ以外の場合、応答本文にはエラーコードと説明が含まれます。



考えられる応答は次のとおりです。



## Management APIの使用

Auth0 Management APIを使用してリフレッシュトークンを取り消すには、取り消すリフレッシュトークンの`id`が必要です。既存のリフレッシュトークンのリストを取得するには、`/api/v2/device-credentials`[エンドポイント](/api/management/v2#!/Device_Credentials/get_device_credentials)を呼び出し、`type=refresh_token`と`user_id`を指定して、`read:device_credentials`スコープを含むアクセス トークンを使用します。結果を絞り込むには、トークンに関連付けられた`client_id`（わかっている場合）を指定することもできます。



応答本文：



リフレッシュトークンを取り消すには、`delete:device_credentials`スコープを含むアクセス トークンと上記で取得した ID の値を使用して、`/api/v2/device-credentials`エンドポイントを呼び出します。



応答は`HTTP 204: The credential no longer exists`（認証情報はもう存在しません）になります。

## 考慮事項と制限

[デバイス認可フロー](/login/flows/device-authorization-flow)では、デバイスに再認証を強制する唯一の方法は、デバイスに割り当てられたリフレッシュトークンを取り消すことです。詳細については、[ユーザーからデバイスのリンクを解除する](/users/unlink-devices-from-users)を参照してください。デバイスは、現在有効なアクセストークンの期限が切れて、アプリケーションが失効したリフレッシュトークンを使おうとするまでは、再認証が強制されないことに注意してください。

[リフレッシュトークンのローテーション](/security/tokens/refresh-tokens/refresh-token-rotation)使用中に以前無効になったトークンが使用されている場合は、その無効になったトークンが発行された以降に発行されたリフレッシュトークンの全セットが付与と同様に直ちに失効され、ユーザーの再認証が必要になります。

* リフレッシュトークンを取り消すには、Authentication APIの`/oauth/revoke`[エンドポイント](/api/authentication#revoke-refresh-token)を使用します。このエンドポイントは、基礎となる許可を削除しません。この動作を変更して、Dashboardで基礎となる許可も削除できます。[［Dashboard］ > ［Tenant Settings（テナント設定）］ > ［Advanced（詳細）］](%24%7Bmanage_url%7D/#/tenant/advanced)。**Settings（設定）**までスクロールし、**リフレッシュトークンの取り消しによる許可の削除**のトグルを有効にします。
* ローテーション用に構成されたリフレッシュトークンを取り消すには、Management API`/api/v2/device-credentials`[エンドポイント](/api/management/v2#!/Device_Credentials/get_device_credentials)を使用します。