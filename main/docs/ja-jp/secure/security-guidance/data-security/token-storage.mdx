---
og:description: Learn how and where to store tokens used in token-based authentication.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: トークンストレージ
og:url: https://auth0.com/docs/
permalink: token-storage
title: トークンストレージ
twitter:description: Learn how and where to store tokens used in token-based authentication.
twitter:title: トークンストレージ
---

APIを呼び出すSPAのセキュリティ確保には、さまざまな懸念が伴います。トークンその他の極秘データが、[クロスサイトスクリプティング](https://www.owasp.org/index.php/Cross-site_Scripting_(XSS))（XSS）の脆弱性を持たないこと、悪意のあるJavaScriptによって解読される可能性がないことを保証する必要があります。

詳細については、[JWTハンドブック](https://auth0.com/resources/ebooks/jwt-handbook)および[Auth0を使用したNext.js認証の究極ガイド](https://auth0.com/blog/ultimate-guide-nextjs-authentication-auth0/?utm_source=twitter&utm_medium=sc&utm_campaign=nextjs_authn_guide)を参照してください。

#### Next.js静的サイトのシナリオ

Next.jsアプリケーションを構築する場合、次の場合に認証が必要になることがあります。

1. ページにアクセスする場合
2. APIルートにアクセスする場合
3. アプリケーションがユーザーに代わってNext.jsアプリケーション外でホストされたAPIを呼び出す場合

サーバーが利用可能な場合、アプリはAuth0とのやり取りを処理してセッションを作成できますが、このモデルではバックエンドはありません。すべての作業はフロントエンドで行われます。

1. ユーザーはAuth0にリダイレクトされます。
2. ユーザーが正常にサインインすると、アプリケーションにリダイレクトされます。
3. クライアント側は Auth0 とのコード交換を完了し、ユーザーの`id_token`と`access_token`を取得します。これらはメモリに保存されます。





### ブラウザのメモリ内シナリオ

Auth0は、最も安全なオプションとして、トークンをブラウザのメモリに保存することを推奨しています。[Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API)はアプリケーションの他の部分とは別のグローバルスコープで実行されるため、トークンの送信と保存を処理するためにWeb Workersを使用するのがトークンを保護する最善の方法です。デフォルトのストレージオプションがWeb Workersを活用したメモリ内ストレージであるAuth0 SPA SDKを使用します。

Web Workersを使用できない場合、Auth0では、代わりに[JavaScriptクロージャ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures#Emulating_private_methods_with_closures)を使用してプライベートメソッドをエミュレートすることを推奨しています。

デフォルトのストレージオプションがメモリ内ストレージであるAuth0 SPA SDKを使用して、トークンの種類に応じてWeb WorkersとJavaScriptクロージャの両方を活用します。



### ブラウザーローカルストレージのシナリオ

ブラウザーローカルストレージの使用は、iframeからアクセス トークンを取得する必要があるメカニズムや、ブラウザーの制限（ITP2など）によりドメイン間でCookieベースの認証が不可能な場合に、有効な代替手段となります。



SPAが暗黙的（代わりにPKCEを使用した認証コードフローの使用を推奨）またはハイブリッドフローを使用している場合、セキュリティリスクを軽減するために、絶対トークン有効期限を短縮できます。これにより、反映されたXSS攻撃の影響が軽減されます（ただし、永続的な攻撃の影響は軽減されません）。有効期限を短縮するには、**ダッシュボード > API > Settings（設定） > Token Expiration For Browser Flows (Seconds)（ブラウザーフローのトークン有効期限切れ（秒））**に移動します。

ドメイン外のソースから含まれるサードパーティJavaScriptコードの量を必要最小限に減らします（jQuery、Bootstrap、Google Analytics へのリンクなど）。サードパーティのJSコードを減らすと、XSS脆弱性の可能性が減ります。可能な場合は、サードパーティスクリプトで[サブリソース整合性（SRI）](https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity)チェックを実行して、取得されたリソースが予期しない操作なしで配信されていることを確認すると、より安全になります。