---
og:description: Describes how to install, use and configure options for the Guardian.swift
  iOS SDK.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Guardian.swift iOS SDK
og:url: https://auth0.com/docs/
permalink: guardian-for-ios-sdk
title: Guardian.swift iOS SDK
twitter:description: Describes how to install, use and configure options for the Guardian.swift
  iOS SDK.
twitter:title: Guardian.swift iOS SDK
---

[Guardian.swift](https://github.com/auth0/Guardian.swift) allows you to integrate Auth0's Guardian multi-factor service in your own iOS app, transforming it into the second factor itself. Your users will get all the benefits of our frictionless <Tooltip tip="Multi-factor authentication (MFA): User authentication process that uses a factor in addition to username and password such as a code via SMS." cta="View Glossary" href="/docs/glossary?term=multi-factor+authentication">multi-factor authentication</Tooltip> from your app. To learn more, read [Getting Started with Apple Push Notification Service](/docs/secure/multi-factor-authentication/multi-factor-authentication-factors/configure-push-notifications-for-mfa#configure-push-notifications-for-apple-using-apn-).

## 要件

* Guardianを使用するにはiOS 10+とSwift 4.1が必要です。
* To use this SDK you have to configure your tenant's Guardian service with your own push notification credentials, otherwise, you would not receive any push notifications. To learn more, read [Configure Push Notifications for MFA](/docs/secure/multi-factor-authentication/multi-factor-authentication-factors/configure-push-notifications-for-mfa).

## Guardian iOS SDKをインストールする

### CocoaPods

Guardian.swift is available through [CocoaPods](http://cocoapods.org). To install it, add the following line to your Podfile:

```bash lines
pod 'Guardian', '~> 1.1.0'
```






### Carthage

以下の行をCartfileに追加します。

```bash lines
github "auth0/Guardian.swift" ~> 1.1.0
```






## Guardianプッシュ通知を有効にする

1. Go to [Dashboard > Security > Multi-factor Auth](https://manage.auth0.com/#/guardian).
2. Toggle **Push Notification** on to enable it.
3. [Configure push notifications](/docs/secure/multi-factor-authentication/multi-factor-authentication-factors/configure-push-notifications-for-mfa#configure-push-notifications-for-apple-using-apn-).

## Usage（使用）

`Guardian` is the core of the SDK. To use the SDK, import the library:

```swift lines
import Guardian
```



Set the domain for your tenant. Or, use the <Tooltip tip="Custom Domain: Third-party domain with a specialized, or vanity, name." cta="View Glossary" href="/docs/glossary?term=custom+domain">custom domain</Tooltip> if you configured one for your tenant:

```swift lines
let domain = "<tenant>.<region>.auth0.com"
```






### 登録

An enrollment is a link between the second factor and an Auth0 account. When an account is enrolled you'll need it to provide the second factor required to verify the identity. If your app is not yet using push notifications or you're not familiar with it, see [Apple Push Notification Service Overview](https://developer.apple.com/go/?id=push-notifications) for details.

登録には、テナントのドメイン以外に以下の情報が必要です。

<table class="table"><thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enrollment URI</strong></td>
<td>Value encoded in the QR code scanned from Guardian Web Widget or your enrollment ticket sent to you in email or SMS.</td>
</tr>
<tr>
<td><strong>APNS Token</strong></td>
<td>Apple APNS token for the device. It must be a string containing the 64 bytes (in hexidecimal format).</td>
</tr>
<tr>
<td><strong>Key Pair</strong></td>
<td>An RSA (private/public) key pair used to assert your identity with Auth0 Guardian.</td>
</tr>
</tbody>
</table>

情報を入手した後、デバイスを登録できます。

```swift lines
Guardian
        .enroll(forDomain: "{yourTenantDomain}",
                usingUri: "{enrollmentUri}",
                notificationToken: "{apnsToken}",
                signingKey: signingKey,
                verificationKey: verificationKey
                )
        .start { result in
            switch result {
            case .success(let enrolledDevice):
                // success, we have the enrollment device data available
            case .failure(let cause):
                // something failed, check cause to see what went wrong
            }
        }
```






成功すると、登録情報を取得できます。その登録情報は、アプリケーションにセキュアに保存する必要があります。この情報には、登録識別子と、登録を更新または削除するためにデバイスに関連付けられたGuardian APIのトークンが含まれます。

#### 署名キーと検証キー

Guardian.swiftは、署名鍵を生成するための便利なクラスを提供しています。

```swift lines
let signingKey = try DataRSAPrivateKey.new()
```






このキーはメモリ内にしか存在しません、`データ`表現を取得し、暗号化されたSQLiteDBなどにセキュアに保存できます。

```javascript lines
// Store data
let data = signingKey.data
// perform the storage

// Load from Storage
let loadedKey = try DataRSAPrivateKey(data: data)
```






しかし、iOSキーチェーンに保存したいだけなら、以下の手順で可能です。

```swift wrap lines
let signingKey = try KeychainRSAPrivateKey.new(with: "com.myapp.mytag")
```






上記の例では、キーを作成し、与えられたタグの下に自動的に保存します。それを取得したい場合、タグを使用できます。

```swift wrap lines
let signingKey = try KeychainRSAPrivateKey(tag: "com.myapp.mytag")
```






検証キーは、`SigningKey`から取得できます。以下の例を挙げます。

```swift lines
let verificationKey = try signingKey.verificationKey()
```






### ログイン要求を許可する

登録を行うと、MFAで本人確認が必要になるたびにプッシュ通知が届きます。Guardianは、APNから受信したデータを解析し、使用可能な`Notification`インスタンスを返すメソッドを提供します。

```swift lines
if let notification = Guardian.notification(from: notificationPayload) {
    // we have received a Guardian push notification
}
```






通知インスタンスを取得すると、`allow`メソッドを使用して簡単に認証要求を許可できます。以前に取得した登録済みデバイスからの情報も必要です。複数の登録がある場合、必ず通知と同じ`id`（`enrollmentId`プロパティ）のものを見つける必要があります。

情報があれば、`device`パラメーターはプロトコル`AuthenticatedDevice`を実装しているものとなります。

```swift lines
struct Authenticator: Guardian.AuthenticationDevice {
    let signingKey: SigningKey
    let localIdentifier: String
}
```






ローカル識別子はデバイスのローカルIDであり、デフォルトでは登録`UIDevice.current.identifierForVendor`にあります。次に、以下を呼び出します。

```swift lines
Guardian
        .authentication(forDomain: "{yourTenantDomain}", device: device)
        .allow(notification: notification)
        .start { result in
            switch result {
            case .success:
                // the auth request was successfuly allowed
            case .failure(let cause):
                // something failed, check cause to see what went wrong
            }
        }
```






### ログイン要求を拒否する

認証要求を拒否するには、代わりに`reject`を呼び出します。オプションで拒否の理由を送ることもできます。拒否の理由はGuardianログに表示されます。

```swift lines
Guardian
        .authentication(forDomain: "{yourTenantDomain}", device: device)
        .reject(notification: notification)
        // or reject(notification: notification, withReason: "hacked")
        .start { result in
            switch result {
            case .success:
                // the auth request was successfuly rejected
            case .failure(let cause):
                // something failed, check cause to see what went wrong
            }
        }
```






### 登録解除する

登録を削除したい場合、たとえばMFAを無効にしたい場合は、以下の要求を行います。

```swift lines
Guardian
        .api(forDomain: "{yourTenantDomain}")
        .device(forEnrollmentId: "{userEnrollmentId}", token: "{enrollmentDeviceToken}")
        .delete()
        .start { result in
            switch result {
            case .success:
                // success, the enrollment was deleted
            case .failure(let cause):
                // something failed, check cause to see what went wrong
            }
        }
```






### モバイル専用OTP登録をセットアップする

You can enable one-time passwords (OTP) as an MFA factor using the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> or <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>. This option does not require a QR code and allows users to enroll manually.

To invite a user to enroll, navigate to the [Auth0 Dashboard > User Management > Users](https://manage.auth0.com/#/users) and select a user. Then, access their Details tab and use the Multi-Factor Authentication section to send an enrollment invitation.

#### Connect a resource

リソースは、Auth0 DashboardまたはGuardian SDKを使って接続できます。

##### Auth0 Dashboardの使用

1. Access the Auth0 login prompt and copy the provided code or a similar base32 encoded key obtained from another source. In the next step, you will enter this code into an authentication application.

   <Frame>![An example login prompt displaying a one-time code](/images/cdy7uua7fh8z/1yoqiIuERVTwCU8yfx6IM8/047513dfe1d40a22ce811b131d5ea289/OTP_Challenge_2_-_English.png)</Frame>
2. Add the code you copied to an authentication application, such as Guardian.

##### SDKを使用する

1. Import the Guardian library.

   ```swift lines
   import Guardian
   ```


   

   
2. Create a code generator.

   ```swift lines
   let codeGenerator = try Guardian.totp(

      base32Secret: enrollmentCode,  // Enrollment code entered by user

      algorithm: .sha1			// Algorithm used by TOTP

   )
   ```


   

   
3. Retrieve generated code.

   ```swift lines
   codeGenerator.code()
   ```


   

   

#### Enter one-time code

Auth0ログインプロンプトで、前のステップで生成したコードを入力します。

<Frame>![An example login prompt displaying a one-time code](/images/cdy7uua7fh8z/1yoqiIuERVTwCU8yfx6IM8/047513dfe1d40a22ce811b131d5ea289/OTP_Challenge_2_-_English.png)</Frame>

［Continue（続ける）］を選択すると、アプリケーションがユーザーの認証要素として追加されたことを示すメッセージが表示されます。

#### Log in with your app

要素が登録されると、ユーザーはアプリを使用してログインできるようになります。まず、認証方法としてGuardianアプリを選択します。

<Frame>![The authentication method selection screen](/images/cdy7uua7fh8z/1k7IsU9kfP5mrXU2jfGHuT/d61e0dcd09b633dbeb2cb54e1fd49018/2025-01-27_14-47-32.png)</Frame>

次に、ワンタイムコードをログインプロンプトに入力し、本人確認を行います。

<Frame>![The Verify Your Identity screen prompting the user for a one-time code](/images/cdy7uua7fh8z/S6uTieLjtuNUrQRMh8uch/21f1671d21ae9f61b63154ffaa21b5a2/OTP_Challenge_-_English.png)</Frame>