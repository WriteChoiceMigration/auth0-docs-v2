---
og:description: Learn how to authenticate users using the Resource Owner Password
  Flow with MFA.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: MFAでリソース所有者のパスワードフロー使用して認証する
og:url: https://auth0.com/docs/
permalink: authenticate-using-ropg-flow-with-mfa
title: MFAでリソース所有者のパスワードフロー使用して認証する
twitter:description: Learn how to authenticate users using the Resource Owner Password
  Flow with MFA.
twitter:title: MFAでリソース所有者のパスワードフロー使用して認証する
---

MFAが有効な場合、[Auth0のMFA API](/api/authentication#multi-factor-authentication)は[リソース所有者のパスワードフロー](/login/flows/resource-owner-password-flow)（ROPG：リソース所有者パスワード付与とも呼ばれる）を用いた認証フローで利用することができます。



## ユーザーを認証する

リソース所有者のパスワードフローを用いた認証では、ユーザー名とパスワードを使用して`/oauth/token`エンドポイントを呼び出します。



MFAが有効な場合には、`mfa_required`エラーと`mfa_token`が返されます。



上記のエラーを受信した場合には、ユーザーにMFA要素が登録されているかどうかを確認する必要があります。前のセクションで取得したMFAトークンを使用して、[MFAオーセンティケーターエンドポイント](/mfa/ropg-mfa/manage-authenticator-factors-mfa-api)を呼び出します。

## 登録されているオーセンティケーターを取得する



使用可能なオーセンティケーターの配列が取得できます。ユーザーが要素を登録しなかった場合、配列は空になります。



ユーザーがMFAに登録されていない場合は、上記で取得したMFAトークンを使用し、それをMFA Associateエンドポイントで登録します。認証要素に合わせてこのフローを実装するには、以下のリンクを参照してください。

## MFA要素を登録する

ユーザーがすでにMFAに登録されている場合には、既存の要素の1つを使用してユーザーにチャレンジする必要があります。MFAオーセンティケーターエンドポイントから返された`authenticator_id`を使用して、MFAチャレンジエンドポイントを呼び出します。

* [SMSまたは音声](/mfa/ropg-mfa/enroll-challenge-sms-voice-authenticators)
* [ワンタイムパスワード（OTP）](/mfa/ropg-mfa/enroll-and-challenge-otp-authenticators)
* [プッシュ](/mfa/ropg-mfa/enroll-and-challenge-push-authenticators)
* [メール](/mfa/ropg-mfa/enroll-and-challenge-email-authenticators)

## MFAを使用してユーザーにチャレンジする

チャレンジが完了したら、もう一度`/oauth/token`エンドポイントを呼び出して認証フローを完了させ、認証トークンを取得します。

認証要素に合わせてこのフローを実装するには、以下のリンクを参照してください。

認証要素に合わせてこのフローを実装するには、以下のリンクを参照してください。

* [SMSまたは音声](/mfa/ropg-mfa/enroll-challenge-sms-voice-authenticators)
* [ワンタイムパスワード（OTP）](/mfa/ropg-mfa/enroll-and-challenge-otp-authenticators)
* [プッシュ](/mfa/ropg-mfa/enroll-and-challenge-push-authenticators)
* [メール](/mfa/ropg-mfa/enroll-and-challenge-email-authenticators)

### MFA OTPコードの制限と制約

**有効期間**：MFA OTPコードの有効期限は5分です。この値の構成は変更できません。

**コード検証**：ユーザーがMFA OTPコードを検証すると、そのコードは再度使用できません。

**コード検証のレート制限**：ユーザー検証の試行が失敗すると、バケットアルゴリズムを使用してレート制限が適用されます。バケットは10回の試行から始まり、6分ごとに1回の試行が補充されます。