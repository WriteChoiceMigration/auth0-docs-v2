---
og:description: Learn how to customize Adaptive Multi-Factor Authentication (MFA).
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Adaptive MFAをカスタマイズする
og:url: https://auth0.com/docs/
permalink: customize-adaptive-mfa
title: Adaptive MFAをカスタマイズする
twitter:description: Learn how to customize Adaptive Multi-Factor Authentication (MFA).
twitter:title: Adaptive MFAをカスタマイズする
---

Adaptive MFAは、[Auth0 Actions](/actions)を使用してさまざまなシナリオでカスタマイズできます。

## Adaptive MFAをカスタマイズするタイミング



ユーザーがMFAに登録されていない場合は、Adaptive MFAにデフォルトのポリシーを使用してください。ユーザーがMFAに登録されておらず、アクションが高リスクだと判断した場合、不正者を阻止する方法は限られてしまいます。

Adaptive MFAのカスタマイズを始める前に、ご自身で以下の点を検討してください。

* どの信頼レベルでMFAをトリガーしたいか？
* リスクをどのように測定したいか？
* Auth0で信頼度を測定したいか、それともカスタム測定をしたいか？
* MFAに登録していないユーザーをどのように処理するか？

## 信頼度を評価する

Adaptive MFAは、3つの評価分析に基づいて全体的な信頼スコアを計算します。評価ごとに独自の信頼スコアが設定されています。詳細については、「[Adaptive MFA](/mfa/adaptive-mfa)」をお読みください。

### 信頼スコア

信頼スコアと関連するアクションについては以下に説明します。



### カスタム信頼スコア

さまざまなシナリオの全体的な信頼スコアを評価するために独自のメソッドを実装したい場合は、[riskAssessment](#riskassessment-context-object)オブジェクトにあるデータを使用することができます。

以下の例をお読みいただき、Adaptive MFAがさまざまなユースケースの信頼スコアをどのように計算するか理解してください。

#### 「リスクが高く、信頼度が低い」シナリオの例

下の表は、リスクが高いために信頼スコアが`low`（低）になるシナリオを示しています。



#### 「リスクが低く、信頼度が高い」シナリオの例

下の表は、リスクが低いために信頼スコアが`high`（高）になるシナリオを示しています。



### riskAssessmentオブジェクト

`riskAssessment`オブジェクトには、全体的な信頼スコア、バージョン情報、および各評価の詳細が含まれています。





### assessmentsオブジェクト

`assessments`オブジェクトには、3つの各リスク評価の詳細が含まれています。

1. [NewDevice評価](#newdevice-assessment)
2. [ImpossibleTravel評価](#impossibletravel-assessment)
3. [UntrustedIP評価](#untrustedip-assessment)
4. [PhoneNumber評価](#phonenumber-assessment)

各評価には[信頼スコア](#confidence-scores)、評価結果を説明するコード、およびその他のコンテキスト情報が含まれています。



#### NewDevice評価

`NewDevice`評価では、ユーザーが既知のデバイスからログインしているかどうかを判定し、以下のプロパティが含まれます。



##### NewDevice評価コードのプロパティ

`NewDevice`評価`code`プロパティは以下のいずれかの値に等しくなります。



##### NewDevice評価の詳細オブジェクト

`code`プロパティの値が`match`、`partial_match`、または`no_match`に等しい場合、`NewDevice`評価には以下のプロパティを持つ`details`オブジェクトが含まれます。



#### ImpossibleTravel評価

`ImpossibleTravel`評価では、ユーザーが不可能な移動を示す場所からログインしているかどうかを判定し、以下のプロパティが含まれます。



#### UntrustedIP評価

`UntrustedIP`評価では、ユーザーのIPアドレスがレピュテーションが低いIPアドレス（「拒否リスト」）のAuth0のリポジトリに存在するかどうかを判定し、以下のプロパティが含まれます。



##### UntrustedIP評価の詳細オブジェクト

`UntrustedIP`評価の`code`プロパティの値が`found_on_deny_list`に等しい場合、`details`オブジェクトは存在し、以下のプロパティが含まれます。



##### UntrustedIP評価の詳細オブジェクトカテゴリのプロパティ

`UntrustedIP`評価の`details`オブジェクト`category`のプロパティでは、Adaptive MFAが特定のIPアドレスを信用できないものとみなす一般的な理由を説明し、以下のいずれかの値に等しくなります。



#### PhoneNumber評価

`PhoneNumber`評価では、送られてくるトランザクションに指定された電話番号のリスクを判定し、以下のプロパティが含まれます。



##### PhoneNumber評価の詳細オブジェクト

`PhoneNumber`評価の`details`オブジェクトには、以下のプロパティが含まれます。



## アクションの結果



いずれかのアクションが信頼スコアに基づいてMFAをトリガーする場合、デフォルトのAdaptive MFAポリシーは、信頼スコアが`low`（低）のときにMFAをトリガーします。

下の表は、アクションとデフォルトのAdaptive MFAポリシーアクションの組み合わせに基づいて考えられる結果を示しています。



## Actionテンプレート

Auth0には、Adaptive MFAに基づいて、[Adaptive MFA](#adaptive-mfa)と[Require MFA Enrollment（MFA登録を必須にする）](#require-mfa-enrollment)という2つのカスタマイズ可能なテンプレートが用意されています。

### Adaptive MFAテンプレート

このテンプレートは例として、個々のリスク評価を使ってカスタムビジネスフローを構築する方法の始点を提供します。



### Require MFA Enrollmentテンプレート

このテンプレートは、標準またはAdaptive MFAポリシーを使うときに、MFA登録をどのように強制できるかを示しています。ここでは、`event.user.multifactor`を使ってユーザーがMFAに登録しているかどうかを確認し、登録していない場合は、登録するよう促します。



## Actionのユースケース

ユースケースに基づいてカスタムアクションを構築する方法に関する提案をご紹介します。

### 全体的な信頼スコアがXの場合にアクションを実行する

`riskAssessment.confidence`プロパティを評価してから、`high`、`medium`、または`low`といった定数と比較します。



### 信頼スコアがX以上またはX以下である場合にアクションを実行する

信頼スコアは範囲でなく不連続の値です。そのため、比較演算子（`<`や`>`など）を使って複数の値を1つの状況で評価することはできません。

複数の状況を使って、処理したいすべての信頼スコアを論理的に組み合わせます。たとえば、信頼スコアが`low`より大きいかどうかを知りたい場合は、`medium`または`high`に等しいかどうかを確認します。



### 全体的な信頼スコアがXの場合に追加の詳細を取得する

`riskAssessment`オブジェクトはテナントログに保存されています。ログエントリーを表示し、リスク評価スコアと決定的な要因（理由）を確認します。

`riskAssessment`オブジェクトを表示し、結果を別の場所で報告します。たとえば、メールを送信したり、レコードを外部データベースに保存したりできます。



### 特定の評価に特定の結果が含まれている場合にアクションを実行する

[assessments](#assessments-object)オブジェクト（`code`プロパティなど）を使って各評価の詳細にアクセスします。



### カスタムの全体的な信頼スコアの評価を集約する

[assessments](#assessments-object)オブジェクトを使って各評価の詳細にアクセスしてから、`confidence`プロパティ、`code`プロパティ、またはその両方を使用します。

カスタム信頼スコアの詳細については、「[カスタム信頼スコア](#custom-confidence-scoring)」をお読みください。

### 特定の評価に特定の結果が含まれている場合は、現在のトランザクションをブロックし、エラーとメッセージを返します。

[assessments](#assessments-object)オブジェクト（`code`プロパティなど）を使って各評価の詳細にアクセスします。

`UnauthorizedError`オブジェクトを[エラーパラメーター](/not-found/70zpztJMDHy4q0bwO4Xzgn/error-handling-best-practices)に使用してコールバック関数を返すことで、ログイントランザクションが完了するのをブロックします。`UnauthorizedError`オブジェクトは必ず`error`を`unauthorized`に設定しますが、`error_message`をカスタマイズすることはできます。



これによってユーザーは、`error`および`error_message`パラメーターを含んだアプリケーションのコールバックURLにリダイレクトされます。

### Auth0が評価を実行できない場合に安全に処理する

リスク評価の実行時に何かしらのエラーが発生した場合、Auth0は自動的に`low`信頼レベルを割り当てます。

このシナリオを軽減するには、[assessments](#assessments-object)オブジェクトを使って個々の評価の`code`プロパティを点検し、値が`assessment_not_available`に設定されているかどうかを確認します。