---
og:description: Describes how to build your own MFA flows using one-time password
  (OTP) as an authentication factor.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: OTP Authenticatorの登録とチャレンジ
og:url: https://auth0.com/docs/
permalink: enroll-and-challenge-otp-authenticators
title: OTP Authenticatorの登録とチャレンジ
twitter:description: Describes how to build your own MFA flows using one-time password
  (OTP) as an authentication factor.
twitter:title: OTP Authenticatorの登録とチャレンジ
---





* Dashboardで、または[Management API](/api/management/v2#!/Guardian/put_factors_by_name)を使って、要素として[OTPを構成します](/mfa/mfa-factors/configure-otp-notifications-for-mfa)。

## OTPで登録する



### Authenticatorを登録する



OTPで登録するには、`authenticator_types`パラメーターを`[otp]`に設定します。



成功すると、次のような応答を受け取ります：



「`User is already enrolled（ユーザーは登録済みです）`」というエラーメッセージを受け取った場合、そのユーザーはすでにMFA要素を登録済みです。このユーザーに対して別の要素を関連付ける前に、既存の要素を使ってユーザーにチャレンジする必要があります。



### OTPの登録を確定する

登録を確定するには、エンドユーザーが、前のステップでGoogle AuthenticatorのようなOTP生成アプリケーションから取得したシークレットを入力する必要があります。このシークレットは、`barcode_uri`を使ってQRコードをスキャンするか、OTPアプリケーションで手動でシークレットコードを入力します。QRコードをスキャンできない場合（たとえば、モバイルデバイスから登録している、デスクトップ用OTPアプリケーションを使用しているなど）に備えて、シークレットをテキストで取得する方法を提供する必要があります。

ユーザーがシークレットを入力したら、OTPアプリケーションが6桁のコードを表示し、これをユーザーがアプリケーションに入力します。そうすると、アプリケーションは`POST`要求をOAuthトークンエンドポイントに対して実行し、これに`otp`値を含めます。



呼び出しが成功すると、アクセストークンを含む応答が以下のフォーマットで返されます。



この時点でAuthenticatorは完全に関連付けられ、利用可能な状態で、ユーザー用の認証トークンを取得します。

MFA Authenticatorエンドポイントを呼び出すことで、Authenticatorが確認されているかどうかをいつでも検証できます。Authenticatorが確認されている場合、`active`に返される値は`true`です。

## OTPを使ってチャレンジする

### MFAトークンを取得する

「[リソース所有者のパスワード付与とMFAで認証する](/mfa/ropg-mfa)」で説明されている手順に従ってMFAトークンを取得します。

### 登録されているAuthenticatorを取得する

登録された全Authenticatorの一覧は、MFA Authenticatorエンドポイントを使って表示できます：



以下の形式でAuthenticatorのリストを取得できます。



### 受信したコードを使って認証を完了します。

ユーザーがワンタイムパスワードを収集すると、こちら側でそれを収集します。

OAuth0トークンエンドポイントを使用して、`otp`パラメーターにワンタイムパスワードを指定し、コードを検証して認証トークンを取得します。



呼び出しが成功すると、アクセストークンを含む応答が以下のフォーマットで返されます：