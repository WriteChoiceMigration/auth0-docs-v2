---
og:description: Learn how to customize multi-factor authentication (MFA) pages that
  appear to users with Universal Login branding options.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 多要素認証ページをカスタマイズする
og:url: https://auth0.com/docs/
permalink: customize-mfa
title: 多要素認証ページをカスタマイズする
twitter:description: Learn how to customize multi-factor authentication (MFA) pages
  that appear to users with Universal Login branding options.
twitter:title: 多要素認証ページをカスタマイズする
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

These customizations do not apply to Duo, which has its own user interface.

</Callout>

You can customize the <Tooltip tip="Multi-factor authentication (MFA): User authentication process that uses a factor in addition to username and password such as a code via SMS." cta="View Glossary" href="/docs/glossary?term=MFA">MFA</Tooltip> pages that appear to your users by adjusting the <Tooltip tip="Multi-factor authentication (MFA): User authentication process that uses a factor in addition to username and password such as a code via SMS." cta="View Glossary" href="/docs/glossary?term=Universal+Login">Universal Login</Tooltip> branding options in the [Universal Login Settings](https://manage.auth0.com/#/login_settings) section of the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>.

ユニバーサル ログイン エクスペリエンスを使用している場合は、フローのカスタマイズ オプションを使用してページをカスタマイズできます。

You can also customize the full HTML content to reflect your organization's particular user experience requirements. To learn more, read [MFA Widget Theme Options](/docs/secure/multi-factor-authentication/customize-mfa/mfa-widget-theme-options).

ユニバーサル ログイン エクスペリエンスにより、MFA がユーザーにとってさらにシンプルに提供されます。ユーザーがログイン画面に資格情報を入力すると、MFA画面が表示されます。MFA要素を登録していない場合は登録が要求され、登録済みの場合はMFA資格情報の提示が要求されます。

## MFA APIを使用する

Auth0 provides an [MFA API](/docs/secure/multi-factor-authentication/multi-factor-authentication-developer-resources/mfa-api) for the following scenarios:

* [Authenticate users with the Resource Owner Password Grant](/docs/secure/multi-factor-authentication/authenticate-using-ropg-flow-with-mfa).
* Build an interface to [let users manage their own authentication factors](/docs/secure/multi-factor-authentication/manage-mfa-auth0-apis/manage-authenticator-factors-mfa-api).
* Invite users to enroll in MFA using [enrollment tickets](/docs/secure/multi-factor-authentication/multi-factor-authentication-developer-resources/create-custom-enrollment-tickets).

MFA APIを使用するには、アプリケーションに対してMFAの付与タイプを有効にしなければなりません。Auth0 DashboardでMFA付与を有効にするには、以下を行います。

1. Go to [Dashboard > Applications > Applications](https://manage.auth0.com/#/applications) and select your application.
2. At the bottom of the **Settings** tab, click **Advanced Settings**.
3. Click the **Grant Types** tab and select **MFA**.

   <Frame>![Dashboard Applications Applications Advanced Settings Grant Types tab](/images/cdy7uua7fh8z/3knG7flXhvUi0b2yhH0JEp/007e84fe56a9828ea59e9d06e0516d34/Screen_Shot_2021-05-18_at_2.24.26_PM.png)</Frame>

   To learn more, read [Enable Multi-Factor Authentication](/docs/secure/multi-factor-authentication/enable-mfa).
4. Click **Save Changes**.

### 制限事項

MFA APIは、SMS、Guardianアプリケーションのプッシュ通知、メール、OTP要素と連動するように設計されています。Duoでの登録には対応していません。

## Actionsを使ってMFAポリシーをカスタマイズする

Actionsを使ってテナント向けのMFAポリシーをカスタマイズし、特定のアプリケーションのユーザーや、特定のユーザーメタデータまたはIPアドレス範囲を持つユーザーなどを対象にMFAを要求することができます。

If you're unfamiliar with creating Actions, read [Write Your First Action](/docs/customize/actions/write-your-first-action).

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Any and all MFA-related behavior defined in Actions take precedence over the **Define policy** settings configured in the **Multi-Factor Auth** section of the Dashboard.

To learn more, read [Enable Multi-Factor Authentication](/docs/secure/multi-factor-authentication/enable-mfa).

</Callout>

アクションを作成するときに、`プロバイダー`設定を使用して、MFAの強制の有無および使用する要素を指定できます。動作は、クラシック ログイン エクスペリエンスを使用するか、ユニバーサル ログイン エクスペリエンスを使用するかによって異なります。

<table class="table"><thead>
<tr>
<th>Provider</th>
<th>Classic Experience</th>
<th>New Experience</th>
</tr>
</thead>
<tbody>
<tr>
<td>any</td>
<td>Push, SMS, or OTP</td>
<td>Push, SMS, Voice, OTP, Email, or WebAuthN security key (when enabled)</td>
</tr>
<tr>
<td>guardian</td>
<td>Push, SMS, or OTP</td>
<td>Push, SMS, OTP, or Email</td>
</tr>
<tr>
<td>google-authenticator</td>
<td>Google Authenticator</td>
<td>Push, SMS, OTP, or Email</td>
</tr>
<tr>
<td>duo</td>
<td>Duo</td>
<td>Duo</td>
</tr>
</tbody>
</table>

ユニバーサル ログインを使用している場合は、MFA ログイン ページのカスタマイズを有効にすると、クラシック ログイン エクスペリエンスの動作を実現できます。

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

The `guardian` and `google-authenticator` options are legacy settings that are kept for backward compatibility reasons, and should not be used moving forward. We recommend using `any` instead. The `google-authenticator` option does not let users enroll a recovery code.

</Callout>

一般的なユースケースの例

```js lines
exports.onExecutePostLogin = async (event, api) => {
    // Forcing the provider to Duo programmatically
    api.multifactor.enable('duo')
}
```






## ここでは、Actionsで処理できる一般的なMFAシナリオをいくつかご紹介します。

特定のアプリケーションにMFAを要求する

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

To ensure that your tenant triggers MFA only when you explicitly require it in your Actions, set your tenant's default MFA policy to **Never**.

For more information, read the "Policies" section in [Multi-Factor Authentication Factors](/docs/secure/multi-factor-authentication/multi-factor-authentication-factors#policies).

</Callout>

### MFAをカスタマイズして、ユーザーが特定のアプリケーションにログインするときのみトリガーされるようにします。

特定のユーザーにMFAを要求する

```js lines
exports.onExecutePostLogin = async (event, api) => {
	const CLIENTS_WITH_MFA = [
		'{yourClientId1}', 
		'{yourClientId2}',
		'{yourClientId3}'
	];

	if (CLIENTS_WITH_MFA.includes(event.client.client_id)) {
		api.multifactor.enable('duo', { allowRememberBrowser: false })
	}
}
```






### MFAをカスタマイズして、MFAを使用するようマークされたユーザーに対してのみ、トリガーされるようにします。

MFAプロンプトの頻度を変更する

```js lines
exports.onExecutePostLogin = async (event, api) => {
  if (event.user.user_metadata && event.user.user_metadata.use_mfa) {
    api.multifactor.enable('duo', { allowRememberBrowser: false });
  }
}
```






### 状況によっては、同じブラウザーを使ってログインしているユーザーに対し、毎回MFAを求めるプロンプトを表示したくないことがあります。`allowRememberBrowser` プロパティを使用してこの動作を変更できます:

プロパティの値に応じて、以下のような動作になります。

```js lines
exports.onExecutePostLogin = async (event, api) => {  
  api.multifactor.enable('any', { allowRememberBrowser: false });
}
```






時間の値はアクティブなユーザー用です。ユーザーが 7 日間以上非アクティブの場合、Cookie は期限切れとなり、次回のログイン試行時に MFA の入力を求められます (`allowRememberBrowser` が `true` に設定されていて、最後の MFA プロンプトから 30 日が経過していないかどうかに関係なく)。

<table class="table"><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>true</code></td>
<td>When provider is set to <code>google-authenticator</code> or <code>duo</code>, the user is prompted for MFA once every 30 days. When provider is set to <code>guardian</code>, the MFA prompt displays the enrollment checkbox for users to choose whether or not to enroll. Defaults to <code>false</code>. To learn more, read <a href="/docs/secure/multi-factor-authentication/customize-mfa ">Customize Multi-Factor Authentication Pages </a></td>
</tr>
<tr>
<td><code>false</code></td>
<td>The user is prompted for MFA each time they authenticate.</td>
</tr>
</tbody>
</table>

ユーザーにMFAのスキップを許可した場合、ユーザーのブラウザーにCookieが保管されます。ユーザーがCookieのセットを持っている場合でもMFAを要求するには、次の2つのオプションがあります。

`allowRememberBrowser` を `false` に設定します

* `/authorize` エンドポイントを呼び出す際に、`acr_values` を`
* Set `acr_values` to `http://schemas.openid.net/pape/policies/2007/06/multi-factor` when calling the `/authorize` endpoint.

In situations where a user loses a trusted device, you can prompt the specific user for MFA during their next login by calling the Auth0 <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip> [Invalidate Remember Browser](https://auth0.com/docs/api/management/v2#!/Users/post_invalidate_remember_browser) endpoint.

### 内部IPアドレスのネットワークについてはアクセスが適切に制御されていると仮定した場合、企業ネットワークの外から要求を送信してくるユーザーにのみ、Auth0がMFAを要求するようにできます。

リフレッシュトークンの要求でMFAをバイパスする

```js lines
exports.onExecutePostLogin = async (event, api) => {
  const ipaddr = require('ipaddr.js@1.9.0');
  const corp_network = '192.168.1.134/26';
  const current_ip = ipaddr.parse(event.request.ip);

  if (!current_ip.match(ipaddr.parseCIDR(corp_network))) {
    api.multifactor.enable('any', {allowRememberBrowser: false});
  }
}
```






### ユーザーによる頻繁なログアウトが報告された場合は、MFAを使用しながらもリフレッシュトークンの要求をバイパスすることができます。`event.transaction.protocol` オブジェクト プロパティのフィルター アクションを使用して、デフォルトの動作を変更できます。

If your users report frequent log-outs, you may need to bypass <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=refresh+token">refresh token</Tooltip> requests while using MFA. You can alter the default behavior with a filter Action on the `event.transaction.protocol` object property.

```js lines
exports.onExecutePostLogin = async (event, api) => {
  if (event.transaction.protocol !== 'oauth2-refresh-token') {
    // MFA-related commands here
    api.multifactor.enable('any');
  }
};
```






To learn more about the Action `event` object, read [Actions Triggers: post-login - Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/post-login-event-object).

## Learn more

* [Customize MFA for Classic Login](/docs/secure/multi-factor-authentication/customize-mfa/customize-mfa-classic-login)
* [Authenticate Using the Resource Owner Password Flow with MFA](/docs/secure/multi-factor-authentication/authenticate-using-ropg-flow-with-mfa)
* [Auth0 MFA API](/docs/secure/multi-factor-authentication/multi-factor-authentication-developer-resources/mfa-api)
* [Manage Authentication Factors with Authentication API](/docs/secure/multi-factor-authentication/manage-mfa-auth0-apis/manage-authenticator-factors-mfa-api)
* [MFA Widget Theme Options](/docs/secure/multi-factor-authentication/customize-mfa/mfa-widget-theme-options)
* [MFA Theme Language Dictionary](/docs/secure/multi-factor-authentication/customize-mfa/mfa-theme-language-dictionary)