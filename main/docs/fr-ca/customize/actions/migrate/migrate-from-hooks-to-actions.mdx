---
og:description: Learn how to migrate your existing Auth0 Hooks code to Auth0 Actions
  code.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Migrer des Hooks vers les Actions
og:url: https://auth0.com/docs/
permalink: migrate-from-hooks-to-actions
title: Migrer des Hooks vers les Actions
twitter:description: Learn how to migrate your existing Auth0 Hooks code to Auth0
  Actions code.
twitter:title: Migrer des Hooks vers les Actions
---

Lorsque vous convertissez des Hooks existants en Actions, vous devez associer la nouvelle Action au Déclencheur correspondant au type du hook. Si vous suivez les étapes ci-dessous et que vous utilisez les mappages que nous avons identifiés, la fonctionnalité devrait être identique.

## Planifier votre migration

Les Actions déployées s’exécutent après les Hooks actifs, ce qui vous permet de convertir les Hooks un par un dans le Dashboard ou tous en même temps à l’aide de Management API.

Vous devrez convertir le code, puis activer l’action et désactiver le hook. Il est possible d’activer l’action et de désactiver le hook rapidement l’une après l’autre, mais en fonction de l’ordre, un court laps de temps peut s’écouler pendant lequel l’une ou l’autre des actions ou aucune d’entre elles n’est en cours d’exécution.

Pour cette raison, nous vous recommandons de migrer votre pipeline étape par étape : convertissez des éléments de votre code Hooks en code Action, testez dans un environnement de préproduction, puis passez à la production avec un élément à la fois. Comme les Hooks actifs s’exécutent préalablement aux Actions déployées, vous pouvez conserver une partie de la logique dans les Hooks pendant que vous élaborez et testez d’autres logiques dans les Actions.



## Comprendre les limites

Bien que les Actions puissent gérer la grande majorité des tâches effectuées par les Hooks, vous devez être conscient de certaines limites avant de commencer votre migration. (Rappelez-vous : les Hooks et les Actions peuvent être en cours d’exécution pendant la migration).

* Les Actions ne peuvent pas conserver les données, comme les jetons d’accès ou les réponses d’API, entre les exécutions.
* Les actions ne sont pas fournies avec [un jeton d’accès à Management API](https://auth0.com/docs/customize/rules/use-management-api) ou [d’accès à l’objet `auth0` global](https://auth0.com/docs/best-practices/rules-best-practices/rules-environment-best-practices#global-object) comme pour les Hooks.

Pour obtenir la liste complète des limitations, veuillez consulter la section [Limitations des actions](/actions/limitations).

## Conversion du code

Pour convertir un Hook en Action, vous devez remplacer le code spécifique à le Hook par le code de l’Action. Cette section couvre les tâches que vous devrez effectuer pour transformer un Hook fonctionnel en Action équivalente.



### Copier le code du hook dans une nouvelle action



1. Connectez-vous à votre locataire de production et copiez le code du hook que vous souhaitez convertir.
2. Passez à un locataire hors production et accédez à [Auth0 Dashboard > Actions > Bibliothèque](%24%7Bmanage_url%7D/select-tenant?path=/actions/library).
3. Sélectionner **Construire une action personnalisée**, puis :

* Saisissez un **Nom** pour votre action qui correspond au nom du Hook que vous convertissez.
* Accédez à **Déclencheur** et sélectionnez le déclencheur approprié **:
**
* Accédez à **Durée d’exécution**, et sélectionnez **Node 18.**
* Sélectionnez **Créer**.
4. Dans le bloc de code de l’éditeur de code d’actions, collez le code du hook que vous souhaitez convertir sous la fonction exportée.
5. Apportez les modifications détaillées dans la suite de cet article à mesure que vous déplacez le code dans la fonction.

Il est également recommandé de consulter l’objet `event` associé au nouveau déclencheur d’actions. Vous trouverez des liens vers la documentation correspondante lorsque vous atteindrez la section [Modifier l’accès aux données](#change-how-data-is-accessed), plus loin dans ce guide.

### Modifier la déclaration de fonction

Les fonctions du hook sont exportées à l’aide de l’export par défaut, tandis que les fonctions d’action utilisent des exports nommés. L’export nommé change en fonction du type de hook que vous convertissez. Le mappage est le suivant :



**Avant**

****

**Après**

****

### Convertir les dépendances

Les Hooks et les Actions gèrent les dépendances de la même manière. Dans les deux cas, les dépendances sont ajoutées séparément via l’interface utilisateur ou Management API et incluses dans le code. Avec les deux, vous pouvez également demander n’importe quel package disponible dans le registre `npm`.

********

1. Rechercher les déclarations `require` à l’intérieur de votre code du Hook.
2. Supprimez les numéros de version, après les avoir notés.
3. Ajoutez la dépendance en suivant les étapes de la section « Ajouter une dépendance » de [Programmer votre première Action](/actions/write-your-first-action) (si la dépendance n’est pas une [module de base NodeJS](https://github.com/nodejs/node/tree/master/lib); si la dépendance est un module NodeJS de base, vous n’avez pas besoin de l’inclure).
4. Déplacez les déclarations `require` que vous avez trouvées en dehors de la déclaration `function`.

### Convertir les secrets

Les Hooks et les Actions traitent les secrets de la même manière. Dans les deux cas, les secrets sont ajoutés par Hook/Action via l’interface utilisateur ou Management API et inclus dans le code.

Pour convertir les secrets des Hooks en Actions :

1. Enregistrez les valeurs nécessaires à l’action spécifique sur laquelle vous travaillez.
2. Ajoutez un secret pour chaque valeur à laquelle vous devez accéder à l’intérieur de l’action. Pour en savoir plus, consultez la section **Ajouter un secret** dans [Programmer votre première Action](/actions/write-your-first-action).
3. Convertir votre code :

**Avant**

********

**Après**

****

Comme pour les Hooks, Auth0 chiffre toutes les valeurs secrètes au repos.

### Modifier l’accès aux données

Avec les Hooks, les données concernant l’utilisateur, le client, la requête et d’autres données contextuelles sont stockées dans plusieurs arguments transmis à la fonction hook. Dans les actions, ces données ont été remodelées et déplacées vers l’objet `event`. De nombreuses propriétés ont été transférées telles quelles, tandis que d’autres ont été combinées pour plus de clarté.

Selon le type du Hook que vous convertissez, l’objet `event` changera :

* [Échange d’identifiants clients - Objet d’événement d’action](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)
* [Objet d’événement d’actions post-modification du mot de passe](/actions/explore-triggers/post-change-password-trigger/post-change-password-event-object)
* [Objet d’événement d’actions post-inscription de l’utilisateur](/signup-and-login-triggers/post-user-registration-trigger/post-user-registration-event-object)
* [Objet d’événement d’actions pré-inscription](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)
* [Envoi de message téléphonique - Objet d’événement d’action](/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object)

**Avant**

********

**Après**

********

********

### Convertir les rappels

Lorsqu’un Hook a terminé son traitement, il doit appeler la fonction `Callback()` pour terminer son exécution. À l’inverse, les Actions n’utilisent pas de mécanisme de Callback; par conséquent, vous devrez supprimer toutes les instances `Callback()` de votre fonction Actions.

Si vous utilisiez auparavant la fonction `Callback()` dans un échange d’informations d’identification client ou un Hook de pré-enregistrement d’utilisateur pour faire échouer la demande ou mettre à jour un utilisateur, vous pourrez toujours le faire dans Actions via une nouvelle interface `api`.

#### Échange d’identifiants clients

Si vous avez ajouté des demandes supplémentaires au jeton d’accès lors d’un hook d’échange d’identifiants clients :



Vous pouvez désormais utiliser les actions [Objet API Échange d’identifiants clients](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object) :



#### Pré-enregistrement de l’utilisateur

Si vous avez ajouté des revendications supplémentaires au jeton d’accès lors d’un Hook de pré-enregistrement d’utilisateur :



Vous pouvez désormais utiliser le [Objet API Pré-enregistrement de l’utilisateur](/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object) :



## Achever la migration

Une fois que votre nouveau code d’action a été écrit et testé, vous devez activer l’action et désactiver le Hook. Vous pouvez effectuer ces deux tâches rapidement l’une après l’autre, mais en fonction de l’ordre, il se peut qu’il y ait un court laps de temps pendant lequel l’une ou l’autre ou aucune des deux actions n’est en cours d’exécution. Comme les Hooks actifs s’exécutent préalablement aux Actions déployées, vous pouvez conserver une partie de la logique dans les Règles pendant que vous élaborez et testez d’autres logiques dans les Actions.