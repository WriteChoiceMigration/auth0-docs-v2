---
og:description: Learn how to migrate your existing Auth0 Hooks code to Auth0 Actions
  code.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Migrer des Hooks vers les Actions
og:url: https://auth0.com/docs/
permalink: migrate-from-hooks-to-actions
title: Migrer des Hooks vers les Actions
twitter:description: Learn how to migrate your existing Auth0 Hooks code to Auth0
  Actions code.
twitter:title: Migrer des Hooks vers les Actions
---

Lorsque vous convertissez des Hooks existants en Actions, vous devez associer la nouvelle Action au Déclencheur correspondant au type du hook. Si vous suivez les étapes ci-dessous et que vous utilisez les mappages que nous avons identifiés, la fonctionnalité devrait être identique.

## Planifier votre migration

Deployed Actions run after active Hooks, so you can either convert Hooks one at a time in the Dashboard or all at once using the <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>.

Vous devrez convertir le code, puis activer l’action et désactiver le hook. Il est possible d’activer l’action et de désactiver le hook rapidement l’une après l’autre, mais en fonction de l’ordre, un court laps de temps peut s’écouler pendant lequel l’une ou l’autre des actions ou aucune d’entre elles n’est en cours d’exécution.

Pour cette raison, nous vous recommandons de migrer votre pipeline étape par étape : convertissez des éléments de votre code Hooks en code Action, testez dans un environnement de préproduction, puis passez à la production avec un élément à la fois. Comme les Hooks actifs s’exécutent préalablement aux Actions déployées, vous pouvez conserver une partie de la logique dans les Hooks pendant que vous élaborez et testez d’autres logiques dans les Actions.

<Card title="Tips when planning your migration">

* Use flags to avoid duplicating expensive or one-time operations.
* Make sure to run changes at a time when impact and traffic will be lowest.
* Consider using the [Auth0 Deploy CLI](/docs/deploy-monitor/deploy-cli-tool) to script, test, and quickly implement the migration all at once or iteratively.

</Card>

## Comprendre les limites

Bien que les Actions puissent gérer la grande majorité des tâches effectuées par les Hooks, vous devez être conscient de certaines limites avant de commencer votre migration. (Rappelez-vous : les Hooks et les Actions peuvent être en cours d’exécution pendant la migration).

* Actions cannot persist data, like <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+tokens">access tokens</Tooltip> or API responses, across executions.
* Actions are not provided with [an access token for the Management API](/docs/customize/rules/use-management-api) or [access to the global `auth0` object](/docs/customize/actions/action-coding-guidelines#global-object) as in Hooks.

For the full list of limitations, see [Actions Limitations](/docs/customize/actions/limitations).

## Conversion du code

Pour convertir un Hook en Action, vous devez remplacer le code spécifique à le Hook par le code de l’Action. Cette section couvre les tâches que vous devrez effectuer pour transformer un Hook fonctionnel en Action équivalente.

<Card title="Tips when converting code">

* In general, look for the read-only properties of objects passed into the Hooks function on the Actions `event` object.
* Use the Actions Code Editor in the Auth0 Dashboard to write your code; it will help by highlighting errors and supplying auto-complete suggestions.
* Before you go live, thoroughly [test your new Actions](/docs/customize/actions/test-actions) in a [staging or test environment](/docs/get-started/auth0-overview/create-tenants/set-up-multiple-environments).

</Card>

### Copier le code du hook dans une nouvelle action

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

We recommend copying your Hook code into a new Action and using the Actions Code Editor in the Auth0 Dashboard; it will help you identify outstanding issues with your code.

</Callout>

1. Log in to your production tenant, and copy the code from the Hook you want to convert.
2. Switch to a non-production tenant, and navigate to [Auth0 Dashboard > Actions > Library](https://manage.auth0.com/#/select-tenant?path=/actions/library).
3. Select **Build Custom**, then:

   * Saisissez un **Nom** pour votre action qui correspond au nom du Hook que vous convertissez.
   * Locate **Trigger**, and select the appropriate trigger**:**

		<table class="table"><thead>
		<tr>
		<th>Type of Hook</th>
		<th>Actions Trigger</th>
		</tr>
		</thead>
		<tbody>
		<tr>
		<td>Client Credentials Exchange</td>
		<td>M2M/Client-Credentials</td>
		</tr>
		<tr>
		<td>Pre-User-Registration</td>
		<td>Pre User Registration</td>
		</tr>
		<tr>
		<td>Post-User-Registration</td>
		<td>Post User Registration</td>
		</tr>
		<tr>
		<td>Post-Change-Password</td>
		<td>Post Change Password</td>
		</tr>
		<tr>
		<td>Send Phone Message</td>
		<td>Send Phone Message</td>
		</tr>
		</tbody>
		</table>
		
   * Accédez à **Durée d’exécution**, et sélectionnez **Node 18.**
   * Sélectionnez **Créer**.
4. In the code block of the Actions Code Editor, paste the Hook code you want to convert below the exported function.
5. Make the changes detailed in the rest of this article as you move the code into the function.
   Il est également recommandé de consulter l’objet `event` associé au nouveau déclencheur d’actions. Vous trouverez des liens vers la documentation correspondante lorsque vous atteindrez la section [Modifier l’accès aux données](#change-how-data-is-accessed), plus loin dans ce guide.

### Modifier la déclaration de fonction

Les fonctions du hook sont exportées à l’aide de l’export par défaut, tandis que les fonctions d’action utilisent des exports nommés. L’export nommé change en fonction du type de hook que vous convertissez. Le mappage est le suivant :

<table class="table"><thead>
<tr>
<th>Type of Hook</th>
<th>Named Export</th>
</tr>
</thead>
<tbody>
<tr>
<td>Client Credentials Exchange</td>
<td><code>onExecuteCredentialsExchange</code></td>
</tr>
<tr>
<td>Pre-User Registration</td>
<td><code>onExecutePreUserRegistration</code></td>
</tr>
<tr>
<td>Post-User Registration</td>
<td><code>onExecutePostUserRegistration</code></td>
</tr>
<tr>
<td>Post-Change Password</td>
<td><code>onExecutePostChangePassword</code></td>
</tr>
<tr>
<td>Send Phone Message</td>
<td><code>onExecuteSendPhoneMessage</code></td>
</tr>
</tbody>
</table>

Si vous utilisiez auparavant la fonction `Callback()` dans un échange d’informations d’identification client ou un Hook de pré-enregistrement d’utilisateur pour faire échouer la demande ou mettre à jour un utilisateur, vous pourrez toujours le faire dans Actions via une nouvelle interface `api`.

```javascript lines
module.exports = async function myHooksFunction(){}
```






**After**

```javascript lines
// Pré-enregistrement de l’utilisateur
exports.onExecuteCredentialsExchange = async (event, api) => {}

// Pre-User Registration
exports.onExecutePreUserRegistration = async (event, api) => {}

// Post-User Registration
exports.onExecutePostUserRegistration = async (event) => {}

// Post-Change Password
exports.onExecutePostChangePassword = async (event) => {}

// Send Phone Message
exports.onExecuteSendPhoneMessage = async (event) => {}
```






### Les Hooks et les Actions gèrent les dépendances de la même manière. Dans les deux cas, les dépendances sont ajoutées séparément via l’interface utilisateur ou Management API et incluses dans le code. Avec les deux, vous pouvez également demander n’importe quel package disponible dans le registre `npm`.

Convertir les secrets

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

If your `npm` modules are not on the latest version, this is a great time to get up to date!

</Callout>

1. Search for `require` statements inside your Hook code.
2. Remove version numbers, but make a note of them.
3. Add the dependency by following the steps in the "Add a Dependency" section of [Write Your First Action](/docs/customize/actions/write-your-first-action) (if the dependency is not a [core NodeJS module](https://github.com/nodejs/node/tree/master/lib); if the dependency is a core NodeJS module, you do not need to include it).
4. Move the found `require` statements outside of the `function` declaration.

### Les Hooks et les Actions traitent les secrets de la même manière. Dans les deux cas, les secrets sont ajoutés par Hook/Action via l’interface utilisateur ou Management API et inclus dans le code.

Pour convertir les secrets des Hooks en Actions :

Comme pour les Hooks, Auth0 chiffre toutes les valeurs secrètes au repos.

1. Save the values needed for the specific Action you are working on.
2. Add a Secret for each value you need to access from inside the Action. To learn how, read the **Add a Secret** section in [Write Your First Action](/docs/customize/actions/write-your-first-action).
3. Convert your code:

Si vous utilisiez auparavant la fonction `Callback()` dans un échange d’informations d’identification client ou un Hook de pré-enregistrement d’utilisateur pour faire échouer la demande ou mettre à jour un utilisateur, vous pourrez toujours le faire dans Actions via une nouvelle interface `api`.

```javascript lines
async function (user, context, cb) {
    const { SECRET_NAME } = context.webtask.secrets;

    // ... additional code
}
```






**After**

```javascript lines
async (event, api) => {
    const { SECRET_NAME } = event.secrets;

	// ... additional code
};
```






Avec les Hooks, les données concernant l’utilisateur, le client, la requête et d’autres données contextuelles sont stockées dans plusieurs arguments transmis à la fonction hook. Dans les actions, ces données ont été remodelées et déplacées vers l’objet `event`. De nombreuses propriétés ont été transférées telles quelles, tandis que d’autres ont été combinées pour plus de clarté.

### Selon le type du Hook que vous convertissez, l’objet `event` changera :

[Échange d’identifiants clients - Objet d’événement d’action](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)

[Objet d’événement d’actions post-modification du mot de passe](/actions/explore-triggers/post-change-password-trigger/post-change-password-event-object)

* [Client Credentials Exchange - Actions Event Object](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-event-object)
* [Post-Change Password - Actions Event Object](/docs/customize/actions/explore-triggers/password-reset-triggers/post-change-password-trigger/post-change-password-event-object)
* [Post-User Registration - Actions Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/post-user-registration-trigger/post-user-registration-event-object)
* [Pre-User Registration - Actions Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-event-object)
* [Send Phone Message - Actions Event Object](/docs/customize/actions/explore-triggers/mfa-notifications-trigger/send-phone-message-event-object)

Si vous utilisiez auparavant la fonction `Callback()` dans un échange d’informations d’identification client ou un Hook de pré-enregistrement d’utilisateur pour faire échouer la demande ou mettre à jour un utilisateur, vous pourrez toujours le faire dans Actions via une nouvelle interface `api`.

```javascript lines
async function (user, context, cb) {
	const clientId = context.clientID;
	const tenant = context.connection.tenant

	// ... additional code
}
```






**After**

```javascript lines
async (event, api) => {
	const clientId = event.client.client_id;
	const tenant = event.tenant.id;

	// ... additional code
};
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Unlike the Hooks `context` object, data stored on or modified in properties of the `event` object does not persist in subsequent Actions. If your Hook is setting data on these properties to trigger core functionality, you will need to use the `api` interface available in the [Machine to Machine](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object) and [Pre User Registration](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object) Actions Flows to persist data across Actions.

</Callout>

### Échange d’identifiants clients

Si vous avez ajouté des demandes supplémentaires au jeton d’accès lors d’un hook d’échange d’identifiants clients :

Vous pouvez désormais utiliser les actions [Objet API Échange d’identifiants clients](/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object) :

#### Pré-enregistrement de l’utilisateur

Si vous avez ajouté des revendications supplémentaires au jeton d’accès lors d’un Hook de pré-enregistrement d’utilisateur :

```javascript lines
// Pré-enregistrement de l’utilisateur Hook
module.exports = function(client, scope, audience, context, cb) {
  var access_token = {};
  access_token.scope = scope;

  access_token['https://example.com/claim'] = 'bar';
  cb(null, access_token);
};
```






You can now use the Actions [Client Credentials Exchange API Object](/docs/customize/actions/explore-triggers/machine-to-machine-trigger/credentials-exchange-api-object):

```javascript lines
// Pré-enregistrement de l’utilisateur Action
exports.onExecuteCredentialsExchange = async (event, api) => {
  api.accessToken.setCustomClaim("https://example.com/claim", 'bar');  
};
```






#### Achever la migration

Une fois que votre nouveau code d’action a été écrit et testé, vous devez activer l’action et désactiver le Hook. Vous pouvez effectuer ces deux tâches rapidement l’une après l’autre, mais en fonction de l’ordre, il se peut qu’il y ait un court laps de temps pendant lequel l’une ou l’autre ou aucune des deux actions n’est en cours d’exécution. Comme les Hooks actifs s’exécutent préalablement aux Actions déployées, vous pouvez conserver une partie de la logique dans les Règles pendant que vous élaborez et testez d’autres logiques dans les Actions.

```javascript lines
// Achever la migration Hook
module.exports = function (user, context, cb) {
	if (user.app_metadata.condition === "success") {
      var response = {};
      response.user = { user_metadata: { favorite_color: "purple" } };
      // This Hook succeeded, proceed with the next Hook.
	  return callback(null, response);
	}

	if (user.app_metadata.condition === "failure") {
		// This Hook failed, stop the login with an error response.
		return callback(new Error("Failure message"));
	}

	// ... additional code
};
```






You can now use the [Pre User Registration API Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/pre-user-registration-trigger/pre-user-registration-api-object):

```javascript lines
// Achever la migration Action
exports.onExecutePreUserRegistration = async (event, api) => {
	if (event.user.app_metadata.condition === "success") {
		// This Action succeeded, proceed with next Action.
		api.user.setUserMetadata("favorite_color", "purple");
		return;
	}

	if (event.user.app_metadata.condition === "failure") {
		// This Action failed, stop the call with an error response.
		return api.access.deny("Failure message");
	}

	// ... additional code
};
```






## Complete the migration

Once your new Actions code has been written and tested, you must activate the Action and deactivate the Hook. These two tasks can be done quickly in succession, but depending on the order, there might be a short period of time where either both or neither are running. Because active Hooks run before deployed Actions, you can keep some logic in Rules as you build and test other logic in Actions.