---
og:description: How to secure a Google Cloud Endpoints API with Auth0.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Sécuriser Google Cloud Endpoints avec Auth0
og:url: https://auth0.com/docs/
permalink: google-cloud-endpoints
title: Sécuriser Google Cloud Endpoints avec Auth0
twitter:description: How to secure a Google Cloud Endpoints API with Auth0.
twitter:title: Sécuriser Google Cloud Endpoints avec Auth0
---

[Google Cloud Endpoints (GCE)](https://cloud.google.com/endpoints/) est un système de gestion d’API offrant des fonctionnalités pour vous aider à créer, maintenir et sécuriser vos API. GCE utilise [OpenAPI](https://www.openapis.org/) pour définir les points de terminaison, les entrées et les sorties, les erreurs et la description de la sécurité de votre API.

Pour plus d’informations sur la spécification OpenAPI, voir le référentiel de spécification [OpenAPI](https://github.com/OAI/OpenAPI-Specification) sur GitHub.

Ce tutoriel explique comment sécuriser Google Cloud Endpoints avec Auth0.

## Prérequis

Avant de commencer, vous aurez besoin d’une API GCE déployée. Si vous n’avez pas encore créé d’API, suivez le [Guide de démarrage rapide de Cloud Endpoints](https://cloud.google.com/endpoints/docs/quickstart-endpoints) qui se trouve dans la documentation de Google.

Le guide de démarrage rapide vous guidera à travers la création d’une API GCE simple avec un seul point de terminaison, `/airportName`, qui renvoie le nom d’un aéroport à partir de son [code IATA](https://en.wikipedia.org/wiki/IATA_airport_code) de trois lettres.



## Définir l’API dans Auth0

Allez dans [Tableau de bord Auth0 > Applications > API](%24%7Bmanage_url%7D/#/apis), et créez une nouvelle API.

Notez l’identifiant d’**audience de l’API** (`http://google_api`dans la capture d’écran ci-dessus) à utiliser à l’étape suivante.

## Mettre à jour la configuration de l’API

Ensuite, nous mettrons à jour le fichier de configuration OpenAPI pour l’API GCE. Pour l’exemple d’API créé lors du démarrage rapide, ce fichier est `openapi.yaml`.

### Ajouter des définitions de sécurité

Ouvrez le fichier de configuration et ajoutez une nouvelle section `securityDefinitions`. Dans cette section, ajoutez une nouvelle définition (`auth0_jwt`) avec les champs suivants :





### Mettre à jour le point de terminaison

Maintenant, mettez à jour le point de terminaison en ajoutant un champ `security` avec la section `securityDefinition` que nous avons créée à l’étape précédente.



Dans l’exemple ci-dessus, le champ `security` indique au proxy GCE que notre chemin `/airportName` s’attend à être sécurisé avec la définition `auth0-jwt`.

Après la mise à jour de la configuration OpenAPI, elle devrait ressembler à ceci :



### Redéployer l’API

Ensuite, redéployez votre API GCE pour appliquer les changements de configuration. Si vous avez suivi le [Guide de démarrage rapide de Cloud Endpoints](https://cloud.google.com/endpoints/docs/quickstart-endpoints), vous pouvez redéployer l’API en saisissant les éléments suivants dans le Cloud Shell de Google :



## Tester l’API

Une fois que vous avez redéployé l’API, appelez à nouveau l’API sans sécurité.



Vous obtiendrez la réponse suivante :



Et c’est exactement ce que l’on veut!

Accédez maintenant à la page **Test** de la définition de votre API Google Endpoints sur le [Auth0 Dashboard](%24%7Bmanage_url%7D/#/apis) et copiez le jeton d’accès sous la réponse :

Effectuez une demande `GET` à votre API avec un en-tête d’autorisation du `Bearer {ACCESS_TOKEN}` pour obtenir un accès autorisé :



Et voilà!