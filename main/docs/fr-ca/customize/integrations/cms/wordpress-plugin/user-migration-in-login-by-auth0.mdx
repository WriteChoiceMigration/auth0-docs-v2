---
og:description: Describes the user migration feature of the Login by Auth0 WordPress
  Plugin
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Migration des utilisateurs dans le plugiciel Login by Auth0 pour WordPress
og:url: https://auth0.com/docs/
permalink: user-migration-in-login-by-auth0
title: Migration des utilisateurs dans le plugiciel Login by Auth0 pour WordPress
twitter:description: Describes the user migration feature of the Login by Auth0 WordPress
  Plugin
twitter:title: Migration des utilisateurs dans le plugiciel Login by Auth0 pour WordPress
---

The User Migration functionality uses a core Auth0 feature called Custom Databases combined with URL endpoints in the Login by Auth0 plugin to allow users to authenticate with existing WordPress user accounts. To learn more about custom databases, read [Custom Database Connections](/docs/authenticate/database-connections/custom-db).

## Comment cela fonctionne-t-il?

Lorsque vous activez la migration des données, le plugiciel expose deux points de terminaison sécurisés qui permettent à Auth0 d’authentifier les utilisateurs utilisant des comptes WordPress. Ces points de terminaison sont sécurisés par un jeton secret et ne peuvent être configurés que pour autoriser les adresses IP utilisées par Auth0.

Le flux de connexion est le suivant :

1. A user attempts to login with an Auth0 login form (embedded on your site or hosted at Auth0).
2. If Auth0 can't find a user associated with the provided credentials in your database connection, it proceeds to call the Migration endpoint on your WordPress site with the user credentials and the migration token.
3. The plugin finds a user in your WordPress database with the provided username/email and verifies the password.
4. If a user can be successfully authenticated, Auth0 creates the user in the database connection for your site, authenticates the user, and logs them in.
5. The next time the user logs in, they will use the Auth0 user, and the Migration endpoint will be skipped.

La migration des utilisateurs doit être configurée lorsque le site est connecté pour la première fois à Auth0. La tentative d’activation ou de désactivation des scripts de base de données personnalisés pour une connexion de base de données qui a déjà eu des utilisateurs échouera. Consultez la section **Dépannage** pour plus d’informations sur le passage d’un mode à l’autre.

## Mise en place et configuration

The easiest way to construct User Migration is to use the Setup Wizard when the plugin is first installed. To learn more about the process, read [Install Login by Auth0](/docs/customize/integrations/cms/wordpress-plugin/install-login-by-auth0).

Si l’assistant de configuration de la migration des utilisateurs n’a pas pu se terminer ou si vous souhaitez voir le processus plus en détail, suivez les étapes ci-dessous. Encore une fois, il s’agit de partir de zéro avec une connexion de base de données qui n’a pas d’utilisateurs. Le processus suivant doit être effectué sur un site sans trafic ou avec le mode maintenance activé.

1. [Create and correctly configure an Application](/docs/customize/integrations/cms/wordpress-plugin/configure-login-by-auth0), and create and activate an empty Database Connection for the Application. These can be the same as the ones created in the standard Setup Wizard process, or you can create these from scratch. To learn more about the Setup Wizard, read [Install Login by Auth0](/docs/customize/integrations/cms/wordpress-plugin/install-login-by-auth0).
2. In the **Auth0 > Settings** screen in WordPress, make sure the Application's Domain, Client ID and Client Secret are saved in the correct fields in the **Basic** tab.
3. In the **Advanced** view, enable the **User Migration Endpoints** setting, and select **Save Changes**. If you are using constant-based settings, set `AUTH0_ENV_MIGRATION_WS` to `true` and `AUTH0_ENV_MIGRATION_TOKEN` to a secure random string at least 16 digits long and without single quotes or backslashes.
4. Under the settings, you should now see a **Security Token**. Keep this page open as you will need this value later on in the process.
5. In the Auth0 Dashboard, go to the Database Connection you want to use and enable **Requires Username** and **Import Users to Auth0**.
6. Select the **Custom Database view**, and enable **Use my own database**.
7. There should be two tabs below this setting under **Database Action Scripts**: one for **Login** and one for **Get User**.
8. Select the **Login** view, clear out the existing code, [copy the db-login.js code from the GitHub repository](https://raw.githubusercontent.com/auth0/wp-auth0/4.4.0/lib/scripts-js/db-login.js), and paste it into the code editor.
9. **This step is for versions 3.10.0 and earlier:** Look for `{THE_WS_URL}` and replace that with your WordPress instance's site URL, followed by `/index.php?a0_action=migration-ws-login`. The site URL can be found in the **Settings > General** screen in wp-admin. You can test this by pasting the complete URL in your browser. You should see `{"status":401,"error":"Unauthorized"}`.
10. **This step is for versions 3.10.0 and earlier:** Look for `{THE_WS_TOKEN}` and replace that with the token that appears under the **User Migration Endpoints** setting.
11. There should be no errors in the editor. If everything looks good, click **Save** at the top.
12. **This step is for 3.11.0 and later:** Scroll down to **Settings** and add the following configuration variables:
    - `endpointUrl` défini sur l’URL du site de l’instance WordPress (**wp-admin > Paramètres > Général > champ "Site URL" **), suivi de `/index.php?a0_action=`.
    - `migrationToken` défini sur la valeur du jeton de sécurité de l’étape 4 ci-dessus.
    - `userNamespace` défini sur votre nom d’application dans Auth0 ou toute autre valeur comprenant uniquement des lettres, des chiffres et des tirets.

    <Frame>![WordPress Plugin custom database settings](/images/cdy7uua7fh8z/1icr0yX47nODUrzP7B6Xl2/b43621c3b6641f68bcb14ac38b237c11/auth0-custom-database-config.png)</Frame>
13. Click the **Try** button at the top and use a valid WordPress user account in the form that appears. You should see the "The profile is" followed by the user's data. If not, please see the **Troubleshooting** section below.
14. Select the **Get User** view, clear out the existing code, [copy the db-get-user.js code from the GitHub repository](https://raw.githubusercontent.com/auth0/wp-auth0/4.4.0/lib/scripts-js/db-get-user.js), and paste it into the code editor.
15. **This step is for 3.10.0 and earlier:** Look for `{THE_WS_URL}` and replace that with your WordPress instance's site URL, followed by /index.php?a0_action=`migration-ws-get-user`. The site URL can be found in the **Settings > General** screen in wp-admin. You can test this by pasting the complete URL in your browser. You should see `{"status":401,"error":"Unauthorized"}`.
16. **This step is for 3.10.0 and earlier:** Look for `{THE_WS_TOKEN}` and replace that with the token that appears under the **User Migration Endpoints** setting.
17. There should be no errors in the editor. If everything looks good, click **Save**.
18. Click the **Try** button at the top and use an email with a valid WordPress user account in the form that appears. You should see the "The profile is" followed by the user's data. If not, please see the **Troubleshooting** section below.
19. In a new browser session, navigate to a login page on the WordPress site and attempt to log in (the user should not already exist in the database). You'll notice that the login process takes a little longer than usual at first, but it should succeed. Subsequent logins will be faster.
20. (OPTIONAL) To turn on additional security for the migration endpoints, go to **Auth0 > Settings** screen in WordPress, turn on, then **Save Changes**. Attempt to log in with a different user to test that Auth0 can still reach the endpoints.

À ce stade, la configuration de la migration des utilisateurs est terminée, et les utilisateurs existants de WordPress seront migrés vers la connexion à la base de données Auth0.

## Dépannage

Les problèmes liés à la migration des utilisateurs proviennent généralement de plusieurs sources :

* Une URL ou un jeton incorrect dans les scripts de la base de données personnalisée.
* La liste d’adresses IP autorisées est active, mais contient des adresses IP incorrectes.
* Points de terminaison restreints ou mis en cache sur votre instance WordPress.

The best way to start troubleshooting the issue is to use the **Try** button for the **Login** script found in the Custom Database view of the Database Connection being used on [Auth0 Dashboard > Authentication > Database](https://manage.auth0.com/#/connections/database). The following are the error messages you might see and the steps to take to fix.

### Jeton inattendu < dans le JSON à la position 0

Cela signifie que le script personnalisé ne reçoit pas les données dans un format qu’il peut utiliser. Une URL de point de terminaison incorrect est probablement à l’origine de ce problème dans le script de la base de données.

Tout d’abord, copiez l’URL à la ligne 10 du script et collez-la dans votre navigateur. Si le point de terminaison est correct, il devrait afficher l’un des deux messages ci-dessous :

`{"status":401,"error":"Unauthorized"}`

`// or`

`{"status":403,"error":"Forbidden"}`

Si ce que vous voyez est la page d’accueil ou une erreur 404, l’URL est incorrecte. Recherchez l’URL de votre site sous **Paramètres > Général > URL du site** dans la section administrateur de WordPress. Ajoutez `/index.php?a0_action=migration-ws-login` à la fin pour le script Login et `/index.php?a0_action=migration-ws-get-user` à la fin pour le script Obtenir l’utilisateur.

- **Pour les versions 3.10.0 et précédentes** : La valeur de l’URL devrait apparaître dans le script lui-même en tant que premier paramètre de l’appel `request.post`.
- **Pour les versions 3.11.0 et ultérieures** : La valeur du jeton doit être enregistrée dans une variable de configuration. Ajoutez ce qui suit à la première ligne de la fonction et utilisez le bouton **Essayer** pour voir la valeur  qui est enregistrée pour `endpointUrl` :

`callback(null, configuration);`

Si vous êtes sûr que les URL sont correctes et que le problème persiste, vérifiez auprès de votre hébergeur que ces URL ne sont pas mises en cache ou restreintes de quelque manière que ce soit.

### Mauvaise adresse électronique ou mauvais mot de passe

Il s’agit de l’erreur par défaut qui s’affiche en cas de problème. La façon la plus simple de résoudre ce problème est d’afficher temporairement l’erreur qui est renvoyée (ces erreurs sont opaques par défaut afin d’éviter d’afficher quoi que ce soit qui puisse donner aux attaquants une base de travail).

À la ligne 30 du script de connexion, remplacez :

`callback(null);`

to:

`callback(wpUser.error);`

Enregistrez le script et essayez à nouveau de vous connecter. Vous devriez voir l’un des messages suivants et être en mesure d’identifier le problème à l’aide des étapes ci-dessous. Une fois le problème résolu, rétablissez le script tel qu’il était.

### Interdit

Cela signifie que les points de terminaison de la migration sont désactivés dans votre installation WordPress. Dans WordPress, allez dans **Auth0 > Paramètres > Avancé** et activez **Points de terminaison de la migration des utilisateurs**. Assurez-vous que le jeton qui apparaît est le même que celui utilisé pour les deux scripts de base de données personnalisés :

* **Pour les versions 3.10.0 et antérieures** : La valeur du jeton doit apparaître dans le script lui-même après `access_token:`
* **Pour les versions 3.11.0 et ultérieures** : La valeur du jeton doit être enregistrée dans une variable de configuration. Ajoutez ce qui suit à la première ligne de la fonction et utilisez le bouton **Essayer** pour voir la valeur enregistrée pour `migrationToken` :

`callback(null, configuration);`

### Non autorisé

Cela signifie que la liste des IP autorisées pour la migration est activée, mais que l’adresse IP entrante ne figure pas sur la liste. Juste en dessous du script de connexion, vous devriez voir une liste d’adresses IP :

<Frame>![WordPress User Migration - Auth0 IP Addresses](/images/cdy7uua7fh8z/3RnxoRlvXm8FmNfu02fXVn/3672806c9cbf2bfe28503be8b8a63eda/auth0-incoming-ip-addresses.png)</Frame>

Assurez-vous que toutes ces adresses IP apparaissent dans WordPress sous **Auth0 > Paramètres > Avancé** dans le plugiciel :

<Frame>![WordPress User Migration - IP Whitelist](/images/cdy7uua7fh8z/3w6C1IrsSC9hoivpSY122l/d117857524ef8d7872f364d3a7dbabda/migration-ip-whitelist-setting-field.png)</Frame>

If one or more of the IP addresses listed in Auth0 do not appear in WordPress, add the missing ones into the field and save the settings page. Also, [create a post in the Auth0 Community](https://community.auth0.com/tags/wordpress) (and tag it "wordpress") that contains the missing IP address(es), so we can address the issue.

### Non autorisé : l’en-tête d’autorisation est manquante

The <Tooltip tip="Security Token: Digitally-signed artifact used to prove that the user was successfully authenticated." cta="View Glossary" href="/docs/glossary?term=security+token">security token</Tooltip> is either missing in the database script (line 16), or your server is not processing the headers correctly. Check the Login script and make sure that the token exists and matches what is in WordPress. If the token is there and correct, then you'll need to talk to your host to enable the `Authorization` header to be parsed. For help with server troubleshooting, read [Apache 2.4 + PHP-FPM and Authorization headers on stackoverflow.com](https://stackoverflow.com/questions/17018586/apache-2-4-php-fpm-and-authorization-headers). To see how the token is retrieved, view the [plugin code in the GitHub repository.](https://github.com/auth0/wp-auth0/blob/master/lib/WP_Auth0_Routes.php#L138)

### Jeton non valide

Le jeton de sécurité dans le script de base de données n’est pas valide. Vérifiez la ligne 16 du script de connexion et assurez-vous que le jeton correspond à ce qui se trouve dans WordPress.

### Identifiants invalides

L’adresse courriel et/ou le mot de passe utilisés sont incorrects. Veillez à saisir une adresse courriel et un mot de passe corrects. Vous pouvez réinitialiser le mot de passe de l’utilisateur pour vous assurer que vous avez le bon mot de passe.

### Impossible de modifier l’adresse courriel, ou les données de l’utilisateur sont incorrectes

Si vous utilisez plus d’une connexion de base de données personnalisée dans votre locataire Auth0 et que vous n’arrivez pas à changer l’adresse courriel ou que vous obtenez des données d’utilisateur stockées pour le mauvais utilisateur, il est probable que vous avez des identifiants d’utilisateur qui se chevauchent dans Auth0. Ce problème a été corrigé pour les nouveaux sites qui installent la version 3.11.0, mais pour les connexions créées avant cette date, il devra être corrigé manuellement en procédant de l’une des manières suivantes :

* Si vous n’avez pas de données utilisateur stockées qui doivent être conservées (si vous n’utilisez la connexion que pour la connexion et que vous ne stockez pas de métadonnées), vous pouvez créer une nouvelle connexion de base de données personnalisée en suivant les étapes ci-dessus (en utilisant les instructions pour la version 3.11.0) et basculer l’application vers cette nouvelle connexion (assurez-vous de désactiver l’ancienne connexion). La migration sera redémarrée et il n’y aura pas d’impact sur l’expérience de l’utilisateur.
* If you do have data in Auth0 that needs to be kept, you can [use our User Import/Export Extension](/docs/manage-users/user-migration/user-import-export-extension) to adjust the user data.
  1. Create a new custom database connection using the steps above (using the 3.11.0 notes).
  2. Export all users from the existing connection (we recommend putting your site in maintenance mode while doing the switch-over, so no users are missed).
  3. Change all user IDs to add the namespace used when creating the new connection. User IDs should go from something like `auth0|123` to `auth0|Your-WP-Site-Name|123`. Adjust all other fields you need to follow the import schema. To learn more, read [Bulk User Import Database Schema and Examples](/docs/manage-users/user-migration/bulk-user-import-database-schema-and-examples).
  4. Turn the new connection on and the old connection off for your application.
  5. Import the new user data into the new connection and test.
* .  3. Modifiez tous les identifiants des utilisateurs pour ajouter l’espace de noms utilisé lors de la création de la nouvelle connexion. Les identifiants d’utilisateurs devraient passer de `auth0|123` à `auth0|Votre-nom-de-site-WP|123`. Ajustez tous les autres champs dont vous avez besoin pour suivre le schéma d’importation. Pour en savoir plus, lisez [Importation d’utilisateurs en lots, schéma de base de données et exemples](/users/import-and-export-users/bulk-user-import-database-schema-and-examples).