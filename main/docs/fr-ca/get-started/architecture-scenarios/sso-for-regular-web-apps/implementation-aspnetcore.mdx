---
og:description: The ASP.NET Core implementation for the Single Sign-on (SSO) for Regular
  Web Apps architecture scenario
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Mise en œuvre d’ASP.NET Core (Web Apps + SSO)
og:url: https://auth0.com/docs/
permalink: implementation-aspnetcore
title: Mise en œuvre d’ASP.NET Core (Web Apps + SSO)
twitter:description: The ASP.NET Core implementation for the Single Sign-on (SSO)
  for Regular Web Apps architecture scenario
twitter:title: Mise en œuvre d’ASP.NET Core (Web Apps + SSO)
---

Le code source complet de l’implémentation ASP.NET Core se trouve dans [ce répertoire GitHub](https://github.com/auth0-samples/auth0-pnp-webapp-oidc).

## Configurer le témoin et le logiciel médiateur OIDC

Pour les besoins de ce guide, nous utiliserons une simple connexion hébergée. Vous pouvez utiliser le témoin standard et le logiciel médiateur OIDC qui est disponible avec ASP.NET Core, assurez-vous donc d’installer les paquets NuGet.



Configurez ensuite le logiciel médiateur OIDC et le témoin dans le pipeline du logiciel médiateur de votre application.



Comme vous pouvez le voir dans le code ci-dessus, nous avons configuré deux types différents du logiciel médiateur d’authentification.

Le premier est le logiciel médiateur de gestion des témoin qui a été enregistré avec l’appel à `UseCookieAuthentication`. Le second est le logiciel médiateur OIDC qui a été enregistré avec l’appel à `UseOpenIdConnectAuthentication`.

Une fois que l’utilisateur s’est connecté à Auth0 à l’aide du logiciel médiateur OIDC, ses informations sont automatiquement stockées dans un témoin de session. Il suffit de configurer le logiciel médiateur comme indiqué ci-dessus pour qu’il s’occupe de la gestion de la session de l’utilisateur.

Le logiciel médiateur OpenID Connect (OIDC) extraira également toutes les demandes du jeton d’ID, qui est envoyé par Auth0 une fois que l’utilisateur s’est authentifié, et les ajoutera en tant que demandes sur le `ClaimsIdentity`.

## Mise en œuvre de la déconnexion

Vous pouvez contrôler à la fois la session de l’application et la session Auth0 en utilisant la méthode `SignOutAsync` de la classe `AuthenticationManager`, et en transmettant le schéma d’authentification à partir duquel vous souhaitez vous déconnecter.

Par exemple, pour se déconnecter du logiciel médiateur de gestion des témoins, et ainsi effacer le témoin d’authentification de votre application, vous pouvez effectuer l’appel suivant :



De même, vous pouvez déconnecter l’utilisateur d'Auth0 en appelant la méthode `SignOutAsync` et en transmettant `Auth0` comme schéma d’authentification à déconnecter.



Pour que cela fonctionne, vous devrez cependant ajouter une configuration supplémentaire lors de l’enregistrement du logiciel médiateur OIDC en gérant l’événement `OnRedirectToIdentityProviderForSignOut`. Dans cet événement, vous devrez rediriger vers [le point de terminaison de déconnexion Auth0](https://auth0.com/docs/api/authentication/reference#logout), ce qui effacera le témoin Auth0.



Vous devrez également vous assurer que vous ajoutez l’URL de votre application à **URL de déconnexion autorisées** de votre application dans le tableau de bord Auth0. Pour plus d’informations, reportez-vous à [Déconnexion](https://auth0.com/docs/logout).

## Mettre en oeuvre les permissions d’administration

La manière la plus simple d’intégrer les groupes dans une application ASP.NET Core est d’utiliser l’autorisation intégrée [Autorisation basée sur les rôles](https://docs.asp.net/en/latest/security/authorization/roles.html) disponible dans ASP.NET Core. Pour ce faire, nous devrons ajouter une Demande de type



pour chacun des groupes auxquels un utilisateur est assigné.

Une fois les demandes ajoutées, nous pouvons facilement nous assurer qu’une action spécifique n’est disponible que pour les utilisateurs `Admin` en décorant la demande avec l’attribut `[Authorize(Roles = "Admin")]`. Vous pouvez également vérifier si un utilisateur occupe un rôle spécifique à partir du code en appelant `User.IsInRole("Admin")` à l’intérieur de votre contrôleur.

Le logiciel médiateur ASP.NET OIDC ajoutera automatiquement toutes les demandes renvoyées dans le JWT en tant que demandes à l’identité `ClaimsIdentity`. Nous devrions donc extraire les informations de la demande `authorization`, désérialiser le corps JSON de la demande et, pour chacun des groupes, ajouter une demande `http://schemas.microsoft.com/ws/2008/06/identity/claims/role` à `ClaimsIdentity`.



Ensuite, nous pouvons ajouter une action qui permet aux Administrateurs d’approuver les feuilles de temps :