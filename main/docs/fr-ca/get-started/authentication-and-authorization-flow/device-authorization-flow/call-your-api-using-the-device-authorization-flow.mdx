---
og:description: Learn how to call your API from an input-constrained device using
  the Device Authorization flow.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Appeler une API à l’aide du flux d’autorisation d’appareil
og:url: https://auth0.com/docs/
permalink: call-your-api-using-the-device-authorization-flow
title: Appeler une API à l’aide du flux d’autorisation d’appareil
twitter:description: Learn how to call your API from an input-constrained device using
  the Device Authorization flow.
twitter:title: Appeler une API à l’aide du flux d’autorisation d’appareil
---



Auth0 permet à votre application d’implémenter facilement le flux d’autorisation d’appareil en utilisant :

* [Authentication API](/api/authentication) : Poursuivez la lecture pour savoir comment appeler votre API directement. Pour une expérience interactive, veuillez consulter [Terrain de jeu du flux d’appareil](https://auth0.github.io/device-flow-playground/).

## Prérequis

Avant de commencer ce tutoriel :

* Vérifiez les limitations (ci-dessous) pour vous assurer que le flux d’autorisation d’appareil convient à votre mise en œuvre.
* [Register the Application with Auth0 (Enregistrez l’application avec Auth0)](/get-started/create-apps/native-apps).

* Sélectionnez un **Application Type (Type d’application)****Native (Natif)**.
* Si nécessaire, définissez **Origines Web autorisées**. Vous pouvez ainsi autoriser localhost comme origine lors du développement local, ou pour définir une origine autorisée pour un logiciel TV spécifique avec une architecture soumise à CORS (par exemple, HTML5 + JS). La plupart des applications n’utiliseront pas ce paramètre.
* Assurez-vous que l’option **OIDC Conformant (Conforme à l’OIDC)** est activée. Ce paramètre se trouve dans [Dashboard](%24%7Bmanage_url%7D) sous **Applications > Application > Advanced Settings (Paramètres avancés) > OAuth**.
* Assurez-vous que les **Grant Types (Types d’autorisation)** de l’application comprennent le **Device Code (Code de l’appareil)**. Pour en savoir plus, lisez [Mettre à jour les types d’autorisation](/applications/update-grant-types).
* Si vous souhaitez que votre application puisse utiliser des jetons d’actualisation, assurez-vous que les **Types d’autorisation** de l’application comprennent le **Jeton d’actualisation**. Pour en savoir plus, lisez [Mettre à jour les types d’autorisation](/applications/update-grant-types). Pour en savoir plus sur les jetons d’actualisation, lisez [Jetons d’actualisation](/security/tokens/refresh-tokens).
* Configurez et activez au moins une connexion pour l’application : [Database connections (Connexions aux bases de données)](/applications/set-up-database-connections), [Social connections (Connexions sociales)](/social)
* [Enregistrez votre application avec Auth0](/architecture-scenarios/mobile-api/part-2#create-the-api)

* Si vous souhaitez que votre API reçoive des jetons d’actualisation afin d’obtenir de nouveaux jetons lorsque les précédents expirent, activez **Autoriser l’accès hors ligne**. Pour en savoir plus sur les jetons d’actualisation, consultez [Jetons d’actualisation](/security/tokens/refresh-tokens).
* [Configure Device User Code Settings (Configurez les paramètres du code utilisateur de l’appareil)](/tenant-settings/configure-device-user-code-settings) pour définir le jeu de caractères, le format et la longueur de votre code utilisateur généré de manière aléatoire.

## Étapes

1. [Demander le code de l’appareil](#request-device-code) (Flux d’appareil) : Demandez un code d’appareil que l’utilisateur peut utiliser pour autoriser l’appareil.
2. [Demander l’activation de l’appareil](#request-device-activation) (Flux d’appareil) : Demandez à l’utilisateur d’autoriser l’appareil à l’aide de son ordinateur portable ou de son téléphone intelligent.
3. [Demander des jetons)](#request-tokens) (Flux d’appareil) : Interrogez le point de terminaison du jeton pour demander un jeton.
4. [Autoriser l’utilisateur](#authorize-user) (Flux du navigateur) : L’utilisateur autorise l’appareil, afin que l’appareil puisse recevoir des jetons.
5. [Recevoir des jetons](#receive-tokens) (Flux d’appareil) : Une fois que l’utilisateur a autorisé avec succès l’appareil, vous pouvez recevoir des jetons.
6. [Appel à l’API](#call-api) (Flux d’appareil) : Utilisez le jeton d’accès récupéré pour appeler votre API.
7. [Jetons d’actualisation](#refresh-tokens) (Flux d’appareil) : Utilisez un jeton d’actualisation pour demander de nouveaux jetons lorsque les anciens expirent.

Facultatif : [Découvrez des cas d’utilisation](#sample-use-cases).

Facultatif :   [Dépanner](#troubleshoot).

### Recevoir le code de l’appareil

Une fois que l’utilisateur a démarré l’application de son appareil et souhaite autoriser l’appareil, vous devrez obtenir un code d’appareil. Lorsque l’utilisateur démarre sa session sur son appareil basé sur un navigateur, ce code sera lié à cette session.

Pour obtenir le code de l’appareil, votre application doit demander un code à partir de l’[URLdu code d’appareil](/api/authentication#get-device-code), notamment l’ID client.

#### Exemple POST vers l’URL de code d’appareil



##### Paramètres du code d’appareil

Veuillez noter que lors de la demande d’un code d’appareil pour appeler une API personnalisée, vous devez procéder ainsi :

* inclure un paramètre audience,
* éventuellement inclure des permissions supplémentaires prises en charge par l’API cible.





#### Réponse du code de l’appareil

Si tout se passe bien, vous recevrez une réponse `HTTP 200` avec une charge utile contenant les valeurs `device_code`, `user_code`, `verification_uri`, `expires_in`, `interval` et `verification_uri_complete`



* `device_code` est le code unique de l’appareil. Lorsque l’utilisateur accèdera à `verification_uri` sur son appareil basé sur un navigateur, ce code sera lié à sa session.
* `code_utilisateur` contient le code qui doit être saisi dans `verification_uri` pour autoriser l’appareil.
* `verification_uri` contient l’URL que l’utilisateur doit visiter pour autoriser l’appareil.
* `verification_uri_complete` contient l’intégralité de l’URL que l’utilisateur doit visiter pour autoriser l’appareil. Cela permet à votre application d’intégrer le `user_code` dans l’URL, si vous le souhaitez.
* `expires_in` indique la durée de vie (en secondes) des codes `device_code` et `user_code`.
* `interval` indique l’intervalle (en secondes) auquel l’application doit interroger l’URL de jeton pour demander un jeton.



### Demande d’activation de l’appareil

Une fois que vous avez reçu un `device_code` et un `user_code` vous devez demander à l’utilisateur d’accéder à `verification_uri` sur son ordinateur portable ou téléphone intelligent et saisir le `user_code` :

Le `device_code` n’est pas destiné directement à l’utilisateur et ne doit pas être affiché pendant l’interaction afin de ne pas créer de confusion chez l’utilisateur.



### Demander des jetons

Pendant que vous attendez que l’utilisateur active l’appareil, commencez à interroger l’URL de jeton pour demander un jeton d’accès. En utilisant l’intervalle d’interrogation (`interval`) extrait de l’étape précédente, vous devrez `POST` sur [l’URL de jeton](/api/authentication#device-auth) en l’envoyant avec le `device_code`.

Pour éviter des erreurs dues à la latence du réseau, vous devez commencer à compter chaque intervalle après la réception de la réponse de la dernière demande d’interrogation.

#### Exemple de demande POST de jeton vers l’URL de jeton.



##### Paramètres de demande de jeton



#### Réponses des jetons

Il est possible de recevoir plusieurs réponses `HTTP 4xx` différentes pendant que vous attendez que l’utilisateur autorise l’appareil :

##### Autorisation en attente

Vous verrez cette erreur pendant que vous attendez que l’utilisateur agisse. Poursuivez l’interrogation en utilisant interval suggéré dans l’étape précédente de ce tutoriel.



##### Ralentissement

L’interrogation est trop rapide. Ralentissez et utilisez l’intervalle suggéré dans l’étape précédente de ce tutoriel. Pour éviter de recevoir cette erreur en raison de la latence du réseau, vous devez commencer à compter chaque intervalle après la réception de la réponse de la dernière demande d’interrogation.



##### Jeton expiré

L’utilisateur n’a pas autorisé l’appareil assez rapidement, par conséquent le `device_code` a expiré. Votre application doit avertir l’utilisateur que le flux a expiré et l’inviter à le réinitialiser.





##### Accès refusé

Enfin, si l’accès est refusé, vous recevrez :



Cela peut se produire pour diverses raisons, notamment :

* l’utilisateur a refusé d’autoriser l’appareil,
* le serveur d’autorisations a refusé la transaction,
* une règle configurée a refusé l’accès (pour en savoir plus, veuillez consulter [Règles d'Auth0](/rules).)

### Autoriser l’utilisateur

L’utilisateur peut soit balayer le code QR, soit ouvrir la page d’activation et saisir le code d’utilisateur :

Une page de confirmation s’affiche pour que l’utilisateur confirme qu’il s’agit du bon appareil :

L’utilisateur terminera la transaction en se connectant. Cette étape peut comprendre un ou plusieurs des procédés suivant :

* Authentifier l’utilisateur;
* Rediriger l’utilisateur vers un fournisseur d’identité pour gérer l’authentification;
* Vérification des sessions actives d’authentification unique (SSO);
* Obtenir le consentement de l’utilisateur pour l’appareil, à moins qu’il n’ait été donné au préalable.

Une fois l’authentification et le consentement obtenus, la demande de confirmation s’affiche :

À ce stade, l’utilisateur s’est authentifié et l’appareil a été autorisé.

### Recevoir les jetons

Pendant que l’utilisateur authentifiait et autorisait l’appareil, l’application de l’appareil a continué à interroger l’URL de jeton pour demander un jeton d’accès.

Une fois que l’utilisateur a autorisé l’appareil avec succès, vous recevrez une réponse `HTTP 200` avec une charge utile contenant les valeurs suivantes `access_token`, `refresh_token` (en option), `id_token` (en option), `token_type`, et `expires_in` :





Les jetons d’accès sont utilisés pour appeler le point de terminaison [`/userinfo` de](/api/authentication#get-user-info) Auth0 Authentication API ou d’une autre API. Pour en savoir plus sur les jetons d’accès, veuillez consulter [Jetons d’accès](/security/tokens/access-tokens). Vous pourrez utiliser le jeton d’accès pour appeler `/userinfo` uniquement si vous avez inclus la permission `openid`. Si vous appelez votre propre API, la première chose que votre API devra faire est [vérifier le jeton d’accès](/security/tokens/access-tokens/validate-access-tokens).

Les jetons d’ID contiennent des informations de l’utilisateur qui doivent être décodées et extraites. (Pour en savoir plus sur les [jetons d’ID](/security/tokens/id-tokens), veuillez consulter la section correspondante) Le `id_token` ne sera présent dans la réponse que si vous avez inclus la permission `openid`

Les jetons d’actualisation sont utilisés pour obtenir un nouveau jeton d’accès ou un nouveau jeton d’ID après l’expiration du jeton précédent. (Pour en savoir plus sur les jetons d’actualisation, consultez [Jetons d’actualisation](/security/tokens/refresh-tokens)). Le `refresh_token` ne sera présent dans la réponse que si vous avez inclus la permission `offline_access` et activé **Autoriser l’accès hors ligne** pour votre API dans Dashboard.



### Appeler votre API

Pour appeler votre API, l’application doit transmettre le jeton d’accès récupéré en tant que jeton du porteur dans l’en-tête d’autorisation de votre requête HTTP.



### Jetons d’actualisation

Vous avez déjà reçu un jeton d’actualisation si vous avez suivi ce tutoriel et complété ce qui suit :

* configuré votre API pour autoriser l’accès hors ligne
* inclus la permission `offline_access` lorsque vous avez lancé la demande d’authentification via le [authorize endpoint (point de terminaison d’autorisation)](/api/authentication/reference#authorize-application)

Vous pouvez utiliser le jeton d’actualisation pour obtenir un nouveau jeton d’accès. Généralement, un utilisateur aura besoin d’un nouveau jeton d’accès uniquement après l’expiration du précédent ou lorsqu’il accède à une nouvelle ressource pour la première fois. Il est déconseillé d’appeler le point de terminaison pour obtenir un nouveau jeton d’accès à chaque fois que vous appelez une API, et Auth0 impose des limites anti-attaques qui réduiront la quantité de requêtes au point de terminaison pouvant être exécutées en utilisant le même jeton depuis la même adresse IP.

Pour actualiser votre jeton, effectuez une requête `POST` au point de terminaison `/oauth/token` dans l’Authentication API, à l’aide de `grant_type=refresh_token`.

#### Exemple de jeton d’actualisation POST vers l’URL de jeton.



##### Paramètres de requête de jeton d’actualisation



#### Réponse du jeton d’actualisation

Si tout se passe bien, vous recevrez une réponse `HTTP 200` avec une charge utile contenant un nouveau `access_token`, `id_token` (en option), durée de vie du jeton en secondes (`expires_in`), valeurs de `scope` accordées et `token_type` :





## Exemples de cas d’utilisation

### Détecter l’utilisation du flux d’autorisation d’appareil

Vous pouvez utiliser des règles pour détecter si la transaction en cours utilise le flux d’autorisation d’appareil. (Pour en savoir plus sur les règles, lisez l’article [Règles d'Auth0](/rules)). Pour cela, vérifiez la propriété `protocol` de l’objet `context` :



### Exemples de mises en œuvre

* [Terrain de jeu du flux de l’appareil](https://auth0.github.io/device-flow-playground/)
* [AppleTV (Swift)](https://github.com/pushpabrol/auth0-device-flow-appletv) : application simple qui montre comment Auth0 peut être utilisé avec le flux d’autorisation d’appareil AppleTV.
* [Interface de ligne de commande (Node.js)](https://gist.github.com/panva/ebaacfe433a8677bdbf458f6e1132045) : exemple de mise en œuvre d’une interface de ligne de commande qui utilise le flux d’autorisation d’un appareil au lieu du flux du code d’autorisation. La principale différence est que votre interface de ligne de commande n’a pas besoin d’héberger un serveur Web et d’écouter sur un port.

## Dépanner

Les journaux de locataires sont créés pour toutes les interactions qui ont lieu et peuvent être utilisés pour résoudre les problèmes. Pour en savoir plus, lisez [Logs (Journaux)](/logs).

### Codes d’erreur



### Limites

Pour utiliser le flux d’autorisation d’appareil, les appareils doivent :

* Prendre en charge Support Server Name Indication (SNI) (Indication du nom du serveur) lorsque des [Custom Domains (Domaines personnalisés) sont utilisés](/custom-domains)
* Avoir une [Auth0 Application Type (Type d’application Auth0)](/applications)**Native (Natif)**
* Avoir la [Token Endpoint Authentication Method (Méthode d’authentification du point de terminaison du jeton)](/applications/application-settings) définie sur **None (Aucune)**
* Être [OIDC-conformant (conforme à l’OIDC)](/applications/application-settings)
* Ne pas être créée au moyen de [Dynamic Client Registration (Enregistrement dynamique des clients)](/applications/dynamic-client-registration)

En outre, le flux d’autorisation d’appareil ne permet pas :

* Les [Social Connections (Connexions sociales)](/social) qui utilisent les [Auth0 developer keys (Clés de développeur Auth0)](/devkeys), sauf si vous utilisez la [ Universal Login experience (Expérience de connexion universelle)](/login/universal-login/universal-experience).
* Les paramètres de la chaîne de requête doivent être accessibles à partir d’une page de connexion ou de règles hébergées.
* [Association de comptes d’utilisateur](/users/user-account-linking)

Nous prenons en charge l’intégralité du Draft 15, à l’exception des clients confidentiels. Pour en savoir plus, veuillez consulter [OAuth 2.0 Device Authorization Grant Draft 15 sur ietf.org](https://tools.ietf.org/html/draft-ietf-oauth-device-flow-15).