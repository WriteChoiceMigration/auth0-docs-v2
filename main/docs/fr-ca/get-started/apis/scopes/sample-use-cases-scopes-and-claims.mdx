---
og:description: Learn how to use scopes and claims with applications and APIs.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: 'Exemples de cas d’utilisation : permissions et demandes'
og:url: https://auth0.com/docs/
permalink: sample-use-cases-scopes-and-claims
title: 'Exemples de cas d’utilisation : permissions et demandes'
twitter:description: Learn how to use scopes and claims with applications and APIs.
twitter:title: 'Exemples de cas d’utilisation : permissions et demandes'
---

In these examples, we use the [Authorization Code Flow](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow) to authenticate a user and request the necessary permissions (scopes) and tokens. For details on the request parameters or to learn how to fully implement this flow, read our tutorial: [Add Login to Regular Web Applications](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow/add-login-auth-code-flow).

## Authentifier un utilisateur et faire des demandes standard

In this example, we want to authenticate a user and get user details that will allow us to personalize our user interface. To do this, we need to get an <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip> that contains the user's name, nickname, profile picture, and email information.

1. Initiate the authentication flow by sending the user to the authorization URL:

   ```text lines
   https://{yourDomain}/authorize?
     response_type=code&
     client_id={yourClientId}&
     redirect_uri={https://yourApp/callback}&
     scope=openid%20profile%20email&
     state=YOUR_STATE_VALUE
   ```


   

   

   Notez que dans cet exemple :
   * Le paramètre `response_type` comprend une valeur :

     + `code` : parce que nous utilisons le flux d’application Web standard, notre demande initiale concerne un code d’autorisation; lorsque nous demandons nos jetons à l’aide de ce code, nous recevons le jeton d’ID dont nous avons besoin pour l’authentification.
   * Le paramètre `scope` comprend trois valeurs; les permissions OIDC demandées :

     + `openid` : pour indiquer que l’application a l’intention d’utiliser OIDC pour vérifier l’identité de l’utilisateur.
     + `profile` : pour obtenir le `name`, le `nickname` et la `picture`.
     + `email` : pour accéder à `email` et `email_verified`.
2. After the user consents (if necessary) and Auth0 redirects back to your app, [request tokens](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow/add-login-auth-code-flow).
3. Extract the ID token from the response and [decode it](/docs/secure/tokens/id-tokens). You should see the following claims:

   ```json lines
   {
     "name": "John Doe",
     "nickname": "john.doe",
     "picture": "https://myawesomeavatar.com/avatar.png",
     "updated_at": "2017-03-30T15:13:40.474Z",
     "email": "john.doe@test.com",
     "email_verified": false,
     "iss": "https://{yourDomain}/",
     "sub": "auth0|USER-ID",
     "aud": "{yourClientId}",
     "exp": 1490922820,
     "iat": 1490886820,
     "nonce": "crypto-value",
     "at_hash": "IoS3ZGppJKUn3Bta_LgE2A"
   }
   ```


   

   

   Votre application peut désormais récupérer les attributs utilisateur et les utiliser pour personnaliser votre interface utilisateur.

## Demander un accès API personnalisé

In this example, we request a custom scope for a calendar API that will authorize the calling application to read appointments for the user. To do this, we want to get an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+token">access token</Tooltip> containing the proper scope to read appointments from the API. Note that requesting an access token is not dependent on requesting an ID token.

Before using a custom API, you need to know what scopes are available for the API you are calling. If the custom API is under your control, you need to register both your application and API with Auth0 and [define the scopes for your API using the Auth0 Dashboard](/docs/get-started/apis/scopes/api-scopes). You can also use defined permissions to [customize the consent prompt](/docs/customize/login-pages/customize-consent-prompts) for your users.

1. Initiate the authorization flow by sending the user to the authorization URL:

   ```text lines
   https://{yourDomain}/authorize?
     response_type=code&
     client_id={yourClientId}&
     redirect_uri={https://yourApp/callback}& 
     scope=read:appointments&
     audience=YOUR_API_AUDIENCE&
     state=YOUR_STATE_VALUE
   ```


   

   

   Notez que dans cet exemple :
   * Le paramètre `response_type` comprend toujours une valeur :

     + `code` : parce que nous utilisons le flux d’application Web standard, notre demande initiale concerne un code d’autorisation; lorsque nous demandons nos jetons à l’aide de ce code, nous recevons le jeton d’accès que nous pouvons utiliser pour appeler notre API.
   * Le paramètre `scope` comprend une valeur; les permissions API demandées :

     + `read:appointments` : pour nous permettre de lire les rendez-vous de l’utilisateur depuis l’API.
   * Le paramètre `audience` est nouveau et comprend une valeur :

     + L’identifiant unique de l’API à partir duquel nous souhaitons lire les rendez-vous de l’utilisateur.
2. As in the previous example, after the user consents (if necessary) and Auth0 redirects back to your app, [request tokens](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow/add-login-auth-code-flow).
3. Extract the access token from the response, and call the API using the access token as credentials.

## Authentifier un utilisateur et faire des demandes standard et un  personnalisé à une API

Dans cet exemple, nous combinons nos deux exemples précédents pour authentifier un utilisateur, faire des demandes standard et également demander une permission personnalisée pour une API de calendrier qui permettra à l’application appelante de lire les rendez-vous de l’utilisateur. Pour cela, obtenez deux jetons :

* Un jeton d’ID qui contient :

  + Nom d’utilisateur
  + Surnom
  + Photo du profil
  + Informations de courriel
* Jeton d’accès contenant la permission appropriée pour lire les rendez-vous à partir de l’API. Notez que la demande d’un jeton d’accès ne dépend pas de la demande d’un jeton d’ID.

Before using a custom API, you need to know what scopes are available for the API you are calling. If the custom API is under your control, you need to register both your application and API with Auth0 and [define the scopes for your API using the Auth0 Dashboard](/docs/get-started/apis/scopes/api-scopes). You can also use defined permissions to [customize the consent prompt](/docs/customize/login-pages/customize-consent-prompts) for your users.

1. Initiate the authentication flow by sending the user to the authorization URL:

   ```text lines
   https://{yourDomain}/authorize?
     response_type=code&
     client_id={yourClientId}&
     redirect_uri={https://yourApp/callback}& 
     scope=openid%20profile%20email%20read:appointments&
     audience=YOUR_API_AUDIENCE&
     state=YOUR_STATE_VALUE
   ```


   

   

   Notez que dans cet exemple :
   * Le paramètre `response_type` comprend toujours une valeur :

     + `code` : parce que nous utilisons le flux d’application Web standard, notre demande initiale concerne un code d’autorisation; lorsque nous demandons nos jetons à l’aide de ce code, nous recevons le jeton d’ID dont nous avons besoin pour l’authentification et le jeton d’accès que nous pouvons utiliser pour appeler notre API.
   * Le paramètre `scope` est utilisé à la fois pour les permissions OIDC et les permissions des API, il inclut donc maintenant quatre valeurs :

     + `openid` : pour indiquer que l’application a l’intention d’utiliser OIDC pour vérifier l’identité de l’utilisateur.
     + `profile` : pour obtenir le `name`, le `nickname` et la `picture`.
     + `email` : pour accéder à `email` et `email_verified`.
     + `read:appointments` : pour nous permettre de lire les rendez-vous de l’utilisateur depuis l’API.
   * Le paramètre `audience` comprend une valeur :

     + L’identifiant unique de l’API à partir de laquelle nous souhaitons lire les rendez-vous de l’utilisateur
2. As in the previous examples, after the user consents (if necessary) and Auth0 redirects back to your app, request tokens.
3. Extract the ID token from the response, decode it, and retrieve the user attributes and use them to personalize your UI.
4. Extract the access token from the response, and call the API using the access token as credentials.

## Ajouter des demandes personnalisées à un jeton

In this example, we add a user's favorite color and preferred contact method to the ID Token. To do this, we create an [Action](/docs/customize/actions) to customize the ID token by adding these [claims](/docs/secure/tokens/json-web-tokens/create-custom-claims). Once added, we will also be able to obtain the custom claims when calling the `/userinfo` endpoint (though the Action will run only during the authentication process).

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Auth0 allows namespaced and non-namespaced claims, but certain restrictions apply (see [General restrictions](/docs/secure/tokens/json-web-tokens/create-custom-claims#general-restrictions)). To avoid name collisions, we recommend using namespaced claims. In case of collisions, the transaction won't fail, but your custom claim won't be added to your tokens.

</Callout>

Supposez que :

* À un moment donné, l’utilisateur a sélectionné une méthode `preferred_contact` d’`email` et une `favorite_color``red` et que nous l’avons enregistrée dans le cadre des `user_metadata` de l’utilisateur.
* We've used the [Management API](https://auth0.com/docs/api/management/v2#!/Users/patch_users_by_id) or the Dashboard to set application-specific information for this user.

In this case, the Auth0-stored [normalized user profile](/docs/manage-users/user-accounts/user-profiles/normalized-user-profiles) is:

```json lines
{
  "email": "jane@example.com",
  "email_verified": true,
  "user_id": "custom|123",
  "favorite_color": "blue",
  "user_metadata": {
    "preferred_contact": "email"
  }
}
```






Pour ce profil, Auth0 renverrait normalement les demandes de jeton d’ID suivantes à votre application :

```json lines
{
  "email": "jane@example.com",
  "email_verified": true,
  "iss": "https://my-domain.auth0.com/",
  "sub": "custom|123",
  "aud": "my_client_id",
  "iat": 1311280970,
  "exp": 1311281970
}
```






Notez que dans cet exemple :

* La demande `sub` contient la valeur de la propriété `user_id`.
* Neither the `favorite_color` nor `user_metadata` properties are present because <Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Connect (OIDC) does not define standard claims that represent `favorite_color` or `user_metadata`.

To receive the custom data, we'll need to [create a new Action](/docs/customize/actions/write-your-first-action) to customize the token with a [custom claims](/docs/secure/tokens/json-web-tokens/create-custom-claims) that represent these properties from the user profile.

1. Navigate to [Auth0 Dashboard > Actions > Library](https://manage.auth0.com/#/actions/library), and select **Build Custom**.
2. Enter a descriptive **Name** for your Action (for example, `Add user metadata to tokens`), select the `Login / Post Login` trigger because you’ll be adding the Action to the Login flow, then select **Create**.
3. Locate the Actions Code Editor, copy the following JavaScript code into it, and select **Save Draft** to save your changes:

   ```text lines
   exports.onExecutePostLogin = async (event, api) => {
     const namespace = 'https://myapp.example.com';
     const { favorite_color, preferred_contact } = event.user.user_metadata;

     if (event.authorization) {
       // Set claims 
       api.idToken.setCustomClaim(`${namespace}/favorite_color`, favorite_color);
       api.idToken.setCustomClaim(`${namespace}/preferred_contact`, preferred_contact);
     }
   };
   ```


   

   
4. From the Actions Code Editor sidebar, select Test (play icon), then select **Run** to [test your code](/docs/customize/actions/test-actions).
5. When you’re ready for the Action to go live, select **Deploy**.

Finally, add the Action you created to the [Login Flow](https://manage.auth0.com/#/actions/flows/login/). To learn how to attach Actions to Flows, read the "Attach the Action to a flow" section in [Write Your First Action](/docs/customize/actions/write-your-first-action).

Avec cette Action activée, Auth0 inclura les demandes  personnalisées `favorite_color` et `preferred_contact` dans le jeton d’ID :

```json lines
{
  "email": "jane@example.com",
  "email_verified": true,
  "iss": "https://my-domain.auth0.com/",
  "sub": "custom|123",
  "aud": "my_client_id",
  "iat": 1311280970,
  "exp": 1311281970,
  "https://myapp.example.com/favorite_color": "red",
  "https://myapp.example.com/preferred_contact": "email"
}
```






Lors de la création de votre Action, assurez-vous de définir une logique qui détermine quand inclure des demandes supplémentaires. L’injection de demandes personnalisées dans chaque jeton d’ID émis n’est pas idéale.

Cet exemple montre des demandes personnalisées ajoutées à un jeton d’ID, qui utilise la méthode `api.idToken.setCustomClaims`. Pour ajouter ces demandes à un jeton d’accès, utilisez la méthode `api.accessToken.setCustomClaim`.

To learn more about the event object for the trigger, read [Actions Triggers: post-login - Event Object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/post-login-event-object). To learn more about tokens, read [Tokens](/docs/secure/tokens).

## Learn more

* [OpenID Connect Scopes](/docs/get-started/apis/scopes/openid-connect-scopes)
* [Create Custom Claims](/docs/secure/tokens/json-web-tokens/create-custom-claims)
* [API Scopes](/docs/get-started/apis/scopes/api-scopes)
* [Configure Logical API for Multiple APIs](/docs/get-started/apis/set-logical-api)