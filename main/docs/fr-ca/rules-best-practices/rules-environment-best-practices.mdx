---
og:description: Learn about best practices for building Auth0 rules.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Meilleures pratiques de l’environnement des règles
og:url: https://auth0.com/docs/
permalink: rules-environment-best-practices
title: Meilleures pratiques de l’environnement des règles
twitter:description: Learn about best practices for building Auth0 rules.
twitter:title: Meilleures pratiques de l’environnement des règles
---

<Warning>

The End of Life (EOL) date of Rules and Hooks will be **November 18, 2026**, and they are no longer available to new tenants created as of **October 16, 2023**. Existing tenants with active Hooks will retain Hooks product access through end of life.

We highly recommend that you use Actions to extend Auth0. With Actions, you have access to rich type information, inline documentation, and public `npm` packages, and can connect external integrations that enhance your overall extensibility experience. To learn more about what Actions offer, read [Understand How Auth0 Actions Work](/docs/customize/actions/actions-overview).

To help with your migration, we offer guides that will help you [migrate from Rules to Actions](/docs/customize/actions/migrate/migrate-from-rules-to-actions) and [migrate from Hooks to Actions](/docs/customize/actions/migrate/migrate-from-hooks-to-actions). We also have a dedicated [Move to Actions](https://auth0.com/extensibility/movetoactions) page that highlights feature comparisons, [an Actions demo](https://www.youtube.com/watch?v=UesFSY1klrI), and other resources to help you on your migration journey.

To read more about the Rules and Hooks deprecation, read our blog post: [Preparing for Rules and Hooks End of Life](https://auth0.com/blog/preparing-for-rules-and-hooks-end-of-life/).

</Warning>

Rules execute as a series of called JavaScript functions in an instance of an Auth0 serverless Webtask **container**. As part of this, a specific environment is provided, together with a number of artifacts supplied by both the container and the Auth0 <Tooltip tip="Authentication Server: Server that confirms or denies a user’s identity." cta="View Glossary" href="/docs/glossary?term=authentication+server">authentication server</Tooltip> (your Auth0 tenant) itself.

## npm modules

Auth0 serverless Webtask containers can make use of a wide range of [`npm`](https://www.npmjs.com/) modules; npm modules not only reduce the overall size of rule code implementation but also provide access to a wide range of pre-built functionality.

By default, a large list of publicly available npm modules are supported out-of-the-box. This list has been compiled and vetted for any potential security concerns. To see the list, read [Can I require: Auth0 Extensibility](https://auth0-extensions.github.io/canirequire/).

If you require an `npm` module that is not supported, you can [make a request at the Auth0 Support portal](https://support.auth0.com/) or through your Auth0 representative. Auth0 evaluates requests to determine suitability. There is currently no support in Auth0 for the use of Modules `npm` from private repositories. New packages are typically added on a 2-week cycle when requested. Existing packages are rarely removed as this would cause breaking changes in rules. Keep in mind, Auth0 packages and versions are stored on an internal registry and are not in sync with `npm`.

When using Modules `npm` to access external services, keep API requests to a minimum, avoid excessive calls to paid services, and avoid potential security exposure by limiting what is sent. To learn more, read [Performance Best Practices](/docs/troubleshoot/performance-best-practices).

Lorsque vous demandez un module dans une règle, si la version n’est pas précisée, le gestionnaire de package utilise la première version qu’il trouve dans la liste interne. Il est possible de préciser une version pour forcer le gestionnaire de package à utiliser une autre version que celle par défaut. Cela permet au code de la règle de profiter des corrections ou des fonctionnalités de la version indiquée qui ne sont pas proposées dans la version par défaut du module.

## Variables d’environnement

Les règles d'Auth0 prennent en charge les variables d’environnement, accessibles par l’objet de configuration globalement accessible. La configuration devrait être traitée en lecture seule, et devrait être utilisée pour stocker des informations sensibles comme des authentifiants ou des clés API permettant d’accéder au service externe. Cela empêchera d’avoir des valeurs sensibles du point de vue de la sécurité codées en dur dans une règle. Elle peut également être utilisée pour soutenir les stratégies de meilleures pratiques du cycle de vie du développement logiciel (SDLC) que vous utilisez en vous permettant de définir des variables qui ont des valeurs propres aux locataires. Cela empêche d’avoir des valeurs codées en dur dans une règle qui peut changer en fonction du locataire qui l’exécute.

### global object

Les conteneurs Webtask sans serveur Auth0 sont approvisionnés à partir d’une banque associée à chaque locataire Auth0. Chaque instance de conteneur met à disposition l’objet `global`, accessible dans toutes les règles qui s’exécutent dans l’instance de conteneur. L’objet `global` agit comme une variable globale et peut être utilisé pour définir des informations, ou même pour définir des fonctions qui peuvent être utilisées dans toutes les règles (qui s’exécutent dans le conteneur), quelle que soit l’instance du pipeline :

```js lines
global.tokenVerify = global.tokenVerify || function(token, secret) {
      /* The 'jwt.verify' function is synchronous, however wrapping with a promise
      * provides for better error management and integration within the logic
      * flow.
      */
      return new Promise(function(resolve, reject) {
      jwt.verify(
    token,
    secret,{
    clockTolerance: 5},
    function(err, decoded) {
      if (err) {
    reject(err);
      } else {
    resolve(decoded);
      }
      });
    });
    };
```






The Objet `général` can also be used to cache expensive resources, such as an <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=Access+Token">Access Token</Tooltip> for a third-party (e.g., logging) API that provides non user-specific functionality or an Access Token to your own API defined in Auth0 and obtained by using Client Credentials flow.

Les règles peuvent s’exécuter plus d’une fois lorsqu’un pipeline est exécuté, et cela dépend du contexte de l’opération. Pour chaque contexte dans lequel une règle est exécutée, une instance de conteneur existante est soit fournie à partir de la banque de locataires Auth0, soit instanciée à nouveau. Pour chaque instanciation d’un nouveau conteneur Webtask, l’objet `global` est réinitialisé. Ainsi, toute déclaration dans l’objet `global` devrait également inclure une disposition pour l’initialisation (comme indiqué ci-dessus), idéalement avec cette déclaration faite le plus tôt possible (c’est-à-dire dans une règle qui s’exécute tôt dans l’ordre d’exécution).

### auth0 object

The Objet `auth0` is a specially-restricted instance of [`ManagementClient`](https://github.com/auth0/node-auth0#management-api-client) (defined in the [node-auth0 Node.js client library](https://github.com/auth0/node-auth0)) and provides limited access to the Auth0 <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip>. It is primarily used for updating metadata associated with the `user` object from within a rule.

En plus d’être restreint (c.-à-d. qu’il prend en charge un nombre limité de méthodes `ManagementClient` pour l’accès `utilisateur` uniquement), les permissions du jeton d’accès associé à l’objet `auth0` sont limitées à `read:users` et à `update:users`. En règle générale, tout cela est suffisant pour la majorité des opérations que nous recommandons d’effectuer à partir d’une règle. Cependant, si vous avez besoin d’accéder à l’ensemble des méthodes prises en charge ou d’accéder à des permissions supplémentaires, vous devrez utiliser un autre moyen d’accès à Management API.

Cet autre accès à l’API à partir d’une règle est généralement obtenu en instanciant une instance indépendante de `ManagementClient`. Vous aurez ainsi accès à toutes les fonctionnalités actuelles, y compris la logique des tentatives automatiques en cas d’erreurs `429` résultant d’une politique de limite anti-attaques. En outre, si vous n’avez besoin que des permissions par défaut, vous pouvez même initialiser la nouvelle instance à l’aide du jeton d’accès associé à l’objet `auth0`.

Like the `context` object, the Objet `auth0` contains security-sensitive information, so you should not pass it to any external or third-party service. Further, the Auth0 Management API is both rate limited and subject to latency, so you should be judicious regarding how often calls are made. Read more about `context` objects on the [Rules Execution Best Practices](/docs/rules-best-practices/rules-execution-best-practices) page.

Utilisez l’objet `auth0` (et tout autre mécanisme pour appeler Management API Auth0) avec parcimonie et utilisez une gestion adéquate des exceptions et des erreurs pour éviter toute interruption inattendue de l’exécution du pipeline.

## Learn more

* [Rules Anatomy Best Practices](/docs/rules-best-practices/rules-anatomy-best-practices)
* [Rules Execution Best Practices](/docs/rules-best-practices/rules-execution-best-practices)
* [Rules Security Best Practices](/docs/rules-best-practices/rules-security-best-practices)
* [Rules Testing Best Practices](/docs/rules-best-practices/rules-testing-best-practices)
* [Error Handling Best Practices](/docs/troubleshoot/error-handling-best-practices)