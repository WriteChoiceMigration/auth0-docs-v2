---
og:description: Learn about best practices for testing and debugging your Auth0 environment.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Meilleures pratiques de test des règles
og:url: https://auth0.com/docs/
permalink: rules-testing-best-practices
title: Meilleures pratiques de test des règles
twitter:description: Learn about best practices for testing and debugging your Auth0
  environment.
twitter:title: Meilleures pratiques de test des règles
---

<Warning>

The End of Life (EOL) date of Rules and Hooks will be **November 18, 2026**, and they are no longer available to new tenants created as of **October 16, 2023**. Existing tenants with active Hooks will retain Hooks product access through end of life.

We highly recommend that you use Actions to extend Auth0. With Actions, you have access to rich type information, inline documentation, and public `npm` packages, and can connect external integrations that enhance your overall extensibility experience. To learn more about what Actions offer, read [Understand How Auth0 Actions Work](/docs/customize/actions/actions-overview).

To help with your migration, we offer guides that will help you [migrate from Rules to Actions](/docs/customize/actions/migrate/migrate-from-rules-to-actions) and [migrate from Hooks to Actions](/docs/customize/actions/migrate/migrate-from-hooks-to-actions). We also have a dedicated [Move to Actions](https://auth0.com/extensibility/movetoactions) page that highlights feature comparisons, [an Actions demo](https://www.youtube.com/watch?v=UesFSY1klrI), and other resources to help you on your migration journey.

To read more about the Rules and Hooks deprecation, read our blog post: [Preparing for Rules and Hooks End of Life](https://auth0.com/blog/preparing-for-rules-and-hooks-end-of-life/).

</Warning>

The <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> provides the facility to `TRY` a rule for the purpose of testing and debugging. This facility allows a mock `user` and `context` object to be defined, which is then passed to the rule as part of its execution. The resulting output from the rule (including any console logging) is displayed upon completion. While this provides an immediate at-a-glance way to unit test a rule, it is very much a manual approach, and one which is unable to leverage the use of automated testing tools such as [Mocha](https://mochajs.org/) or [rewire](https://www.npmjs.com/package/rewire).

En tant que meilleure pratique, et dans le cadre de l’assistance recommandée pour le cycle de vie du développement logiciel, vous devriez utiliser un locataire de test séparé dans Auth0 pour tester toute nouvelle règle ou tout changement de règle avant de les déployer en production.

## Automatisation

Avec l’aide d’un petit modèle, il est toutefois possible de mettre en œuvre une règle qui peut être déployée et exécutée dans un locataire Auth0 et, sans modification, être consommée dans n’importe quel environnement de test (unitaire) automatisé d’intégration continue/déploiement continu (CI/CD) :

```javascript lines expandable
const vm = require('vm');
  const fs = require('fs');
  var user = {
      "name":        "jdoe@foobar.com",
      "email":       "jdoe@foobar.com",
      "user_id":     "auth0|0123456789",
          .
          .
    };
  var context = {
      "clientID":            "123456789",
      "clientName":          "MyWebApp",
      "connection":          "MyDbConn",
      "connectionStrategy":  "auth0",
      "protocol":            "oidc-basic-profile",
          .
          .
    };

  global.configuration = {
    DEBUG: true
  };

  vm.runInThisContext(
      "(()=>{return " + fs.readFileSync('./rules/Normalized Profile Claims.js') + " })();", {
        // filename for stack traces
        filename: 'Normalized Profile Claims.js',
        displayErrors: true
      }
  )(
    user,
    context,
    function callback() {
      console.log("Complete");
    }
  );
```






As shown in the example above, some relatively straightforward testing can be implemented (in an independent node module) by using the Node.js [VM](https://www.w3schools.com/nodejs/ref_vm.asp) to execute the rule to be tested. In this case, a rule named Normalized Profile Claims is read from a file, and some boilerplate is added around the rule (JavaScript) code prior to executing it (the boilerplate being in the strings that both prefix and suffix the filesystem call to [read the file](https://nodejs.org/api/fs.html#fs_fs_readfilesync_path_options) containing the rule code).

The options object passed on the call to `runInThisContext` provides information that can be used to assist with debugging in the case where any exceptional error condition(s) may arise. Please see the Node.js [documentation](https://node.readthedocs.io/en/stable/api/vm/) for further information regarding this function call.

Les deux premiers objets transmis à la règle pendant les tests représentent les objets `user` et `context`, qui peuvent être simulés d’une manière similaire à celle employée dans la fonctionnalité Auth0 Dashboard `TRY`. La fonction `callback`, fournie en tant que troisième paramètre, peut être mise en œuvre pour simuler la poursuite du pipeline, en exécutant ensuite la règle suivante dans l’ordre.

La fonction `callback` fournie peut être utilisée pour s’assurer que l’exécution de la fonction de rappel est effectuée au moins une fois en demandant à la fonction (de rappel) de terminer le test et/ou de fournir une assertion. Nous recommandons également de prévoir une implémentation pour garantir que l’exécution multiple de la fonction callback n’est pas effectuée par une règle.

En outre, l’objet (Node.js) `global` peut être utilisé pour fournir à la fois l’objet de configuration et une instance de l’objet `auth0` si nécessaire. Dans l’exemple ci-dessus, un objet `configuration` global a été défini, ce qui est conforme aux pratiques recommandées pour faciliter le débogage (comme décrit dans la section ci-dessus).

L’exemple précédent utilise également la structure de répertoire du système de fichiers fournie par l’outil Auth0 Deploy CLI, qui peut faciliter le déploiement des règles.