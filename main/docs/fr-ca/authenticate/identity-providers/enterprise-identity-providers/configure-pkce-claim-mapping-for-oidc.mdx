---
og:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Configurer la PKCE et le mappage des demandes pour les connexions OIDC
og:url: https://auth0.com/docs/
permalink: configure-pkce-claim-mapping-for-oidc
title: Configurer la PKCE et le mappage des demandes pour les connexions OIDC
twitter:description: Configure Proof Key for Code Exchange (PKCE) and mapping templates
  for OpenID Connect and Okta Workforce connections.
twitter:title: Configurer la PKCE et le mappage des demandes pour les connexions OIDC
---

Enterprise connections using [OpenID Connect](/docs/authenticate/identity-providers/enterprise-identity-providers/oidc) or O[kta Workforce](/docs/authenticate/identity-providers/enterprise-identity-providers/okta) as the <Tooltip tip="Identity Provider (IdP): Service that stores and manages digital identities." cta="View Glossary" href="/docs/glossary?term=identity+provider">identity provider</Tooltip> can support Proof Key for Code Exchange (PKCE), as well as attribute and token mapping.

## Configurer la PKCE pour les connexions OIDC

<Tooltip tip="OpenID: Open standard for authentication that allows applications to verify users' identities without collecting and storing login information." cta="View Glossary" href="/docs/glossary?term=OpenID">OpenID</Tooltip> Connect and Okta Workforce connections are automatically configured to support Proof Key for Code Exchange (PKCE).

If your OIDC identity provider (IdP) supports PKCE through OIDC Discovery metadata, Auth0 will use the strongest algorithm available by default. For more information on OIDC Discovery metadata, review [OpenID’s documentation](https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata).

### Afficher la configuration PKCE pour une connexion

You can view the PKCE configuration for a specific connection through the <Tooltip tip="Auth0 Dashboard: Auth0's main product to configure your services." cta="View Glossary" href="/docs/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip>:

1. Navigate to **Authentication > Enterprise** and choose your OIDC provider (either OpenID Connect or Okta Workforce).
2. Select the **Settings** tab.
3. In the **General** section, locate the **Connection Profile** field.

<Tabs><Tab title="Auth0 Dashboard">

You can manage the PKCE configuration for a connection through the Auth0 Dashboard:

1. Navigate to [**Dashboard > Authenticate >Enterprise**](https://manage.auth0.com/#/connections/enterprise) and choose your OIDC provider (either OpenID Connect or Okta Workforce).
2. Select the **Settings** tab and locate the **Connection Profile** field.
3. Set the `pkce` property to one of the [supported values](#supported-pkce-configuration-values) listed below.
4. Select **Save**.

</Tab><Tab title="Management API">

#### Use discovery endpoint

```bash lines
curl --request POST \
--url 'https://{yourDomain}/api/v2/connections' \
--header 'authorization: Bearer MGMT_API_ACCESS_TOKEN' \
--data '{ 
  "strategy": "oidc", 
   "name": "CONNECTION_NAME", 
   "options": { 
     "type": "back_channel", 
     "discovery_url": "https://IDP_DOMAIN/.well-known/openid-configuration", 
     "client_id" : "IDP_CLIENT_ID", 
     "client_secret" : "IDP_CLIENT_SECRET", 
     "scopes": "openid profile", 
     "connection_settings": { "pkce": "auto" }
               } 
          }'
```






#### Without discovery endpoint

Without a `discovery_url` the `oidc_metadata` object needs to be populated manually with the necessary fields.

```bash lines
curl --request POST \
  --url 'https://{yourDomain}/api/v2/connections' \
  --header 'authorization: Bearer MGMT_API_ACCESS_TOKEN' \
  --data '{
    "strategy": "oidc",
    "name": "CONNECTION_NAME",
    "options": {
      "type": "back_channel",
      "client_id": "IDP_CLIENT_ID",
      "client_secret": "IDP_CLIENT_SECRET",
      "connection_settings": { "pkce": "auto" },
      "issuer": "https://IDP_DOMAIN",
      "authorization_endpoint": "https://IDP_DOMAIN/authorize",
      "jwks_uri": "https://IDP_DOMAIN/.well-known/jwks.json",
      "scopes": "openid profile",
      "oidc_metadata": {
        "issuer": "https://IDP_DOMAIN",
        "authorization_endpoint": "https://IDP_DOMAIN/authorize",
        "jwks_uri": "https://IDP_DOMAIN/.well-known/jwks.json",
        "token_endpoint": "https://IDP_DOMAIN/token/refresh",
        "code_challenge_methods_supported": ["plain", "S256"]
      }
    }
  }'
```






</Tab></Tabs>

### Valeurs de configuration PKCE prises en charge

Auth0 prend en charge les valeurs suivantes pour la configuration PKCE :

<table class="table"><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auto</code></td>
<td>Default value. Uses the strongest algorithm available.</td>
</tr>
<tr>
<td><code>s256</code></td>
<td>Uses the SHA-256 algorithm. Auth0 does not currently support RS512 tokens.</td>
</tr>
<tr>
<td><code>plain</code></td>
<td>Uses plaintext as described in the <a href="https://www.rfc-editor.org/rfc/rfc7636#section-4.2" title="Proof Key for Code Exchange by OAuth Public Clients - Code Challenge">PKCE specification</a>.</td>
</tr>
<tr>
<td><code>disabled</code></td>
<td>Disables support for PKCE.</td>
</tr>
</tbody>
</table>

<Warning>

Setting the `pkce` property to a value other than `auto`may prevent a connection from working properly if the selected value is not supported by the identity provider.

Do not set the property to `disabled` except when troubleshooting authentication issues.

</Warning>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

**Azure AD Limitation**

If you are using an OpenID Connect connection for Azure AD, you must set `pkce` to `s256` as the connection's metadata does not expose the hashing algorithm used. Currently, the [Azure AD Enterprise connection](/docs/authenticate/identity-providers/enterprise-identity-providers/azure-active-directory/v2) does not support PKCE.

</Callout>

## Mapper les demandes pour les connexions OIDC

Les connexions OpenID Connect et Okta Workforce peuvent automatiquement mapper les demandes reçues du fournisseur d’identité (IdP). Vous pouvez configurer ce mappage à l’aide d’un modèle de bibliothèque fourni par Auth0 ou en saisissant directement votre propre modèle.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Mapped claims are not automatically added to an Auth0 ID token. To add claims to an ID token, see [Create custom claims](/docs/secure/tokens/json-web-tokens/create-custom-claims#create-custom-claims).

</Callout>

### Propriétés du modèle de mappage

Les modèles de mappage prennent en charge les propriétés de l’objet `options.attribute_map` énumérées ci-dessous. Les modèles doivent être au format JSON avec des paires clé/valeur valides.

<table class="table"><thead>
<tr>
<th><strong>Property</strong></th>
<th><strong>Required?</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mapping_mode</code></td>
<td>Required</td>
<td>Method used to map incoming claims.</td>
</tr>
<tr>
<td><code>userinfo_scope</code></td>
<td>Optional</td>
<td>Scopes to send to the IdP's Userinfo endpoint.</td>
</tr>
<tr>
<td><code>attributes</code></td>
<td>Required</td>
<td>Object containing mapping details for incoming claims.</td>
</tr>
</tbody>
</table>

### Mode de mappage

La propriété `mapping_mode` définit la méthode utilisée pour faire correspondre les demandes entrantes de l’IdP au profil utilisateur Auth0. `mapping_mode` prend en charge les valeurs suivantes :

<table class="table"><thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>use_map</code></td>
<td>Uses the provided template to map the data.</td>
</tr>
<tr>
<td><code>bind_all</code></td>
<td>Copies all data elements provided by the IdP.</td>
</tr>
</tbody>
</table>

#### Demandes restreintes

Certaines demandes sont réservées à l’usage d’Auth0 : de telles demandes ne peuvent pas être utilisées comme clés d’attribut pour les profils utilisateurs.

Si vous attribuez la valeur `bind_all` à la propriété `mapping_mode`, votre IdP peut tenter de faire correspondre des valeurs à une ou plusieurs de ces demandes restreintes. Bien que cela n’empêche pas les utilisateurs de s’authentifier sur votre connexion, les valeurs associées aux demandes restreintes ne sont **pas** transmises au profil utilisateur Auth0.

Si vous attribuez la valeur `use_map` à `mapping_mode`, vous pouvez faire correspondre la demande restreinte entrante à une demande valide :

```json lines
"attribute_map": {
        "mapping_mode": "use_map",
        "attributes": {
            "amr": "{context.tokenset.amr}", // `amr` is a restricted claim and will not be mapped
            "federated_amr": "{context.tokenset.amr}" // `federated_amr` is not a restricted claim and will be mapped
        }
    }
```






For a complete list of restricted claims, review [Create Custom Claims](/docs/secure/tokens/json-web-tokens/create-custom-claims).

### La permission UserInfo

La propriété `userinfo_scope` définit les permissions qu’Auth0 envoie au point de terminaison UserInfo de l’IdP lorsqu’elles sont demandées.

Par exemple, si vous souhaitez envoyer les permissions OIDC standard et la permission `groups` lorsque vous demandez le point de terminaison UserInfo, vous pouvez procéder comme suit :

```json lines
"attribute_map": {
    . . .
    "mapping_mode": "bind_all",
    "userinfo_scope": "openid email profile groups",
    . . .
}
```






### Attributs

La propriété `attributes` est un objet contenant des informations de mappage qui permettent à Auth0 d’interpréter les demandes entrantes de l’IdP. Les informations de mappage doivent être fournies sous forme de paires clé/valeur.

La clé à gauche correspond à un attribut de profil utilisateur Auth0. La valeur à droite représente la demande entrante de l’IdP qui peut être exprimée comme une valeur littérale, un objet de contexte dynamique ou une combinaison des deux. Les objets de contexte dynamique sont des expressions de modèle écrites dans le format `${variable}` familier.

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "name": "${context.tokenset.name}",
        "email": "${context.tokenset.email}",
        "username": "${context.tokenset.preferred_username}"
    }
}
```






#### Valeurs littérales

Une valeur littérale est une valeur statique attribuée à un attribut de profil spécifique pour tous les utilisateurs sur votre connexion.

Par exemple, si vous configurez une connexion OIDC SalesForce et que vous souhaitez attribuer le même identifiant de communauté SFDC à tous les profils utilisateurs, vous pouvez procéder comme suit :

```json lines
"attribute_map": {
    . . .
    "attributes": {
        …
        "sf_community_id": "3423409219032-32"
    }
}
```






#### Objet de contexte

Vous pouvez faire correspondre des valeurs dynamiques aux attributs du profil utilisateur en utilisant l’objet `context`. Cela vous permet de stocker des valeurs uniques pour les profils individuels, contrairement aux valeurs littérales qui sont statiques pour tous les profils.

The `context` object supports the following properties:

<table class="table"><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context.connection</code></td>
<td>Contains the following properties:<br/><br/><li> <code>id</code>: The connection’s unique identifier (for example, <code>con_4423423423432423</code>).</li><br/><li> <code>strategy</code>: The connection’s strategy (for example, <code>oidc</code>).</li></td>
</tr>
<tr>
<td><code>context.tokenset</code></td>
<td>Contains the following properties:<br/><br/><li> <code>access_token</code>: The entire validated access token sent by the IdP.</li><br/><li><code>&lt;claim name&gt;</code>: Any ID token claim sent by the IdP.</li></td>
</tr>
<tr>
<td><code>context.userinfo</code></td>
<td>Contains the following properties:<br/><br/><li> <code>&lt;claim name&gt;</code>: Any available claim provided by the IdP’s UserInfo endpoint.</li></td>
</tr>
</tbody>
</table>

### Exemples

#### Mappage simple des demandes utilisateur

This example demonstrates how to map common user claims to the Auth0 user profile with data from the <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip>:

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "name": "${context.tokenset.name}",
        "email": "${context.tokenset.email}",
        "username": "${context.tokenset.preferred_username}"
    }
}
```






#### Mappage des demandes de groupe

Cet exemple montre comment faire correspondre les groupes au profil utilisateur Auth0 à partir de l’IdP entrant :

```json lines
"attribute_map": {
    . . .
    "attributes": {
        "federated_groups": "${context.userinfo.groups}",
        "federated_locale": "${context.userinfo.locale}",
        "federated_zoneinfo": "${context.userinfo.zoneinfo}"
    }
}
```






#### Combinaison de valeurs littérales et d’objets de contexte

Cet exemple montre comment combiner des valeurs littérales et des expressions de modèle dynamique pour faire correspondre une valeur complexe à un attribut sur le profil utilisateur Auth0 :

```json lines
"attribute_map":{
    . . .
    "attributes": {
        "alt_id": "user_email|${context.tokenset.email}",
        . . .
    }
}
```