---
og:description: Describes how to call an external Identity Provider API.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Appeler une API de fournisseur d’identité
og:url: https://auth0.com/docs/
permalink: calling-an-external-idp-api
title: Appeler une API de fournisseur d’identité
twitter:description: Describes how to call an external Identity Provider API.
twitter:title: Appeler une API de fournisseur d’identité
---

Lorsque vous authentifiez avec succès un utilisateur auprès d’un fournisseur d’identité externe (IdP), tel que Facebook ou GitHub, l’IdP inclut souvent un jeton d’accès dans le profil utilisateur qu’il renvoie à Auth0.

Vous pouvez récupérer et utiliser ce jeton pour appeler l’API de l’IdP.



La procédure à suivre diffère selon que votre code s’exécute dans le système dorsal ou dans le système du côté client.

* Si votre code s’exécute dans le système dorsal, nous pouvons supposer que votre serveur est fiable pour stocker des secrets en toute sécurité (comme vous le verrez, nous utilisons un secret dans le scénario du système dorsal). Si c’est le cas, passez à la section [système dorsal](#from-the-backend) de cet article.
* Si votre code s’exécute dans le système du côté client (par exemple, il s’agit d’une application à page unique, d’une application native de bureau ou d’une application mobile), votre application ne peut pas conserver les informations d’identification de manière sécurisée et doit suivre une autre approche. Dans ce cas, passez à la section [système du côté client](#from-the-frontend) de cet article.

## Depuis le système dorsal

Lorsque vous authentifiez un utilisateur, l’IdP inclut souvent un jeton d’accès dans le profil utilisateur qu’il renvoie à Auth0.

Pour des raisons de sécurité et de conformité, Auth0 n’envoie pas ce jeton à votre application dans le cadre du profil utilisateur. Pour l’obtenir, vous devez accéder à Management API d’Auth0 et récupérer le profil complet de l’utilisateur.

1. Obtenez un jeton d’accès qui vous permet d’appeler la [Management API d’Auth0](/api/management/v2).
2. Appelez le point de terminaison [Obtenir les utilisateurs selon leurs ID](/api/management/v2#!/Users/get_users_by_id) du Management API d’Auth0 à l’aide du jeton d’accès obtenu à la première étape. Ce point final renvoie le profil complet de l’utilisateur, qui contient le jeton d’accès à l’IdP.
3. Extraire le jeton d’accès de l’IdP de la réponse et l’utiliser pour appeler l’API de l’IdP.

### Étape 1 : Obtenir un jeton

Vous aurez besoin d’un jeton d’accès pour appeler la [Management API](/api/management/v2).

#### Créer une application d’essai pour Management API

Si c’est la première fois que vous demandez un [Jeton Management APIv2](/api/management/v2/tokens), vous devrez créer et configurer une application qui peut être utilisée pour appeler Management API :

1. Naviguez vers [Auth0 Dashboard > Applications > API](%24%7Bmanage_url%7D/#/apis), et sélectionnez [Auth0 Management API](%24%7Bmanage_url%7D/#/apis/management/authorized-clients).
2. Sélectionnez la vue **Explorateur d’API** et cliquez sur **Créer et autoriser une application d’essai**.

Cela créera une nouvelle application et accordera toutes les permissions de Management API, ce qui signifie que les jetons générés pour cette application pourront accéder à tous les points de terminaison du Management API.





Pour accorder ou supprimer des permissions de Management API d’Auth0 [enregistrée](%24%7Bmanage_url%7D/#/apis/management/authorized-clients), sélectionnez la [**vue**Machine to Machine Applications (Applications de communication entre machines)](%24%7Bmanage_url%7D/#/apis/management/authorized-clients) :

#### Obtenir le jeton de Management API

Vous avez maintenant terminé la configuration et êtes prêt à obtenir votre jeton de Management API :

1. À partir de la [Management API d’Auth0 enregistrée ](%24%7Bmanage_url%7D/#/apis/management/authorized-clients), sélectionnez la [**vue**Essai](%24%7Bmanage_url%7D/#/apis/management/test).
2. Choisissez votre application dans le menu déroulant **Application** pour pré-remplir les extraits prêts à l’emploi avec des variables personnalisées.
3. Choisissez le langage de votre choix pour l’extrait, puis copiez-le et exécutez-le.
4. Extrayez la propriété `access_token` de la réponse. C’est ce que vous utiliserez pour accéder à Management API.



#### Expiration du jeton

Par défaut, le jeton que vous avez reçu expire dans 24 heures (86 400 secondes). Pour changer cela :

1. Naviguez vers [Auth0 Dashboard > Applications > API](%24%7Bmanage_url%7D/#/apis), et sélectionnez [Auth0 Management API](%24%7Bmanage_url%7D/#/apis/management/authorized-clients).
2. Sélectionnez la vue **Paramètres**, localisez le champ **Expiration du jeton (secondes)**, saisissez une nouvelle valeur et cliquez sur **Enregistrer**. La valeur maximale que vous pouvez définir est de 2 592 000 secondes (30 jours), mais nous vous recommandons de conserver la valeur par défaut.

Le prochain jeton que vous générerez utilisera le délai d’expiration mis à jour.



### Étape 2 : Obtenir le profil utilisateur complet

Pour obtenir le profil d’un utilisateur, appelez le point de terminaison [Obtenir un utilisateur](/api/management/v2#!/Users/get_users_by_id) du Management API en utilisant le jeton d’accès que vous avez extrait dans la section précédente.



Remplacer ces valeurs :

* `{userId}` : ID de l’utilisateur pour lequel vous souhaitez appeler l’API de l’IdP.
* `{yourAccessToken}` : Jeton d’accès que vous avez extrait dans la section précédente.



### Étape 3 : Extraire le jeton d’accès de l’IdP

Vous pouvez trouver le jeton d’accès utilisé pour appeler l’API de l’IdP dans le tableau `identities` de l’utilisateur : `user.identities[0].access_token`.



Dans la plupart des cas, l’utilisateur n’aura qu’une seule identité, mais si l’utilisateur s’est connecté plusieurs fois via différentes connexions et que vous avez utilisé l’[association de comptes](/users/user-account-linking/link-user-accounts), il peut y en avoir plusieurs.

Dans cet exemple de réponse, nous voyons que notre utilisateur n’a qu’une seule identité : `google-oauth2`.



Vous êtes maintenant prêt à appeler l’API de l’IdP. Veuillez vous référer à la documentation de l’IdP pour plus de détails sur la façon de procéder.





## Depuis le côté client

Si vous travaillez avec une application publique (application à page unique, bureau natif ou application mobile), vous êtes au bon endroit.

Lorsque vous travaillez avec une application du côté client, le processus d’appel des IdP API diffère du processus du système dorsal, car les applications du côté client sont des applications publiques qui **ne peuvent pas conserver les informations d’identification en toute sécurité**. Étant donné que le code d’une application à page unique peut être consulté et modifié, et que les applications natives/mobiles peuvent être décompilées et inspectées, on ne peut pas leur faire confiance pour conserver des informations sensibles telles que des clés secrètes ou des mots de passe.

En particulier, elles ne peuvent pas contenir en toute sécurité le **Secret du client** pour l’application de communication entre machines, laquelle vous utilisez pour appeler `/oauth/token` au cours de la première étape du processus dorsal.

Au lieu de cela, vous devez construire un proxy pour votre système dorsal et l’exposer à votre application en tant qu’API.

### Construire un proxy

Tout d’abord, vous allez construire un processus dans votre programme dorsal qui mettra en œuvre les étapes incluses dans [la section du système dorsal](#from-the-backend) de cet article, et l’exposer à votre application en tant qu’API.

Vous appellerez l’API de l’IdP à partir du même processus dorsal, de sorte que le jeton d’accès ne soit jamais exposé à votre application publique.

Ensuite, vous appelerez l’API de votre proxy à partir de votre application publique en utilisant le [Flux de code d’autorisation avec Proof Key for Code Exchange (PKCE)](/login/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce).