---
og:description: Describes the deprecation of using ID tokens as credentials for the
  Management API and how to migrate your configuration to use access tokens.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Migrer vers les points de terminaison de Management API avec des jetons
  d’accès
og:url: https://auth0.com/docs/
permalink: migrate-to-calling-api-with-access-tokens
title: Migrer vers les points de terminaison de Management API avec des jetons d’accès
twitter:description: Describes the deprecation of using ID tokens as credentials for
  the Management API and how to migrate your configuration to use access tokens.
twitter:title: Migrer vers les points de terminaison de Management API avec des jetons
  d’accès
---

L’utilisation des jetons d’ID pour appeler les points de terminaison de Management API est obsolète. Vous devez utiliser des jetons d’accès. La période de grâce pour cette migration a commencé le **31 mars 2018**.

Une fois la migration vers les jetons d’accès terminée, désactivez le bouton à bascule **Autoriser les jetons d’ID pour l’authentification Management API v2** dans le Dashboard.

Si vous utilisez des jetons d’ID pour appeler l’un des points de terminaison suivants, vous êtes concerné par cette migration. Ces points de terminaison peuvent désormais accepter des jetons d’accès ordinaires. Rien d’autre ne change dans la façon dont les points de terminaison fonctionnent. Les schémas de demande et de réponse sont les mêmes et il suffit de mettre à jour le jeton que vous utilisez pour l’autorisation.

## Points de terminaison concernés



## Actions

### Modifications de permissions

Les actions que vous pouvez effectuer avec Management API dépendent des permissions que votre jeton d’accès contient. Avec cette migration, vous pouvez obtenir soit un jeton d’accès limité qui ne peut mettre à jour que les données de l’utilisateur connecté, soit un jeton d’accès qui peut mettre à jour les données de n’importe quel utilisateur. Dans la matrice suivante, vous pouvez voir les permissions que votre jeton doit avoir par cas et par point de terminaison.

Par exemple, si vous obtenez un jeton d’accès qui contient la permission `read:users`, vous pouvez récupérer les données de n’importe quel utilisateur en utilisant le point de terminaison `GET /api/v2/users/{id} `. Toutefois, si votre jeton contient la permission `read:current_user`, vous ne pouvez récupérer que les informations de l’utilisateur actuellement connecté (celui pour lequel le jeton a été émis).



### Obtenir des jetons d’accès

Auth0 a modifié la façon dont vous obtenez un jeton pour les points de terminaison mentionnés ci-dessus. Il existe plusieurs variantes sur la manière d’authentifier un utilisateur et d’obtenir des jetons, en fonction de la technologie et du flux OAuth 2.0 que vous utilisez pour l’authentification :

* **SPA fonctionnant dans un navigateur** : utilisez le point de terminaison d’autorisation.
* **Application Web exécutée sur un serveur, application mobile, processus serveur ou application hautement fiable** : utilisez le point de terminaison du jeton.
* **Authentification croisée** : utilisez Lock intégré ou auth0.js pour authentifier les utilisateurs lorsque les demandes proviennent de domaines différents.

#### Point de terminaison d’autorisation

Dans cette section, nous allons utiliser un exemple pour montrer les différences dans la façon dont vous obtenez un jeton avec le point de terminaison Authorization. Gardez à l’esprit que, quel que soit le point de terminaison que vous souhaitez migrer, les changements sont les mêmes, la seule chose qui diffère sont les permissions que vous spécifiez dans la requête.

Dans l’exemple ci-dessous, vous utilisez le point de terminaison `GET User by ID (Obtenir l’utilisateur par identifiant)` pour récupérer les informations de profil complètes de l’utilisateur connecté. Pour ce faire, nous allons d’abord authentifier l’utilisateur à l’aide de l’octroi implicite et récupérer le(s) jeton(s). Vous pouvez voir ci-dessous une implémentation de l’ancienne approche qui obtient un jeton d’ID et l’utilise ensuite pour appeler le point de terminaison.



Dans l’exemple ci-dessous, vous pouvez voir la nouvelle approche qui obtient un jeton d’accès.



Pour obtenir un jeton d’accès permettant d’accéder à Management API :

* Définir `audience` à `https://${account.namespace}/api/v2/`
* Demander la permission `${scope}`
* Définissez le `response_type` à `id_token token` pour que Auth0 envoie à la fois un jeton d’ID et un jeton d’accès.

Si vous décodez le jeton d’accès reçu et examinez son contenu, vous verrez ce qui suit :



Remarquez que `aud` est défini sur l’URI de l’API de votre locataire, `scope` est défini sur `${scope}`, et `sub` est défini sur l’identifiant de l’utilisateur connecté.

Une fois que vous avez le jeton d’accès, vous pouvez l’utiliser pour appeler le point de terminaison. Cette partie reste inchangée, rien d’autre ne change dans la demande, à l’exception de la valeur utilisée comme jeton `Bearer`. La réponse reste également la même.

#### Point de terminaison du jeton

Dans cette section, nous allons utiliser un exemple pour montrer les différences dans la façon dont vous obtenez un jeton avec le point de terminaison du jeton. Gardez à l’esprit que, quel que soit le point d’accès que vous souhaitez migrer, les changements sont les mêmes, la seule chose qui diffère est les permissions que vous spécifiez dans la requête.

Dans l’exemple ci-dessous, vous souhaitez utiliser le point de terminaison `GET User by ID` pour récupérer les informations de profil complètes de l’utilisateur connecté. Tout d’abord, authentifiez l’utilisateur à l’aide de l’octroi Password Exchange (Échange de mot passe), puis récupérez le(s) jeton(s). Vous pouvez voir ci-dessous une implémentation de l’ancienne approche qui obtient un jeton d’ID (et l’utilise ensuite pour appeler le point de terminaison).



Dans l’exemple ci-dessous, vous pouvez voir la nouvelle approche qui obtient également un jeton d’accès.



Pour obtenir un jeton d’accès permettant d’accéder à Management API :

* Définir le `aud` à `https://${account.namespace}/api/v2/`
* Demandez la permission `read:current_user`

Une fois que vous avez le jeton d’accès, vous pouvez l’utiliser pour appeler le point de terminaison. Cette partie reste inchangée, rien d’autre ne change dans la demande, à l’exception de la valeur utilisée comme jeton `Bearer`. La réponse reste également la même.

#### Lock intégré ou auth0.js

Si vous intégrez Lock ou auth0.js v9 dans votre application, vous utilisez l’authentification inter-origines. Celle-ci est utilisée pour authentifier les utilisateurs lorsque les demandes proviennent de domaines différents.

Si vous utilisez auth0.js pour accéder à Management API et gérer vos utilisateurs, votre script devra être mis à jour.

Dans l’exemple ci-dessous, vous pouvez voir l’ancienne approche.



Dans cet exemple, vous pouvez voir la nouvelle approche.



* Demandez un jeton d’ID et un jeton d’accès dans la réponse

`responseType: ’token id_token’`
* Définir Management API comme audience visée par le jeton

`audience: ’https://YOUR_DOMAIN/api/v2/’`
* Demander la permission requise

`scope: ’read:current_user’`
* S’authentifier auprès de Management API à l’aide du jeton d’accès

### Changements dans la liaison des comptes

Les modifications apportées à cette fonctionnalité sont les suivantes :

* Vous ne pouvez plus utiliser de jeton d’ID dans l’en-tête `Authorization`.
* Si vous utilisez un jeton d’accès dans l’en-tête `Authorization`, avec `update:users` comme permission accordée, vous pouvez envoyer dans le corps de la requête soit le `user_id`, soit le jeton d’ID du compte secondaire.
* Si vous utilisez un jeton d’accès dans l’en-tête `Authorization`, avec `update:current_user_metadata` comme permission accordée, vous ne pouvez envoyer que le jeton d’ID du compte secondaire dans le corps de la requête. Les conditions suivantes doivent être remplies :

* Le jeton d’ID doit être signé à l’aide de `RS256` (vous pouvez définir cette valeur dans **Dashboard > Applications > Paramètres de l’application > Paramètres avancés > OAuth**).
* La demande `aud` du jeton d’ID doit identifier l’application et avoir la même valeur que la demande `azp` du jeton d’accès.

## Restrictions

Les jetons d’accès utilisés pour accéder à Management API ne doivent contenir qu’une seule valeur au niveau de la demande `aud`. Si votre jeton contient plus d’une valeur, votre demande au Management API sera rejetée.