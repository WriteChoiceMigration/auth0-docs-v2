---
og:description: Describes how to migrate from legacy authentication flows.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Migrer depuis des flux d’authentification hérités
og:url: https://auth0.com/docs/
permalink: migrate-from-legacy-auth-flows
title: Migrer depuis des flux d’authentification hérités
twitter:description: Describes how to migrate from legacy authentication flows.
twitter:title: Migrer depuis des flux d’authentification hérités
---

Lorsque vous utilisez des versions de Lock antérieures à 11 et Auth0.js antérieures à 9, il est possible que vous utilisiez certains flux d’authentification hérités, qui sont obsolètes. Auth0 recommande de migrer le code des anciennes versions d’Auth0.js et de Lock vers les nouvelles API conformes à l’OIDC.

## Jetons de renouvellement

Legacy applications used <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=Refresh+Tokens">Refresh Tokens</Tooltip> and the `refreshToken()` function as a way to get new tokens upon expiration (an example of this is below).

In auth0.js v9 and Lock 11 you need to use [Silent Authentication](/docs/authenticate/login/configure-silent-authentication) and `checkSession()`(an example of this is below).

## Appeler des API

Legacy applications used an <Tooltip tip="ID Token: Credential meant for the client itself, rather than for accessing a resource." cta="View Glossary" href="/docs/glossary?term=ID+token">ID token</Tooltip> to invoke APIs. This is a bad practice, and we recommend that you only use <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/docs/glossary?term=access+tokens">access tokens</Tooltip>.

Pour appeler une API, vous devrez spécifier l’identifiant de l’API en tant que paramètre `audience` lors de l’initialisation d’auth0.js ou de Lock.

If you specify an <Tooltip tip="Audience: Unique identifier of the audience for an issued token. Named aud in a token, its value contains the ID of either an application (Client ID) for an ID Token or an API (API Identifier) for an Access Token." cta="View Glossary" href="/docs/glossary?term=audience">audience</Tooltip>, then the OIDC flow will be triggered and the user profile data returned by Auth0 in ID tokens or from `/userinfo` will be OIDC conformant. If your application is using any non-standard claim from the user profile, it will break.

Voir la section **Appeler une API** de notre guide de Démarrage rapide pour les applications à page unique pour plus d’informations sur la manière d’appeler des API à partir d’une application à page unique. Vous devrez également migrer votre implémentation dorsale d’API pour utiliser des jetons d’accès. Reportez-vous à la section Démarrage rapide - API pour savoir comment procéder.

## Profils utilisateurs

Les flux d’authentification hérités qui permettent aux jetons d’ID et au point de terminaison `/userinfo` d’inclure le profil utilisateur complet sont obsolètes. Assurez-vous que le bouton à bascule `Legacy User Profile (Profil utilisateur hérité)` est désactivé après avoir effectué la migration vers les nouvelles API conformes à l’OIDC.

Lors de l’utilisation des flux d’authentification hérités, le profil utilisateur complet est renvoyé dans les jetons d’ID et à partir de `/userinfo`, comme indiqué ci-dessous.

The new user profile conforms to the OIDC specification, which allows for certain [standard claims](https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims) to be available in the response.

Le contenu variera en fonction des permissions demandées. Vous devrez ajuster les permissions demandées lors de la configuration d’Auth0.js ou de Lock afin que toutes les demandes dont vous avez besoin soient disponibles dans votre application. Notez que vous pouvez ajouter des demandes personnalisées pour renvoyer les données que vous souhaitez (par exemple, les métadonnées de l’utilisateur).

Another approach to get the full user profile is to use the <Tooltip tip="Management API: A product to allow customers to perform administrative tasks." cta="View Glossary" href="/docs/glossary?term=Management+API">Management API</Tooltip> (instead of getting the profile through the authentication flow) as described in the next section.

## Obtenir le profil utilisateur avec Management API

Dans les flux hérités, Management API prenait en charge l’authentification à l’aide d’un jeton d’ID. Cette approche a été abandonnée et vous devez maintenant l’appeler avec un jeton d’accès.

To get an Access Token, you need to ask Auth0 for one using the `https://{yourDomain}/api/v2/` audience. Auth0 does not currently support specifying two audiences when authenticating, so you will need to still use your application's API audience when initializing Lock or auth0.js. Once the user is authenticated, you can use `checkSession` to retrieve a Management API `access_token`, and then call the `getUser()` endpoint.

Vous pouvez demander les permissions suivantes :

* `read:current_user`
* `update:current_user_identities`
* `create:current_user_metadata`
* `update:current_user_metadata`
* `delete:current_user_metadata`
* `create:current_user_device_credentials`
* `delete:current_user_device_credentials`

You could get a `consent_required` error when calling `checkSession()`. If you do, make sure you have **Allow Skipping User Consent** enabled for the Management API and that you are not running from localhost.