---
og:description: Learn how to enable automatic user migration with your custom database.
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Configurer la migration automatique à partir de votre base de données
og:url: https://auth0.com/docs/
permalink: configure-automatic-migration-from-your-database
title: Configurer la migration automatique à partir de votre base de données
twitter:description: Learn how to enable automatic user migration with your custom
  database.
twitter:title: Configurer la migration automatique à partir de votre base de données
---

Configurez votre connexion à la base de données pour migrer automatiquement vos utilisateurs d’un magasin d’utilisateurs externe vers Auth0 à l’aide de [scripts d’action de base de données personnalisés](/templates).



## Configurez la connexion à la base de données en tant que personnalisée.

Créez une connexion à la base de données, puis définissez-la comme personnalisée.

1. Allez dans [Auth0 Dashboard > Authentification > Base de données](%24%7Bmanage_url%7D/#/connections/database) et sélectionnez la base de données à afficher.
2. Sélectionnez l’aperçu **Base de données personnalisée** , puis activez **Utiliser ma propre base de données**.
3. Sélectionnez l’aperçu **Paramètres**, puis activez **Importer les utilisateurs vers Auth0**, ensuite cliquez sur **Enregistrer**.

## Configurez les scripts d’action de base de données.

Sélectionnez l’aperçu **Base de données personnalisée**, puis localisez **Scripts d’action de base de données**.

### Connexion

Le script [Connexion](/login) s’exécute chaque fois qu’un utilisateur non trouvé dans Auth0 tente de se connecter. Il vérifie que l’utilisateur existe dans le magasin d’utilisateurs externe sans redemander le mot de passe à ce dernier.

### Obtenir un utilisateur

Le script [Obtenir l’utilisateur](/get-user) s’exécute après l’un des scénarios suivants :

* Un utilisateur initie une tentative d’inscription.
* Un utilisateur initie un processus de changement de mot de passe.
* Un utilisateur saisit son identifiant de connexion lorsqu’il utilise Identifier First + Données biométriques.
* Il est fait appel au point de terminaison de Management API [mettre à jour le courriel ou le nom d’utilisateur](/api/v2#!/Users/patch_users_by_id) ou [créer un utilisateur](/api/management/v2#!/Users/post_users) .

Si un utilisateur qui n’a pas été migré confirme un changement de mot de passe et se connecte avec succès, son profil utilisateur sera créé dans Auth0 avec le nouveau mot de passe. Ce profil utilisateur contient toutes les données renvoyées dans le script Obtenir l’utilisateur. Toutes les connexions ultérieures pour cet utilisateur seront effectuées directement dans Auth0.

## Vérifiez que la migration des utilisateurs est complète.

Vérifiez que tous les utilisateurs ont été migrés vers le magasin d’utilisateurs Auth0 en utilisant le tableau de bord Auth0 ou Management API Auth0.

1. Allez à [Auth0 Dashboard > Gestion des utilisateurs > Utilisateurs](%24%7Bmanage_url%7D/#/users), et examinez la liste des utilisateurs.
2. Utilisez le point de terminaison [List or Search Users (Lister ou Rechercher des utilisateurs)](/api/v2#!/Users/get_users) de Management API.

## Déconnectez le magasin d’utilisateurs externe.

Reconfigurer les scripts d’action de base de données car aucune opération ne fonctionne. Cela empêchera Auth0 d’accéder à votre magasin d’utilisateurs externe pour authentifier les utilisateurs.



1. Allez à [Auth0 Dashboard > Authentification > Base de données](%24%7Bmanage_url%7D/#/connections/database), ensuite sélectionnez votre connexion à la base de données.
2. Passez à l’aperçu **Base de données personnalisée**, puis localisez **Scripts d’action de base de données**.
3. Mettre à jour le script de **Connexion** .
4. Mettre à jour le script **Obtenir l’utilisateur** .

## Résoudre les problèmes de migration des utilisateurs.

Si vous rencontrez des problèmes avec la migration automatique, lisez premièrement [Les meilleures pratiques pour la connexion à la base de données personnalisée et les scripts d’action.](/custom-database-connections-scripts).

### L’utilisateur existe déjà.

Les scénarios les plus courants relatifs à quand vous pourriez rencontrer ce problème :

* Vous supprimez un utilisateur de votre connexion à la base de données, puis vous essayez de le recréer.
* Vous essayez de créer un nouvel utilisateur sur votre connexion à la base de données alors que ledit utilisateur existe déjà dans votre magasin d’utilisateurs externe.
* Un processus de migration d’un utilisateur a été interrompu.

Au cours du processus de migration de l’utilisateur, Auth0 crée premièrement un profil utilisateur partiel dans un magasin d’utilisateurs interne, puis crée un profil utilisateur complet dans votre connexion à la base de données. Si un problème survient qui empêche la création de ce profil utilisateur complet, vous pourriez faire face à l’erreur `The user already exists` .

Vous pouvez généralement résoudre ce problème en supprimant l’utilisateur de la connexion à la base de données, en supprimant l’utilisateur du magasin d’utilisateurs interne, puis en réessayant le processus de migration.

1. Vérifiez les instructions `console.log()` avec l’[extension Journaux Webtask en temps réel](/extensions/real-time-webtask-logs).
2. Supprimez l’utilisateur avec le point de terminaison [Delete a User (Supprimer un utilisateur)](https://auth0.com/docs/api/management/v2#!/Users/delete_users_by_id) de Management API.
3. Supprimez l’utilisateur avec le point de terminaison [Delete a Connection User (Supprimer un utilisateur de connexion)](/api/management/v2#!/Connections/delete_users_by_email) de Management API.
4. Demandez à l’utilisateur de se connecter ou de changer son mot de passe pour réessayer la migration.

### Métadonnées manquantes.

Si un utilisateur est interrompu pendant le processus de connexion ou de changement de mot de passe qui initie la migration, Auth0 peut ne pas être en mesure de transférer ses métadonnées (`user_metadata` ou `app_metadata`) avec ses autres données de profil.

Vous pouvez atténuer ce scénario en créant une [Action](/actions) qui vérifie si le profil de l’utilisateur manque de métadonnées, les récupère depuis le magasin d’utilisateurs externe, puis les stocke dans Auth0.