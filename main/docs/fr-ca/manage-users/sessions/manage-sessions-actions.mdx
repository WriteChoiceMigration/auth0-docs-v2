---
og:description: Learn about managing sessions with Actions
og:image: https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
og:title: Sessions avec actions
og:url: https://auth0.com/docs/
permalink: manage-sessions-actions
title: Sessions avec actions
twitter:description: Learn about managing sessions with Actions
twitter:title: Sessions avec actions
---

Using Sessions with [Actions](/docs/customize/actions) allows you to configure post-authentication risk detection and response capabilities to protect your applications and users against session hijacking. You can also dynamically customize the [session lifetime limits](/docs/manage-users/sessions/configure-session-lifetime-settings).

Pour faciliter cela, les Actions post-connexion comportent deux objets clés :

* **event.session** : Fournit des renseignements pertinents, y compris les données `id`, `created_at`, `expires_at`, `idle_expires_at` et `updated_at`, `clients`, `authentication_at` et des données liées à `device`, comme `ASN`, `IP` et `User_agent`.
* **api.session**: Vous permet de gérer les sessions existantes en révoquant les sessions ou en modifiant les dates d’expiration `expiry`.

The `event.session` and `api.session` objects both support interactive web-based flows, including [authorization code flow](/docs/get-started/authentication-and-authorization-flow/authorization-code-flow), implicit flow, device code flow, as well as <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=SAML">SAML</Tooltip> and <Tooltip tip="Security Assertion Markup Language (SAML): Standardized protocol allowing two parties to exchange authentication information without a password." cta="View Glossary" href="/docs/glossary?term=WS-Fed">WS-Fed</Tooltip>.

Vous pouvez utiliser l’objet `event.session` pour examiner l’horodatage des dernières interactions et évaluer les risques associés aux transactions en cours. Vous pouvez également combiner l’objet `event.session` avec d’autres objets d’événement, tels que `event.authentication` ou `event.request`.

Vous pouvez ensuite utiliser l’objet `api.session` pour réinitialiser les dates d’expiration de la session existante ou révoquer la session.

Pour en savoir plus sur ces objets, consultez :

* [Event object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/post-login-event-object): Learn about the session Event object and properties.
* [API object](/docs/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/post-login-api-object): Learn about the session API object and methods.

## Révoquer des sessions à l’aide des Actions

The post-login **api.session.revoke(reason, options)** method allows you to react to risks associated with a transaction. This method includes an option to allow you to preserve the <Tooltip tip="Refresh Token: Token used to obtain a renewed Access Token without forcing users to log in again." cta="View Glossary" href="/docs/glossary?term=refresh+tokens">refresh tokens</Tooltip> bound to the revoked transaction.

In addition to revoking the session, the method will also initiate a `session-revoked` [OIDC Back-Channel Logout Initiator](/docs/authenticate/login/logout/back-channel-logout/oidc-back-channel-logout-initiators) to log out users from all applications bound to the current session and log a [session_revoked](/docs/deploy-monitor/logs/log-event-type-codes) event in the tenant logs.

Vous pouvez utiliser cette méthode pour :

* invalider la transaction de la session en cours dans Auth0;
* refuser la transaction en cours;
* Revoke all [refresh tokens](/docs/secure/tokens/refresh-tokens) associated with the existing session with a matching `session_id` value.

  + Il s’agit d’une option personnalisable, vous pouvez choisir de conserver les jetons d’actualisation plutôt que de les révoquer. Cette opération s’exécute de manière asynchrone et devient finalement cohérente.

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

If you want to use the `api.session.revoke(reason,options)` method, ensure that the property event.session.id exists.

Different from `api.access.deny()`, `api.session.revoke()` will deny the current transaction and also revoke the session, therefore first factor authentication will be required again

</Callout>

### Surveiller les événements de révocation du journal

The revoke operation adds the following log event in your [tenant logs](/docs/deploy-monitor/logs):

Un code d’événement `session_revoked` indiquant une session révoquée avec son attribut `session_id` associé.

## Cas d’utilisation des sessions avec Actions

You can modify session [expiry dates](/docs/manage-users/sessions/session-lifetime-limits) with the following post-login methods:

* **api.session.setExpiresAt(absolute)** vous permet de définir une nouvelle date d’expiration de session absolue (Nécessiter la connexion après) pour une session spécifiée.
* **api.session.setIdleExpiresAt(idle)** allows you to set a new inactivity timeout date for a specified session.

Vous pouvez utiliser ces méthodes pour personnaliser dynamiquement les stratégies de durée de vie et d’inactivité de la session en fonction de :

* L’organisation d’un utilisateur
* La connexion Auth0 d’un utilisateur
* L’adhésion ou le profil de groupe d’un utilisateur spécifique
* L’évaluation des risques
* Tout autre critère dynamique disponible lors de l’exécution de l’Action

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

If you want to use the `api.session.setExpiresAt(absolute)` and `api.session.setIdleExpiresAt(idle)` methods, ensure that a property of the event.session object exists, such as `event.session.id`.

The `api.session.setIdleExpiresAt(idle)` method sets the session inactivity timeout for  the current interaction. If the method is not reapplied, subsequent successful interactions will override the inactivity timeout using the session inactivity timeout settings.

</Callout>

## Limites

Les sessions émises avant la publication des méthodes API post-connexion `api.session.setExpiresAt(absolute)` et `api.session.setIdleExpiresAt(idle)` ne contiendront pas la propriété event.session suivante : `last_interacted_at`.

Les sessions émises avant la publication de la méthode API post-connexion `api.session.revoke(reason, options)` ne contiendront pas les propriétés event.session.device suivantes :

* `initial_ip`
* `initial_asn`
* `initial_user_agent`

For security reasons, inactivity and absolute timeouts cannot be set above the session settings defined in the [session lifetime limits](/docs/manage-users/sessions/configure-session-lifetime-settings) for the tenant. If you attempt to set a date above the lifetime limits, the API methods will update up to the lifetime limits and log a warning event (`w`) in the tenant logs.

## Cas d’utilisation : Révoquer une session

You can use [Actions](/docs/customize/actions) to configure risk detections and revoke risky sessions and their associated refresh tokens with the post-login `api.session.revoke(reason, options)` method and the `event.session` object.

### Révoquer une session en raison d’une liaison réseau ASN

You can use the post-login object properties, `event.session.device.initial_asn` and `event.request.asn` to bind session transactions to a specific [autonomous system number (ASN)](https://www.arin.net/resources/guide/asn/) network for their duration and require a re-authentication if the ASN network changes.

```js lines
exports.onExecutePostLogin = async (event, api) => {
  const sessionInitialAsn = event.session?.device?.initial_asn;
  const sessionCurrentAsn = event.request.asn;

  // if there is a session and the ASN changes
  if (
    sessionInitialAsn &&
    sessionCurrentAsn &&
    sessionInitialAsn != sessionCurrentAsn
  ) {
    api.session.revoke( "Invalid network change. Login again from a trusted network" )
  }
};
```

Dans cet exemple, une vérification se produit au début de l’Action pour vérifier si les propriétés `event.session.device.initial_asn` et `event.request.asn` restent dans le même réseau ASN pendant la transaction. Si cette vérification échoue, l’Action appelle  `api.session.revoke()` pour :

* invalider la session;
* refuser la transaction en cours;
* révoquer tous ses jetons d’actualisation associés;
* inviter à la réauthentification.

### Révoquer une session en raison d’une liaison IP

You can use the post-login object properties `event.session.device.initial_ip` and `event.request.ip` to ensure a session transaction stays with the same IP address for its duration. In this scenario, any IP change is considered a risk, and the user will be prompted to re-authenticate.

```js lines
exports.onExecutePostLogin = async (event, api) => {
  const sessionInitialIp = event.session?.device?.initial_ip;
  const sessionCurrentIp = event.request.ip;

  // if there is a session and the IP changes
  if (
    sessionInitialIp &&
    sessionCurrentIp &&
    sessionInitialIp != sessionCurrentIp
  ) {
    api.session.revoke("Invalid IP change")
  }
};
```






Dans cet exemple, une vérification se produit au début de l’Action pour vérifier si les propriétés `event.session.device.initial_ip` et `event.request.ip` conservent la même adresse IP pendant la transaction. Si la vérification échoue, l’Action appelle alors `api.session.revoke()` pour :

* invalider la session;
* refuser la transaction en cours;
* révoquer tous ses jetons d’actualisation associés;
* inviter à la réauthentification.

## Cas d’utilisation : Personnaliser les dates d’expiration d’une session

You can use [Actions](/docs/customize/actions) to customize session idle and absolute expiration dates. Specifically, you can configure the expiry dates for a particular session transaction using the post-login `api.session.setExpiresAt(absolute)` and `api.session.setIdleExpiresAt(idle)` methods and the `event.session` object.

### Personnalisation le délai d’expiration absolu de la session en fonction des connexions

Vous pouvez utiliser les propriétés d’objet post-connexion suivantes pour définir une durée de vie pour la connexion utilisée pour authentifier un utilisateur.

* event.session.created_at
* event.session.expires_at

And using the Auth0 [Management API](https://auth0.com/docs/api/management/v2/connections/patch-connections-by-id) to create a connection metadata , `event.connection.metadata.session_timeout define` a specific connection timeout.

```js lines
exports.onExecutePostLogin = async (event, api) => {
  const created = Date.parse(event.session?.created_at ?? "");

  // desired session lifetime for this connection in milliseconds, configured as connection metadata
  const connection_lifetime = event.connection?.metadata?.session_timeout;

  // if there is a session lifetime defined for the connection, set it
  if (event.session?.id && connection_lifetime) {
    api.session.setExpiresAt(created + Number(connection_lifetime));
  }
};
```






Dans cet exemple, une vérification se produit au début de l’Action pour vérifier s’il y a une valeur `session_timeout` définie dans la connexion actuelle. Dans ce cas, l’Action définit l’expiration de la session comme étant égale à la date de création `created` de la session, plus le paramètre `connection_lifetime`.

### Personnalisation du délai d’inactivité de session en fonction de l’organisation

Vous pouvez définir une variable `current_time` et utiliser une nouvelle métadonnée d’Organization appelée `idle_session_timeout` pour définir le délai d’inactivité souhaité pour une organization.

```js lines
exports.onExecutePostLogin = async (event, api) => {
  // The Organization metadata is configured with a shorter idle timeout for sessions (in milliseconds)
  const idle_organization_lifetime =
    event.organization?.metadata?.idle_session_timeout;

  // If the organization has an specific idle timeout defined, set the timeout
  if (event.session?.id && idle_organization_lifetime) {
    const current_time = new Date().getTime();

    api.session.setIdleExpiresAt(
      current_time + Number(idle_organization_lifetime),
    );
  }
};
```






Dans cet exemple, si un délai d’inactivité spécifique est défini pour l’Organization, l’Action définit le délai d’inactivité de la session comme étant égal à la valeur `current_time` plus la valeur `idle_organization_lifetime`.